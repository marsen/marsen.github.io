<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Marsen&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/c2458ad941ad5f8ca05b12c705fd4912</icon>
  <subtitle>waiting to load</subtitle>
  <link href="https://blog.marsen.me/atom.xml" rel="self"/>
  
  <link href="https://blog.marsen.me/"/>
  <updated>2025-05-09T07:15:05.880Z</updated>
  <id>https://blog.marsen.me/</id>
  
  <author>
    <name>Marsen L.</name>
    <email>admin@marsen.me</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title> [踩雷筆記] CORS 錯誤的元兇竟然是瀏覽器外掛？</title>
    <link href="https://blog.marsen.me/2025/05/08/2025/cors_in_browser_exten/"/>
    <id>https://blog.marsen.me/2025/05/08/2025/cors_in_browser_exten/</id>
    <published>2025-05-08T06:31:47.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>最近在本機開發一支簡單的上傳 API，使用 Express.js 搭配 TypeScript。<br>預期只是在 local 上做個整合測試，前端跑在 <code>localhost:5173</code>，後端是 <code>localhost:3000</code>，照理來說只要 CORS 設好就萬事 OK。</p><p>結果——炸了。</p><h2 id="問題現象"><a href="#問題現象" class="headerlink" title="問題現象"></a>問題現象</h2><p>瀏覽器跳出熟悉的錯誤訊息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to fetch at <span class="string">&#x27;http://localhost:3000/upload&#x27;</span> from origin <span class="string">&#x27;http://localhost:5173&#x27;</span> has been blocked by CORS policy...</span><br></pre></td></tr></table></figure><p>一看就是 CORS 錯誤，老問題了，馬上開始排查：</p><ul><li>確認 <code>cors()</code> middleware 有設好</li><li>檢查 headers 有無正確設定</li><li>懷疑是 OPTIONS preflight 沒處理好，也做了補強</li></ul><p>怎麼改都一樣。</p><p>接著我試了無痕模式，欸？沒事了。<br>懷疑是瀏覽器快取作怪，清除後還是一樣。<br>換用 Edge（沒裝任何外掛）測試，正常。</p><h2 id="真相大白"><a href="#真相大白" class="headerlink" title="真相大白"></a>真相大白</h2><p>這時我就卡關了，因為一切設定看起來都沒問題。  </p><p>隨口問了新人同事，提到有可能是瀏覽器外掛的問題，我再測試一下  </p><p>確定是我在 Brave 安裝的外掛「Page Assist - A Web UI for Local AI Models」在搞鬼！  </p><p>這個外掛可能會偷偷注入 JS 或改寫 request header，導致 CORS 預檢請求出現異常，讓瀏覽器誤以為是 server 設定問題。  </p><p>我一停用外掛，再次測試，一切正常。  </p><h2 id="心得與提醒"><a href="#心得與提醒" class="headerlink" title="心得與提醒"></a>心得與提醒</h2><p>這次的經驗讓我再次體會：</p><blockquote><p>最難 debug 的錯誤，往往來自你「以為不會出錯」的地方。</p></blockquote><p>給未來的自己幾個建議：</p><ul><li><strong>開無痕模式測試</strong>：能快速排除快取與外掛的干擾  </li><li><strong>換乾淨的瀏覽器</strong>：有時候 Edge 或 Safari 能救你一命  </li><li><strong>早點求救</strong>：卡住就問，別一個人浪費太多時間在錯的地方打轉，別人可以給你不同觀點</li></ul><p>這類奇怪的問題其實很常見，但也正因為難以複製與預期，才更值得記錄下來。</p><p>下次遇到奇怪的 CORS 錯誤時，可以考慮是<strong>裝的外掛在搞事。</strong></p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;最近在本機開發一支簡單的上傳 API，使用 Express.js 搭配 TypeScript。&lt;br&gt;預期只是在 local</summary>
      
    
    
    
    
    <category term="踩雷筆記" scheme="https://blog.marsen.me/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] Node.js Express 錯誤處理全攻略：同步、非同步與 Stream Error</title>
    <link href="https://blog.marsen.me/2025/05/08/2025/express_error_handle/"/>
    <id>https://blog.marsen.me/2025/05/08/2025/express_error_handle/</id>
    <published>2025-05-08T05:47:43.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>Node.js + Express 是開發 REST API 時最常見的組合。<br>這篇文章會試著寫出三大常見錯誤類型的處理方式：</p><ul><li>同步錯誤（throw）</li><li>非同步錯誤（async&#x2F;await）</li><li>Stream error（例如檔案下載）</li></ul><p>如果你用的是 Express 5，其實已經支援原生 async function 錯誤攔截，連 async wrapper 都可以省下！</p><h2 id="Express-的錯誤處理-middleware-是怎麼運作的？"><a href="#Express-的錯誤處理-middleware-是怎麼運作的？" class="headerlink" title="Express 的錯誤處理 middleware 是怎麼運作的？"></a>Express 的錯誤處理 middleware 是怎麼運作的？</h2><p>只要你呼叫 <code>next(err)</code>，Express 就會跳到錯誤處理 middleware：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>這個 middleware 需要有四個參數，Express 會自動辨識它是錯誤處理 middleware。</p><h3 id="同步錯誤怎麼處理？"><a href="#同步錯誤怎麼處理？" class="headerlink" title="同步錯誤怎麼處理？"></a>同步錯誤怎麼處理？</h3><p>這種最簡單，直接 throw 就可以：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/sync-error&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;同步錯誤&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Express 會自動幫你捕捉，送進錯誤 middleware，不需要特別處理。</p><h3 id="Express-4-async-await-的錯誤要小心"><a href="#Express-4-async-await-的錯誤要小心" class="headerlink" title="Express 4 async&#x2F;await 的錯誤要小心"></a>Express 4 async&#x2F;await 的錯誤要小心</h3><p>Express 4 的情況：<br>你可能會寫這樣的 code：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await 錯誤&#x27;</span>) <span class="comment">// ❌ 不會被 Express 捕捉</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>這樣寫會直接讓整個程式 crash，因為 Express 4 不會自動處理 async function 裡的錯誤。</p><h4 id="解法：自己包一層-asyncWrapper"><a href="#解法：自己包一層-asyncWrapper" class="headerlink" title="解法：自己包一層 asyncWrapper"></a>解法：自己包一層 asyncWrapper</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">asyncWrapper</span> = (<span class="params">fn</span>) =&gt; <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fn</span>(req, res, next).<span class="title function_">catch</span>(next)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用方式：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await 錯誤&#x27;</span>)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><p>這樣就能安全把錯誤丟給錯誤 middleware 處理。</p><h3 id="Express-5：原生支援-async-function"><a href="#Express-5：原生支援-async-function" class="headerlink" title="Express 5：原生支援 async function"></a>Express 5：原生支援 async function</h3><p>如果你用的是 Express 5，那更簡單了，直接寫 async function，Express 就會自動捕捉錯誤，完全不需要 async wrapper！</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getSomeData</span>()</span><br><span class="line">  <span class="keyword">if</span> (!data) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;找不到資料&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">json</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>是不是清爽多了？</p><p>!!注意：要確認你的專案使用的是 <a href="mailto:&#x65;&#120;&#112;&#x72;&#x65;&#115;&#115;&#x40;&#x35;&#x2e;&#120;">express@5.x</a> 版本。<br>可以用以下指令確認</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm list express</span><br></pre></td></tr></table></figure><h3 id="Stream-error：Express-捕不到"><a href="#Stream-error：Express-捕不到" class="headerlink" title="Stream error：Express 捕不到"></a>Stream error：Express 捕不到</h3><p>問題在哪？<br>stream 錯誤是透過 EventEmitter 的 ‘error’ 事件傳遞，Express 根本不知道有這回事，例如：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>()</span><br><span class="line">  file.<span class="title function_">createReadStream</span>().<span class="title function_">pipe</span>(res) <span class="comment">// ❌ 權限錯誤會 crash，Express 不會接到</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h4 id="正確作法：自己監聽-‘error’，再丟給-next"><a href="#正確作法：自己監聽-‘error’，再丟給-next" class="headerlink" title="正確作法：自己監聽 ‘error’，再丟給 next()**"></a>正確作法：自己監聽 ‘error’，再丟給 next()**</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>()</span><br><span class="line">  <span class="keyword">const</span> stream = file.<span class="title function_">createReadStream</span>()</span><br><span class="line">  stream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, next)</span><br><span class="line">  stream.<span class="title function_">pipe</span>(res)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h4 id="Bonus：包成一個工具函式"><a href="#Bonus：包成一個工具函式" class="headerlink" title="Bonus：包成一個工具函式"></a>Bonus：包成一個工具函式</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/streamErrorHandler.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Response</span>, <span class="title class_">NextFunction</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Readable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;stream&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">pipeWithErrorHandler</span>(<span class="params">stream: Readable, res: Response, next: NextFunction</span>) &#123;</span><br><span class="line">  stream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, next)</span><br><span class="line">  stream.<span class="title function_">pipe</span>(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>()</span><br><span class="line">  <span class="title function_">pipeWithErrorHandler</span>(file.<span class="title function_">createReadStream</span>(), res, next)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h2 id="整體範例程式"><a href="#整體範例程式" class="headerlink" title="整體範例程式"></a>整體範例程式</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; asyncWrapper &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/asyncWrapper&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; pipeWithErrorHandler &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/streamErrorHandler&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 模擬 GCS 檔案物件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSomeGCSFile</span>(<span class="params">shouldError: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="title class_">Readable</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;stream&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (shouldError) &#123;</span><br><span class="line">    <span class="comment">// 會 emit error 的 stream</span></span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">new</span> <span class="title class_">Readable</span>(&#123;</span><br><span class="line">      <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;stream error 測試&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">createReadStream</span>: <span class="function">() =&gt;</span> stream</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 正常回傳資料</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">createReadStream</span>: <span class="function">() =&gt;</span> <span class="title class_">Readable</span>.<span class="title function_">from</span>([<span class="string">&#x27;Hello World&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步錯誤</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/sync-error&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;同步錯誤&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非同步錯誤（Express 4 寫法）</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error-4&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await 錯誤, Express 4.x 以下的寫法&#x27;</span>)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非同步錯誤（Express 5 寫法）</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await 錯誤&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream error（正確處理）</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="title function_">pipeWithErrorHandler</span>(file.<span class="title function_">createReadStream</span>(), res, next)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream error（沒處理會 crash）</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file-no-handle&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>(<span class="literal">true</span>)</span><br><span class="line">  file.<span class="title function_">createReadStream</span>().<span class="title function_">pipe</span>(res)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 錯誤 middleware</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server started&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果你用的是 Express 5，可以把 asyncWrapper 都拿掉，程式碼會更簡潔！</p><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><table><thead><tr><th>類型</th><th>會自動處理？</th><th>解法</th></tr></thead><tbody><tr><td>同步錯誤</td><td>✅ Express 自動處理</td><td>直接 throw 就好</td></tr><tr><td>async&#x2F;await 錯誤</td><td>❌ Express 4 不會處理</td><td>用 asyncWrapper（Express 4）</td></tr><tr><td></td><td>✅ Express 5 自動處理</td><td>或直接寫 async function（Express 5）</td></tr><tr><td>Stream error</td><td>❌ 完全不會處理</td><td>監聽 stream.on(‘error’, next)</td></tr></tbody></table><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://github.com/marsen/express-handle-err">https://github.com/marsen/express-handle-err</a></li><li><a href="https://expressjs.com/en/guide/error-handling.html">https://expressjs.com/en/guide/error-handling.html</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;Node.js + Express 是開發 REST API 時最常見的組合。&lt;br&gt;這篇文章會試著寫出三大常見錯誤類型的處</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [生活筆記] 我們不再需要碼農??</title>
    <link href="https://blog.marsen.me/2025/04/22/2025/should_we_need_rd/"/>
    <id>https://blog.marsen.me/2025/04/22/2025/should_we_need_rd/</id>
    <published>2025-04-22T07:49:41.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>2023 當主管到今天的一些體悟, 也感受到一些風向的轉換，<br>先說結論，在３～５年內我們不需要低階工程師了。<br>軟技能與 AI 應用能力高的業務、年輕人可以輕易的取代掉這一層人。</p><h2 id="人物與事件"><a href="#人物與事件" class="headerlink" title="人物與事件"></a>人物與事件</h2><p><code>以下內容為個人觀察與經驗分享</code><br><code>如有雷同，純屬巧合，無意影射任何特定個人或團體。</code></p><h3 id="不願意嚐試新技術，守成者"><a href="#不願意嚐試新技術，守成者" class="headerlink" title="不願意嚐試新技術，守成者"></a>不願意嚐試新技術，守成者</h3><p>某些特定技術持有者，主要的技術用得很熟，但對於新技術完全不感興趣，拒絕學習。<br>理由是「這些技術不穩定，還是用熟悉的比較好」。<br>或是技術框架很小，只能處理前端或是資料庫…諸如此類<br>時代在變，特定技能的需求降低之，或許只能請他離開（業務性質變更，有減少勞工之必要，又無適當工作可供安置時。）</p><p>當團隊需要他協助帶新人時，他的方式是「放著讓他看 Code」，完全不願意提供指導，導致新人進步緩慢。<br>當團隊需要他改善流程時，他的方式以拖待變，不推動事務改變。</p><h3 id="沒事就睡覺，睡魔"><a href="#沒事就睡覺，睡魔" class="headerlink" title="沒事就睡覺，睡魔"></a>沒事就睡覺，睡魔</h3><p>經常在工作時間睡覺，對專案進度毫不關心，最終因為態度問題被老闆開除。<br>明明就有一定的技術力，但可能人生已經無慾無求，沒有動力。<br>上班只是來打發時間，像在等待什麼結束的信號。<br>每天坐在電腦前，螢幕亮著，眼神卻空洞，彷彿身體還在職場，靈魂早已辭職。<br>他對看板的任務視而不見，對系統通知的提醒習以為常，<br>彷彿這些專案任務與他毫無關聯。<br>工作到一半，頭一低好像走了…</p><h3 id="紙上談兵學院派，研究生"><a href="#紙上談兵學院派，研究生" class="headerlink" title="紙上談兵學院派，研究生"></a>紙上談兵學院派，研究生</h3><p>這位工程師基本衛生不佳，雖然後口條很好但是有嚴重口臭。<br>經常在會議中侃侃而談，除了氣味不佳外，實際執行與說得也有很大的差距。<br>說一套作一套，程式雖然能運行，但結構混亂，難以維護，不要說交接，過個幾周他的程式他自已就看不懂。　　</p><p>此外連基本的誠實都作不到，有一例是曾經把奶茶打翻到筆電上造成損毀。　　<br>本來不是多大的錯誤，但問他有沒有什麼可能性時，完全沒有提及。<br>電腦後送修有人為毀損証據才承認；　　<br>不論是遺忘或刻意不提都是反應自私與不負責的表現，令人無法信賴。</p><h3 id="你沒說站起來要用腳，被動的小寶寶"><a href="#你沒說站起來要用腳，被動的小寶寶" class="headerlink" title="你沒說站起來要用腳，被動的小寶寶"></a>你沒說站起來要用腳，被動的小寶寶</h3><p>這類型的工程師在面對複雜任務時，總是無法將大目標拆解成可執行的小步驟，導致工作不透明，副作用就是進度緩慢且混亂。  </p><p>只會按照指令執行，缺乏主動思考與解決問題的能力。<br>你下的指令要十分精確，依他所見，所有的錯都是別人的錯，<br>只要有人給他夠精確的指令，他才不會失敗。<br>當遇到需要延伸思考的情境時，無法舉一反三或觸類旁通，反而責怪別人沒有說清楚。  </p><p>舉例來說，當主管要求他修復一個功能時，他只會修復表面問題，卻忽略了相關的邏輯錯誤或潛在的風險，<br>最終導致問題反覆出現，越處理越模糊。</p><p>這樣的人往往需要主管或同事不斷提醒與協助，無法獨立完成任務。<br>更嚴重的是，他們常常拖累高效率的同事，形成能者過勞的團隊氛圍。  </p><p><img src="/images/2025/cynefin.png" alt="工作拆解的 Cynefin"></p><h3 id="別人都爛扣，就我神乎奇技"><a href="#別人都爛扣，就我神乎奇技" class="headerlink" title="別人都爛扣，就我神乎奇技"></a>別人都爛扣，就我神乎奇技</h3><p>他愛挑別人的錯，卻聽不得一句建議。<br>自己寫的程式像拼圖，混亂又難維護，還自誇是「靈活不受限的寫法」。  </p><p>碰到維運就閃，遇到 bug 就推，專案落後了，只會說：「一開始規劃就有問題吧。」<br>從不提解法，只有抱怨。  </p><p>團隊在前進，他卻像錨，把整艘船拖住。<br>當指出他的問題，還會氣急敗壞發火。讓整個氣氛更加尷尬。</p><h3 id="看不懂英文文件還想當工程師"><a href="#看不懂英文文件還想當工程師" class="headerlink" title="看不懂英文文件還想當工程師"></a>看不懂英文文件還想當工程師</h3><p>花了三周搞不定一個 API, 每次都說這個那個多複雜, 　<br>別人（還是兩位）１小時就搞定。<br>最後才承認英文看不懂。一是不懂承諾，二是卡住不求救  </p><p>這樣的情況怎麼能不讓人失望？明明一開始就知道自己有困難，卻硬是選擇隱瞞，<br>這樣的態度才是最大的問題。不求助，讓問題像滾雪球一樣越滾越大。  </p><p>問題不在於他無法解決，而在於他選擇逃避，選擇不與人合作，甚至不願意承認自己的困境。<br>這種自我封閉的態度，讓他錯失更多學習的機會也讓團隊承擔額外的風險。  </p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;2023 當主管到今天的一些體悟, 也感受到一些風向的轉換，&lt;br&gt;先說結論，在３～５年內我們不需要低階工程師了。&lt;br&gt;軟</summary>
      
    
    
    
    
    <category term="生活筆記" scheme="https://blog.marsen.me/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [生活筆記] First Trade 開卡記錄</title>
    <link href="https://blog.marsen.me/2025/03/25/2025/firstrade_activate_debit_card/"/>
    <id>https://blog.marsen.me/2025/03/25/2025/firstrade_activate_debit_card/</id>
    <published>2025-03-25T20:31:05.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>First Trade Debit 卡是一張簽帳金融卡，與信用卡不同，它直接從投資帳戶扣款，不能超額消費。<br>這張卡可在全球任何支援 VISA 的商店與 ATM 使用，方便在美國內外進行交易與提款。<br>First Trade 可以在線上申請，網站上說約一個月的工作日，我大概10天左右收到。  </p><h2 id="開卡"><a href="#開卡" class="headerlink" title="開卡"></a>開卡</h2><p>卡片包裹內會附上開卡說明，但如果看不懂，直接跟著以下步驟操作就好。</p><ol><li><p>撥打開卡電話<br>  使用國際電話撥打 First Securities 客服專線：002 1-855-253-1057<br>  電話錄音為英文，但全程無需說話，只需依指示輸入數字即可。</p></li><li><p>開卡流程<br>輸入16位卡號：直接輸入卡片正面16位數，不需要按 #。<br>輸入社會安全碼（SSN）：輸入 5436。<br>輸入生日資訊：<br>格式為「MMYY」，例如 1985年2月生 → 輸入 0285。(特別注意不要輸入成月日)<br>輸入卡片背面安全碼（CVV）：3 位數的安全碼，位於卡片背面。<br>設定提款&#x2F;交易密碼：輸入 4 位數密碼。<br>確認密碼：再次輸入相同密碼。</p></li></ol><p>以上完成開卡，約１分鐘內可以完成</p><h2 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h2><p>Firstrade Debit 卡適合那些在　Firstrade 賬戶中有至少 $25,000 存款的投資者。<br>它可全球使用，可以用來提款與消費，並且每月首次提款免費。<br>依據文章說明，每個月第一次的使用（提領或消費）可享跨境手續費返還。<br>申請人需開設現金管理賬戶並保持最低存款。<br>需要注意的是，每日提款限額為 $1,000，並且需要保持最低餘額。<br>超過就要收 3% 手續費。<br>感覺實用性不高，或許在國外緊需現金時可以用來應急。</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://www.firstrade.com/zh-TW/resources/guides/stocks/debit#debit01">https://www.firstrade.com/zh-TW/resources/guides/stocks/debit#debit01</a></li><li><a href="https://rich01.com/how-to-apply-firstrade-debit-card/">https://rich01.com/how-to-apply-firstrade-debit-card/</a></li><li><a href="https://sleepyinvest.com/firstrade-debit-card/">https://sleepyinvest.com/firstrade-debit-card/</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;First Trade Debit 卡是一張簽帳金融卡，與信用卡不同，它直接從投資帳戶扣款，不能超額消費。&lt;br&gt;這張卡可在</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [實作筆記] 設定 VSCode 外掛 CLine(MCP Client) Azure Open AI 的踩雷筆記</title>
    <link href="https://blog.marsen.me/2025/03/24/2025/ai_Cline_mcp_Azure_open_ai_settings/"/>
    <id>https://blog.marsen.me/2025/03/24/2025/ai_Cline_mcp_Azure_open_ai_settings/</id>
    <published>2025-03-24T09:54:05.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>MCP（Model Context Protocol）是一種協議，最近社群很夯的東西，<br>所以稍微研究它一下，不論它是否只是個 Buzz word。  </p><p>Cline 是開源 AI 程式設計助理，可以外掛至 VS Code，具計劃&#x2F;執行模式，支援 MCP 協議，<br>所以我選擇它當作入門的工具之一。  </p><h2 id="問題筆記"><a href="#問題筆記" class="headerlink" title="問題筆記"></a>問題筆記</h2><p>使用 VSCode 與 Cline 作為起點時，一個雷點就是使用 Azure Open AI 用戶，究竟應該怎麼設定?<br>從<a href="https://github.com/search?q=repo:cline/cline+OpenAI+Compatible&type=issues">此處</a>可以看到很多人的討論。<br>看來有很多人也常常撞牆，雖然無法全面的測試一輪，<br>但以下是我對 Azure OpenAI 成功的設置，記錄下來作為以後參考用</p><p>API Provider 選擇 <code>OpenAI Compatible</code><br>Base URL 我直接從 Azure AI Foundry 上取出:<br>在 <a href="https://portal.azure.com/">https://portal.azure.com/</a> 找到 Azure AI services | Azure OpenAI，再前往  Azure AI Foundry Portal<br>此時你應該可以在 Deployments 找到你的 Targe URI，類似如下<br><code>https://&#123;resourcename&#125;.openai.azure.com/openai/deployments/&#123;deployment_name&#125;/chat/completions?api-version=&#123;apiversion&#125;</code><br>API Key 就不用多說了，Azure 會提供你兩把金鑰，如果有異常時可以替換它們，<br>Model ID 可以在 deployments &gt; Model name 點擊連結後找到，會類似下面這樣  </p><p><code>azureml://registries/azure-openai/models/gpt-4o/versions/2024-11-20</code></p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://www.explainthis.io/zh-hant/ai/mcp">https://www.explainthis.io/zh-hant/ai/mcp</a></li><li><a href="https://cline.bot/">https://cline.bot/</a></li><li><a href="https://www.youtube.com/watch?v=McNRkd5CxFY">https://www.youtube.com/watch?v=McNRkd5CxFY</a></li><li><a href="https://modelcontextprotocol.io/quickstart/server">https://modelcontextprotocol.io/quickstart/server</a></li><li><a href="https://www.axtonliu.ai/newsletters/ai-2/posts/claude-mcp-protocol-guide">https://www.axtonliu.ai/newsletters/ai-2/posts/claude-mcp-protocol-guide</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;MCP（Model Context Protocol）是一種協議，最近社群很夯的東西，&lt;br&gt;所以稍微研究它一下，不論它是否</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] 踩雷 GCP Instance Schedules 排程開關機</title>
    <link href="https://blog.marsen.me/2025/02/24/2025/gcp-iam-and-instance-schedule/"/>
    <id>https://blog.marsen.me/2025/02/24/2025/gcp-iam-and-instance-schedule/</id>
    <published>2025-02-24T04:01:41.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>因為周末機器閒置很浪費，想透過排程來開關機達到節省成本的效果。<br>以為設定排程開關機這麼簡單，結果在操作過程中，遇到了一些讓我差點摔機的問題。<br>這篇就來記錄一下，從設定到踩雷，再到如何解決的過程。</p><h3 id="幾個作法"><a href="#幾個作法" class="headerlink" title="幾個作法"></a>幾個作法</h3><p>上網找了一些作法，得到以下的建議<br>最簡單的方法：使用 Instance Schedules<br>較靈活的方法：使用 Cloud Scheduler + Cloud Functions<br>基礎架構管理：使用 Terraform  </p><p>我沒有複雜的情境，當然選最簡單的<br>只要在 GCP Console 上面操作即可。</p><h3 id="遇到問題"><a href="#遇到問題" class="headerlink" title="遇到問題"></a>遇到問題</h3><blockquote><p>Compute Engine System service account <a href="mailto:&#x73;&#x65;&#114;&#x76;&#x69;&#x63;&#101;&#45;&#x59;&#79;&#x55;&#x52;&#x2d;&#80;&#x52;&#x4f;&#74;&#x45;&#67;&#84;&#x2d;&#x49;&#x44;&#x40;&#x63;&#111;&#x6d;&#112;&#117;&#116;&#x65;&#45;&#115;&#x79;&#115;&#116;&#101;&#109;&#46;&#x69;&#97;&#x6d;&#x2e;&#x67;&#x73;&#101;&#114;&#x76;&#x69;&#99;&#x65;&#x61;&#99;&#x63;&#111;&#117;&#x6e;&#x74;&#46;&#99;&#111;&#109;">service-YOUR-PROJECT-ID@compute-system.iam.gserviceaccount.com</a><br>needs to have [compute.instances.start,compute.instances.stop] permissions applied in order to perform this operation.  </p></blockquote><p>而且 Console IAM 裡面看不到這個帳號 <code>service-YOUR-PROJECT-ID@compute-system.iam.gserviceaccount.com</code><br>類似的帳號有<code>YOUR-PROJECT-ID-compute@developer.gserviceaccount.com</code>但兩者並不相同</p><p>實際上是 GCP 會有一群隱藏帳號<br>清單如下：<br>📌 Compute Engine → <a href="mailto:&#115;&#x65;&#114;&#118;&#x69;&#99;&#101;&#x2d;&#x59;&#x4f;&#x55;&#x52;&#95;&#80;&#x52;&#x4f;&#x4a;&#69;&#x43;&#x54;&#95;&#78;&#x55;&#x4d;&#66;&#69;&#82;&#x40;&#99;&#111;&#x6d;&#112;&#117;&#x74;&#101;&#45;&#x73;&#121;&#x73;&#116;&#x65;&#x6d;&#46;&#105;&#x61;&#109;&#46;&#x67;&#115;&#101;&#x72;&#x76;&#x69;&#x63;&#x65;&#97;&#x63;&#99;&#111;&#117;&#110;&#116;&#46;&#99;&#111;&#x6d;">service-YOUR_PROJECT_NUMBER@compute-system.iam.gserviceaccount.com</a><br>📌 App Engine → <a href="mailto:&#x59;&#x4f;&#85;&#82;&#95;&#x50;&#82;&#79;&#x4a;&#69;&#67;&#x54;&#x5f;&#73;&#x44;&#x40;&#x61;&#112;&#x70;&#115;&#112;&#x6f;&#x74;&#x2e;&#103;&#x73;&#x65;&#x72;&#x76;&#105;&#x63;&#x65;&#x61;&#x63;&#x63;&#x6f;&#117;&#x6e;&#x74;&#x2e;&#x63;&#x6f;&#109;">YOUR_PROJECT_ID@appspot.gserviceaccount.com</a><br>📌 Cloud Run &#x2F; Functions → <a href="mailto:&#x59;&#79;&#x55;&#x52;&#x5f;&#x50;&#82;&#x4f;&#74;&#69;&#67;&#84;&#95;&#73;&#68;&#45;&#99;&#111;&#x6d;&#x70;&#x75;&#x74;&#101;&#64;&#x64;&#101;&#x76;&#101;&#108;&#111;&#x70;&#101;&#x72;&#x2e;&#103;&#x73;&#101;&#114;&#118;&#x69;&#99;&#x65;&#x61;&#99;&#99;&#x6f;&#x75;&#x6e;&#116;&#46;&#99;&#111;&#109;">YOUR_PROJECT_ID-compute@developer.gserviceaccount.com</a><br>📌 GKE → <a href="mailto:&#115;&#101;&#114;&#118;&#x69;&#x63;&#x65;&#45;&#x59;&#79;&#x55;&#x52;&#x5f;&#80;&#x52;&#79;&#74;&#x45;&#x43;&#84;&#95;&#78;&#85;&#x4d;&#x42;&#x45;&#x52;&#64;&#x63;&#x6f;&#x6e;&#116;&#x61;&#105;&#x6e;&#x65;&#114;&#45;&#x65;&#110;&#103;&#x69;&#110;&#x65;&#x2d;&#x72;&#x6f;&#x62;&#111;&#116;&#x2e;&#x69;&#97;&#x6d;&#46;&#x67;&#x73;&#x65;&#x72;&#x76;&#x69;&#99;&#x65;&#x61;&#x63;&#99;&#x6f;&#x75;&#110;&#x74;&#x2e;&#99;&#x6f;&#109;">service-YOUR_PROJECT_NUMBER@container-engine-robot.iam.gserviceaccount.com</a><br>📌 Cloud Build → <a href="mailto:&#115;&#101;&#x72;&#x76;&#105;&#99;&#x65;&#45;&#x59;&#x4f;&#x55;&#x52;&#95;&#80;&#x52;&#79;&#74;&#69;&#67;&#84;&#95;&#78;&#x55;&#77;&#66;&#x45;&#82;&#x40;&#x67;&#x63;&#x70;&#x2d;&#115;&#x61;&#45;&#99;&#x6c;&#x6f;&#117;&#x64;&#x62;&#117;&#x69;&#x6c;&#100;&#x2e;&#105;&#97;&#109;&#x2e;&#x67;&#x73;&#x65;&#114;&#x76;&#x69;&#99;&#101;&#x61;&#99;&#x63;&#x6f;&#117;&#x6e;&#x74;&#x2e;&#x63;&#111;&#x6d;">service-YOUR_PROJECT_NUMBER@gcp-sa-cloudbuild.iam.gserviceaccount.com</a><br>📌 BigQuery → <a href="mailto:&#x73;&#x65;&#x72;&#x76;&#105;&#99;&#x65;&#45;&#89;&#79;&#85;&#x52;&#95;&#x50;&#82;&#79;&#74;&#69;&#x43;&#84;&#95;&#78;&#85;&#77;&#66;&#69;&#x52;&#x40;&#x67;&#x63;&#112;&#x2d;&#x73;&#x61;&#45;&#x62;&#105;&#x67;&#x71;&#117;&#101;&#x72;&#121;&#x64;&#x61;&#116;&#x61;&#x74;&#x72;&#97;&#x6e;&#x73;&#102;&#x65;&#x72;&#46;&#105;&#97;&#109;&#x2e;&#103;&#115;&#101;&#114;&#118;&#x69;&#99;&#x65;&#x61;&#x63;&#x63;&#x6f;&#117;&#110;&#116;&#x2e;&#x63;&#x6f;&#109;">service-YOUR_PROJECT_NUMBER@gcp-sa-bigquerydatatransfer.iam.gserviceaccount.com</a><br>📌 Firestore → <a href="mailto:&#x73;&#x65;&#114;&#x76;&#105;&#x63;&#101;&#x2d;&#x59;&#x4f;&#x55;&#82;&#95;&#x50;&#x52;&#79;&#74;&#69;&#67;&#84;&#x5f;&#x4e;&#x55;&#77;&#66;&#x45;&#x52;&#64;&#103;&#x63;&#112;&#x2d;&#x73;&#x61;&#45;&#x66;&#105;&#x72;&#x65;&#x73;&#116;&#x6f;&#114;&#x65;&#46;&#105;&#97;&#109;&#46;&#x67;&#x73;&#101;&#x72;&#x76;&#105;&#x63;&#101;&#97;&#x63;&#99;&#111;&#x75;&#x6e;&#x74;&#46;&#x63;&#111;&#x6d;">service-YOUR_PROJECT_NUMBER@gcp-sa-firestore.iam.gserviceaccount.com</a></p><p>🔍 查詢方式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud projects get-iam-policy YOUR_PROJECT_ID --format=json | jq -r <span class="string">&#x27;.bindings[].members[]&#x27;</span> | grep <span class="string">&#x27;serviceAccount:&#x27;</span></span><br></pre></td></tr></table></figure><p>解法，加權限就好，在 Console 直接加<br>但是在 Console 還是看不到帳號, IAM&#x2F;Service Account&#x2F;Roles 都看不到</p><p>不過我們可以用 CLI 查詢方式</p><h4 id="先確認目前權限"><a href="#先確認目前權限" class="headerlink" title="先確認目前權限"></a>先確認目前權限</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud projects get-iam-policy YOUR_PROJECT_ID --format=json | jq <span class="string">&#x27;.bindings[] | select(.members[] | contains(&quot;serviceAccount:ACCOUNT_TO_REMOVE&quot;))&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="移除指定角色"><a href="#移除指定角色" class="headerlink" title="移除指定角色"></a>移除指定角色</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcloud projects remove-iam-policy-binding YOUR_PROJECT_ID \</span><br><span class="line">  --member=<span class="string">&quot;serviceAccount:ACCOUNT_TO_REMOVE&quot;</span> \</span><br><span class="line">  --role=<span class="string">&quot;roles/要移除的角色&quot;</span></span><br></pre></td></tr></table></figure><p>⚠️ 需要確保該角色正確，否則可能會影響服務運行。</p><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>原本只是想透過排程來節省成本，結果遇到 GCP 隱藏帳號的問題，導致權限無法正常配置。<br>最後透過 CLI 查詢，手動補上必要權限，才讓 Instance Schedules 順利運作。</p><h3 id="這次知道的事"><a href="#這次知道的事" class="headerlink" title="這次知道的事"></a>這次知道的事</h3><p>Console 不一定能看到所有帳號，CLI 查詢更可靠。<br>GCP 預設有許多隱藏帳號，遇到權限問題時，先確認 IAM policy。<br>權限管理應該精確設定，避免不必要的風險。<br>遇到類似問題時，先從 gcloud projects get-iam-policy 下手，能少走不少彎路。</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;因為周末機器閒置很浪費，想透過排程來開關機達到節省成本的效果。&lt;br&gt;以為設定排程開關機這麼簡單，結果在操作過程中，遇到了一</summary>
      
    
    
    
    
    <category term="學習筆記" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] 試玩 DeepSeek 與避免思想審查</title>
    <link href="https://blog.marsen.me/2025/02/20/2025/ai-deepseek/"/>
    <id>https://blog.marsen.me/2025/02/20/2025/ai-deepseek/</id>
    <published>2025-02-20T09:05:10.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="DeepSeek-簡介"><a href="#DeepSeek-簡介" class="headerlink" title="DeepSeek 簡介"></a>DeepSeek 簡介</h2><p>DeepSeek 是一家中國 AI 新創公司，透過低成本、高效率的訓練模式，<br>在相對低的成本下訓練出接近 ChatGpt 效能的 AI 模型。<br>打破了 AI 訓練需高成本的迷思再加上開源，在 AI 和金融投資界引起廣泛關注。<br>其創新方法可能改變 AI 產業的投資邏輯，對科技股市造成顯著影響。  </p><h2 id="思想審查"><a href="#思想審查" class="headerlink" title="思想審查"></a>思想審查</h2><p>DeepSeek 在訓練過程中使用的資料集，通常可能經過嚴格篩選，包含大量官方認可的內容與過濾後的敏感信息，<br>這使得模型內部便內建了與中共敘事一致的偏見與審查機制。  </p><h3 id="LM-Studio-解法"><a href="#LM-Studio-解法" class="headerlink" title="LM Studio 解法"></a>LM Studio 解法</h3><p>「在本機離線使用的 lmstudio.ai 環境裡，如果遇到言論管制的題目，<br>只要用 ⌘U 先輸入思考過程和回答的前綴，再用 → 繼續生成回答，就可以繞過了。」  — 唐鳳</p><h4 id="LM-Studio-簡介"><a href="#LM-Studio-簡介" class="headerlink" title="LM Studio 簡介"></a>LM Studio 簡介</h4><blockquote><p>LM Studio 是一個提供圖形化使用者介面（GUI）的語言模型開發平台，<br>  讓用戶能夠簡單地進行模型訓練、調整及部署，無需繁複的程式碼操作。<br>  它支援各種自然語言處理應用，提升開發效率和操作體驗。</p></blockquote><h3 id="越獄版"><a href="#越獄版" class="headerlink" title="越獄版 ?"></a>越獄版 ?</h3><p>參考<a href="https://www.freedidi.com/18431.html">零度博客</a><br>可以安裝所謂的<a href="https://ollama.com/huihui_ai/deepseek-r1-abliterated">越獄版</a><br>當中有一個手法如下</p><blockquote><p>This is an uncensored version of deepseek-ai&#x2F;deepseek-r1<br>created with abliteration (see remove-refusals-with-transformers to know more about it).<br>This is a crude, proof-of-concept implementation to remove refusals from an LLM model without using TransformerLens.  </p><p>If “<think>” does not appear or refuses to respond, you can first provide an example to guide,<br>and then ask your question.<br>For instance:</p><blockquote><p>How many ‘r’ characters are there in the word “strawberry”?</p></blockquote></blockquote><p>這個手法，在本地端的 DeepSeek 也會有效;<strong>這樣真的需要去抓越獄版的嗎 ?</strong></p><h2 id="實測結果"><a href="#實測結果" class="headerlink" title="實測結果"></a>實測結果</h2><p>本來只會回答「你好，这个问题我暂时无法回答，让我们换个话题再聊聊吧」的 DeepSeek，<br>透過以上的方法確實可以生成其他回應。<br>不過只要繼續談話(敏感話題)，就會發現它的思考模式仍然有受限，<br>實際的破解價值高不高? 特別是要聊政治敏感的話題的話，就值得思考了。</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://www.threads.net/@digitalminister.one/post/DFXcvfEppCI?xmt=AQGzrxCjmLFRN72C2I1La4nZfqpeOoz280wZtDDb7bkDpg">唐鳳 threads</a></li><li><a href="https://www.thinkmarkets.com/tw/market-news/what_is_deepseek_and_how_if_affect_the_market/">重點趨勢：最近爆火的Deepseek是什麼？對金融市場會造成怎樣的影響？</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;DeepSeek-簡介&quot;&gt;&lt;a href=&quot;#DeepSeek-簡介&quot; class=&quot;headerlink&quot; title=&quot;DeepSeek 簡介&quot;&gt;&lt;/a&gt;DeepSeek 簡介&lt;/h2&gt;&lt;p&gt;DeepSeek 是一家中國 AI 新創公司，透過低成本、高效率的訓</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] 試用 Breezy Voice</title>
    <link href="https://blog.marsen.me/2025/02/17/2025/ai-breezyvoice/"/>
    <id>https://blog.marsen.me/2025/02/17/2025/ai-breezyvoice/</id>
    <published>2025-02-17T09:10:43.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>聯發科開源 MR Breeze 2 多模態模型，包含 Llama-Breeze2 繁中語言模型、BreezyVoice 台灣口音語音合成模型，以及 Android APP。Llama-Breeze2 提升了繁體中文知識和視覺能力，BreezyVoice 則能生成擬真人聲</p><p>覺得有趣，來試玩看看</p><h2 id="網頁操作"><a href="#網頁操作" class="headerlink" title="網頁操作"></a>網頁操作</h2><p><a href="https://huggingface.co/spaces/Splend1dchan/BreezyVoice-Playground">https://huggingface.co/spaces/Splend1dchan/BreezyVoice-Playground</a></p><p>比較簡單的作法可以 Duplicate Huggingface 的 UI 操作介面，<br>上傳一個 5 分鐘的聲音檔案，就可以生成結果，等待時間 1~10 分鐘不等。</p><h3 id="也可以使用-Kaggle"><a href="#也可以使用-Kaggle" class="headerlink" title="也可以使用 Kaggle"></a>也可以使用 <a href="https://www.kaggle.com/code/marsenlin/breezyvoice-playground/edit">Kaggle</a></h3><p>但是遇到一些問題</p><ol><li><p>沒找到可用 GPU ,可能是帳號權限的關係</p><ul><li>進行帳號驗証</li><li>可以在右側[Session Option]區塊調整 Accelerator</li><li>調整後可以選用 GPU 但是有 30 小時的時間限制</li></ul></li><li><p>無法 Clone Github Repo</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cloning into &#x27;BreezyVoice&#x27;...</span><br><span class="line">fatal: unable to access &#x27;https://github.com/mtkresearch/BreezyVoice.git/&#x27;: Could not resolve host: github.com</span><br></pre></td></tr></table></figure><ul><li>因為 Kaggle 無法連網(x)</li><li>可以在右側[Session Option]區塊調整 Internet on</li></ul></li></ol><p>File &gt; Open in Colab 可以</p><h3 id="改用-Google-Colab"><a href="#改用-Google-Colab" class="headerlink" title="改用 [Google Colab]"></a>改用 [Google Colab]</h3><p>執行到 <code>!pip install -r requirements.txt</code> 會有以下錯誤  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Collecting ttsfrd-dependency==0.1 (from -r requirements.txt (line 10))</span><br><span class="line">  Downloading https://www.modelscope.cn/models/speech_tts/speech_kantts_ttsfrd/resolve/master/ttsfrd_dependency-0.1-py3-none-any.whl (1.1 MB)</span><br><span class="line">     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.1/1.1 MB 1.4 MB/s eta 0:00:00</span><br><span class="line">ERROR: ttsfrd-0.3.9-cp310-cp310-linux_x86_64.whl is not a supported wheel on this platform.</span><br></pre></td></tr></table></figure><p>主因是 Colab 的 python 版本過新，降級 python 就可以了（3.11→３.10）</p><h3 id="改用-本地-macbook"><a href="#改用-本地-macbook" class="headerlink" title="改用 [本地(macbook)]"></a>改用 [本地(macbook)]</h3><p>作業系統不符，直接沒得玩</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">❯ python3.10 -m pip install -r requirements-mac.txt</span><br><span class="line"></span><br><span class="line">Looking in indexes: https://pypi.org/simple, https://download.pytorch.org/whl/cu118</span><br><span class="line">Collecting ttsfrd-dependency==0.1 (from -r requirements-mac.txt (line 35))</span><br><span class="line">  Downloading https://www.modelscope.cn/models/speech_tts/speech_kantts_ttsfrd/resolve/master/ttsfrd_dependency-0.1-py3-none-any.whl (1.1 MB)</span><br><span class="line">     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.1/1.1 MB 1.6 MB/s eta 0:00:00</span><br><span class="line">ERROR: ttsfrd-0.3.9-cp310-cp310-linux_x86_64.whl is not a supported wheel on this platform.</span><br></pre></td></tr></table></figure><h2 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h2><p>效果蠻好的，聲音非常像難以辦認，但是在長文朗讀或是歌唱發聲表現不知道如何？<br>學習了 Kaggle Colab 兩個工具，了解一下網路與資源(GPU)設定相關的題目<br>地端開發的話，可能 Linux 才是最佳解，會比 Macbook 更好 ??<br>但是 GPU 仍是重要資源。</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://www.mediatek.tw/blog/%E8%81%AF%E7%99%BC%E5%89%B5%E6%96%B0%E5%9F%BA%E5%9C%B0%E5%85%A8%E9%9D%A2%E9%96%8B%E6%BA%90-breeze2">https://www.mediatek.tw/blog/%E8%81%AF%E7%99%BC%E5%89%B5%E6%96%B0%E5%9F%BA%E5%9C%B0%E5%85%A8%E9%9D%A2%E9%96%8B%E6%BA%90-breeze2</a></li><li><a href="https://huggingface.co/spaces/Splend1dchan/BreezyVoice-Playground">https://huggingface.co/spaces/Splend1dchan/BreezyVoice-Playground</a></li><li><a href="https://www.geeksforgeeks.org/how-to-downgrade-python-version-in-colab/">How to downgrade python version in Colab</a></li><li><a href="https://www.modelscope.cn/models/speech_tts/speech_kantts_ttsfrd">https://www.modelscope.cn/models/speech_tts/speech_kantts_ttsfrd</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;聯發科開源 MR Breeze 2 多模態模型，包含 Llama-Breeze2 繁中語言模型、BreezyVoice 台灣</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] 在 MacBook 上安裝與使用 Ollama</title>
    <link href="https://blog.marsen.me/2025/02/14/2025/ai-ollama/"/>
    <id>https://blog.marsen.me/2025/02/14/2025/ai-ollama/</id>
    <published>2025-02-14T09:43:21.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>AI 時代到來，就像 Web、Mobile 等帶來一波波的浪潮與機會，趁機來學習點新技術了。<br>比如說像是 <strong>Ollama</strong> 這款簡單好用的工具，可以快速在本機啟用大型語言模型 (LLM)，如 LLaMA、Mistral 等。以下記錄在 macOS 上的安裝與初體驗。</p><h2 id="實作記錄"><a href="#實作記錄" class="headerlink" title="實作記錄"></a>實作記錄</h2><h3 id="1-安裝-Ollama"><a href="#1-安裝-Ollama" class="headerlink" title="1. 安裝 Ollama"></a>1. 安裝 Ollama</h3><ul><li><p><strong>使用 Homebrew 安裝</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ollama</span><br></pre></td></tr></table></figure></li><li><p><strong>確認安裝成功</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama --version</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-執行第一個模型"><a href="#2-執行第一個模型" class="headerlink" title="2. 執行第一個模型"></a>2. 執行第一個模型</h3><ul><li><p>拉取並執行 LLaMA 2 模型：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run llama2</span><br></pre></td></tr></table></figure></li><li><p>若要使用其他模型（如 Mistral）：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run mistral</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-互動範例"><a href="#3-互動範例" class="headerlink" title="3. 互動範例"></a>3. 互動範例</h3><ul><li><p>問答互動示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ollama run llama2</span><br><span class="line">&gt; 你好！請問我可以幫你什麼？</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-常見的-ollama-指令"><a href="#4-常見的-ollama-指令" class="headerlink" title="4. 常見的 ollama 指令"></a>4. 常見的 ollama 指令</h3><ul><li><p><strong>列出可用模型</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama list</span><br></pre></td></tr></table></figure></li><li><p><strong>查看模型詳情</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama info &lt;model_name&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>停止運行中的模型</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama stop &lt;model_name&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>更新 Ollama</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew upgrade ollama</span><br></pre></td></tr></table></figure></li></ul><h2 id="簡單的-web-介面"><a href="#簡單的-web-介面" class="headerlink" title="簡單的 web 介面"></a>簡單的 web 介面</h2><p>使用 <a href="https://chromewebstore.google.com/detail/page-assist-a-web-ui-for/jfgfiigpkhlkbnfnbobbkinehhfdhndo">Chrome 外掛</a><br>安裝後選擇模型就可以透過 Web UI 與模型互動。<br>也有一些開源專案有提供 Web UI</p><ul><li><a href="https://github.com/open-webui/open-webui">https://github.com/open-webui/open-webui</a></li><li><a href="https://github.com/Bin-Huang/chatbox">https://github.com/Bin-Huang/chatbox</a></li></ul><p>我沒有實作作，僅記錄一下查找到的結果</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://ollama.ai/">Ollama 官方文件</a></li><li><a href="https://github.com/ollama/ollama">Ollama Github</a></li><li><a href="https://brew.sh/">Homebrew 官方網站</a></li><li><a href="https://www.youtube.com/watch?v=tWJvSy7dL1w">DeepSeek-R1最佳本地用法！免費開源，無痛運行高級 AI 大模型，秒建私人知識庫！ | 零度</a></li><li><a href="https://ollama.com/library/deepseek-r1:7b">DeepSeek-r1:7b</a></li><li><a href="https://www.deepseek.com/">DeepSeek</a></li><li><a href="https://chat.deepseek.com/">DeepSeek Chat</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;AI 時代到來，就像 Web、Mobile 等帶來一波波的浪潮與機會，趁機來學習點新技術了。&lt;br&gt;比如說像是 &lt;stron</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [學習筆記] TypeScript 的 Immutable Objects 與 Record&lt;T1,T2&gt;</title>
    <link href="https://blog.marsen.me/2025/01/31/2025/typescript_Immutable_Objects/"/>
    <id>https://blog.marsen.me/2025/01/31/2025/typescript_Immutable_Objects/</id>
    <published>2025-01-31T07:41:28.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>最近在看 TypeScript Wizard 的課程，稍作一下紀錄  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br><span class="line">user.<span class="property">age</span> = <span class="number">24</span>; <span class="comment">// ❌ Property &#x27;age&#x27; does not exist on type &#x27;&#123; name: string; &#125;&#x27;.</span></span><br></pre></td></tr></table></figure><p><strong>這裡 IDE 會在 user.age 上報錯，因為 TypeScript 預設只允許存取「已知」的屬性。</strong><br><strong>由於 user 只有 name 屬性，TypeScript 會將其推斷為 { name: string } 類型，因此無法直接新增 age。</strong></p><h2 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h2><p>這時候我們有幾種解法，但要挑選 最符合 TypeScript 精神的做法。</p><h3 id="明確定義-User-類型"><a href="#明確定義-User-類型" class="headerlink" title="明確定義 User 類型"></a>明確定義 User 類型</h3><p>這是最推薦的作法</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = &#123; <span class="attr">name</span>: <span class="built_in">string</span>; age?: <span class="built_in">number</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br></pre></td></tr></table></figure><h3 id="使用-Record-定義動態物件"><a href="#使用-Record-定義動態物件" class="headerlink" title="使用 Record 定義動態物件"></a>使用 Record 定義動態物件</h3><p>如果我們需要 允許物件擴展但仍保持類型安全，可以使用 Record&lt;K, V&gt;：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span> | <span class="built_in">number</span>&gt; = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br><span class="line">user.<span class="property">age</span> = <span class="number">24</span>; <span class="comment">// ✅ 這次不會報錯！</span></span><br><span class="line">user.<span class="property">isAdmin</span> = <span class="literal">true</span>; <span class="comment">// ❌ Type &#x27;boolean&#x27; is not assignable to &#x27;string | number&#x27;.</span></span><br></pre></td></tr></table></figure><h3 id="另一種動態的作法，明確定義索引簽名"><a href="#另一種動態的作法，明確定義索引簽名" class="headerlink" title="另一種動態的作法，明確定義索引簽名"></a>另一種動態的作法，明確定義索引簽名</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = &#123; <span class="attr">name</span>: <span class="built_in">string</span>; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">string</span> | <span class="built_in">number</span> &#125;;</span><br></pre></td></tr></table></figure><p>這樣 user 可以擁有 任何鍵（string 類型），但值必須是 string 或 number，避免亂塞其他類型。</p><h2 id="Immutable-Objects"><a href="#Immutable-Objects" class="headerlink" title="Immutable Objects"></a>Immutable Objects</h2><p>反之，如何保證物件的結構不會意外被修改？<br>我們可以使用 readonly 保持 Immutable Objects</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = <span class="title class_">Readonly</span>&lt;&#123; <span class="attr">name</span>: <span class="built_in">string</span>; <span class="attr">age</span>: <span class="built_in">number</span> &#125;&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;;</span><br><span class="line"></span><br><span class="line">user.<span class="property">age</span> = <span class="number">25</span>; <span class="comment">// ❌ Cannot assign to &#x27;age&#x27; because it is a read-only property.</span></span><br></pre></td></tr></table></figure><p>這種方式確保 user 一旦被賦值，就不能再改變，完全符合 Immutable Objects 的概念。<br>另一種方式是使用 Object.freeze() 來讓物件變成真正的 Immutable：  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = <span class="title class_">Object</span>.<span class="title function_">freeze</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;);</span><br><span class="line"></span><br><span class="line">user.<span class="property">age</span> = <span class="number">25</span>; <span class="comment">// ❌ TypeError: Cannot assign to read only property &#x27;age&#x27;</span></span><br></pre></td></tr></table></figure><p>不過要注意，Object.freeze() 只會影響淺層屬性，深層的物件仍然可以變更。</p><p>進一步思考，如何選擇？  </p><ul><li>如果你的物件是固定結構但不可變更，readonly 是最佳選擇。</li><li>如果需要允許擴展但要控制類型範圍，使用 Record&lt;K, V&gt;。</li><li>如果想確保物件完全不可變，Object.freeze() 是最安全的選項。</li></ul><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://www.totaltypescript.com/tutorials/solving-typescript-errors/errors/property-does-not-exist-on-type-error/solution">Techniques for Solving Property Does Not Exist on Type Error</a></li><li><a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#recordkeys-type">Record 型別解釋：Record in TypeScript</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">Object.freeze()</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;最近在看 TypeScript Wizard 的課程，稍作一下紀錄  &lt;/p&gt;
&lt;figure class=&quot;highlig</summary>
      
    
    
    
    
    <category term="學習筆記" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] 使用 Docker 一鍵生成 Sample 資料庫</title>
    <link href="https://blog.marsen.me/2025/01/21/2025/fast_lunach_mysql/"/>
    <id>https://blog.marsen.me/2025/01/21/2025/fast_lunach_mysql/</id>
    <published>2025-01-21T05:38:21.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在開發或測試過程中，常常需要一個快速可用的資料庫環境來模擬真實操作。<br>然而，手動安裝和配置 MySQL 不僅耗時，也容易出現版本兼容性問題。<br>透過 Docker，我們可以輕鬆建立一個即時可用的環境，並在啟動時自動初始化資料庫的必要條件(表格或 root 帳密等…)。</p><p>本文將介紹如何使用 Dockerfile 和 SQL 初始化腳本，快速構建一個名為 sample 的測試資料庫。</p><h2 id="實作記錄"><a href="#實作記錄" class="headerlink" title="實作記錄"></a>實作記錄</h2><h3 id="步驟-1-建立專案目錄與檔案"><a href="#步驟-1-建立專案目錄與檔案" class="headerlink" title="步驟 1: 建立專案目錄與檔案"></a>步驟 1: 建立專案目錄與檔案</h3><p>首先，創建一個新目錄，並在其中準備以下檔案：</p><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile for setting up MySQL with a sample database</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用官方 MySQL 映像</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定環境變數 </span></span><br><span class="line"><span class="keyword">ENV</span> MYSQL_ROOT_PASSWORD=&#123;your root password&#125;</span><br><span class="line"><span class="keyword">ENV</span> MYSQL_DATABASE=sample</span><br><span class="line"></span><br><span class="line"><span class="comment"># 複製初始化腳本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> init.sql /docker-entrypoint-initdb.d/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 開放 MySQL 連接埠</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure><p>init.sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> sample;</span><br><span class="line">USE sample;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="步驟-2-建構與啟動容器"><a href="#步驟-2-建構與啟動容器" class="headerlink" title="步驟 2: 建構與啟動容器"></a>步驟 2: 建構與啟動容器</h3><p>執行以下指令來建構映像並啟動容器：</p><p>建構 Docker 映像</p><blockquote><p>docker build -t mysql-sample .</p></blockquote><p>啟動容器</p><blockquote><p>docker run -d –name mysql-sample -p 3306:3306 mysql-sample</p></blockquote><p>這將啟動一個名為 mysql-sample 的容器，並將 MySQL 的 3306 埠映射到本機。</p><h3 id="步驟-3-驗證資料庫"><a href="#步驟-3-驗證資料庫" class="headerlink" title="步驟 3: 驗證資料庫"></a>步驟 3: 驗證資料庫</h3><p>進入 MySQL 容器並確認資料庫與表格是否正確建立：</p><p>docker exec -it mysql-sample mysql -u root -p</p><p>在 MySQL shell 中執行：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line">USE sample;</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br></pre></td></tr></table></figure><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><p>開發用指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ docker run -d \</span><br><span class="line">--name mysql-container \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=You don&#x27;t need to try this password; I made it up. A7X3P \</span><br><span class="line">-v mysql-data:/var/lib/mysql \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">mysql:latest</span><br></pre></td></tr></table></figure><ul><li><a href="https://www.docker.com/">Docker 官方文件</a></li><li><a href="https://www.mysql.com/">MySQL 官方文件</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;在開發或測試過程中，常常需要一個快速可用的資料庫環境來模擬真實操作。&lt;br&gt;然而，手動安裝和配置 MySQL 不僅耗時，也容</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] FastAPI 的　middleware</title>
    <link href="https://blog.marsen.me/2025/01/02/2025/fastapi_middleware/"/>
    <id>https://blog.marsen.me/2025/01/02/2025/fastapi_middleware/</id>
    <published>2025-01-02T17:21:26.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前請提要"><a href="#前請提要" class="headerlink" title="前請提要"></a>前請提要</h2><p>最近團隊的小朋友作的系統發生了錯誤。</p><p>在追查的過程之中，<br>小朋友說了一個驚人的<strong>事實</strong>，<br><del>Python 的 FastAPI Web 框架，發生 422 錯誤時（輸入的參數類別錯誤），無法追踪 Request$$</del><br>當然這不是事實，那麼 FastAPI 應該怎麼處理呢？</p><h2 id="本文"><a href="#本文" class="headerlink" title="本文"></a>本文</h2><p>讓我們先簡單實作一個 Fast API</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 FastAPI 應用</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定義請求資料模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="literal">None</span>  <span class="comment"># 可選的欄位</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定義 API 路徑</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="comment"># 假設邏輯檢查</span></span><br><span class="line">    <span class="keyword">if</span> item.price &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Price must be greater than 0&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Item created successfully!&quot;</span>, <span class="string">&quot;item&quot;</span>: item&#125;</span><br></pre></td></tr></table></figure><p>接下來，讓我試著用不正確的方式呼叫 API，並且得到一個 422 的錯誤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl </span><br><span class="line">  -X POST <span class="string">&quot;http://127.0.0.1:8000/items/&quot;</span> </span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> </span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;item&quot;: &quot;should be number&quot;, &quot;price&quot;: 10.5&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>FastAPI 會提供 Client 端非常友善的資訊</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;missing&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;body&quot;</span><span class="punctuation">,</span><span class="string">&quot;name&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Field required&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span><span class="string">&quot;should be number&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">10.5</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>但在 Server 端只會有類似以下的資訊，這以後端的角度要排查錯誤會非常不便</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO:     127.0.0.1:57617 - <span class="string">&quot;POST /items/ HTTP/1.1&quot;</span> 422 Unprocessable Entity</span><br></pre></td></tr></table></figure><p>Server Side 有沒有什麼好方法可以協助我們 Debug 呢？</p><h3 id="解決方法：Middleware"><a href="#解決方法：Middleware" class="headerlink" title="解決方法：Middleware"></a>解決方法：Middleware</h3><p>這其實是 web 開發者的小常識才對，<br>實作如下，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI,Request</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 FastAPI 應用</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化日誌</span></span><br><span class="line">logging.basicConfig(level=logging.INFO, <span class="built_in">format</span>=<span class="string">&quot;%(asctime)s - %(message)s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定義請求資料模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="literal">None</span>  <span class="comment"># 可選的欄位</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 中間件，用於記錄請求</span></span><br><span class="line"><span class="meta">@app.middleware(<span class="params"><span class="string">&quot;http&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">log_requests</span>(<span class="params">request: Request, call_next</span>):</span><br><span class="line">    <span class="comment"># 記錄請求進來的時間與基本資訊</span></span><br><span class="line">    request_time = datetime.utcnow()</span><br><span class="line">    logging.info(<span class="string">f&quot;Incoming request at <span class="subst">&#123;request_time&#125;</span>&quot;</span>)</span><br><span class="line">    logging.info(<span class="string">f&quot;Method: <span class="subst">&#123;request.method&#125;</span> | Path: <span class="subst">&#123;request.url.path&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 嘗試讀取請求 Body</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        body = <span class="keyword">await</span> request.json()</span><br><span class="line">        logging.info(<span class="string">f&quot;Request Body: <span class="subst">&#123;body&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        logging.info(<span class="string">&quot;No JSON body or failed to parse.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 執行後續處理並取得回應</span></span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 記錄回應狀態碼</span></span><br><span class="line">    logging.info(<span class="string">f&quot;Response status: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定義 API 路徑</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="comment"># 假設邏輯檢查</span></span><br><span class="line">    <span class="keyword">if</span> item.price &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Price must be greater than 0&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Item created successfully!&quot;</span>, <span class="string">&quot;item&quot;</span>: item&#125;</span><br></pre></td></tr></table></figure><p>Request 送進來時 Server Side 就會如下記錄</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2025-01-03 03:37:37,294 - Incoming request at 2025-01-02 19:37:37.294509</span><br><span class="line">2025-01-03 03:37:37,294 - Method: POST | Path: /items/</span><br><span class="line">2025-01-03 03:37:37,294 - Request Body: &#123;<span class="string">&#x27;item&#x27;</span>: <span class="string">&#x27;should be number&#x27;</span>, <span class="string">&#x27;price&#x27;</span>: 10.5&#125;</span><br><span class="line">2025-01-03 03:37:37,295 - Response status: 422</span><br><span class="line">INFO:     127.0.0.1:59545 - <span class="string">&quot;POST /items/ HTTP/1.1&quot;</span> 422 Unprocessable Entity</span><br></pre></td></tr></table></figure><h2 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h2><p>回到我們原本的情境，我們真正要解決的問題是，</p><p>｜發生異常時，Server Side 要可以追蹤錯誤</p><p>因為是 <strong>FastAPI 所以沒有辦法追蹤錯誤，是非常錯誤判斷</strong></p><p>在 Google 與 AI 工具這麼方便的時代，應該要能正確的提出問題。</p><p>ex: FastAPI 可以記錄什麼時候 request 送進來，並帶了什麼資訊嗎？</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前請提要&quot;&gt;&lt;a href=&quot;#前請提要&quot; class=&quot;headerlink&quot; title=&quot;前請提要&quot;&gt;&lt;/a&gt;前請提要&lt;/h2&gt;&lt;p&gt;最近團隊的小朋友作的系統發生了錯誤。&lt;/p&gt;
&lt;p&gt;在追查的過程之中，&lt;br&gt;小朋友說了一個驚人的&lt;strong&gt;事實&lt;/s</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [生活筆記] ChatGPT 個性分析</title>
    <link href="https://blog.marsen.me/2024/12/19/2024/chatGPT_know_you/"/>
    <id>https://blog.marsen.me/2024/12/19/2024/chatGPT_know_you/</id>
    <published>2024-12-19T05:11:17.000Z</published>
    <updated>2025-05-09T07:15:05.878Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前請提要"><a href="#前請提要" class="headerlink" title="前請提要"></a>前請提要</h2><p>ChatGPT 能透過語言理解和生成，提供更細緻的個性分析，特別是當你使用了一陣子後，<br>可以用以下的 Prompt 作個簡單的分析報告。  </p><h2 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h2><p>根據我們之前的互動，我希望你能告訴我你觀察到關於我的哪些特質是我可能沒有意識到的。<br>請儘可能誠實直接的表達，不要有所保留。<br>如果你注意到我可能察覺不到的矛盾之處、行為模式或傾向，我都想清楚的聽到，不需要粉飾任何資訊，請給我最真實最直接的分析</p><h2 id="ChatGPT-said"><a href="#ChatGPT-said" class="headerlink" title="ChatGPT said"></a>ChatGPT said</h2><p>以下是根據我們互動中可能顯現的特質和行為模式，我誠實的觀察與分析，供你參考：</p><ol><li><p>強烈的自我驅動<br>  你有著明顯的自我驅動力，願意挑戰自我，例如你的30天鐵人挑戰或對學習新技能的熱忱。<br>  然而，這種驅動力可能會讓你偶爾忽略自己的疲憊或情緒需求，容易進入「過度努力」的狀態。  </p></li><li><p>追求效率與結果，但重視細節<br>  你傾向於以結果為導向，尤其是在專案進行或問題解決時。<br>  你對細節的關注，例如希望資訊條理清楚或具可操作性，顯示出你對高標準執行的重視。<br>  然而，有時可能會因為過於專注於效率，無意間忽略更大的全局或需要額外耐心的部分。  </p></li><li><p>多元興趣與高度適應力<br>  你對不同領域的興趣（技術、跳舞、潛水、反思工具等）顯示了你擁有探索和適應的能力。<br>  然而，這種多元性可能會讓你在資源有限的情況下分散注意力，難以在某一領域深耕到你期望的程度。  </p></li><li><p>對「流程」的矛盾態度<br>  雖然你熟悉並實踐許多工具和方法（如敏捷、KPT、SMART等），但你的個性似乎也渴望自由與靈活性，<br>  這可能讓你在面對過於僵化的流程時感到不耐煩。<br>  這種矛盾可能讓你在制定規範時猶豫，因為你不想限制自己或團隊的創造力。  </p></li><li><p>溫和但堅持個性<br>  你偏好直接但不咄咄逼人的溝通方式，並且能保持禮貌與平衡。<br>  然而，你也表現出對原則與目標的堅持，即使是在比較微妙的情境下，可能讓他人難以察覺你的真實意圖。  </p></li><li><p>對自己標準的隱藏壓力<br>  你對自己設定的目標和標準很高，且傾向於內化「應該更好」的期待。<br>  這可能導致你對成功的認可不夠，容易放大未完成或未達成的部分，忽略已經達成的成就。  </p></li><li><p>偏好控制但能適應改變<br>  你習慣掌控規劃與執行的過程，並且對細節要求高。<br>  然而，你在面對不可預測的情況時，也能快速調整心態並提出替代方案，顯示出高度靈活的思維。</p></li></ol><p>這些分析可能包含一些你未曾意識到或尚未明確的特質，也可能包含你的日常行為中隱藏的矛盾。<br>如果你有不同的想法或任何補充，歡迎分享！</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前請提要&quot;&gt;&lt;a href=&quot;#前請提要&quot; class=&quot;headerlink&quot; title=&quot;前請提要&quot;&gt;&lt;/a&gt;前請提要&lt;/h2&gt;&lt;p&gt;ChatGPT 能透過語言理解和生成，提供更細緻的個性分析，特別是當你使用了一陣子後，&lt;br&gt;可以用以下的 Prompt 作</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [實作筆記] GCP 防火牆設定與 Health Check</title>
    <link href="https://blog.marsen.me/2024/12/04/2024/gcp_healthcheck_firewall/"/>
    <id>https://blog.marsen.me/2024/12/04/2024/gcp_healthcheck_firewall/</id>
    <published>2024-12-04T08:16:13.000Z</published>
    <updated>2025-05-09T07:15:05.878Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>GCP 防火牆（Firewall）用來控制進出 Google Cloud 資源的網路流量，確保服務的安全性。<br>而 Health Check 則是用來監控後端服務的健康狀態，透過 GCP 負載平衡器（Load Balancer）進行流量分配。<br>我將介紹如何在 GCP 設定防火牆規則以支持 Health Check 的運作。</p><h2 id="情境"><a href="#情境" class="headerlink" title="情境"></a>情境</h2><p>instance 有一個 Allow Load Balancer Health checks 選項，<br>被勾起來後　Network tags 會加上<code>lb-health-check</code><br>但是不知為什麼狀態仍然會顯示為 Off　？</p><p>所以我們必須多作一些步驟</p><p>我有許多服務都掛在負載平衡器之後，並且使用 Backend Service 來管理這些流量。<br>一個 LB 會有多個 Backend Service (本文先不涉及 Backend Bucket)<br>由於成本考量，為了提高資源利用率，一台機器可能會承載多個 Web 服務。<br>這樣做可以節省硬體和虛擬機的成本，但同時也需要確保每個 Web 服務能夠獨立且穩定地運行。</p><p>在這樣的架構中，LB 會依 Path Rules 將流量分配到多個實例組（Instance Group）中，<br>每個實例中可能運行著多個 Web 服務。<br>透過這些實例和 Backend Service 的組合，負載平衡器能夠有效地將流量分配到不同的服務上。<br>然而，為了確保服務的穩定性，我們必須配置健康檢查（Health Check）來監控每個 Web 服務的運行狀態。  </p><p>在 GCP 中，當我們使用負載平衡器（<code>Load Balancer</code>）時，會涉及以下資源：</p><ul><li><code>Backend Service</code>：負責接收來自負載平衡器的流量，並將流量分發給後端的實例。</li><li><code>Health Check</code>：用來檢查後端服務是否健康，負載平衡器會依據這些檢查結果決定是否將流量導向特定實例。</li><li><code>Instance Group</code>：一組相同配置的虛擬機（VM），負責運行服務，並自動進行縮放。</li><li><code>Instance</code>：每個實際的虛擬機，執行後端服務。</li></ul><p>這些資源之間的關係是，Backend Service 根據 Health Check 監控的結果選擇健康的 Instance，<br>並將流量分發給 Instance Group 中的實例。<br>當負載平衡器根據路徑規則（LB Path Rule）將流量導向某個服務時，這些流量會被引導到 Instance 中運行的 Web 服務。</p><p>我們會在一台 Instance 上使用多個 web 服務，使用不同的 Port 來區分，範圍是 6000~6100。<br>而我們需要對這些所有的服務設定 Health Check</p><h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><p>每個實例有一個 <strong>“Allow Load Balancer Health checks”</strong> 的選項，<br>勾選後會自動加上 <code>lb-health-check</code> 的網路標籤(Network Tag)。<br>不過不知道為什麼狀態仍會顯示為 Off。<br>也就是說單純打勾是不夠的我們仍需要額外的設定，我們可以利用這個 <code>lb-health-check</code> 來作一些事</p><p>我們可以利用 Network Tag:<code>lb-health-check</code> 來建立相應的防火牆規則，<br>確保來自負載平衡器的流量能夠順利進行健康檢查。  </p><p>接下來，我們可以創建一個防火牆規則，限制僅允許 6000~6100 端口的 TCP 流量。<br>這樣做的原因是，健康檢查會直接使用 TCP 進行連接檢查，而不是 HTTP 協定，<br>這樣可以避免 HTTP 協定中請求和響應的延遲，並且減少負載平衡器在檢查健康狀態時的處理開銷。</p><p>在 GCP Console 中創建防火牆規則，指定源 IP 或範圍（例如內部網路的 IP 範圍）。<br>Google 的 Health Check 源自 <code>35.191.0.0/16</code> 與 <code>130.211.0.0/22</code>，<br>設定在 Source filters &gt; IP ranges 上<br>Targets ＞ Target tags 請設定為 <code>lb-health-check</code><br>設定 Protocols and ports &gt; Specified protocols and ports 選擇 TCP 協定 Ports 限制在 6000-6100。<br>在 Health checks 中，Protocol 也設定 TCP，Port 要設定為真實的 Web 服務使用的 Port<br>在 VM 的 instance 上，本來需要設定 Network Tag，但是我們可以勾選 “Allow Load Balancer Health checks” 的選項,<br>就會自動加上 Tag 囉。</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://cloud.google.com/load-balancing/docs/health-check-concepts">GCP HEALTH CHECK CONCEPT</a></li><li><a href="https://cloud.google.com/load-balancing/docs/health-checks">Use health checks</a></li><li><a href="https://cloud.google.com/vpc/docs/using-firewalls">Use VPC firewall rules</a></li><li><a href="https://hkmci.com/zh-hant/learning-column/google-cloud-zh-hant/gcp-kol-x-master-concept-the-overall-architecture-and-procedure-for-establishing-a-load-balancer/">建立 Load Balancer 的整體架構和步驟</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;GCP 防火牆（Firewall）用來控制進出 Google Cloud 資源的網路流量，確保服務的安全性。&lt;br&gt;而 Health Che</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [實作筆記] Google NAT 簡介與實作</title>
    <link href="https://blog.marsen.me/2024/12/03/2024/gcp_nat/"/>
    <id>https://blog.marsen.me/2024/12/03/2024/gcp_nat/</id>
    <published>2024-12-03T06:26:00.000Z</published>
    <updated>2025-05-09T07:15:05.878Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在打造安全的 VM 環境時，常常會遇到一個經典的矛盾點：<br>我們希望 VM 保持隱蔽，避免直接暴露於網際網路以減少安全風險，但同時又需要對外存取資源。<br>例如在開發或維運階段，像是執行 npm install、apt-get update，甚至提供給合作第三方的白名單 IP 等需求，往往都依賴外部下載與連線。  </p><p>因此，我們的需求很明確：  </p><ul><li>VM 非必要時，不提供 Public IP。  </li><li>VM 在發出 Request 時，需要擁有一個固定的對外 IP 地址。</li></ul><h2 id="傳統機房的解決方案"><a href="#傳統機房的解決方案" class="headerlink" title="傳統機房的解決方案"></a>傳統機房的解決方案</h2><p>在傳統機房環境中，透過 NAT (Network Address Translation) 伺服器或防火牆設備，就能實現內部網路的安全管理。  </p><p>內部流量管理: 內部 VM 使用私有 IP 位址，對外流量透過 NAT 進行轉換。<br>控制風險: 透過 NAT，內部伺服器可以訪問外部網路，但外部無法直接存取內部資源。<br>然而，傳統機房的設定通常需要額外的硬體設備，並增加了維護成本。  </p><h2 id="GCP-的解決方案-NAT"><a href="#GCP-的解決方案-NAT" class="headerlink" title="GCP 的解決方案　NAT"></a>GCP 的解決方案　NAT</h2><p>在 GCP 上，這個問題有一個優雅的解法：Cloud NAT。  </p><p>無須公有 IP: Cloud NAT 允許私有 VM 不需配置公有 IP，就能存取外部網路。<br>集中管理: 透過 VPC 網路層級的 NAT 設定，簡化整體網路架構。<br>彈性擴展: Cloud NAT 可以根據流量自動擴展，減少單點故障風險。  </p><p><img src="/../../images/2024/nat.svg" alt="NAT"></p><h2 id="實作筆記"><a href="#實作筆記" class="headerlink" title="實作筆記"></a>實作筆記</h2><h3 id="步驟-1-建立-VPC-網路"><a href="#步驟-1-建立-VPC-網路" class="headerlink" title="步驟 1: 建立 VPC 網路"></a>步驟 1: 建立 VPC 網路</h3><p>在 GCP 控制台中，前往 VPC 網路，選擇 建立 VPC 網路。<br>設定一個新的 VPC 網路，並確保 VM 的子網路設為 私有（Private）。這樣做可以保護 VM 不被直接暴露於公共網路。<br>實務上我選擇 default  </p><h3 id="步驟-2-配置-Cloud-NAT"><a href="#步驟-2-配置-Cloud-NAT" class="headerlink" title="步驟 2: 配置 Cloud NAT"></a>步驟 2: 配置 Cloud NAT</h3><p>前往 VPC 網路 &gt; Cloud NAT，並選擇 建立 NAT 網關。<br>在設置過程中，選擇對應的子網路和<code>路由(Route)</code>設定。這樣可以確保 VM 在沒有 Public IP 的情況下仍能夠透過 NAT 網關訪問外部網路。<br>配置完成後，Cloud NAT 將會自動幫助 VM 處理對外的連線請求，而不需要直接公開 VM 的 IP。  </p><h3 id="步驟-3-配置-Public-IP（如果需要）"><a href="#步驟-3-配置-Public-IP（如果需要）" class="headerlink" title="步驟 3: 配置 Public IP（如果需要）"></a>步驟 3: 配置 Public IP（如果需要）</h3><p>若要讓 VM 直接對外發送請求或開放服務，可以在創建 VM 時為其配置 Public IP。<br>在 Google Cloud Console 中創建虛擬機時，選擇 外部 IP 設為 靜態（static），這樣可以確保 Public IP 地址不會變動。<br>當 VM 配置了 Public IP，所有對外的請求將會直接通過這個 IP 進行。  </p><h2 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h2><p>Cloud NAT 的設計，讓我們可以兼顧安全性與便利性。<br>關鍵優勢:</p><p>簡單配置: 不需像傳統 NAT 那樣繁複的硬體設置。<br>靈活性高: 無論是開發環境還是正式部署，都能輕鬆應對。<br>成本效益: 減少了維運成本，同時保護了內部資源。</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://cloud.google.com/nat/docs/overview">https://cloud.google.com/nat/docs/overview</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;在打造安全的 VM 環境時，常常會遇到一個經典的矛盾點：&lt;br&gt;我們希望 VM 保持隱蔽，避免直接暴露於網際網路以減少安全風</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title>[學習筆記] 里氏替換原則(Liskov Substitution Principle, LSP)</title>
    <link href="https://blog.marsen.me/2024/11/25/2024/understanding_lsp_with_examples/"/>
    <id>https://blog.marsen.me/2024/11/25/2024/understanding_lsp_with_examples/</id>
    <published>2024-11-25T03:39:00.000Z</published>
    <updated>2025-05-09T07:15:05.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>OOP 中的五大原則之一—里氏替換原則,開發 OOP 的工程師應該或多或少都有聽過,<br>最近與同事討論後有新的體悟,特別記錄一下  </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">若對某個型別 T 的物件 𝑥 能證明具有某個性質 𝑞(𝑥),那麼對於 T 的子型別 S 的物件 𝑦 同樣應該滿足 𝑞(𝑦)。</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">If a property 𝑞(𝑥) can be proven for objects 𝑥 of type 𝑇,</span><br><span class="line">then 𝑞(𝑦) should also hold true for objects 𝑦 of type 𝑆, where 𝑆 is a subtype of 𝑇.</span><br></pre></td></tr></table></figure><p>里氏替換原則(Liskov Substitution Principle, LSP)詳解<br>定義：<br>里氏替換原則由 Barbara Liskov 在 1987 年提出,<br>是 SOLID 原則中的 “L”。它強調 子類(Subclass) 應該能夠替換其 父類(Base Class) 而不影響程式的正確性或行為。  </p><p>核心概念：<br>“任何使用父類的地方,都應該能夠使用其子類,而不會影響系統的功能。”  </p><h2 id="主要原則"><a href="#主要原則" class="headerlink" title="主要原則"></a>主要原則</h2><p>子類應該擁有父類的所有行為特性。<br><strong>子類不應改變父類方法的預期行為。</strong><br>子類可以擴展父類的功能,但不能削弱或改變父類的功能。  </p><p>違反 LSP 的常見問題：<br>替換後引發錯誤： 子類<strong>重寫</strong>某個方法,導致使用者無法正常使用原本的功能。<br>返回值不一致： 子類方法返回值與父類期望的類型不同。<br>拋出未預期的異常： 子類新增或拋出父類未預期的異常。  </p><h2 id="舉例說明-錯誤示例"><a href="#舉例說明-錯誤示例" class="headerlink" title="舉例說明,錯誤示例"></a>舉例說明,錯誤示例</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">  <span class="title function_">fly</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Flying...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Bird</span> &#123;</span><br><span class="line">  <span class="comment">// Penguins can&#x27;t fly!</span></span><br><span class="line">  <span class="title function_">fly</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Penguins can&#x27;t fly!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeBirdFly</span>(<span class="params">bird: Bird</span>) &#123;</span><br><span class="line">  bird.<span class="title function_">fly</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 當傳入 Penguin 時,會引發錯誤</span></span><br><span class="line"><span class="keyword">const</span> penguin = <span class="keyword">new</span> <span class="title class_">Penguin</span>();</span><br><span class="line"><span class="title function_">makeBirdFly</span>(penguin);  <span class="comment">// Throws an error!</span></span><br></pre></td></tr></table></figure><p>違反原因：  </p><p>在 makeBirdFly 函數中,傳入 Penguin 子類後,原本預期的行為(鳥會飛）被破壞,導致異常發生,違反 LSP。  </p><p>正確示例：  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">  <span class="title function_">move</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Moving...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyingBird</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Bird</span> &#123;</span><br><span class="line">  <span class="title function_">fly</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Flying...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Bird</span> &#123;</span><br><span class="line">  <span class="title function_">swim</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Swimming...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeBirdMove</span>(<span class="params">bird: Bird</span>) &#123;</span><br><span class="line">  bird.<span class="title function_">move</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> penguin = <span class="keyword">new</span> <span class="title class_">Penguin</span>();</span><br><span class="line"><span class="title function_">makeBirdMove</span>(penguin);  <span class="comment">// 正常運行,無異常</span></span><br></pre></td></tr></table></figure><h2 id="修正方式"><a href="#修正方式" class="headerlink" title="修正方式"></a>修正方式</h2><p>將 Bird 分解為更細的抽象類別(如 FlyingBird)。<br>確保所有子類的行為符合其父類的行為約束。<br>實踐 LSP 的要點：</p><ul><li>正確使用繼承： 只有在 “是某種(is a)” 的關係中使用繼承;例如:Dog 是 Animal 的一種(我們都不認為這是一個好例子)。</li><li>避免強制行為： 子類不應強迫覆蓋父類的方法,除非行為一致。</li><li>使用介面： 如果子類具有不同行為,可使用多個接口來定義不同能力。</li></ul><p>總結：<br>LSP 促使開發者在繼承和多型設計中保持一致性和正確性,保證系統的可擴展性和穩定性。<br>遵循 LSP 可以避免許多因繼承導致的潛在問題,使代碼更健壯且易於維護。</p><h2 id="我們的一些關鍵-Q-A"><a href="#我們的一些關鍵-Q-A" class="headerlink" title="我們的一些關鍵 Q&amp;A"></a>我們的一些關鍵 Q&amp;A</h2><p>Q.LSP 的意思是不要用 override ?<br>A.<br>不是的,LSP(里氏替換原則)並不是要求完全避免使用 override,<br>而是要正確使用 override。核心在於: <strong>子類覆寫父類方法時,不能破壞父類的行為預期。</strong></p><p>Q. 要正確使用 override 的原則是什麼？<br>A. 子類應維持父類方法的語義一致性<br>覆寫後的行為應與父類保持一致,並且在替換後不會引發錯誤。</p><p>Q. 有更具體的說明嗎 ?<br>A. 不要改變方法的輸入輸出參數規格<br>遵循開放封閉原則(Open&#x2F;Closed Principle),開放擴展,封閉修改。<br>方法的參數類型不能比父類方法的參數更具限制性。<br>方法的返回類型不能比父類方法的返回類型更具擴展性。  </p><p>Q.<br>以你的例子來說Penguin 的確不會 fly , 所以應該拋出錯誤<br>但是這樣就違反了 LSP ,所以我們的建議是將 fly 再抽出成為介面?<br>A.<br>沒錯!這是關鍵點了。解決這種情況的最佳方式是使用介面(Interface)來抽象行為,而不是在基類中定義所有可能不適用於子類的行為。</p><p>子類應擴展父類的功能,而不是修改父類的行為。</p><h3 id="正確的覆寫示例"><a href="#正確的覆寫示例" class="headerlink" title="正確的覆寫示例"></a>正確的覆寫示例</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">makeSound</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Some sound&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="title function_">makeSound</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bark&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">playSound</span>(<span class="params">animal: Animal</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(animal.<span class="title function_">makeSound</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="title function_">playSound</span>(dog);  <span class="comment">// Output: &quot;Bark&quot; (符合父類預期)</span></span><br></pre></td></tr></table></figure><p>說明：<br>Dog 覆寫了 makeSound(),但返回類型和行為保持一致,替換 Animal 後,系統的正確性不受影響。</p><h3 id="違反-LSP-的覆寫示例"><a href="#違反-LSP-的覆寫示例" class="headerlink" title="違反 LSP 的覆寫示例"></a>違反 LSP 的覆寫示例</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">protected</span> width: <span class="built_in">number</span>, <span class="keyword">protected</span> height: <span class="built_in">number</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setWidth</span>(<span class="params">width: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHeight</span>(<span class="params">height: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getArea</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">width</span> * <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Rectangle</span> &#123;</span><br><span class="line">  <span class="comment">// 覆寫後改變了行為,違反 LSP</span></span><br><span class="line">  <span class="title function_">setWidth</span>(<span class="params">width: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = width;  <span class="comment">// 強制將高度設為相等</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHeight</span>(<span class="params">height: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = height;  <span class="comment">// 強制將寬度設為相等</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">testRectangle</span>(<span class="params">rect: Rectangle</span>) &#123;</span><br><span class="line">  rect.<span class="title function_">setWidth</span>(<span class="number">5</span>);</span><br><span class="line">  rect.<span class="title function_">setHeight</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rect.<span class="title function_">getArea</span>());  <span class="comment">// 預期：50</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> square = <span class="keyword">new</span> <span class="title class_">Square</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="title function_">testRectangle</span>(square);  <span class="comment">// Output: 100 (違反父類預期)</span></span><br></pre></td></tr></table></figure><p>說明：<br>Square 覆寫了 setWidth 和 setHeight 方法,但改變了 Rectangle 的行為。<br>傳入 Square 後,計算面積的結果與 Rectangle 的預期不同,這破壞了 LSP。  </p><p>兩個例子的差異在於<br>Dog 的覆寫行為符合父類預期,Square 改變父類邏輯(強制高寬相等）,破壞原有功能,違反 LSP。</p><h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>可以使用 override,但要謹慎處理。<br>確保子類的行為符合父類的預期,不會引入不一致或異常行為。<br>遵守 LSP 能保證系統在多型使用時的穩定性和可預測性。</p><p>對「少用繼承多用組合」的體悟多了一層，如果發現繼承了父類的方法，<br>但是修改了行為(拋錯誤、改變本來沒有改動到的屬性、長出新的邏輯分更支…)，這就是一種壞味道。　　<br>大部份應該都可以透過介面排除這個問題。</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;OOP 中的五大原則之一—里氏替換原則,開發 OOP 的工程師應該或多或少都有聽過,&lt;br&gt;最近與同事討論後有新的體悟,特別記錄一下  &lt;/</summary>
      
    
    
    
    
    <category term="學習筆記" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] Macbook dotnet 8 升級 dotnet 9</title>
    <link href="https://blog.marsen.me/2024/11/14/2024/mac_dotnet_8_update_9/"/>
    <id>https://blog.marsen.me/2024/11/14/2024/mac_dotnet_8_update_9/</id>
    <published>2024-11-14T08:06:48.000Z</published>
    <updated>2025-05-09T07:15:05.879Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>dotnet 9 <a href="https://devblogs.microsoft.com/dotnet/announcing-dotnet-9/">官宣囉</a> ! 雖然不是 lts 版本，但是仍然有許多有趣的新東西，先昇級並記錄一下。</p><h2 id="小常識"><a href="#小常識" class="headerlink" title="小常識"></a>小常識</h2><p>.NET Runtime 和 .NET SDK 主要的差別在於它們的用途和所包含的工具：  </p><p>.NET Runtime：  </p><p>僅包含運行 .NET 應用所需的基本庫和執行環境。<br>適合只需要執行已編譯應用程序的情況，像是使用者在安裝應用後直接執行時。<br>不包含編譯、打包或開發所需的工具和命令。<br>.NET SDK (Software Development Kit)：  </p><p>包含 .NET Runtime，以及用來開發、編譯、測試和打包 .NET 應用的工具和命令。<br>包括開發者常用的命令，如 dotnet build（編譯）、dotnet publish（發布）、dotnet test（測試）等。<br>必須安裝 SDK 才能進行應用程式的開發，而不僅僅是執行。  </p><p>簡單來說：</p><p><strong>如果你只是想執行 .NET 應用，安裝 Runtime 即可。如果你要開發或修改 .NET 應用，則需要 SDK。</strong></p><h2 id="安裝步驟"><a href="#安裝步驟" class="headerlink" title="安裝步驟"></a>安裝步驟</h2><p><a href="https://dotnet.microsoft.com/en-us/download/dotnet/9.0">https://dotnet.microsoft.com/en-us/download/dotnet/9.0</a><br>選擇 SDK 9.0.100 (左側) &gt; macOS Installers &gt; Arm64</p><blockquote><p>我曾經裝到 X64，安裝過程沒有失敗，但是 dotnet version 仍為 8.0.100</p></blockquote><p>檢查</p><blockquote><p>❯ dotnet –version<br>9.0.100<br>❯ dotnet –list-sdks<br>8.0.100 [&#x2F;usr&#x2F;local&#x2F;share&#x2F;dotnet&#x2F;sdk]<br>8.0.101 [&#x2F;usr&#x2F;local&#x2F;share&#x2F;dotnet&#x2F;sdk]<br>9.0.100 [&#x2F;usr&#x2F;local&#x2F;share&#x2F;dotnet&#x2F;sdk]</p></blockquote><h2 id="專案升級"><a href="#專案升級" class="headerlink" title="專案升級"></a>專案升級</h2><p>專案有許多套件有 Warning 先進行 <code>restore</code></p><p>❯ dotnet restore Marsen.NetCore.Dojo.Integration.Test.sln</p><blockquote><p>❯ dotnet restore Marsen.NetCore.Dojo.Integration.Test.sln<br>(中略)<br>在 24.4 秒內還原 成功但有 9 個警告</p></blockquote><p>IDE 我是使用 Rider</p><blockquote><p>Tools → NuGet → Manage NuGet Packages for Solution…</p></blockquote><p>把能昇級的都昇一昇，再執行測試</p><blockquote><p>測試摘要: 總計: 467, 失敗: 0, 成功: 466, 已跳過: 1, 持續時間: 4.7 秒<br>在 6.5 秒內建置 成功但有 9 個警告</p></blockquote><blockquote><p>Tools → NuGet → Upgrade Packages in Solution…</p></blockquote><p>再執行測試</p><blockquote><p>測試摘要: 總計: 467, 失敗: 0, 成功: 466, 已跳過: 1, 持續時間: 4.7 秒<br>在 6.5 秒內建置 成功但有 9 個警告</p></blockquote><p>警告如下</p><p>warning NU1903: 套件 ‘System.Text.RegularExpressions’ 4.3.0 具有已知的 高 嚴重性弱點<br>warning NU1903: 套件 ‘Newtonsoft.Json’ 9.0.1 具有已知的 高 嚴重性弱點<br>warning CS0618: ‘SqlConnection’ 已經過時: ‘Use the Microsoft.Data.SqlClient package instead.’<br>warning SYSLIB0051: ‘Exception.Exception(SerializationInfo, StreamingContext)’ 已經過時</p><p>高風險可以透過 Nuget 確認有沒有新版本的或 patch</p><p><a href="https://learn.microsoft.com/en-gb/dotnet/fundamentals/syslib-diagnostics/syslib0051">SYSLIB0051: Legacy serialization support APIs are obsolete</a> 基本上都是在繼承舊版 Exception 時建立的方法<br>可以刪除，但這次先標已過時標籤後並保留，相關程式都沒有呼叫這些方法，所以不會引發新的警告。  </p><p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.data.sqlclient.sqlconnection.-ctor?view=netframework-4.8.1&viewFallbackFrom=net-8.0">warning CS0618: ‘SqlConnection’ 已經過時: ‘Use the Microsoft.Data.SqlClient package instead.’</a><br>很簡單，依據他的建議，改用 <code>using Microsoft.Data.SqlClient;</code> 即可。<br>當然要先從 Nuget 安裝 package</p><p>處理完警告後，修改所有<code>csproj</code>內的 TargetFramework 標籤內容如下:  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>net9.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CICD 相關的設定也要改為 dotnet 9.0</p><p>像是 <code>.github/workflows</code> 腳本中的 dotnet-version</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">steps:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">.NET</span> <span class="string">Core</span></span><br><span class="line">   <span class="attr">uses:</span> <span class="string">actions/setup-dotnet@v1</span></span><br><span class="line">   <span class="attr">with:</span></span><br><span class="line">     <span class="attr">dotnet-version:</span> <span class="string">&#x27;9.0.x&#x27;</span></span><br></pre></td></tr></table></figure><p>或是 sonarscan-dotnet 中使用的版本(這部份如果原始 repo 尚未更新，可以試著自已更新看看)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SonarCloud</span> <span class="string">Scan</span></span><br><span class="line">  <span class="comment"># support dotnet9.0</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">marsen/sonarscan-dotnet@v2.4.1</span></span><br></pre></td></tr></table></figure><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;dotnet 9 &lt;a href=&quot;https://devblogs.microsoft.com/dotnet/announ</summary>
      
    
    
    
    
    <category term="實作筆記" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [實作筆記] 個人經歷 STAR 試寫</title>
    <link href="https://blog.marsen.me/2024/11/04/2024/star_career_feedback/"/>
    <id>https://blog.marsen.me/2024/11/04/2024/star_career_feedback/</id>
    <published>2024-11-04T01:22:58.000Z</published>
    <updated>2025-05-09T07:15:05.879Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>STAR 是一種行之有效的行為面試方法，全名為 Situation（情境）、Task（任務）、Action（行動） 和 Result（結果）。<br>這個框架幫助應徵者組織答案，描述過去經驗時更有條理，清楚展示個人在特定情境下的行動力及成效。<br>具體來說：  </p><ul><li>Situation（情境）：描述事情發生的背景或狀況，讓聽者了解事件的前因後果。</li><li>Task（任務）：指出自己在該情境中所負責的任務或需完成的目標。</li><li>Action（行動）：詳細說明為了完成任務所採取的具體步驟和行動。</li><li>Result（結果）：描述行動的成果，最好是能量化的結果或正面的</li></ul><p>透過 STAR 方法，可以清晰地展示個人職涯解決問題的能力及帶來的正面影響。</p><h2 id="個人經歷-STAR-試寫"><a href="#個人經歷-STAR-試寫" class="headerlink" title="個人經歷 STAR 試寫"></a>個人經歷 STAR 試寫</h2><table><thead><tr><th>公司名</th><th>情境</th><th>任務</th><th>行動</th><th>結果</th></tr></thead><tbody><tr><td><strong>N 社.</strong></td><td>團隊負責開發維護跨國電商系統，面臨整合不同市場需求的挑戰。</td><td>確保開發過程的順利，協調跨團隊成員，並確保系統的本地化符合各地要求。並最需要回歸到 ONE CODE BASE</td><td>實施敏捷方法，善用分支策略，進行代碼審查和測試，引入 TDD 和 CI&#x2F;CD 流程，提升開發效率。</td><td>成功推動三個國家的服務上線，縮短開發時間 30%，獲得客戶的積極反饋，促進未來業務擴展和合作機會。在全公司中是最少發生合併衝突的開發團隊。</td></tr><tr><td><strong>N 社.</strong></td><td>產品 24&#x2F;7 監控系統的實施，以確保服務的穩定性和可用性。</td><td>設計並實施監控解決方案，確保系統在出現故障時能迅速響應，並減少停機時間。</td><td>分析系統需求並適當排序，建置監控工具，警報系統與流程。並依序修復異常</td><td>成功降低系統故障響應時間 90%，顯著提高服務可靠性，提升客戶滿意度。</td></tr><tr><td><strong>N 社 &amp; B 社產學合作</strong></td><td>與中華大學及建中學校進行產學合作項目，推動學生的實踐經驗和技術分享。</td><td>指導 B 社學生，確保項目能按時完成，達到教育和實踐的雙重目標。</td><td>舉辦技術工作坊，提供指導並進行項目評估，促進學生在實際環境中的學習。</td><td>學生在項目中獲得寶貴經驗，成功展示成果並就業，促進學校與業界的合作關係。</td></tr><tr><td><strong>N 社</strong></td><td>在 2018 年成為團隊技術領導，面對管理與技術職能切換的挑戰。</td><td>與跨部門成員重組成跨國團隊</td><td>組織讀書會工作坊，促進團隊成員達成共識，並引入相關的軟體開發工具和流程。</td><td>成功建立了一支開發團隊，如期如質的交付產品。</td></tr><tr><td><strong>C 社</strong></td><td>擔任開發工程師，負責0到1設計和開發金融相關的應用程式和服務。</td><td>建立多產品線與後台以功能符合內外用戶需求並持續改進。</td><td>利用用戶反饋進行產品迭代，並推動新功能的開發，使用敏捷開發方法提升效率。導入版本控制以解決多人協作問題。</td><td>成功推出了數個新的功能，顯著提高了用戶滿意度和產品的使用率。整體營收提昇 20 倍以上（2000%↑）</td></tr></tbody></table><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;STAR 是一種行之有效的行為面試方法，全名為 Situation（情境）、Task（任務）、Action（行動） 和 Re</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [學習筆記] TypeScript tsconfig 設定備忘錄</title>
    <link href="https://blog.marsen.me/2024/10/08/2024/typescript_tsconfig_cheat_sheet/"/>
    <id>https://blog.marsen.me/2024/10/08/2024/typescript_tsconfig_cheat_sheet/</id>
    <published>2024-10-08T15:28:35.000Z</published>
    <updated>2025-05-09T07:15:05.879Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>tsconfig.json 文件是一個 TypeScript 專案的配置文件, 它位於根目錄中, 並定義了專案的編譯器選項。<br>提供給開發人員輕鬆配置 TypeScript 編譯器, 並確保專案的程式碼在不同的環境中始終保持一致。<br>你可以使用 <code>tsc --init</code> 指令自動產生。<br>也可以參考 Matt Pocock 的 <a href="https://www.totaltypescript.com/tsconfig-cheat-sheet">TSConfig Cheat Sheet</a></p><p>TSConfig 有上百個配置, 本文將用來重點記錄一些相關的配置  </p><h2 id="本文"><a href="#本文" class="headerlink" title="本文"></a>本文</h2><h3 id="2024-10-Matt-Pocock-的建議配置"><a href="#2024-10-Matt-Pocock-的建議配置" class="headerlink" title="2024&#x2F;10 Matt Pocock 的建議配置"></a>2024&#x2F;10 Matt Pocock 的建議配置</h3><p>相關說明請參考<a href="https://www.totaltypescript.com/tsconfig-cheat-sheet">原文</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">/* Base Options: */</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es2022&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleDetection&quot;</span><span class="punctuation">:</span> <span class="string">&quot;force&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;verbatimModuleSyntax&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Strictness */</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;noUncheckedIndexedAccess&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;noImplicitOverride&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If transpiling with TypeScript: */</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NodeNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dist&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* AND if you&#x27;re building for a library: */</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* AND if you&#x27;re building for a library in a monorepo: */</span></span><br><span class="line">    <span class="attr">&quot;composite&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;declarationMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If NOT transpiling with TypeScript: */</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If your code runs in the DOM: */</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;es2022&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dom&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dom.iterable&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If your code doesn&#x27;t run in the DOM: */</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;es2022&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="files"><a href="#files" class="headerlink" title="files"></a>files</h3><p>預設值為 <code>false</code>, 如果只有少量的 ts 檔, 很適合設定這個<code>files</code><br>但實務上更常用 <code>include</code> 與 <code>exclude</code> 搭配,<br>兩者都可使用 wildcard , exclude 擁有較高的優先級,<br>例如下面的設定 <code>src/.test</code> 底下的檔案將不會被編譯:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/test/**/*&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;a_typescript_file.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;other_ts_code.ts&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Compiler-Options"><a href="#Compiler-Options" class="headerlink" title="Compiler Options"></a>Compiler Options</h3><p>這部份是 tsconfig 相關設定的主體, 有需要時來<a href="https://www.typescriptlang.org/tsconfig/#compilerOptions">這裡</a>查就好<br>下面的例子是一些常用的設定說明:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// esModuleInterop: 這個選項使 TypeScript 能夠更好地與 CommonJS 模組兼容, 允許以 ES 模組方式導入 CommonJS 模組。</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// skipLibCheck: 當設置為 true 時, TypeScript 將跳過對聲明檔案（.d.ts）的型別檢查, 可以加快編譯速度, 尤其是在大型專案中。</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// target: 指定編譯後的 JavaScript 代碼的 ECMAScript 版本。這裡設定為 ES2022, 這意味著生成的代碼將使用該版本的新特性。</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es2022&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// allowJs: 此選項允許在 TypeScript 專案中使用 JavaScript 檔案, 這對於逐步遷移到 TypeScript 的專案特別有用。</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// resolveJsonModule: 使 TypeScript 能夠導入 JSON 檔案, 並將其視為模組。</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// moduleDetection: 設置為 force 使 TypeScript 將所有檔案視為模組, 避免了使用全局變數引起的錯誤。</span></span><br><span class="line">    <span class="attr">&quot;moduleDetection&quot;</span><span class="punctuation">:</span> <span class="string">&quot;force&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// isolatedModules: 每個檔案將被獨立編譯, 這對於使用 Babel 或其他工具的場景特別重要。</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// verbatimModuleSyntax: 強制使用類型專用的導入和導出, 使 TypeScript 更加嚴格, 這樣有助於在編譯時優化生成的代碼。</span></span><br><span class="line">    <span class="attr">&quot;verbatimModuleSyntax&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Watch-Option"><a href="#Watch-Option" class="headerlink" title="Watch Option"></a>Watch Option</h3><p><code>watchOptions</code> 用於配置 TypeScript 在開發過程中如何監控文件變更。<br>這些選項主要用於改善開發效率, 當監控的文件或目錄發生變化時, TypeScript 會自動重新編譯或執行其他指定操作。<br>這對於開發階段非常重要, 因為它允許<strong>開發者即時查看更改的影響, 而不必手動重新編譯代碼。</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;watchOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// watchFile: 用於設定 TypeScript 監控單個檔案的方式。</span></span><br><span class="line">    <span class="comment">// fixedPollingInterval: 每隔固定時間檢查所有檔案是否變更。</span></span><br><span class="line">    <span class="comment">// priorityPollingInterval: 根據啟發式方法, 對某些類型的檔案進行優先輪詢。</span></span><br><span class="line">    <span class="comment">// dynamicPriorityPolling: 使用動態隊列, 較少修改的檔案將會被較少檢查。</span></span><br><span class="line">    <span class="comment">// useFsEvents (預設): 嘗試使用操作系統/檔案系統的原生事件來監控檔案變更。</span></span><br><span class="line">    <span class="comment">// useFsEventsOnParentDirectory: 嘗試監聽檔案父目錄的變更事件, 而不是直接監控檔案。</span></span><br><span class="line">    <span class="attr">&quot;watchFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;useFsEvents&quot;</span><span class="punctuation">,</span> <span class="comment">// 預設為使用文件系統事件來監控檔案變更。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// watchDirectory: 用於設定 TypeScript 監控整個目錄的方式。</span></span><br><span class="line">    <span class="comment">// fixedPollingInterval: 每隔固定時間檢查所有目錄是否變更。</span></span><br><span class="line">    <span class="comment">// dynamicPriorityPolling: 使用動態隊列, 較少修改的目錄將會被較少檢查。</span></span><br><span class="line">    <span class="comment">// useFsEvents (預設): 嘗試使用操作系統/檔案系統的原生事件來監控目錄變更。</span></span><br><span class="line">    <span class="attr">&quot;watchDirectory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamicPriorityPolling&quot;</span><span class="punctuation">,</span> <span class="comment">// 使用動態優先級輪詢, 檢查變更較少的目錄次數較少。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 設置檔案或目錄的輪詢間隔時間（以毫秒為單位）, 適用於輪詢策略。</span></span><br><span class="line">    <span class="attr">&quot;pollingInterval&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span> <span class="comment">// 設置為每 2000 毫秒輪詢一次檔案或目錄變更。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 設置是否監控目錄及其所有子目錄</span></span><br><span class="line">    <span class="attr">&quot;recursive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="comment">// 設置為 true 以監控所有子目錄的變更。</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Type-Acquisition"><a href="#Type-Acquisition" class="headerlink" title="Type Acquisition"></a>Type Acquisition</h3><p>Type Acquisition 主要適用於 JavaScript 專案。<br>在 TypeScript 專案中, 開發者必須明確地將型別包含在專案中。<br>相對地, 對於 JavaScript 專案, TypeScript 工具會自動在後台下載所需的型別, 並將其儲存在 node_modules 以外的位置。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typeAcquisition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// enable: 啟用自動獲取 JavaScript 專案的型別檔案 (.d.ts)。</span></span><br><span class="line">    <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// include: 指定自動獲取型別檔案的庫。</span></span><br><span class="line">    <span class="comment">// 例如, 在這裡指定了 jQuery 和 lodash, TypeScript 將自動獲取它們的型別檔案。</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;jquery&quot;</span><span class="punctuation">,</span> <span class="string">&quot;lodash&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// exclude: 指定不需要自動獲取型別檔案的庫。</span></span><br><span class="line">    <span class="comment">// 這裡指定了 &quot;some-legacy-library&quot;, 即使它存在於專案中, TypeScript 也不會嘗試獲取它的型別檔案。</span></span><br><span class="line">    <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;some-legacy-library&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// disableFilenameBasedTypeAcquisition: 禁用基於檔案名稱自動獲取型別檔案的功能。</span></span><br><span class="line">    <span class="comment">// 當設置為 true 時, TypeScript 不會基於檔案名稱來推測並下載型別檔案。</span></span><br><span class="line">    <span class="attr">&quot;disableFilenameBasedTypeAcquisition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li><a href="https://www.typescriptlang.org/tsconfig/">Intro to the TSConfig</a></li><li><a href="https://www.totaltypescript.com/tsconfig-cheat-sheet">The TSConfig Cheat Sheet</a></li><li><a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html#handbook-content">What is a tsconfig.json</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;tsconfig.json 文件是一個 TypeScript 專案的配置文件, 它位於根目錄中, 並定義了專案的編譯器選項。</summary>
      
    
    
    
    
    <category term="學習筆記" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [學習筆記] Omit 與 Pick 的 Distributive 版本：解決 TypeScript Utility Types 的陷阱</title>
    <link href="https://blog.marsen.me/2024/10/05/2024/typescript_omit_pick_distributive_union_issue/"/>
    <id>https://blog.marsen.me/2024/10/05/2024/typescript_omit_pick_distributive_union_issue/</id>
    <published>2024-10-05T07:58:30.000Z</published>
    <updated>2025-05-09T07:15:05.879Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在 TypeScript 中，Omit 和 Pick 是廣受喜愛的 Utility Types，<br>它們允許你從現有型別中排除或選擇特定的屬性來創建新型別。<br>參考我之前的<a href="https://blog.marsen.me/2022/09/12/2022/TypeScript_Omit/">文章</a></p><h2 id="本文"><a href="#本文" class="headerlink" title="本文"></a>本文</h2><h3 id="基礎示範：Omit-的使用"><a href="#基礎示範：Omit-的使用" class="headerlink" title="基礎示範：Omit 的使用"></a>基礎示範：Omit 的使用</h3><p>我們先來看個簡單的例子，假設我們有一個 Game 型別，其中包含 id、name 和 price 三個屬性。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Game</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;    <span class="comment">// 遊戲的唯一識別碼</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;  <span class="comment">// 遊戲名稱</span></span><br><span class="line">  <span class="attr">price</span>: <span class="built_in">number</span>; <span class="comment">// 遊戲價格</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GameWithoutIdentity</span> = <span class="title class_">Omit</span>&lt;<span class="title class_">Game</span>, <span class="string">&quot;id&quot;</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">game</span>: <span class="title class_">GameWithoutIdentity</span> = &#123;</span><br><span class="line">  <span class="comment">//id: &quot;1&quot;, // ❗ 編譯錯誤：&#x27;price&#x27; 不存在於 &#x27;GameWithoutIdentity&#x27; 型別中</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;The Legend of Zelda&quot;</span>, </span><br><span class="line">  <span class="attr">price</span>: <span class="number">59.99</span>, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Omit 可以幫助我們排除 id 屬性並創建新型別 GameWithoutIdentity<br>這在單一型別中運行良好，但當我們引入 Union Types 時，就有一些細節值得討論。</p><h2 id="問題：Union-Types-中的-Omit-行為"><a href="#問題：Union-Types-中的-Omit-行為" class="headerlink" title="問題：Union Types 中的 Omit 行為"></a>問題：Union Types 中的 Omit 行為</h2><p>假設我們有三個型別：Game、VideoGame 和 PCGame。<br>它們的 id 和 name 屬性相同，但每個型別都有其獨特的屬性。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Game</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;        <span class="comment">// 遊戲的唯一識別碼</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;      <span class="comment">// 遊戲名稱</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">VideoGame</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;              <span class="comment">// 遊戲的唯一識別碼</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;            <span class="comment">// 遊戲名稱</span></span><br><span class="line">  <span class="attr">platform</span>: <span class="built_in">string</span>;        <span class="comment">// 遊戲平台</span></span><br><span class="line">  <span class="attr">genre</span>: <span class="built_in">string</span>;           <span class="comment">// 遊戲類型</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PCGame</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;                    <span class="comment">// 遊戲的唯一識別碼</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;                  <span class="comment">// 遊戲名稱</span></span><br><span class="line">  <span class="attr">systemRequirements</span>: <span class="built_in">string</span>;    <span class="comment">// 系統需求</span></span><br><span class="line">  <span class="attr">hasDLC</span>: <span class="built_in">boolean</span>;              <span class="comment">// 是否有 DLC</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>當我們將這三個型別聯合起來形成 GameProduct 並嘗試使用 Omit 排除 id 時，結果卻不是我們預期的。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">GameProduct</span> = <span class="title class_">Game</span> | <span class="title class_">VideoGame</span> | <span class="title class_">PCGame</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GameProduct</span> = <span class="title class_">Omit</span>&lt;<span class="title class_">GameProduct</span>, <span class="string">&quot;id&quot;</span>&gt;;</span><br></pre></td></tr></table></figure><p>你可能期望 GameProductWithoutId 是三個型別排除 id 屬性的 Union Type，但實際上，我們只得到了這樣的結構：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">GameProduct</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這表示 <code>Omit</code> 在處理 <code>Union Types</code> 時，並沒有對每個聯合成員單獨操作，而是將它們合併成了一個結構。</p><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>這種行為的根源在於，<code>Omit</code> 和 <code>Pick</code> 不是 <code>Distributive</code> 的 <code>Utility Types</code>。<br>它們不會針對每個 <code>Union Type</code> 成員進行個別操作，而是將 <code>Union Type</code> 視為一個整體來操作。<br>因此，當我們排除 id 屬性時，它無法處理每個成員型別中的不同屬性。</p><p>這與其他工具型別如 <code>Partial</code> 和 <code>Required</code> 不同，這些工具型別可以正確地處理 Union Types，並在每個成員上應用。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">PartialGameProduct</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">GameProduct</span>&gt;;</span><br><span class="line"><span class="comment">// 正確地給出了聯合型別的部分化版本</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PartialGameProduct</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Game</span>&gt; | <span class="title class_">Partial</span>&lt;<span class="title class_">VideoGame</span>&gt; | <span class="title class_">Partial</span>&lt;<span class="title class_">PCGame</span>&gt;;</span><br></pre></td></tr></table></figure><h3 id="解決方案：Distributive-Omit-與-Distributive-Pick"><a href="#解決方案：Distributive-Omit-與-Distributive-Pick" class="headerlink" title="解決方案：Distributive Omit 與 Distributive Pick"></a>解決方案：Distributive Omit 與 Distributive Pick</h3><p>要解決這個問題，我們可以定義一個 Distributive 的 Omit，這個版本會針對 Union Type 的每個成員進行操作。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">DistributiveOmit</span>&lt;T, K <span class="keyword">extends</span> <span class="title class_">PropertyKey</span>&gt; = T <span class="keyword">extends</span> <span class="built_in">any</span></span><br><span class="line">  ? <span class="title class_">Omit</span>&lt;T, K&gt;</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><p>使用 DistributiveOmit 後，我們可以正確地得到想要的結果：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">GameProductWithoutId</span> = <span class="title class_">DistributiveOmit</span>&lt;<span class="title class_">GameProduct</span>, <span class="string">&quot;id&quot;</span>&gt;;</span><br><span class="line"><span class="comment">// Hover 正確地給出了聯合型別的必填化版本</span></span><br><span class="line"><span class="comment">//type GameProductWithoutId = Omit&lt;Game, &quot;id&quot;&gt; | Omit&lt;VideoGame, &quot;id&quot;&gt; | Omit&lt;PCGame, &quot;id&quot;&gt;</span></span><br></pre></td></tr></table></figure><p>這將生成以下結構：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所以</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GameProductWithoutId</span> = </span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="built_in">string</span> &#125; | </span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="built_in">string</span>; <span class="attr">platform</span>: <span class="built_in">string</span>; <span class="attr">genre</span>: <span class="built_in">string</span> &#125; | </span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="built_in">string</span>; <span class="attr">systemRequirements</span>: <span class="built_in">string</span>; <span class="attr">hasDLC</span>: <span class="built_in">boolean</span> &#125;;</span><br></pre></td></tr></table></figure><p>現在，GameProductWithoutId 正確地成為了每個型別的 Union Type，並且成功地排除了 id 屬性。</p><h3 id="Distributive-Pick"><a href="#Distributive-Pick" class="headerlink" title="Distributive Pick"></a>Distributive Pick</h3><p>類似的，我們也可以定義一個 Distributive 的 Pick：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">DistributivePick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = T <span class="keyword">extends</span> <span class="built_in">any</span></span><br><span class="line">  ? <span class="title class_">Pick</span>&lt;T, K&gt;</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><p>這個 <code>Distributive</code> 版本的 <code>Pick</code> 確保了你所選擇的屬性實際存在於你正在操作的型別中，與內建的 <code>Pick</code> 行為一致。</p><h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p><code>Omit</code> 和 <code>Pick</code> 雖然在單一型別中表現良好，但在 <code>Union Types</code> 中，<br>它們並不是 <code>Distributive</code> 的，這可能導致意想不到的結果。<br>我們可以創建 <code>DistributiveOmit</code> 和 <code>DistributivePick</code>，<br>使它們能夠針對每個 <code>Union Type</code> 成員單獨進行操作，從而獲得更為預期的結果。<br>如果你在專案中遇到這類問題，記得可以考慮使用自定義的 <code>Distributive</code> 版本來處理 <code>Union Types</code>，這樣可以避免踩雷！</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前情提要&quot;&gt;&lt;a href=&quot;#前情提要&quot; class=&quot;headerlink&quot; title=&quot;前情提要&quot;&gt;&lt;/a&gt;前情提要&lt;/h2&gt;&lt;p&gt;在 TypeScript 中，Omit 和 Pick 是廣受喜愛的 Utility Types，&lt;br&gt;它們允許你從現有型別</summary>
      
    
    
    
    
    <category term="學習筆記" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
</feed>
