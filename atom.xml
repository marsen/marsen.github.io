<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Marsen&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/c2458ad941ad5f8ca05b12c705fd4912</icon>
  <subtitle>waiting to load</subtitle>
  <link href="https://blog.marsen.me/atom.xml" rel="self"/>
  
  <link href="https://blog.marsen.me/"/>
  <updated>2025-08-27T14:25:35.438Z</updated>
  <id>https://blog.marsen.me/</id>
  
  <author>
    <name>Marsen L.</name>
    <email>admin@marsen.me</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] æ€éº¼å»ºç«‹ä¸€å€‹ç¶²ç«™ï¼Ÿ(å››) - è‡ªè¨‚ç¶²åŸŸ EMail æ”¶å¯„ä¿¡(ä½¿ç”¨ Cloudflare èˆ‡ Brevo)</title>
    <link href="https://blog.marsen.me/2025/08/27/2025/brevo_smtp/"/>
    <id>https://blog.marsen.me/2025/08/27/2025/brevo_smtp/</id>
    <published>2025-08-27T14:19:02.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>å››å¹´å‰ã€Œ<a href="https://blog.marsen.me/2020/10/22/2020/google_domain_forward_mail/">æ€éº¼å»ºç«‹ä¸€å€‹ç¶²ç«™ï¼Ÿ(å››) - è‡ªè¨‚ç¶²åŸŸ EMail</a>ã€å·²éæ™‚äº†ï¼Œ<br>ç•¶æ™‚é€é Google Domain è¨­å®šäº†è‡ªå·±çš„ç¶²åŸŸä¿¡ç®±ï¼Œé‚£ç¨®æ“æœ‰ <code>admin@marsen.me</code> çš„å°ˆæ¥­åº¦çœŸçš„æ˜¯æ»¿åˆ°æº¢å‡ºä¾†ã€‚</p><p>ä½†æ˜¯ï¼Œç¾å¯¦ç¸½æ˜¯æ®˜é…·çš„ã€‚</p><p>2023 å¹´ Google Domain å®£å¸ƒåœæ­¢ç‡Ÿé‹ï¼Œæˆ‘é¸æ“‡è½‰ç§»åˆ°äº† Cloudflareã€‚</p><p>æ›´æ‚²åŠ‡çš„æ˜¯ï¼ŒGmail çš„æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ä¹Ÿåœ¨å®‰å…¨æ€§è€ƒé‡ä¸‹è¶Šä¾†è¶Šä¸è¢«æ¨è–¦ä½¿ç”¨ã€‚</p><p>Google å° Gmail SMTP çš„ä½¿ç”¨é™åˆ¶è¶Šä¾†è¶Šåš´æ ¼ã€‚</p><p>åœ¨é–‹å•Ÿ 2FA çš„æƒ…æ³ä¸‹ï¼Œåªèƒ½ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ï¼Œä½†æ˜¯ Google æœ¬èº«ä¹Ÿä¸æ¨è–¦é€™æ¨£ä½¿ç”¨å¯†ç¢¼ã€‚</p><h2 id="å•é¡Œåˆ†æ"><a href="#å•é¡Œåˆ†æ" class="headerlink" title="å•é¡Œåˆ†æ"></a>å•é¡Œåˆ†æ</h2><p>ç¾æœ‰å•é¡Œï¼š</p><ul><li>Google Domain åœæ­¢æœå‹™ï¼ŒCloudflare é›–ç„¶æ¥ç®¡äº†åŸŸåï¼Œä½†æ²’æœ‰æä¾›é¡ä¼¼çš„ä¿¡ç®±è½‰ç™¼æœå‹™</li><li>Gmail ç„¡æ³•ç¹¼çºŒä½¿ç”¨ Email Forwarding çš„å¯†ç¢¼æ–¹å¼ä¸å†è¢«æ¨è–¦ä½¿ç”¨ï¼Œæˆ‘ä¹Ÿæ²’æœ‰æŸ¥åˆ°æ›¿ä»£æ–¹æ¡ˆ</li></ul><p>éœ€æ±‚ï¼š</p><ul><li>èƒ½å¤ ä½¿ç”¨ <code>admin@marsen.me</code> æ”¶ä¿¡ï¼Œå·²å®Œæˆ(åœ¨ Cloudflare è¨­å®š Email Forwarding)</li><li>èƒ½å¤ ä»¥ <code>admin@marsen.me</code> å¯„ä¿¡ï¼Œè€Œä¸”ä¸æœƒè¢«æ¨™è¨˜ç‚ºå¯ç–‘éƒµä»¶</li><li>å…è²»æˆ–ä¾¿å®œçš„è§£æ±ºæ–¹æ¡ˆ</li><li>è¨­å®šè¦ç°¡å–®å¿«é€Ÿ</li></ul><h2 id="æŠ€è¡“é¸æ“‡çš„æ€è€ƒ"><a href="#æŠ€è¡“é¸æ“‡çš„æ€è€ƒ" class="headerlink" title="æŠ€è¡“é¸æ“‡çš„æ€è€ƒ"></a>æŠ€è¡“é¸æ“‡çš„æ€è€ƒ</h2><p>ç¶“éä¸€ç•ªèª¿ç ”ï¼Œæˆ‘æŠŠç›®æ¨™é–å®šåœ¨å¹¾å€‹ä¸»æµçš„ SMTP æœå‹™ï¼š</p><ol><li><strong>Brevo (åŸ Sendinblue)</strong>ï¼šå…è²»é¡åº¦æ¯å¤© 300 å°ä¿¡ï¼Œä»˜è²»æ–¹æ¡ˆ $25&#x2F;æœˆ</li><li><strong>Mailjet</strong>ï¼šå…è²»é¡åº¦æ¯å¤© 200 å°ä¿¡ï¼Œä»˜è²»æ–¹æ¡ˆ $17&#x2F;æœˆ</li><li><strong>SendGrid</strong>ï¼šå…è²»é¡åº¦æ¯å¤© 100 å°ä¿¡</li><li><strong>Amazon SES</strong>ï¼šæŒ‰é‡è¨ˆè²»ï¼Œè¶…ä¾¿å®œä½†è¨­å®šè¤‡é›œ</li></ol><p>ç¶œåˆè€ƒé‡ä¸‹ï¼Œæˆ‘é¸æ“‡ <strong>Brevo</strong> çš„ç†ç”±ï¼š</p><ul><li><strong>åƒ¹æ ¼æœ€åˆ’ç®—</strong>ï¼šå…è²»é¡åº¦æœ€é«˜ï¼ˆ300å°&#x2F;å¤©ï¼‰ï¼Œå°å€‹äººä½¿ç”¨ç¶½ç¶½æœ‰é¤˜</li><li><strong>åŠŸèƒ½å®Œæ•´</strong>ï¼šä¸åªæ˜¯ SMTPï¼Œé‚„æœ‰å®Œæ•´çš„éƒµä»¶è¡ŒéŠ·åŠŸèƒ½</li><li><strong>è¨­å®šè¶…å¿«</strong>ï¼šAPI æ•´åˆç°¡å–®ï¼Œæ–‡ä»¶é½Šå…¨</li><li><strong>ä¿¡è­½è‰¯å¥½</strong>ï¼šæ­æ´²å…¬å¸ï¼ŒGDPR åˆè¦ï¼Œä¿¡ä»¶åˆ°é”ç‡é«˜</li></ul><p>å‚™æ¡ˆæ˜¯ Mailjetï¼Œä½†æ—¢ç„¶ Brevo å¯¦éš›ä½¿ç”¨å¾ˆé †åˆ©ï¼Œæˆ‘å°±æ²’æœ‰å»è©¦äº†ã€‚</p><h2 id="å¯¦ä½œéç¨‹"><a href="#å¯¦ä½œéç¨‹" class="headerlink" title="å¯¦ä½œéç¨‹"></a>å¯¦ä½œéç¨‹</h2><h3 id="Step-1-è¨»å†Š-Brevo-å¸³è™Ÿ"><a href="#Step-1-è¨»å†Š-Brevo-å¸³è™Ÿ" class="headerlink" title="Step 1: è¨»å†Š Brevo å¸³è™Ÿ"></a>Step 1: è¨»å†Š Brevo å¸³è™Ÿ</h3><p>å‰å¾€ <a href="https://brevo.com/">Brevo å®˜ç¶²</a> è¨»å†Šå…è²»å¸³è™Ÿï¼Œéç¨‹å¾ˆç°¡å–®ï¼Œä¸éœ€è¦ä¿¡ç”¨å¡ã€‚</p><p>å¯ä»¥ç”¨ Google å¸³è™Ÿè¨»å†Šï¼Œä½†æ˜¯å¡«å¯«ä¸€äº›è³‡æ–™ï¼Œç¸½é«”ä¾†èªªä¸¦ä¸å†—é•·ç¹ç‘£ã€‚</p><h3 id="Step-2-è¨­å®š-Sending-Domain"><a href="#Step-2-è¨­å®š-Sending-Domain" class="headerlink" title="Step 2: è¨­å®š Sending Domain"></a>Step 2: è¨­å®š Sending Domain</h3><p>ç™»å…¥å¾Œå°ï¼Œé€²å…¥ã€ŒSenders &amp; IPã€â†’ã€ŒDomainsã€ï¼Œæ·»åŠ ä½ çš„åŸŸåï¼ˆå¦‚ <code>marsen.me</code>ï¼‰ã€‚</p><p>Brevo æœƒè¦æ±‚ä½ åœ¨ DNS åŸŸåè¨­å®šä¸­æ·»åŠ å¹¾ç­†è¨˜éŒ„(æˆ‘æ˜¯ä½¿ç”¨ Cloudflare)ä¾†é©—è­‰åŸŸåæ“æœ‰æ¬Šï¼š</p><p>è¨­å®šéç¨‹ä¹Ÿå¾ˆå‚»ç“œé»æ“Šè·Ÿè‘—æ“ä½œå°±æœƒå¼•å°ä½ ç™»å…¥ Cloudflare çš„å¾Œå°ï¼Œä¸ä¿è¨¼å…¶ä»–åŸŸåå•†æœ‰é€™éº¼æ–¹ä¾¿ï¼Œ</p><p>æœƒåœ¨ Cloudflare DNS ç®¡ç†ä¸­æ·»åŠ ï¼š2 ç­† CNAME èˆ‡ 2 ç­† TXT è¨˜éŒ„ï¼Œæ‡‰è©²æ˜¯è®“ Brevo é©—è¨¼ç¶²åŸŸæ‰€æœ‰æ¬Šçš„ã€‚</p><p>DNS ç”Ÿæ•ˆå¾Œï¼ŒBrevo å°±æœƒé©—è­‰é€šéã€‚</p><h3 id="Step-3-è¨­å®šæ”¶ä¿¡"><a href="#Step-3-è¨­å®šæ”¶ä¿¡" class="headerlink" title="Step 3: è¨­å®šæ”¶ä¿¡"></a>Step 3: è¨­å®šæ”¶ä¿¡</h3><p>è¨­å®š Email Forwarding é€™éƒ¨åˆ†æˆ‘ç›´æ¥åœ¨ Cloudflare è¨­å®šï¼š</p><p>ã€ŒEmailã€â†’ã€ŒEmail Routingã€â†’ã€ŒRoutesã€</p><p>æ·»åŠ è½‰ç™¼è¦å‰‡ï¼š</p><p>å¾ï¼š<code>admin@marsen.me</code> åˆ°æˆ‘çš„ gmail</p><p>é€™æ¨£å°±èƒ½æ”¶åˆ°å¯„å¾€è‡ªè¨‚åŸŸåçš„ä¿¡äº†ã€‚</p><h3 id="Step-4-è¨­å®š-Gmail-ä½¿ç”¨-Brevo-SMTP"><a href="#Step-4-è¨­å®š-Gmail-ä½¿ç”¨-Brevo-SMTP" class="headerlink" title="Step 4: è¨­å®š Gmail ä½¿ç”¨ Brevo SMTP"></a>Step 4: è¨­å®š Gmail ä½¿ç”¨ Brevo SMTP</h3><p>é€²å…¥ Gmail è¨­å®š &gt; å¸³æˆ¶å’ŒåŒ¯å…¥ &gt; æ–°å¢å¦ä¸€å€‹é›»å­éƒµä»¶åœ°å€ï¼š</p><ul><li>åç¨±ï¼šMarsen</li><li>é›»å­éƒµä»¶åœ°å€ï¼š<code>admin@marsen.me</code></li><li>SMTP ä¼ºæœå™¨ï¼š<code>smtp-relay.brevo.com</code></li><li>é€šè¨ŠåŸ ï¼š587</li><li>ä½¿ç”¨è€…åç¨±ï¼šä½ çš„ Brevo å¸³è™Ÿ email</li><li>å¯†ç¢¼ï¼šå» Brevo å¾Œå°ã€ŒAccount Settingsã€â†’ã€ŒSMTP &amp; APIã€ç”Ÿæˆçš„ SMTP Key</li><li>è¨­å®šå®Œæˆå¾Œï¼ŒGmail æœƒå¯„é©—è­‰ä¿¡ï¼Œç¢ºèªå¾Œæ”¶åˆ°çš„ä¿¡æ‰ä¸æœƒæœ‰è­¦å‘Šã€‚</li></ul><h2 id="å¯¦æ¸¬çµæœ"><a href="#å¯¦æ¸¬çµæœ" class="headerlink" title="å¯¦æ¸¬çµæœ"></a>å¯¦æ¸¬çµæœ</h2><p>è¨­å®šå®Œæˆå¯¦æ¸¬ï¼š</p><ul><li>âœ… æ”¶ä¿¡æ­£å¸¸ï¼šå¯„åˆ° <code>admin@marsen.me</code> çš„ä¿¡éƒ½èƒ½åœ¨ Gmail æ”¶åˆ°</li><li>âœ… å¯„ä¿¡æ­£å¸¸ï¼šå¾ Gmail å¯ä»¥é¸æ“‡ç”¨ <code>admin@marsen.me</code> å¯„ä¿¡</li><li>âœ… ä¿¡è­½è‰¯å¥½ï¼šæ”¶ä»¶è€…ä¸æœƒçœ‹åˆ°ã€Œæœªé©—è­‰ã€è­¦å‘Š</li></ul><p>æ•´å€‹è¨­å®šéç¨‹ä¸åˆ° 20 åˆ†é˜ã€‚</p><h2 id="ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ"><a href="#ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ" class="headerlink" title="ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ"></a>ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ</h2><p><strong>DNS ç”Ÿæ•ˆæ™‚é–“</strong><br>SPFã€DKIM è¨˜éŒ„å¯èƒ½éœ€è¦å¹¾å€‹å°æ™‚æ‰æœƒå®Œå…¨ç”Ÿæ•ˆï¼Œä¸è¦æ€¥è‘—æ¸¬è©¦ã€‚</p><p>ä½†æ˜¯æˆ‘å¯¦æ¸¬ç´„å¹¾åˆ†é˜å°±ç”Ÿæ•ˆäº†ã€‚</p><p><strong>SMTP Key ä¸æ˜¯å¯†ç¢¼</strong><br>Brevo çš„ SMTP Key æ˜¯å°ˆé–€çµ¦ API å’Œ SMTP ç”¨çš„ï¼Œä¸æ˜¯ä½ ç™»å…¥å¯†ç¢¼ã€‚</p><p><strong>å…è²»é¡åº¦é™åˆ¶</strong><br>æ¯å¤© 300 å°ä¿¡å°æˆ‘å€‹äººä½¿ç”¨å¾ˆå¤ ï¼Œä½†å¦‚æœä½ è¦å¤§é‡å¯„ä¿¡ï¼Œè¨˜å¾—å‡ç´šä»˜è²»æ–¹æ¡ˆã€‚</p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://brevo.com/">Brevo å®˜æ–¹ç¶²ç«™</a></li><li><a href="https://support.google.com/accounts/answer/185833">é‡è¦äº‹é …ï¼šæˆ‘å€‘ä¸å»ºè­°ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼</a></li><li><a href="https://blog.marsen.me/2020/10/22/2020/google_domain_forward_mail/">æ€éº¼å»ºç«‹ä¸€å€‹ç¶²ç«™ï¼Ÿ(å››) - è‡ªè¨‚ç¶²åŸŸ EMail</a> (2020å¹´èˆŠæ–‡)</li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;å››å¹´å‰ã€Œ&lt;a href=&quot;https://blog.marsen.me/2020/10/22/2020/google_dom</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [æ¶æ§‹ç­†è¨˜] Clean Architecture åˆ†å±¤è·è²¬çš„åæ€</title>
    <link href="https://blog.marsen.me/2025/08/12/2025/backend-architecture-layer-design-principles/"/>
    <id>https://blog.marsen.me/2025/08/12/2025/backend-architecture-layer-design-principles/</id>
    <published>2025-08-12T05:29:15.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘åœ¨ Code Review æ™‚é‡åˆ°ä¸€å€‹æœ‰è¶£çš„é¡Œç›®ï¼š</p><p>æª”æ¡ˆä¸Šå‚³åŠŸèƒ½ä¸­ï¼Œæª”æ¡ˆç·¨ç¢¼ä¿®å¾©æ‡‰è©²æ”¾åœ¨ Middleware é‚„æ˜¯ UseCaseï¼Ÿ</p><p>é€™å€‹å•é¡Œå¼•ç™¼äº†æˆ‘å° Clean Architecture åˆ†å±¤è·è²¬çš„é‡æ–°æ€è€ƒï¼Œèˆ‡åœ˜éšŠèƒŒå¾Œçš„è¨­è¨ˆå“²å­¸ã€‚</p><h2 id="å•é¡ŒèƒŒæ™¯"><a href="#å•é¡ŒèƒŒæ™¯" class="headerlink" title="å•é¡ŒèƒŒæ™¯"></a>å•é¡ŒèƒŒæ™¯</h2><p>åœ¨ä¸€å€‹æ¡ç”¨ Clean Architecture çš„å°ˆæ¡ˆä¸­ï¼Œæˆ‘å€‘æœ‰å…©å€‹æª”æ¡ˆä¸Šå‚³åŠŸèƒ½ï¼š</p><ul><li><strong>çŸ¥è­˜åº«æª”æ¡ˆä¸Šå‚³</strong> - æ”¯æ´ PDFã€Wordã€åœ–ç‰‡ç­‰å¤šç¨®æ ¼å¼</li><li><strong>åˆç´„æª”æ¡ˆä¸Šå‚³</strong> - åŸå§‹åˆç´„æ”¯æ´ PDF&#x2F;Wordï¼Œç°½ç½²å¾Œåˆç´„åªæ”¯æ´ PDF</li></ul><p>ç•¶å‰ç³»çµ±æ¶æ§‹åŒ…å«ï¼š</p><ul><li><strong>Middleware</strong> - Express ä¸­ä»‹è»Ÿé«”å±¤</li><li><strong>Controller</strong> - HTTP è«‹æ±‚è™•ç†å±¤  </li><li><strong>UseCase</strong> - æ¥­å‹™é‚è¼¯å±¤</li><li><strong>Service</strong> - åŸºç¤è¨­æ–½æœå‹™å±¤</li></ul><h2 id="æ ¸å¿ƒå•é¡Œï¼šåˆ†å±¤è·è²¬å¦‚ä½•åŠƒåˆ†ï¼Ÿ"><a href="#æ ¸å¿ƒå•é¡Œï¼šåˆ†å±¤è·è²¬å¦‚ä½•åŠƒåˆ†ï¼Ÿ" class="headerlink" title="æ ¸å¿ƒå•é¡Œï¼šåˆ†å±¤è·è²¬å¦‚ä½•åŠƒåˆ†ï¼Ÿ"></a>æ ¸å¿ƒå•é¡Œï¼šåˆ†å±¤è·è²¬å¦‚ä½•åŠƒåˆ†ï¼Ÿ</h2><p>ä»¥ä¸‹é‚è¼¯æ‡‰è©²æ”¾åœ¨å“ªä¸€å±¤ï¼Ÿ</p><ol><li><strong>æª”æ¡ˆç·¨ç¢¼ä¿®å¾©</strong> - è§£æ±ºä¸­æ–‡æª”åäº‚ç¢¼å•é¡Œ (latin1 â†’ utf8)</li><li><strong>æª”æ¡ˆé¡å‹é©—è­‰</strong> - æª¢æŸ¥ MIME type æ˜¯å¦ç¬¦åˆæ¥­å‹™éœ€æ±‚  </li><li><strong>æª”æ¡ˆå¤§å°é™åˆ¶</strong> - æ ¹æ“šä¸åŒæ¥­å‹™å ´æ™¯è¨­å®šä¸åŒå¤§å°é™åˆ¶</li><li><strong>JWT Token é©—è­‰</strong> - æª¢æŸ¥ä½¿ç”¨è€…èº«ä»½</li><li><strong>æª”æ¡ˆå…§å®¹è§£æ</strong> - æå– PDF&#x2F;Word æ–‡ä»¶å…§å®¹</li></ol><p>åˆ†ææ€è·¯ â€” è·è²¬è§’åº¦</p><h3 id="Middleware-çš„è·è²¬ï¼šåå‘åŸºç¤è¨­æ–½"><a href="#Middleware-çš„è·è²¬ï¼šåå‘åŸºç¤è¨­æ–½" class="headerlink" title="Middleware çš„è·è²¬ï¼šåå‘åŸºç¤è¨­æ–½"></a>Middleware çš„è·è²¬ï¼šåå‘åŸºç¤è¨­æ–½</h3><p>æ§åˆ¶é€²å‡ºæµç¨‹ â†’ ä¾‹ï¼šAPI è«‹æ±‚é€²ä¾†å…ˆæª¢æŸ¥ Token</p><p>éæ¿¾èˆ‡è½‰æ›è³‡æ–™ â†’ ä¾‹ï¼šå°‡æ—¥æœŸå­—ä¸²è½‰æˆæ¨™æº–æ ¼å¼</p><p>ä¿è­·ç³»çµ±é‚Šç•Œ â†’ ä¾‹ï¼šæ””æˆªæœªæˆæ¬Šçš„å­˜å–</p><p>ä»¥ä¸‹ä¸èˆ‰ä¾‹:</p><ul><li><strong>è·¨é ˜åŸŸæŠ€è¡“å•é¡Œ</strong> (èªè­‰ã€ç·¨ç¢¼ã€éŒ¯èª¤è™•ç†)</li><li><strong>HTTP å”è­°ç›¸é—œ</strong> (è«‹æ±‚è§£æã€å›æ‡‰æ ¼å¼)  </li><li><strong>åŸºç¤è¨­æ–½é—œæ³¨é»</strong> (æ—¥èªŒã€ç›£æ§ã€å®‰å…¨)</li><li><strong>èˆ‡æ¥­å‹™ç„¡é—œçš„æŠ€è¡“ç´°ç¯€</strong></li></ul><h3 id="Use-Case-çš„è·è²¬ï¼šåå‘å•†æ¥­é‚è¼¯"><a href="#Use-Case-çš„è·è²¬ï¼šåå‘å•†æ¥­é‚è¼¯" class="headerlink" title="Use Case çš„è·è²¬ï¼šåå‘å•†æ¥­é‚è¼¯"></a>Use Case çš„è·è²¬ï¼šåå‘å•†æ¥­é‚è¼¯</h3><p>é©…å‹•æ ¸å¿ƒè¡Œç‚º â†’ ä¾‹ï¼šå»ºç«‹ä¸€ç­†è¨‚å–®æµç¨‹</p><p>åŸ·è¡Œæ¥­å‹™è¦å‰‡ â†’ ä¾‹ï¼šæª¢æŸ¥åº«å­˜æ˜¯å¦è¶³å¤ </p><p>å”èª¿å…§å¤–è³‡æº â†’ ä¾‹ï¼šå‘¼å«ä»˜æ¬¾æœå‹™ä¸¦æ›´æ–°è³‡æ–™åº«</p><p>ä»¥ä¸‹ä¸èˆ‰ä¾‹:</p><ul><li><strong>ç‰¹å®šæ¥­å‹™å ´æ™¯çš„è¦å‰‡</strong> (ä¸åŒæ¥­å‹™æœ‰ä¸åŒæª”æ¡ˆé™åˆ¶)</li><li><strong>é ˜åŸŸçŸ¥è­˜é©—è­‰</strong> (åˆç´„æ¨™é¡Œã€å…§å®¹æª¢æŸ¥)</li><li><strong>æ¥­å‹™æµç¨‹é‚è¼¯</strong> (æª”æ¡ˆè™•ç†ã€è³‡æ–™å„²å­˜)</li><li><strong>å‹•æ…‹é…ç½®çš„æ¥­å‹™åƒæ•¸</strong> (å¾ç’°å¢ƒè®Šæ•¸è®€å–çš„æ¥­å‹™é™åˆ¶)</li></ul><h2 id="å¯¦éš›æ¡ˆä¾‹åˆ†æ"><a href="#å¯¦éš›æ¡ˆä¾‹åˆ†æ" class="headerlink" title="å¯¦éš›æ¡ˆä¾‹åˆ†æ"></a>å¯¦éš›æ¡ˆä¾‹åˆ†æ</h2><h3 id="æª”æ¡ˆç·¨ç¢¼å•é¡Œ"><a href="#æª”æ¡ˆç·¨ç¢¼å•é¡Œ" class="headerlink" title="æª”æ¡ˆç·¨ç¢¼å•é¡Œ"></a>æª”æ¡ˆç·¨ç¢¼å•é¡Œ</h3><p>æŠ€è¡“å•é¡Œ â†’ æ•´å€‹ç³»çµ±ä¸€é«”é©ç”¨ï¼Œé¸ Middleware âœ…</p><p>ç´°ç¯€åˆ†æ:</p><ul><li>é€™æ˜¯ HTTP ä¸Šå‚³éç¨‹ä¸­çš„æŠ€è¡“å•é¡Œï¼Œä¸æ˜¯æ¥­å‹™é‚è¼¯</li><li>æ‰€æœ‰æª”æ¡ˆä¸Šå‚³éƒ½éœ€è¦é€™å€‹è™•ç†ï¼Œè·¨å¤šå€‹ UseCase</li><li>å±¬æ–¼è«‹æ±‚è™•ç†å±¤é¢çš„è²¬ä»»</li></ul><h3 id="æª”æ¡ˆé¡å‹é™åˆ¶"><a href="#æª”æ¡ˆé¡å‹é™åˆ¶" class="headerlink" title="æª”æ¡ˆé¡å‹é™åˆ¶"></a>æª”æ¡ˆé¡å‹é™åˆ¶</h3><p>æ¥­å‹™é‚è¼¯ â†’ ä¸åŒçš„ä¸Šå‚³ä»»å‹™æœ‰ä¸åŒé™åˆ¶ï¼Œå±¬å•†æ¥­é‚è¼¯ï¼Œé¸ UseCase âœ…</p><p>ç´°ç¯€åˆ†æ:</p><ul><li>ä¸åŒæ¥­å‹™å ´æ™¯æœ‰ä¸åŒçš„æª”æ¡ˆé¡å‹é™åˆ¶</li><li>é€™æ˜¯é ˜åŸŸçŸ¥è­˜ï¼Œéœ€è¦æ¥­å‹™é‚è¼¯åˆ¤æ–·</li><li>å¯èƒ½éš¨è‘—æ¥­å‹™éœ€æ±‚è®ŠåŒ–è€Œèª¿æ•´</li></ul><h3 id="é€™é ­çµ¦ä½ æƒ³"><a href="#é€™é ­çµ¦ä½ æƒ³" class="headerlink" title="é€™é ­çµ¦ä½ æƒ³"></a>é€™é ­çµ¦ä½ æƒ³</h3><p>å¦‚æœæª”æ¡ˆå¤§å°é™åˆ¶è¦å‹•æ…‹èª¿æ•´å‘¢ï¼Ÿ</p><h2 id="ç¸½çµ"><a href="#ç¸½çµ" class="headerlink" title="ç¸½çµ"></a>ç¸½çµ</h2><p>å¥½çš„æ¶æ§‹è¨­è¨ˆä¸æ˜¯æ†‘æ„Ÿè¦ºï¼Œè€Œæ˜¯è¦æœ‰æ˜ç¢ºçš„åŸå‰‡ï¼š</p><ul><li><strong>Middleware</strong> &#x3D; æŠ€è¡“åŸºç¤è¨­æ–½ï¼Œè™•ç† HTTP å±¤é¢çš„å•é¡Œ</li><li><strong>UseCase</strong> &#x3D; æ¥­å‹™é‚è¼¯é©—è­‰ï¼Œè™•ç†é ˜åŸŸç›¸é—œçš„è¦å‰‡</li></ul><p>é€™ç¨®åˆ†å±¤ä¸åªè®“ç¨‹å¼ç¢¼æ›´å¥½ç¶­è­·ï¼Œä¹Ÿè®“æ¸¬è©¦æ›´å®¹æ˜“æ’°å¯«ï¼Œæ›´ç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡ã€‚</p><p>ä¸‹æ¬¡åœ¨è¨­è¨ˆæ¶æ§‹æ™‚ï¼Œä¸å¦¨å•å•è‡ªå·±ï¼š</p><ul><li>é€™å€‹é‚è¼¯æ˜¯æŠ€è¡“å•é¡Œé‚„æ˜¯æ¥­å‹™å•é¡Œï¼Ÿ</li><li>é€™å€‹è¦å‰‡æœƒå› ç‚ºæ¥­å‹™éœ€æ±‚è®ŠåŒ–å—ï¼Ÿ</li><li>é€™å€‹è™•ç†é‚è¼¯éœ€è¦åœ¨å¤šå€‹åœ°æ–¹é‡è¤‡å—ï¼Ÿ</li></ul><p>Clean Architecture çš„ç²¾ç¥å°±åœ¨æ–¼ï¼š<strong>è®“æ¥­å‹™é‚è¼¯ç¨ç«‹æ–¼æŠ€è¡“ç´°ç¯€</strong>ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨ Code Review æ™‚é‡åˆ°ä¸€å€‹æœ‰è¶£çš„é¡Œç›®ï¼š&lt;/p&gt;
&lt;p&gt;æª”æ¡ˆä¸Šå‚³åŠŸèƒ½ä¸­ï¼Œæª”æ¡ˆç·¨ç¢¼ä¿®å¾©æ‡‰è©²æ”¾åœ¨ Middlewa</summary>
      
    
    
    
    
    <category term="å­¸ç¿’ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å­¸ç¿’ç­†è¨˜] Node.js æª”æ¡ˆæ“ä½œ mkdir çš„æ­£ç¢ºå§¿å‹¢</title>
    <link href="https://blog.marsen.me/2025/08/07/2025/race-condition-in-file-storage/"/>
    <id>https://blog.marsen.me/2025/08/07/2025/race-condition-in-file-storage/</id>
    <published>2025-08-07T05:15:41.000Z</published>
    <updated>2025-08-27T14:25:35.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>åœ¨ code review ä¸­ RD å¯«äº†ä»¥ä¸‹çš„ç¨‹å¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">exists</span>(fullPath)) &#123;</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¼¼åˆç†çš„ã€Œæª¢æŸ¥ç„¶å¾ŒåŸ·è¡Œã€ï¼ˆCheck-Then-Actï¼‰æ¨¡å¼å¯èƒ½å°è‡´çš„ä½µç™¼å•é¡Œã€‚</p><p>å‡è¨­å…©å€‹è«‹æ±‚åŒæ™‚ä¸Šå‚³æª”æ¡ˆåˆ°åŒä¸€å€‹ä¸å­˜åœ¨çš„ç›®éŒ„ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ™‚é–“ç·šï¼š</span><br><span class="line">T1: è«‹æ±‚A åŸ·è¡Œ this.exists(fullPath) â†’ è¿”å› false (ç›®éŒ„ä¸å­˜åœ¨)</span><br><span class="line">T2: è«‹æ±‚B åŸ·è¡Œ this.exists(fullPath) â†’ è¿”å› false (ç›®éŒ„ä¸å­˜åœ¨)</span><br><span class="line">T3: è«‹æ±‚A åŸ·è¡Œ mkdir(fullPath) â†’ æˆåŠŸå»ºç«‹ç›®éŒ„</span><br><span class="line">T4: è«‹æ±‚B åŸ·è¡Œ mkdir(fullPath) â†’ å¯èƒ½æ‹‹å‡º EEXIST éŒ¯èª¤(fs.promises.mkdir å·²åœ¨åº•å±¤æ’é™¤é€™å€‹å•é¡Œ)</span><br></pre></td></tr></table></figure><p>é›–ç„¶ä½¿ç”¨äº† <code>recursive: true</code>ï¼Œé‚£å‰é¢çš„æª¢æŸ¥å¾ˆå¯èƒ½æ˜¯ä¸å¿…è¦çš„è¡Œç‚ºã€‚</p><h3 id="ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ"><a href="#ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ"></a>ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ</h3><p>å•é¡Œçš„æ ¹æºåœ¨æ–¼<strong>æ™‚é–“çª—å£</strong>ã€‚å…©å€‹æ­¥é©Ÿä¹‹é–“å­˜åœ¨æ™‚é–“å·®ï¼Œè€Œé€™å€‹æ™‚é–“å·®å°±æ˜¯ç«¶æ…‹æ¢ä»¶çš„æº«åºŠï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æœ‰æ™‚é–“çª—å£çš„å¯«æ³•</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">exists</span>(fullPath)) &#123;  <span class="comment">// æ­¥é©Ÿ1: æª¢æŸ¥</span></span><br><span class="line">  <span class="comment">// ğŸ‘† é€™è£¡åˆ°ä¸‹é¢ä¹‹é–“å°±æ˜¯å±éšªçš„æ™‚é–“çª—å£</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)  <span class="comment">// æ­¥é©Ÿ2: åŸ·è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ±ºæ–¹æ¡ˆ"><a href="#è§£æ±ºæ–¹æ¡ˆ" class="headerlink" title="è§£æ±ºæ–¹æ¡ˆ"></a>è§£æ±ºæ–¹æ¡ˆ</h2><h3 id="æ–¹æ³•1-ç›´æ¥ä½¿ç”¨-mkdirï¼ˆæ¨è–¦ï¼‰"><a href="#æ–¹æ³•1-ç›´æ¥ä½¿ç”¨-mkdirï¼ˆæ¨è–¦ï¼‰" class="headerlink" title="æ–¹æ³•1: ç›´æ¥ä½¿ç”¨ mkdirï¼ˆæ¨è–¦ï¼‰"></a>æ–¹æ³•1: ç›´æ¥ä½¿ç”¨ mkdirï¼ˆæ¨è–¦ï¼‰</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">uploadFile</span>(<span class="attr">file</span>: <span class="title class_">UploadedFile</span>, pathToStore?: <span class="string">`/<span class="subst">$&#123;<span class="built_in">string</span>&#125;</span>`</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fullPath = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.uploadDir&#125;</span><span class="subst">$&#123;pathToStore ?? <span class="string">&#x27;&#x27;</span>&#125;</span>`</span></span><br><span class="line">  <span class="comment">// ç›´æ¥å»ºç«‹ç›®éŒ„ï¼Œrecursive: true æœƒè‡ªå‹•è™•ç†å·²å­˜åœ¨çš„æƒ…æ³</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="keyword">const</span> uploadPath = path.<span class="title function_">join</span>(fullPath, file.<span class="property">originalName</span>)</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">writeFile</span>(uploadPath, file.<span class="property">buffer</span>)</span><br><span class="line">  <span class="keyword">return</span> uploadPath</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç‚ºä»€éº¼-recursive-true-å·²ç¶“è¶³å¤ "><a href="#ç‚ºä»€éº¼-recursive-true-å·²ç¶“è¶³å¤ " class="headerlink" title="ç‚ºä»€éº¼ recursive: true å·²ç¶“è¶³å¤ "></a>ç‚ºä»€éº¼ recursive: true å·²ç¶“è¶³å¤ </h2><p>æ ¹æ“š Node.js å®˜æ–¹æ–‡ä»¶ï¼Œ<code>fs.promises.mkdir(path, &#123; recursive: true &#125;)</code> å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li><strong>è‡ªå‹•å»ºç«‹çˆ¶ç›®éŒ„</strong>ï¼šå¦‚æœçˆ¶ç›®éŒ„ä¸å­˜åœ¨æœƒè‡ªå‹•å»ºç«‹</li><li><strong>è™•ç†å·²å­˜åœ¨ç›®éŒ„</strong>ï¼šç•¶ <code>recursive</code> ç‚º <code>true</code> æ™‚ï¼Œå¦‚æœç›®éŒ„å·²å­˜åœ¨ä¸æœƒæ‹‹å‡ºéŒ¯èª¤</li><li><strong>ç°¡åŒ–éŒ¯èª¤è™•ç†</strong>ï¼šé¿å…äº†æ‰‹å‹•æª¢æŸ¥ç›®éŒ„æ˜¯å¦å­˜åœ¨çš„éœ€è¦</li></ol><p>å®˜æ–¹ç¯„ä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mkdir &#125; <span class="keyword">from</span> <span class="string">&#x27;node:fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create ./tmp/a/apple, regardless of whether ./tmp and ./tmp/a exist.</span></span><br><span class="line"><span class="title function_">mkdir</span>(<span class="string">&#x27;./tmp/a/apple&#x27;</span>, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">é€™å°±åƒé¤å»³é»é¤çš„å·®åˆ¥ï¼š</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`typescript</span></span><br><span class="line"><span class="string">// âŒ ç«¶æ…‹æ¢ä»¶ç‰ˆæœ¬ï¼ˆä¸å¥½çš„åšæ³•ï¼‰</span></span><br><span class="line"><span class="string">if (é¤å»³æ²’æœ‰æº–å‚™æˆ‘è¦çš„é¤) &#123;  // æª¢æŸ¥</span></span><br><span class="line"><span class="string">  è«‹å»šå¸«æº–å‚™é€™é“é¤        // åŸ·è¡Œ</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// å•é¡Œï¼šå…©å€‹å®¢äººå¯èƒ½åŒæ™‚æª¢æŸ¥åˆ°ã€Œæ²’æœ‰ã€ï¼Œç„¶å¾Œéƒ½è¦æ±‚æº–å‚™</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// âœ… ç›´æ¥åŸ·è¡Œç‰ˆæœ¬ï¼ˆå¥½çš„åšæ³•ï¼‰</span></span><br><span class="line"><span class="string">è«‹å»šå¸«æº–å‚™é€™é“é¤ï¼Œå¦‚æœå·²ç¶“æœ‰äº†å°±ä¸ç”¨é‡è¤‡æº–å‚™</span></span><br><span class="line"><span class="string">// å»šå¸«æœƒè‡ªå·±åˆ¤æ–·æ˜¯å¦éœ€è¦æº–å‚™ï¼Œé¿å…é‡è¤‡å·¥ä½œ</span></span><br></pre></td></tr></table></figure><h2 id="æ•ˆèƒ½å„ªå‹¢"><a href="#æ•ˆèƒ½å„ªå‹¢" class="headerlink" title="æ•ˆèƒ½å„ªå‹¢"></a>æ•ˆèƒ½å„ªå‹¢</h2><p>ä¿®å¾©å¾Œé‚„æœ‰æ„å¤–çš„æ•ˆèƒ½æå‡ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®å¾©å‰ï¼š2æ¬¡ç³»çµ±èª¿ç”¨</span></span><br><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">exists</span>(fullPath)  <span class="comment">// ç³»çµ±èª¿ç”¨1: stat()</span></span><br><span class="line"><span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>()    <span class="comment">// ç³»çµ±èª¿ç”¨2: mkdir()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¾©å¾Œï¼š1æ¬¡ç³»çµ±èª¿ç”¨  </span></span><br><span class="line"><span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)  <span class="comment">// ç³»çµ±èª¿ç”¨1: mkdir()</span></span><br></pre></td></tr></table></figure><h2 id="ç¶“é©—æ•™è¨“"><a href="#ç¶“é©—æ•™è¨“" class="headerlink" title="ç¶“é©—æ•™è¨“"></a>ç¶“é©—æ•™è¨“</h2><ol><li><strong>é¿å… Check-Then-Act æ¨¡å¼</strong>ï¼šé€™æ˜¯ä½µç™¼ç¨‹å¼è¨­è¨ˆçš„ç¶“å…¸é™·é˜±ï¼Œä¸éé€™æ¬¡æ¡ˆä¾‹ï¼ŒåŸ·è¡Œçš„åº•å±¤å¯¦ä½œå·²è™•ç†å¥½ï¼Œæ‰€ä»¥ä¸æœƒæœ‰å•é¡Œ</li><li><strong>ä¿¡ä»»ç³»çµ±èª¿ç”¨</strong>ï¼šç¾ä»£ API é€šå¸¸å·²ç¶“è€ƒæ…®äº†ä½µç™¼å ´æ™¯</li><li><strong>ç°¡å–®å°±æ˜¯ç¾</strong>ï¼šç§»é™¤ä¸å¿…è¦çš„æª¢æŸ¥é‚è¼¯ï¼Œç¨‹å¼ç¢¼æ›´ç°¡æ½”ä¹Ÿæ›´å®‰å…¨</li></ol><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://nodejs.org/api/fs.html#fsmkdirpath-options-callback">Nodejs - fsPromises.mkdir(path[, options])</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;åœ¨ code review ä¸­ RD å¯«äº†ä»¥ä¸‹çš„ç¨‹å¼&lt;/p&gt;
&lt;figure class=&quot;highlight typesc</summary>
      
    
    
    
    
    <category term="å­¸ç¿’ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] AI Agent å¯¦ä½œ Web Search APIï¼šå¾è¨­è¨ˆåˆ°éƒ¨ç½²çš„å®Œæ•´è¨˜éŒ„</title>
    <link href="https://blog.marsen.me/2025/07/31/2025/ai_google_search_api/"/>
    <id>https://blog.marsen.me/2025/07/31/2025/ai_google_search_api/</id>
    <published>2025-07-31T08:51:10.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘è³¼è²· Claude Codeï¼Œåœ¨æ­¤åŒæ™‚ä¹Ÿæœ‰è©¦ç”¨ Github Copilot &#x2F; Gitlab Duo &#x2F; Gemini &#x2F; Amazon Q</p><p>å‰›å¥½æ‰‹ä¸Šæœ‰éœ€æ±‚ï¼Œæ˜¯ç°¡å–®çš„ API ä¸²æ¥ï¼Œä½†æ˜¯æˆ‘å€‘çš„ç³»çµ±æ¶æ§‹æœ‰ä¸€äº›åªæœ‰åœ˜éšŠçŸ¥é“çš„ Know Howã€‚</p><p>æˆ‘æƒ³è©¦è©¦ç”¨ AI Agent ä¾†å”åŠ©æˆ‘è™•ç†é€™äº›é–‹ç™¼ï¼Œéœ€æ±‚ç°¡å–®æ˜ç¢ºï¼Œä½†æ˜¯æŠ€è¡“ç´°ç¯€ä¸¦ä¸å°‘ï¼Œ</p><p>å¦‚æœæ˜¯æ–°é€² RD(å³ä½¿æœ‰é–‹ç™¼ç¶“é©—)ä¹Ÿä¸è¦‹å¾—èƒ½æŒæ¡å¾—å¾ˆå¥½ï¼Œæˆ‘ä¾†è©¦è©¦çœ‹ AI Agent èƒ½ä½œä»€éº¼ç¨‹åº¦ã€‚</p><p>é€™ç¯‡æ–‡ç« è¨˜éŒ„æˆ‘åœ¨åŸºæ–¼ Clean Architecture çš„ Node.js API ç³»çµ±ä¸­å¯¦ä½œ Web Search åŠŸèƒ½çš„å®Œæ•´éç¨‹ï¼ŒåŒ…å«æ¶æ§‹è¨­è¨ˆã€æ¬Šé™ç®¡ç†ã€éŒ¯èª¤è™•ç†ç­‰ç´°ç¯€ã€‚</p><h2 id="ç³»çµ±æ¶æ§‹èƒŒæ™¯"><a href="#ç³»çµ±æ¶æ§‹èƒŒæ™¯" class="headerlink" title="ç³»çµ±æ¶æ§‹èƒŒæ™¯"></a>ç³»çµ±æ¶æ§‹èƒŒæ™¯</h2><p>å°ˆæ¡ˆæ¡ç”¨ <strong>Clean Architecture</strong> æ­é… <strong>ä¾è³´æ³¨å…¥ (Inversify)</strong>ï¼ŒæŠ€è¡“æ£§åŒ…å«ï¼š</p><ul><li>TypeScript + Express.js</li><li>TypeORM (è³‡æ–™åº« ORM)</li><li>Inversify (ä¾è³´æ³¨å…¥å®¹å™¨)</li><li>JWT (èº«ä»½é©—è­‰)</li><li>Zod (åƒæ•¸é©—è­‰)</li></ul><p>æ¶æ§‹åˆ†ç‚ºå››å€‹ä¸»è¦å±¤ç´šï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ adapters/          # å¤–éƒ¨ä»‹é¢å±¤ - æ§åˆ¶å™¨</span><br><span class="line">â”œâ”€â”€ domain/           # é ˜åŸŸå±¤ - æ ¸å¿ƒæ¥­å‹™é‚è¼¯  </span><br><span class="line">â”œâ”€â”€ infrastructure/   # åŸºç¤è¨­æ–½å±¤ - å¤–éƒ¨ä¾è³´å¯¦ä½œ  </span><br><span class="line">â””â”€â”€ useCases/        # æ‡‰ç”¨å±¤ - æ¥­å‹™ç”¨ä¾‹</span><br></pre></td></tr></table></figure><h2 id="éœ€æ±‚åˆ†æèˆ‡è¨­è¨ˆæ±ºç­–"><a href="#éœ€æ±‚åˆ†æèˆ‡è¨­è¨ˆæ±ºç­–" class="headerlink" title="éœ€æ±‚åˆ†æèˆ‡è¨­è¨ˆæ±ºç­–"></a>éœ€æ±‚åˆ†æèˆ‡è¨­è¨ˆæ±ºç­–</h2><h3 id="API-è¦æ ¼å®šç¾©"><a href="#API-è¦æ ¼å®šç¾©" class="headerlink" title="API è¦æ ¼å®šç¾©"></a>API è¦æ ¼å®šç¾©</h3><ul><li><strong>ç«¯é»</strong>: <code>GET /api/v1/websearch?keyword=é—œéµå­—</code></li><li><strong>è¼¸å…¥</strong>: Query åƒæ•¸ <code>&#123; keyword: string &#125;</code></li><li><strong>è¼¸å‡º</strong>: <code>&#123; data: [&#123; title: string, url: string, description: string &#125;] &#125;</code></li><li><strong>çµæœæ•¸</strong>: 10 ç­†</li><li><strong>æ¬Šé™</strong>: æ‰€æœ‰ API éƒ½éœ€è¦æ¬Šé™æª¢æŸ¥(æˆ‘å€‘ä¹‹å‰é–‹ç™¼å¥½çš„ RBAC æ¬Šé™ç³»çµ± )ï¼Œä¸€å€‹åŠŸèƒ½å°æ‡‰ä¸€å€‹æ¬Šé™ï¼Œç‚ºæ­¤æˆ‘éœ€è¦æ–°å¢ <code>web_search</code> æ¬Šé™</li></ul><h3 id="é—œéµè¨­è¨ˆæ±ºç­–"><a href="#é—œéµè¨­è¨ˆæ±ºç­–" class="headerlink" title="é—œéµè¨­è¨ˆæ±ºç­–"></a>é—œéµè¨­è¨ˆæ±ºç­–</h3><p><strong>1. æ§åˆ¶å™¨é¸æ“‡</strong>  </p><p>æ±ºå®šå°‡åŠŸèƒ½æ”¾åœ¨ <code>BasicController</code> è€Œé <code>ProjController</code>ï¼Œå› ç‚ºé€™æ˜¯é€šç”¨åŠŸèƒ½è€Œéç‰¹å®šæ¥­å‹™é‚è¼¯ã€‚</p><p>| é€™è£¡æˆ‘åœ¨éœ€æ±‚ä¸Šæœ‰æ˜ç¢ºå‘ŠçŸ¥ AIï¼Œå¯¦ä½œä¸Šä¹Ÿæ²’æœ‰å•é¡Œ</p><p><strong>2. ä¾è³´é—œä¿‚</strong><br>åš´æ ¼éµå¾ª Clean Architecture çš„ä¾è³´è¦å‰‡ï¼š</p><p>| ä¹Ÿæœ‰å¯«å…¥ CLAUDE.md çš„é–‹ç™¼æº–å‰‡ä¸­ï¼Œä½† AI æœƒå¸¸å¸¸å¿˜è¨˜é€™ä»¶äº‹</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Controller â†’ UseCase â†’ Service â†’ External API</span><br></pre></td></tr></table></figure><p><strong>3. ç’°å¢ƒè®Šæ•¸ç­–ç•¥</strong>  </p><p>å°‡ Google API è¨­å®šç‚ºéå¿…è¦æ¬„ä½ï¼Œæœªè¨­å®šæ™‚è­¦å‘Šä½†ä¸ä¸­æ–·å…¶ä»–æœå‹™ã€‚</p><p>| AI æä¾›å¾ˆå¥½çš„å»ºè­°ä¸¦å¿«é€Ÿå®Œæˆé–‹ç™¼</p><p><strong>4. éŒ¯èª¤è™•ç†è¨­è¨ˆ</strong>  </p><ul><li>503: API æœªè¨­å®š</li><li>502: API å‘¼å«å¤±æ•—  </li><li>400: åƒæ•¸éŒ¯èª¤ (Zod é©—è­‰)</li></ul><h2 id="å¯¦ä½œæ­¥é©Ÿè©³è§£"><a href="#å¯¦ä½œæ­¥é©Ÿè©³è§£" class="headerlink" title="å¯¦ä½œæ­¥é©Ÿè©³è§£"></a>å¯¦ä½œæ­¥é©Ÿè©³è§£</h2><h3 id="Phase-1-ç’°å¢ƒè¨­å®šæ“´å……"><a href="#Phase-1-ç’°å¢ƒè¨­å®šæ“´å……" class="headerlink" title="Phase 1: ç’°å¢ƒè¨­å®šæ“´å……"></a>Phase 1: ç’°å¢ƒè¨­å®šæ“´å……</h3><p>é¦–å…ˆæ“´å……ç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œæ–°å¢ Google Search API ç›¸é—œè¨­å®šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env.example</span></span><br><span class="line"><span class="comment"># Google Search API Configuration</span></span><br><span class="line">GOOGLE_API_KEY=your_google_api_key</span><br><span class="line">GOOGLE_SEARCH_ENGINE_ID=your_search_engine_id  </span><br><span class="line">GOOGLE_SEARCH_API_URL=https://www.googleapis.com/customsearch/v1</span><br><span class="line">GOOGLE_SEARCH_RESULTS_COUNT=10</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ envConfigService.ts</strong><br>æ–°å¢ <code>getOptional()</code> æ–¹æ³•æ”¯æ´å¯é¸é…ç½®ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">getOptional</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="literal">undefined</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> process.<span class="property">env</span>[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Phase-2-æ¬Šé™ç³»çµ±æ•´åˆ"><a href="#Phase-2-æ¬Šé™ç³»çµ±æ•´åˆ" class="headerlink" title="Phase 2: æ¬Šé™ç³»çµ±æ•´åˆ"></a>Phase 2: æ¬Šé™ç³»çµ±æ•´åˆ</h3><p>å»ºç«‹è³‡æ–™åº«é·ç§»æª”æ¡ˆï¼Œæ–°å¢ <code>web_search</code> æ¬Šé™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> permissions (name, description) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;web_search&#x27;</span>, <span class="string">&#x27;Web Search API access permission&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ†é…çµ¦ admin å’Œ member è§’è‰²</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> role_permissions (role_id, permission_id) </span><br><span class="line"><span class="keyword">SELECT</span> r.id, p.id <span class="keyword">FROM</span> roles r, permissions p </span><br><span class="line"><span class="keyword">WHERE</span> r.name <span class="keyword">IN</span> (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;member&#x27;</span>) <span class="keyword">AND</span> p.name <span class="operator">=</span> <span class="string">&#x27;web_search&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="Phase-3-æ ¸å¿ƒæ¶æ§‹å¯¦ä½œ"><a href="#Phase-3-æ ¸å¿ƒæ¶æ§‹å¯¦ä½œ" class="headerlink" title="Phase 3: æ ¸å¿ƒæ¶æ§‹å¯¦ä½œ"></a>Phase 3: æ ¸å¿ƒæ¶æ§‹å¯¦ä½œ</h3><h4 id="1-å®šç¾©é ˜åŸŸä»‹é¢"><a href="#1-å®šç¾©é ˜åŸŸä»‹é¢" class="headerlink" title="1. å®šç¾©é ˜åŸŸä»‹é¢"></a>1. å®šç¾©é ˜åŸŸä»‹é¢</h4><p><strong>src&#x2F;domain&#x2F;interfaces&#x2F;webSearchService.ts</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">WebSearchService</span> &#123;</span><br><span class="line">  <span class="title function_">search</span>(<span class="attr">keyword</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">WebSearchResult</span>[]&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">WebSearchResult</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">url</span>: <span class="built_in">string</span>  </span><br><span class="line">  <span class="attr">description</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Google-Search-Service-å¯¦ä½œ"><a href="#2-Google-Search-Service-å¯¦ä½œ" class="headerlink" title="2. Google Search Service å¯¦ä½œ"></a>2. Google Search Service å¯¦ä½œ</h4><p><strong>src&#x2F;infrastructure&#x2F;services&#x2F;googleSearchService.ts</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GoogleSearchService</span> <span class="keyword">implements</span> <span class="title class_">WebSearchService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TYPES.HttpClient) <span class="keyword">private</span> <span class="keyword">readonly</span> httpClient: IHttpClient,</span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TYPES.EnvConfigService) <span class="keyword">private</span> <span class="keyword">readonly</span> envConfig: IEnvConfigService</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">search</span>(<span class="attr">keyword</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">WebSearchResult</span>[]&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> apiKey = <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">getOptional</span>(<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> searchEngineId = <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">getOptional</span>(<span class="string">&#x27;GOOGLE_SEARCH_ENGINE_ID&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!apiKey || !searchEngineId) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppError</span>(<span class="string">&#x27;Google Search API æœªè¨­å®š&#x27;</span>, <span class="number">503</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      <span class="attr">key</span>: apiKey,</span><br><span class="line">      <span class="attr">cx</span>: searchEngineId, </span><br><span class="line">      <span class="attr">q</span>: keyword,</span><br><span class="line">      <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">get</span>(<span class="string">&#x27;GOOGLE_SEARCH_RESULTS_COUNT&#x27;</span>, <span class="string">&#x27;10&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">httpClient</span>.<span class="title function_">get</span>(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">get</span>(<span class="string">&#x27;GOOGLE_SEARCH_API_URL&#x27;</span>), </span><br><span class="line">        &#123; params &#125;</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">transformGoogleResponse</span>(response.<span class="property">data</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppError</span>(<span class="string">&#x27;æœå°‹æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨&#x27;</span>, <span class="number">502</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">transformGoogleResponse</span>(<span class="attr">data</span>: <span class="built_in">any</span>): <span class="title class_">WebSearchResult</span>[] &#123;</span><br><span class="line">    <span class="keyword">if</span> (!data.<span class="property">items</span>) <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">items</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">title</span>: item.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">url</span>: item.<span class="property">link</span>,</span><br><span class="line">      <span class="attr">description</span>: item.<span class="property">snippet</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-UseCase-å±¤å¯¦ä½œ"><a href="#3-UseCase-å±¤å¯¦ä½œ" class="headerlink" title="3. UseCase å±¤å¯¦ä½œ"></a>3. UseCase å±¤å¯¦ä½œ</h4><p><strong>src&#x2F;useCases&#x2F;ExecuteWebSearch.ts</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ExecuteWebSearch</span> <span class="keyword">implements</span> <span class="title class_">IUseCase</span>&lt;<span class="title class_">ExecuteWebSearchDTO</span>, <span class="title class_">WebSearchResponseDTO</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TYPES.WebSearchService) <span class="keyword">private</span> <span class="keyword">readonly</span> webSearchService: WebSearchService</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">execute</span>(<span class="attr">input</span>: <span class="title class_">ExecuteWebSearchDTO</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">WebSearchResponseDTO</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">webSearchService</span>.<span class="title function_">search</span>(input.<span class="property">keyword</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">data</span>: results &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DTO å®šç¾©</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ExecuteWebSearchDTO</span> &#123;</span><br><span class="line">  <span class="attr">keyword</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">WebSearchResponseDTO</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">WebSearchResult</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-Controller-å±¤å¯¦ä½œ"><a href="#4-Controller-å±¤å¯¦ä½œ" class="headerlink" title="4. Controller å±¤å¯¦ä½œ"></a>4. Controller å±¤å¯¦ä½œ</h4><p><strong>src&#x2F;adapters&#x2F;controllers&#x2F;basicController.ts</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; z &#125; <span class="keyword">from</span> <span class="string">&#x27;zod&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Zod é©—è­‰ schema</span></span><br><span class="line"><span class="keyword">const</span> webSearchQuerySchema = z.<span class="title function_">object</span>(&#123;</span><br><span class="line">  <span class="attr">keyword</span>: z.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">1</span>, <span class="string">&#x27;keyword åƒæ•¸ç‚ºå¿…å¡«ä¸”ä¸èƒ½ç‚ºç©ºå­—ä¸²&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">webSearch</span>(<span class="attr">req</span>: <span class="title class_">Request</span>, <span class="attr">res</span>: <span class="title class_">Response</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ Zod é€²è¡Œåƒæ•¸é©—è­‰</span></span><br><span class="line">  <span class="keyword">const</span> &#123; keyword &#125; = webSearchQuerySchema.<span class="title function_">parse</span>(req.<span class="property">query</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="attr">input</span>: <span class="title class_">ExecuteWebSearchDTO</span> = &#123; keyword &#125;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">executeWebSearch</span>.<span class="title function_">execute</span>(input)</span><br><span class="line">  </span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-è·¯ç”±è¨­å®š"><a href="#5-è·¯ç”±è¨­å®š" class="headerlink" title="5. è·¯ç”±è¨­å®š"></a>5. è·¯ç”±è¨­å®š</h4><p><strong>src&#x2F;infrastructure&#x2F;routes&#x2F;basicRouter.ts</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¨»å†Šè·¯ç”±ï¼Œå…ˆåŸ·è¡Œæ¬Šé™æª¢æŸ¥ï¼Œå†åŸ·è¡Œæ¥­å‹™é‚è¼¯</span></span><br><span class="line">r.<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;basePath&#125;</span>/websearch`</span>, </span><br><span class="line">  auth.<span class="title function_">user</span>(<span class="string">&#x27;web_search&#x27;</span>),  <span class="comment">// æ¬Šé™ä¸­ä»‹è»Ÿé«”</span></span><br><span class="line">  <span class="title function_">asyncWrapper</span>(basicController.<span class="property">webSearch</span>.<span class="title function_">bind</span>(basicController))</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Phase-4-ä¾è³´æ³¨å…¥è¨­å®š"><a href="#Phase-4-ä¾è³´æ³¨å…¥è¨­å®š" class="headerlink" title="Phase 4: ä¾è³´æ³¨å…¥è¨­å®š"></a>Phase 4: ä¾è³´æ³¨å…¥è¨­å®š</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="comment">// è¨»å†Š UseCase</span></span><br><span class="line">container.<span class="property">bind</span>&lt;<span class="title class_">IUseCase</span>&lt;<span class="title class_">ExecuteWebSearchDTO</span>, <span class="title class_">WebSearchResponseDTO</span>&gt;&gt;(</span><br><span class="line">  <span class="variable constant_">TYPES</span>.<span class="property">ExecuteWebSearch</span></span><br><span class="line">).<span class="title function_">to</span>(<span class="title class_">ExecuteWebSearch</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¨»å†Š Service</span></span><br><span class="line">container.<span class="property">bind</span>&lt;<span class="title class_">WebSearchService</span>&gt;(</span><br><span class="line">  <span class="variable constant_">TYPES</span>.<span class="property">WebSearchService</span></span><br><span class="line">).<span class="title function_">to</span>(<span class="title class_">GoogleSearchService</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–° TYPES å¸¸æ•¸</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">TYPES</span> = &#123;</span><br><span class="line">  <span class="comment">// ... existing types</span></span><br><span class="line">  <span class="title class_">ExecuteWebSearch</span>: <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;ExecuteWebSearch&#x27;</span>),</span><br><span class="line">  <span class="title class_">WebSearchService</span>: <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;WebSearchService&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¸¬è©¦èˆ‡é©—è­‰"><a href="#æ¸¬è©¦èˆ‡é©—è­‰" class="headerlink" title="æ¸¬è©¦èˆ‡é©—è­‰"></a>æ¸¬è©¦èˆ‡é©—è­‰</h2><h3 id="æº–å‚™æ¸¬è©¦ç’°å¢ƒ-â€“-å–å¾—æ¸¬è©¦-Token"><a href="#æº–å‚™æ¸¬è©¦ç’°å¢ƒ-â€“-å–å¾—æ¸¬è©¦-Token" class="headerlink" title="æº–å‚™æ¸¬è©¦ç’°å¢ƒ â€“ å–å¾—æ¸¬è©¦ Token"></a>æº–å‚™æ¸¬è©¦ç’°å¢ƒ â€“ å–å¾—æ¸¬è©¦ Token</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X <span class="string">&#x27;POST&#x27;</span> <span class="string">&#x27;http://localhost:4578/api/v1/auth/login&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;accept: application/json&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;account&quot;: &quot;test_act&quot;, &quot;password&quot;: &quot;test_pwd&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ"><a href="#æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ" class="headerlink" title="æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ"></a>æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ</h3><p>| AIã€€æœƒè‡ªå‹•å¹«æˆ‘è·‘ End To End æ¸¬è©¦ï¼ˆæœ¬ä¾†æ˜¯ RD ç”¨curl æˆ– postman é€²è¡Œçš„å·¥ä½œï¼‰<br>| æ¡ˆä¾‹çš„è¨­è¨ˆä¸Šä¹Ÿå¾ˆç´°å¿ƒï¼Œå¾ˆå¤š RD æ˜¯åªæ¸¬è©¦ Happy Case çš„</p><h4 id="æ­£å¸¸åŠŸèƒ½æ¸¬è©¦-happy-case"><a href="#æ­£å¸¸åŠŸèƒ½æ¸¬è©¦-happy-case" class="headerlink" title="æ­£å¸¸åŠŸèƒ½æ¸¬è©¦(happy case)"></a>æ­£å¸¸åŠŸèƒ½æ¸¬è©¦(happy case)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch?keyword=nodejs&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"><span class="comment"># é æœŸ: Google æœå°‹çµæœ JSON</span></span><br></pre></td></tr></table></figure><h4 id="æ¬Šé™æª¢æŸ¥å¤±æ•—æ¸¬è©¦"><a href="#æ¬Šé™æª¢æŸ¥å¤±æ•—æ¸¬è©¦" class="headerlink" title="æ¬Šé™æª¢æŸ¥å¤±æ•—æ¸¬è©¦"></a>æ¬Šé™æª¢æŸ¥å¤±æ•—æ¸¬è©¦</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch?keyword=test&quot;</span></span><br><span class="line"><span class="comment"># é æœŸ: &#123;&quot;error&quot;:&quot;Authentication invalid&quot;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="åƒæ•¸é©—è­‰æ¸¬è©¦"><a href="#åƒæ•¸é©—è­‰æ¸¬è©¦" class="headerlink" title="åƒæ•¸é©—è­‰æ¸¬è©¦"></a>åƒæ•¸é©—è­‰æ¸¬è©¦</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼ºå°‘åƒæ•¸</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"><span class="comment"># é æœŸ: Zod é©—è­‰éŒ¯èª¤ï¼Œ400 status</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç©ºåƒæ•¸</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch?keyword=&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"><span class="comment"># é æœŸ: &#123;&quot;error&quot;:[&#123;...,&quot;message&quot;:&quot;keyword åƒæ•¸ç‚ºå¿…å¡«ä¸”ä¸èƒ½ç‚ºç©ºå­—ä¸²&quot;&#125;]&#125;</span></span><br></pre></td></tr></table></figure><h2 id="éŒ¯èª¤è™•ç†æ©Ÿåˆ¶"><a href="#éŒ¯èª¤è™•ç†æ©Ÿåˆ¶" class="headerlink" title="éŒ¯èª¤è™•ç†æ©Ÿåˆ¶"></a>éŒ¯èª¤è™•ç†æ©Ÿåˆ¶</h2><h3 id="Zod-é©—è­‰æ•´åˆ"><a href="#Zod-é©—è­‰æ•´åˆ" class="headerlink" title="Zod é©—è­‰æ•´åˆ"></a>Zod é©—è­‰æ•´åˆ</h3><blockquote><p>å°ˆæ¡ˆå·²å…§å»º Zod åœ¨ req&#x2F;res æª¢æŸ¥åƒæ•¸èˆ‡éŒ¯èª¤è™•ç†æœ‰å¾ˆå¥½çš„è¡¨ç¾ï¼Œæ˜¯åœ˜éšŠçš„é–‹ç™¼å·¥å…·ä¹‹ä¸€<br>ä½†è¦æé†’ AI ä¸ç„¶ä»–æœƒæ‰‹åˆ»ä¸€å€‹éŒ¯èª¤è™•ç†çµ¦ä½ ï¼ˆåˆ»å¾—ä¹Ÿä¸å·®å°±æ˜¯äº†ï¼‰</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// errorHandler.ts å·²æ”¯æ´</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">ZodError</span>,</span><br><span class="line">  <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">  <span class="attr">log</span>: <span class="string">&#x27;Zod validation error&#x27;</span>,</span><br><span class="line">  <span class="attr">getMsg</span>: <span class="function">(<span class="params">err: ZodError</span>) =&gt;</span> err.<span class="property">errors</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="âŒ-éŒ¯èª¤æ–¹å¼ï¼šAI-æ‰‹åˆ»éŒ¯èª¤è™•ç†"><a href="#âŒ-éŒ¯èª¤æ–¹å¼ï¼šAI-æ‰‹åˆ»éŒ¯èª¤è™•ç†" class="headerlink" title="âŒ éŒ¯èª¤æ–¹å¼ï¼šAI æ‰‹åˆ»éŒ¯èª¤è™•ç†"></a>âŒ éŒ¯èª¤æ–¹å¼ï¼šAI æ‰‹åˆ»éŒ¯èª¤è™•ç†</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!keyword || <span class="keyword">typeof</span> keyword !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;keyword åƒæ•¸ç‚ºå¿…å¡«ä¸”å¿…é ˆæ˜¯å­—ä¸²&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="âœ…-æ­£ç¢ºæ–¹å¼ï¼šä½¿ç”¨-Zod"><a href="#âœ…-æ­£ç¢ºæ–¹å¼ï¼šä½¿ç”¨-Zod" class="headerlink" title="âœ… æ­£ç¢ºæ–¹å¼ï¼šä½¿ç”¨ Zod"></a>âœ… æ­£ç¢ºæ–¹å¼ï¼šä½¿ç”¨ Zod</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keyword &#125; = webSearchQuerySchema.<span class="title function_">parse</span>(req.<span class="property">query</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Zod çš„å¥½è™•ï¼š</p><ul><li>çµ±ä¸€çš„éŒ¯èª¤æ ¼å¼</li><li>è‡ªå‹•æ•´åˆåˆ°å…¨åŸŸéŒ¯èª¤è™•ç†å™¨</li><li>å‹åˆ¥å®‰å…¨ä¿è­‰</li></ul><h3 id="ä¸­ä»‹è»Ÿé«”åŸ·è¡Œé †åº"><a href="#ä¸­ä»‹è»Ÿé«”åŸ·è¡Œé †åº" class="headerlink" title="ä¸­ä»‹è»Ÿé«”åŸ·è¡Œé †åº"></a>ä¸­ä»‹è»Ÿé«”åŸ·è¡Œé †åº</h3><blockquote><p>é‡æ§‹ç®—æ˜¯é€™æ¬¡éœ€æ±‚çš„å¤§ç›®æ¨™ï¼Œåªè¦æç¤ºè©å¯«å¾—å¤ å¥½ AI å¯ä»¥æä¾›å¾ˆå®Œæ•´çš„è·¯ç”±åˆ—è¡¨<br>è€Œä¸”é‡æ§‹çš„ç‹€æ…‹ä¹Ÿå¾ˆæ­£ç¢ºï¼Œä¸éæˆ‘çš„å°ˆæ¡ˆä¸å¤§åªæœ‰ 30 éš»å·¦å³çš„ API åƒåŠ åƒ¹å€¼å¯èƒ½ä¸é«˜</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è«‹æ±‚ â†’ auth.user(&#x27;web_search&#x27;) â†’ asyncWrapper â†’ zod.parse() â†’ æ¥­å‹™é‚è¼¯</span><br></pre></td></tr></table></figure><p>é€™å€‹é †åºç¢ºä¿ï¼š</p><ol><li>å…ˆæª¢æŸ¥èº«ä»½æ¬Šé™</li><li>å†é€²è¡Œåƒæ•¸é©—è­‰  </li><li>æœ€å¾ŒåŸ·è¡Œæ¥­å‹™é‚è¼¯</li></ol><h2 id="Google-Custom-Search-API-æ•´åˆè¦é»"><a href="#Google-Custom-Search-API-æ•´åˆè¦é»" class="headerlink" title="Google Custom Search API æ•´åˆè¦é»"></a>Google Custom Search API æ•´åˆè¦é»</h2><blockquote><p>å•†æ¥­éœ€æ±‚çš„ä¸»é‚è¼¯ï¼Œæˆ‘ä¸€è¡Œç¨‹å¼æ²’å¯«åªèˆ‡ AI äº’å‹•å°±å®Œæˆäº†é€™å€‹åŠŸèƒ½ï¼ŒåŒ…å«é»å°é»çš„æ¸¬è©¦<br>ä¸éåœ¨é›¶ä¿¡ä»»åŸå‰‡ä¸‹ï¼Œé‚„æ˜¯è«‹å…¶ä»– RD å†ä½œä¸€æ¬¡ Code Review èˆ‡å®Œæ•´æ¸¬è©¦</p></blockquote><h3 id="å¿…è¦åƒæ•¸èªªæ˜"><a href="#å¿…è¦åƒæ•¸èªªæ˜" class="headerlink" title="å¿…è¦åƒæ•¸èªªæ˜"></a>å¿…è¦åƒæ•¸èªªæ˜</h3><ul><li><code>key</code>: Google API Key</li><li><code>cx</code>: Custom Search Engine ID  </li><li><code>q</code>: æœå°‹é—œéµå­—</li><li><code>num</code>: çµæœæ•¸é‡</li></ul><h3 id="API-å›æ‡‰è½‰æ›"><a href="#API-å›æ‡‰è½‰æ›" class="headerlink" title="API å›æ‡‰è½‰æ›"></a>API å›æ‡‰è½‰æ›</h3><p>Google API å›æ‡‰çµæ§‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœå°‹çµæœæ¨™é¡Œ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;snippet&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœå°‹çµæœæ‘˜è¦&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è½‰æ›ç‚ºç³»çµ±æ ¼å¼ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœå°‹çµæœæ¨™é¡Œ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœå°‹çµæœæ‘˜è¦&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€™æ¬¡å¯¦ä½œè®“æˆ‘æ·±åº¦é«”é©—äº† AI èˆ‡å„ªè‰¯æ¶æ§‹åœ¨å¯¦éš›å°ˆæ¡ˆä¸­çš„é‹ç”¨ã€‚å¹¾å€‹é—œéµæ”¶ç©«ï¼š</p><h3 id="æ¶æ§‹å„ªå‹¢"><a href="#æ¶æ§‹å„ªå‹¢" class="headerlink" title="æ¶æ§‹å„ªå‹¢"></a>æ¶æ§‹å„ªå‹¢</h3><ul><li>æ¸…æ™°çš„åˆ†å±¤è®“è·è²¬åˆ†æ˜ï¼Œæ¸¬è©¦å®¹æ˜“</li><li>ä¾è³´æ³¨å…¥è®“å…ƒä»¶å¯æŠ½æ›ï¼Œç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡</li><li>çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œç¶­è­·æˆæœ¬ä½</li></ul><p>ä¸Šé¢æ˜¯åŸæœ¬çš„å„ªå‹¢ï¼ŒåŠ ä¸Š AI åˆ¤è®€å¾Œï¼Œå¯ä»¥é«˜æ•ˆç”¢ç”Ÿ Clean Code  </p><p>ä¸å¤ªç¢ºå®šä¸è‰¯ä»£ç¢¼æœƒæœ‰ä»€éº¼çµæœï¼Œå¾ˆå¹¸é‹æ˜¯æˆ‘ä¸åœ¨é‚£ç¨®ç’°å¢ƒä¹‹ä¸­  </p><p>ç¾åœ¨ä¸‰å€‹åœˆåœˆæ˜¯æœ‰äº¤é›†çš„ï¼Œå¥½åˆå¿«åˆä¾¿å®œ(ç”¢å‡ºï¼å–®ä½æ™‚é–“)ï¼Œ  </p><p>ä¾ç…§ AI å¸¶ä¾†çš„ç”Ÿç”¢åŠ›èˆ‡ç¾æœ‰çš„ RD ç›¸æ¯”ï¼Œå…¶å¯¦æ˜¯å¾ˆä¾¿å®œçš„é¸æ“‡ã€‚</p><p>è‰¯å¥½çš„è¨­è¨ˆçµåˆå·¥å…·(AI)æ˜¯ææ˜‡æ•ˆç‡çš„æ‰‹æ®µ,  </p><p>3 å€‹äººå¯ä»¥ç•¶ ï¼— å€‹äººç”¨ã€‚è‡³æ–¼ç‚ºä»€éº¼æ˜¯ï¼“å€‹äººï¼Œæœ‰æ©Ÿæœƒå†èªªäº†ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘è³¼è²· Claude Codeï¼Œåœ¨æ­¤åŒæ™‚ä¹Ÿæœ‰è©¦ç”¨ Github Copilot &amp;#x2F; Gitlab Duo &amp;#x</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] EAI æ©Ÿå™¨ç€è¦½å™¨å®‰è£å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ</title>
    <link href="https://blog.marsen.me/2025/07/29/2025/ai-eai-browser-install-flatpak-solution/"/>
    <id>https://blog.marsen.me/2025/07/29/2025/ai-eai-browser-install-flatpak-solution/</id>
    <published>2025-07-29T05:51:36.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘æ‹¿åˆ°ä¸€å€‹åœ°ç«¯è³‡æº <a href="https://www.lannerinc.com/products/edge-ai-appliance/deep-learning-inference-appliances/eai-i233">EAI-I233</a> é–‹ç™¼åœ°ç«¯ AI æ‡‰ç”¨ã€‚<br>éç¨‹ä¸­é‡åˆ°äº†å®‰è£ç€è¦½å™¨(firefox)ç„¡æ³•æ­£å¸¸é‹ä½œçš„å•é¡Œã€‚<br>ç¶“éæŸ¥æ‰¾è³‡æ–™ï¼Œç™¼ç¾é€™æ˜¯ Jetson Orin Nano ä¸Šçš„å·²çŸ¥å•é¡Œï¼Œä¸æ˜¯å€‹æ¡ˆã€‚<br>è¨˜éŒ„ä¸€ä¸‹å¦‚ä½•é€é Flatpak å®‰è£ Chromium åœ¨ EAI æ©Ÿå™¨ä¸Šï¼Œä»¥è§£æ±ºç€è¦½å™¨å•é¡Œã€‚</p><h2 id="å•é¡Œæè¿°"><a href="#å•é¡Œæè¿°" class="headerlink" title="å•é¡Œæè¿°"></a>å•é¡Œæè¿°</h2><p>åœ¨ Jetson Orin Nano ç­‰ EAI è¨­å‚™ä¸Šï¼Œé€é snap å®‰è£çš„ Chromium ç€è¦½å™¨æœƒå‡ºç¾ç„¡æ³•æ­£å¸¸å•Ÿå‹•æˆ–é‹è¡Œä¸ç©©å®šçš„ç‹€æ³ã€‚<br>é€™å€‹å•é¡Œä¸¦éå€‹æ¡ˆï¼Œåœ¨ NVIDIA é–‹ç™¼è€…è«–å£‡ä¸Šæœ‰è¨±å¤šç”¨æˆ¶å›å ±é¡ä¼¼å•é¡Œã€‚  </p><h2 id="è§£æ±ºæ–¹æ¡ˆ"><a href="#è§£æ±ºæ–¹æ¡ˆ" class="headerlink" title="è§£æ±ºæ–¹æ¡ˆ"></a>è§£æ±ºæ–¹æ¡ˆ</h2><h3 id="ç§»é™¤ç¾æœ‰çš„-snap-ç‰ˆæœ¬-Chromium"><a href="#ç§»é™¤ç¾æœ‰çš„-snap-ç‰ˆæœ¬-Chromium" class="headerlink" title="ç§»é™¤ç¾æœ‰çš„ snap ç‰ˆæœ¬ Chromium"></a>ç§»é™¤ç¾æœ‰çš„ snap ç‰ˆæœ¬ Chromium</h3><p>é¦–å…ˆç§»é™¤é€é snap å®‰è£çš„ Chromiumï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap remove chromium</span><br></pre></td></tr></table></figure><h3 id="å®‰è£èˆ‡è¨­å®š-Flatpak"><a href="#å®‰è£èˆ‡è¨­å®š-Flatpak" class="headerlink" title="å®‰è£èˆ‡è¨­å®š Flatpak"></a>å®‰è£èˆ‡è¨­å®š Flatpak</h3><p>æ›´æ–°å¥—ä»¶ç®¡ç†å™¨ä¸¦å®‰è£ Flatpakï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install flatpak</span><br></pre></td></tr></table></figure><p>æ·»åŠ  Flathub å„²å­˜åº«ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo</span><br></pre></td></tr></table></figure><h3 id="é‡é–‹æ©Ÿä¸¦å®‰è£-Chromium"><a href="#é‡é–‹æ©Ÿä¸¦å®‰è£-Chromium" class="headerlink" title="é‡é–‹æ©Ÿä¸¦å®‰è£ Chromium"></a>é‡é–‹æ©Ÿä¸¦å®‰è£ Chromium</h3><p>é‡æ–°å•Ÿå‹•æ©Ÿå™¨å¾Œï¼Œé€é Flatpak å®‰è£ Chromiumï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡é–‹æ©Ÿå¾ŒåŸ·è¡Œ</span></span><br><span class="line">flatpak install flathub org.chromium.Chromium</span><br></pre></td></tr></table></figure><h2 id="ç‚ºä»€éº¼è¦ç”¨-Flatpakï¼Ÿ"><a href="#ç‚ºä»€éº¼è¦ç”¨-Flatpakï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼è¦ç”¨ Flatpakï¼Ÿ"></a>ç‚ºä»€éº¼è¦ç”¨ Flatpakï¼Ÿ</h2><p>ç›¸æ¯”æ–¼ snapï¼ŒFlatpak åœ¨ ARM æ¶æ§‹çš„è¨­å‚™ä¸Šæœ‰æ›´å¥½çš„ç›¸å®¹æ€§ã€‚<br>ç‰¹åˆ¥æ˜¯åœ¨ Jetson ç³»åˆ—é–‹ç™¼æ¿ä¸Šï¼ŒFlatpak èƒ½å¤ æä¾›æ›´ç©©å®šçš„å¥—ä»¶åŸ·è¡Œç’°å¢ƒï¼Œé¿å…å› ç‚º snap æ²™ç›’æ©Ÿåˆ¶èˆ‡ç¡¬é«”é©…å‹•äº’å‹•æ™‚ç”¢ç”Ÿçš„å•é¡Œã€‚  </p><h2 id="ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ"><a href="#ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ" class="headerlink" title="ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ"></a>ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ</h2><p><strong>é‡é–‹æ©Ÿæ˜¯å¿…è¦çš„</strong><br>åœ¨å®‰è£å®Œ Flatpak å¾Œï¼Œå‹™å¿…é‡é–‹æ©Ÿå†å®‰è£ Chromiumï¼Œç¢ºä¿æ‰€æœ‰ç›¸ä¾æœå‹™æ­£ç¢ºå•Ÿå‹•ã€‚</p><p><strong>æ¬Šé™å•é¡Œ</strong><br>å¦‚æœé‡åˆ°æ¬Šé™å•é¡Œï¼Œç¢ºèªç•¶å‰ä½¿ç”¨è€…å·²åŠ å…¥ç›¸é—œç¾¤çµ„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G sudo <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h2 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul><li><a href="https://forums.developer.nvidia.com/t/jetson-orin-nano-browser-issue/338580/44">Jetson Orin Nano Browser Issue - NVIDIA Developer Forum</a></li><li><a href="https://jetsonhacks.com/2025/07/12/why-chromium-suddenly-broke-on-jetson-orin-and-how-to-bring-it-back/">JetsonHacks: Why Chromium Suddenly Broke on Jetson Orin</a></li></ul><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€é Flatpak å®‰è£ Chromium æ˜¯ç›®å‰åœ¨ EAI è¨­å‚™ä¸Šæœ€ç©©å®šçš„è§£æ±ºæ–¹æ¡ˆã€‚<br>é›–ç„¶éœ€è¦é¡å¤–çš„è¨­å®šæ­¥é©Ÿï¼Œä½†èƒ½å¤ æœ‰æ•ˆè§£æ±º snap ç‰ˆæœ¬åœ¨ ARM æ¶æ§‹ä¸Šçš„ç›¸å®¹æ€§å•é¡Œã€‚<br>é€™å€‹è§£æ±ºæ–¹æ¡ˆä¸åƒ…é©ç”¨æ–¼ Jetson Orin Nanoï¼Œä¹Ÿå¯ä»¥æ‡‰ç”¨åˆ°å…¶ä»–é¡ä¼¼çš„ ARM æ¶æ§‹é–‹ç™¼æ¿ä¸Šã€‚<br>æœ‰æ©Ÿæœƒæ‹¿åˆ°åˆ¥çš„æ©Ÿå™¨å†ä¾†è©¦è©¦ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ‹¿åˆ°ä¸€å€‹åœ°ç«¯è³‡æº &lt;a href=&quot;https://www.lannerinc.com/products/edge-ai</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [å­¸ç¿’ç­†è¨˜] Express.js middleware auth çš„æ¥­ç•Œæ¨™æº–(res.locals)</title>
    <link href="https://blog.marsen.me/2025/07/25/2025/express-res-locals-auth-best-practice/"/>
    <id>https://blog.marsen.me/2025/07/25/2025/express-res-locals-auth-best-practice/</id>
    <published>2025-07-25T03:17:04.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Express.js èªè­‰ç³»çµ±ä¸­ï¼Œå¸¸è¦‹çš„åšæ³•æ˜¯åœ¨æ¯å€‹éœ€è¦é©—è­‰çš„è·¯ç”±ä¸­ç›´æ¥è§£æ JWT tokenã€‚<br>ä½†æœ‰ä¸€å€‹æ›´å¥½çš„å¯¦ä½œæ–¹å¼ï¼šä½¿ç”¨ä¸­ä»‹è»Ÿé«”å°‡èªè­‰çµæœå­˜æ”¾åœ¨ <code>res.locals</code> ä¸­ã€‚<br>é€™ä¸åƒ…æ˜¯å®˜æ–¹å»ºè­°çš„åšæ³•ï¼Œä¹Ÿé¿å…äº†é‡è¤‡è§£æ token çš„æ•ˆèƒ½å•é¡Œã€‚</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>ä½¿ç”¨ <code>res.locals</code> è™•ç†èªè­‰æ˜¯ Express.js çš„æ¨™æº–å¯¦ä½œï¼š</p><ul><li>é¿å…åœ¨æ¯å€‹è·¯ç”±é‡è¤‡è§£æ JWT token</li><li>Auth.jsã€Passport.js ç­‰ä¸»æµå‡½å¼åº«éƒ½æ¡ç”¨é€™ç¨®æ¨¡å¼</li><li>Express.js å®˜æ–¹æ–‡æª”æ˜ç¢ºæ”¯æŒé€™ç¨®ç”¨æ³•</li></ul><h2 id="ç›´æ¥è§£æ-JWT-çš„ç¼ºé»"><a href="#ç›´æ¥è§£æ-JWT-çš„ç¼ºé»" class="headerlink" title="ç›´æ¥è§£æ JWT çš„ç¼ºé»"></a>ç›´æ¥è§£æ JWT çš„ç¼ºé»</h2><h3 id="é‡è¤‡å·¥ä½œçš„æ•ˆèƒ½å•é¡Œ"><a href="#é‡è¤‡å·¥ä½œçš„æ•ˆèƒ½å•é¡Œ" class="headerlink" title="é‡è¤‡å·¥ä½œçš„æ•ˆèƒ½å•é¡Œ"></a>é‡è¤‡å·¥ä½œçš„æ•ˆèƒ½å•é¡Œ</h3><p>å¦‚æœæ¯å€‹è·¯ç”±éƒ½ç›´æ¥è§£æ JWTï¼Œæœƒé€ æˆä¸å¿…è¦çš„é‡è¤‡é‹ç®—ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ åœ¨æ¯å€‹è·¯ç”±é‡è¤‡è§£æ</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/profile&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = req.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">const</span> user = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>) <span class="comment">// é‡è¤‡è§£æ</span></span><br><span class="line">  res.<span class="title function_">json</span>(&#123; user &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/orders&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = req.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">const</span> user = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>) <span class="comment">// åˆè§£æä¸€æ¬¡</span></span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">orders</span>: <span class="title function_">getUserOrders</span>(user.<span class="property">id</span>) &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="ç¨‹å¼ç¢¼é‡è¤‡èˆ‡ç¶­è­·å›°é›£"><a href="#ç¨‹å¼ç¢¼é‡è¤‡èˆ‡ç¶­è­·å›°é›£" class="headerlink" title="ç¨‹å¼ç¢¼é‡è¤‡èˆ‡ç¶­è­·å›°é›£"></a>ç¨‹å¼ç¢¼é‡è¤‡èˆ‡ç¶­è­·å›°é›£</h3><p>æ¯å€‹éœ€è¦èªè­‰çš„è·¯ç”±éƒ½è¦å¯«é¡ä¼¼çš„ token é©—è­‰é‚è¼¯ï¼Œé•åäº† DRY åŸå‰‡ï¼Œä¹Ÿå¢åŠ äº†ç¶­è­·æˆæœ¬ã€‚</p><h3 id="éŒ¯èª¤è™•ç†ä¸ä¸€è‡´"><a href="#éŒ¯èª¤è™•ç†ä¸ä¸€è‡´" class="headerlink" title="éŒ¯èª¤è™•ç†ä¸ä¸€è‡´"></a>éŒ¯èª¤è™•ç†ä¸ä¸€è‡´</h3><p>ä¸åŒè·¯ç”±å¯èƒ½æœ‰ä¸åŒçš„ token é©—è­‰éŒ¯èª¤è™•ç†æ–¹å¼ï¼Œé€ æˆ API å›æ‡‰ä¸ä¸€è‡´ã€‚</p><h2 id="ä»€éº¼æ˜¯-res-localsï¼Ÿ"><a href="#ä»€éº¼æ˜¯-res-localsï¼Ÿ" class="headerlink" title="ä»€éº¼æ˜¯ res.localsï¼Ÿ"></a>ä»€éº¼æ˜¯ res.localsï¼Ÿ</h2><p>æ ¹æ“š Express.js å®˜æ–¹æ–‡æª”ï¼Œ<code>res.locals</code> æ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œç”¨ä¾†å­˜æ”¾<strong>è«‹æ±‚ç¯„åœå…§çš„å€åŸŸè®Šæ•¸</strong>ï¼Œé€™äº›è®Šæ•¸åªåœ¨ç•¶å‰è«‹æ±‚-å›æ‡‰é€±æœŸä¸­å¯ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Express.js å®˜æ–¹ç¯„ä¾‹</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">user</span> = req.<span class="property">user</span></span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">authenticated</span> = !req.<span class="property">user</span></span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="ä¸»æµå‡½å¼åº«çš„æ¨™æº–å¯¦ä½œ"><a href="#ä¸»æµå‡½å¼åº«çš„æ¨™æº–å¯¦ä½œ" class="headerlink" title="ä¸»æµå‡½å¼åº«çš„æ¨™æº–å¯¦ä½œ"></a>ä¸»æµå‡½å¼åº«çš„æ¨™æº–å¯¦ä½œ</h2><h3 id="Auth-js-å®˜æ–¹ç¯„ä¾‹"><a href="#Auth-js-å®˜æ–¹ç¯„ä¾‹" class="headerlink" title="Auth.js å®˜æ–¹ç¯„ä¾‹"></a>Auth.js å®˜æ–¹ç¯„ä¾‹</h3><p>Auth.js å®˜æ–¹æ–‡æª”æ˜ç¢ºå±•ç¤ºäº†ä½¿ç”¨ <code>res.locals</code> çš„æ¨™æº–æ¨¡å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getSession &#125; <span class="keyword">from</span> <span class="string">&quot;@auth/express&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">authSession</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">session</span> = <span class="keyword">await</span> <span class="title function_">getSession</span>(req)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(authSession)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨è·¯ç”±ä¸­ä½¿ç”¨</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; session &#125; = res.<span class="property">locals</span></span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;index&quot;</span>, &#123; <span class="attr">user</span>: session?.<span class="property">user</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Passport-js-çš„å¯¦ä½œæ¨¡å¼"><a href="#Passport-js-çš„å¯¦ä½œæ¨¡å¼" class="headerlink" title="Passport.js çš„å¯¦ä½œæ¨¡å¼"></a>Passport.js çš„å¯¦ä½œæ¨¡å¼</h3><p>Passport.js åœ¨èªè­‰æˆåŠŸæ™‚æœƒè¨­ç½® <code>req.user</code> å±¬æ€§ï¼Œè¨±å¤šé–‹ç™¼è€…æœƒå°‡æ­¤è³‡è¨Šè¤‡è£½åˆ° <code>res.locals</code> ä»¥ä¾¿åœ¨è¦–åœ–ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èªè­‰ä¸­ä»‹è»Ÿé«”</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">user</span> = req.<span class="title function_">isAuthenticated</span>() ? req.<span class="property">user</span> : <span class="literal">null</span></span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">isAuthenticated</span> = req.<span class="title function_">isAuthenticated</span>()</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="ç‚ºä»€éº¼é€™æ˜¯å¥½å¯¦ä½œï¼Ÿ"><a href="#ç‚ºä»€éº¼é€™æ˜¯å¥½å¯¦ä½œï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼é€™æ˜¯å¥½å¯¦ä½œï¼Ÿ"></a>ç‚ºä»€éº¼é€™æ˜¯å¥½å¯¦ä½œï¼Ÿ</h2><h3 id="1-å®˜æ–¹æ”¯æŒçš„æ¨™æº–"><a href="#1-å®˜æ–¹æ”¯æŒçš„æ¨™æº–" class="headerlink" title="1. å®˜æ–¹æ”¯æŒçš„æ¨™æº–"></a>1. å®˜æ–¹æ”¯æŒçš„æ¨™æº–</h3><p>Express.js å®˜æ–¹æ–‡æª”èªªæ˜ <code>res.locals</code> å°±æ˜¯ç”¨ä¾†å­˜æ”¾è«‹æ±‚ç´šåˆ¥çš„è³‡è¨Šï¼Œå¦‚èªè­‰ç”¨æˆ¶ã€ç”¨æˆ¶è¨­å®šç­‰ã€‚é€™ä¸æ˜¯ hack æˆ– workaroundï¼Œè€Œæ˜¯è¨­è¨ˆç”¨é€”ã€‚</p><h3 id="2-ç”Ÿæ…‹ç³»çµ±å…±è­˜"><a href="#2-ç”Ÿæ…‹ç³»çµ±å…±è­˜" class="headerlink" title="2. ç”Ÿæ…‹ç³»çµ±å…±è­˜"></a>2. ç”Ÿæ…‹ç³»çµ±å…±è­˜</h3><p>ä¸»æµçš„èªè­‰å‡½å¼åº«éƒ½æ¡ç”¨é¡ä¼¼æ¨¡å¼ï¼š</p><ul><li>Auth.js ç›´æ¥åœ¨æ–‡æª”ä¸­å±•ç¤º <code>res.locals.session</code></li><li>Passport.js ç¤¾ç¾¤æ™®éä½¿ç”¨ <code>res.locals.user</code></li><li>è¨±å¤šæ•™å­¸éƒ½å±•ç¤ºå°‡èªè­‰ç‹€æ…‹å­˜æ”¾åœ¨ <code>res.locals</code> çš„æ¨¡å¼</li></ul><h3 id="3-åˆ†é›¢é—œæ³¨é»"><a href="#3-åˆ†é›¢é—œæ³¨é»" class="headerlink" title="3. åˆ†é›¢é—œæ³¨é»"></a>3. åˆ†é›¢é—œæ³¨é»</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èªè­‰ä¸­ä»‹è»Ÿé«” - åªè² è²¬èªè­‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">authMiddleware</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> token = req.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>)</span><br><span class="line">    res.<span class="property">locals</span>.<span class="property">user</span> = decoded</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯ç”±è™•ç†å™¨ - åªè² è²¬æ¥­å‹™é‚è¼¯</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/profile&#x27;</span>, authMiddleware, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; user &#125; = res.<span class="property">locals</span></span><br><span class="line">  <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Unauthorized&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">profile</span>: user &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-è¦–åœ–æ•´åˆå„ªå‹¢"><a href="#4-è¦–åœ–æ•´åˆå„ªå‹¢" class="headerlink" title="4. è¦–åœ–æ•´åˆå„ªå‹¢"></a>4. è¦–åœ–æ•´åˆå„ªå‹¢</h3><p>åœ¨ä½¿ç”¨æ¨¡æ¿å¼•æ“æ™‚ï¼Œ<code>res.locals</code> çš„è³‡æ–™æœƒè‡ªå‹•å‚³éçµ¦è¦–åœ–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸­ä»‹è»Ÿé«”è¨­å®š</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">currentUser</span> = req.<span class="property">user</span></span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ EJS/Pug æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// &lt;%= currentUser.name %&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸è¦‹çš„åæ¨¡å¼"><a href="#å¸¸è¦‹çš„åæ¨¡å¼" class="headerlink" title="å¸¸è¦‹çš„åæ¨¡å¼"></a>å¸¸è¦‹çš„åæ¨¡å¼</h2><h3 id="é¿å…çš„åšæ³•"><a href="#é¿å…çš„åšæ³•" class="headerlink" title="é¿å…çš„åšæ³•"></a>é¿å…çš„åšæ³•</h3><p>æœ‰äº›é–‹ç™¼è€…èªç‚ºéåº¦ä½¿ç”¨ <code>res.locals</code> æœƒè®“é™¤éŒ¯è®Šå›°é›£ï¼Œä½†é€™é€šå¸¸æ˜¯å› ç‚ºï¼š</p><ol><li><strong>æ¿«ç”¨ä¸­ä»‹è»Ÿé«”æ¨¡å¼</strong> - æŠŠæ¥­å‹™é‚è¼¯ä¹Ÿæ”¾åœ¨ä¸­ä»‹è»Ÿé«”è£¡</li><li><strong>éåº¦è€¦åˆ</strong> - å¤šå€‹ä¸­ä»‹è»Ÿé«”äº’ç›¸ä¾è³´ <code>res.locals</code> çš„é †åº</li></ol><h3 id="æ­£ç¢ºçš„ä½¿ç”¨åŸå‰‡"><a href="#æ­£ç¢ºçš„ä½¿ç”¨åŸå‰‡" class="headerlink" title="æ­£ç¢ºçš„ä½¿ç”¨åŸå‰‡"></a>æ­£ç¢ºçš„ä½¿ç”¨åŸå‰‡</h3><p>ä¸­ä»‹è»Ÿé«”æ‡‰è©²ç”¨æ–¼æ‰€æœ‰ HTTP è«‹æ±‚å…±é€šçš„äº‹é …ï¼Œä¸”ä¸åŒ…å«æ¥­å‹™é‚è¼¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å¥½çš„åšæ³• - ç´”ç²¹çš„èªè­‰æª¢æŸ¥</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">authenticate</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="title function_">getTokenFromRequest</span>(req)</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">validateToken</span>(token)</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">user</span> = user</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å¥½çš„åšæ³• - æˆæ¬Šæª¢æŸ¥</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">requireAuth</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">locals</span>.<span class="property">user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Unauthorized&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é¿å…çš„åšæ³• - åœ¨ä¸­ä»‹è»Ÿé«”ä¸­è™•ç†æ¥­å‹™é‚è¼¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">badMiddleware</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = res.<span class="property">locals</span>.<span class="property">user</span></span><br><span class="line">  <span class="keyword">const</span> orders = <span class="title function_">getUserOrders</span>(user.<span class="property">id</span>) <span class="comment">// æ¥­å‹™é‚è¼¯ä¸æ‡‰è©²åœ¨é€™è£¡</span></span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">orders</span> = orders</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¦å‹™ä¸Šçš„æœ€ä½³å¯¦ä½œ"><a href="#å¯¦å‹™ä¸Šçš„æœ€ä½³å¯¦ä½œ" class="headerlink" title="å¯¦å‹™ä¸Šçš„æœ€ä½³å¯¦ä½œ"></a>å¯¦å‹™ä¸Šçš„æœ€ä½³å¯¦ä½œ</h2><h3 id="æ¨™æº–èªè­‰ä¸­ä»‹è»Ÿé«”"><a href="#æ¨™æº–èªè­‰ä¸­ä»‹è»Ÿé«”" class="headerlink" title="æ¨™æº–èªè­‰ä¸­ä»‹è»Ÿé«”"></a>æ¨™æº–èªè­‰ä¸­ä»‹è»Ÿé«”</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">authMiddleware</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">replace</span>(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, process.<span class="property">env</span>.<span class="property">JWT_SECRET</span>)</span><br><span class="line">      res.<span class="property">locals</span>.<span class="property">user</span> = decoded</span><br><span class="line">      res.<span class="property">locals</span>.<span class="property">isAuthenticated</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="property">locals</span>.<span class="property">user</span> = <span class="literal">null</span></span><br><span class="line">      res.<span class="property">locals</span>.<span class="property">isAuthenticated</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="property">locals</span>.<span class="property">user</span> = <span class="literal">null</span></span><br><span class="line">    res.<span class="property">locals</span>.<span class="property">isAuthenticated</span> = <span class="literal">false</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆæ¬Šæª¢æŸ¥ä¸­ä»‹è»Ÿé«”</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">requireAuth</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">locals</span>.<span class="property">isAuthenticated</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Authentication required&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ–¹å¼</span></span><br><span class="line">app.<span class="title function_">use</span>(authMiddleware)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/profile&#x27;</span>, requireAuth, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; user &#125; = res.<span class="property">locals</span></span><br><span class="line">  res.<span class="title function_">json</span>(&#123; user &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="èˆ‡-req-è‡ªå®šç¾©å±¬æ€§çš„æ¯”è¼ƒ"><a href="#èˆ‡-req-è‡ªå®šç¾©å±¬æ€§çš„æ¯”è¼ƒ" class="headerlink" title="èˆ‡ req è‡ªå®šç¾©å±¬æ€§çš„æ¯”è¼ƒ"></a>èˆ‡ req è‡ªå®šç¾©å±¬æ€§çš„æ¯”è¼ƒ</h3><p>é›–ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>req.user</code> æˆ– <code>req.data</code> ç­‰è‡ªå®šç¾©å±¬æ€§ï¼Œä½† <code>res.locals</code> æœ‰å¹¾å€‹å„ªå‹¢ï¼š</p><ol><li><strong>èªæ„æ¸…æ™°</strong> - æ˜ç¢ºè¡¨ç¤ºé€™æ˜¯çµ¦è¦–åœ–ç”¨çš„è³‡æ–™</li><li><strong>è‡ªå‹•å‚³é</strong> - æ¨¡æ¿å¼•æ“æœƒè‡ªå‹•å–ç”¨ <code>res.locals</code> çš„è³‡æ–™</li><li><strong>æ¨™æº–åŒ–</strong> - ç¤¾ç¾¤å…±è­˜ï¼Œç¶­è­·æ€§æ›´å¥½</li></ol><h2 id="çµè«–"><a href="#çµè«–" class="headerlink" title="çµè«–"></a>çµè«–</h2><p><code>res.locals</code> åœ¨èªè­‰ç³»çµ±ä¸­çš„ä½¿ç”¨ç¢ºå¯¦æ˜¯æ¨™æº–å¯¦ä½œï¼š</p><ol><li><strong>å®˜æ–¹æ”¯æŒ</strong> - Express.js å’Œ Auth.js å®˜æ–¹æ–‡æª”éƒ½å±•ç¤ºé€™ç¨®ç”¨æ³•</li><li><strong>ç”Ÿæ…‹ç³»çµ±æ¨™æº–</strong> - Passport.js ç­‰ä¸»æµå‡½å¼åº«æ¡ç”¨ç›¸åŒæ¨¡å¼</li><li><strong>æ•ˆèƒ½è€ƒé‡</strong> - é¿å…é‡è¤‡è§£æ JWT æˆ–æŸ¥è©¢è³‡æ–™åº«</li><li><strong>é–‹ç™¼é«”é©—</strong> - æ§åˆ¶å™¨å¯ä»¥ç›´æ¥å­˜å–ç”¨æˆ¶è³‡è¨Š</li></ol><p>æ‰€ä»¥ä¸‹æ¬¡æœ‰äººèªªä½¿ç”¨ <code>res.locals</code> ä¸æ˜¯å¥½å¯¦ä½œæ™‚ï¼Œå¯ä»¥æ‹¿å‡ºé€™äº›å®˜æ–¹æ–‡æª”ä¾†è­‰æ˜é€™ç¢ºå¯¦æ˜¯è¢«å»£æ³›æ¥å—çš„æ¨™æº–åšæ³•ã€‚</p><h2 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul><li><a href="https://expressjs.com/en/guide/using-middleware.html">Express.js Using middleware</a></li><li><a href="https://authjs.dev/reference/express">Auth.js Express Integration</a></li><li><a href="https://www.passportjs.org/concepts/authentication/middleware/">Passport.js Middleware Documentation</a></li><li><a href="https://expressjs.com/en/api.html#res.locals">Express.js res.locals API Reference</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨ Express.js èªè­‰ç³»çµ±ä¸­ï¼Œå¸¸è¦‹çš„åšæ³•æ˜¯åœ¨æ¯å€‹éœ€è¦é©—è­‰çš„è·¯ç”±ä¸­ç›´æ¥è§£æ JWT tokenã€‚&lt;br&gt;ä½†æœ‰ä¸€å€‹æ›´å¥½çš„å¯¦ä½œæ–¹å¼ï¼šä½¿ç”¨ä¸­</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[è¸©é›·ç­†è¨˜] GitHub Action ssh-keyscan not found å•é¡Œä¿®å¾©</title>
    <link href="https://blog.marsen.me/2025/07/22/2025/ithub-action-ssh-keyscan-not-found-fix/"/>
    <id>https://blog.marsen.me/2025/07/22/2025/ithub-action-ssh-keyscan-not-found-fix/</id>
    <published>2025-07-22T05:42:30.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>GitHub Action <code>marsen/hexo-action@v1.0.11</code> ä¹‹å‰é‹è¡Œæ­£å¸¸ï¼Œä½†æœ€è¿‘é–‹å§‹å¤±æ•—ï¼ŒéŒ¯èª¤è¨Šæ¯ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/app/entrypoint.sh: 9: /usr/app/entrypoint.sh: ssh-keyscan: not found</span><br></pre></td></tr></table></figure><h2 id="å•é¡Œåˆ†æ"><a href="#å•é¡Œåˆ†æ" class="headerlink" title="å•é¡Œåˆ†æ"></a>å•é¡Œåˆ†æ</h2><h3 id="åˆæ­¥æª¢æŸ¥"><a href="#åˆæ­¥æª¢æŸ¥" class="headerlink" title="åˆæ­¥æª¢æŸ¥"></a>åˆæ­¥æª¢æŸ¥</h3><p>æª¢æŸ¥ entrypoint.sh ç¬¬9è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keyscan -t rsa github.com &gt;&gt; /root/.ssh/known_hosts</span><br></pre></td></tr></table></figure><p>æª¢æŸ¥ Dockerfile å¥—ä»¶å®‰è£ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span>-buster-slim</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y git openssh-client</span></span><br></pre></td></tr></table></figure><p>æ˜æ˜æœ‰å®‰è£ <code>openssh-client</code>ï¼Œç‚ºä»€éº¼æ‰¾ä¸åˆ° <code>ssh-keyscan</code>ï¼Ÿ</p><h3 id="æ ¹æœ¬åŸå› "><a href="#æ ¹æœ¬åŸå› " class="headerlink" title="æ ¹æœ¬åŸå› "></a>æ ¹æœ¬åŸå› </h3><p><strong>Debian Buster ç”Ÿå‘½é€±æœŸçµæŸ</strong></p><ul><li><code>node:20-buster-slim</code> åŸºæ–¼ Debian 10 (Buster)</li><li>Debian 10 æ–¼ 2024å¹´8æœˆé”åˆ° End of Life</li><li>å¥—ä»¶åº«ä¸å†ç¶­è­·ï¼Œå¥—ä»¶çµæ§‹å¯èƒ½è®ŠåŒ–</li></ul><p><strong>OpenSSH å¥—ä»¶é‡çµ„</strong></p><ul><li>2024å¹´ OpenSSH å¤šå€‹ç‰ˆæœ¬ç™¼å¸ƒ (9.7, 9.9)</li><li><code>ssh-keyscan</code> å¯èƒ½å¾ <code>openssh-client</code> ç§»åˆ°å…¶ä»–å¥—ä»¶</li></ul><p><strong>Docker æ˜ åƒè‡ªå‹•æ›´æ–°</strong></p><ul><li>Docker Hub æœƒè‡ªå‹•é‡å»ºæ˜ åƒ</li><li>æ–°ç‰ˆæœ¬ç§»é™¤ä¸å¿…è¦å·¥å…·ä»¥æ¸›å°‘æ”»æ“Šé¢</li></ul><h2 id="è§£æ±ºæ–¹æ¡ˆ"><a href="#è§£æ±ºæ–¹æ¡ˆ" class="headerlink" title="è§£æ±ºæ–¹æ¡ˆ"></a>è§£æ±ºæ–¹æ¡ˆ</h2><h3 id="å¿«é€Ÿä¿®å¾©ï¼ˆä¸æ¨è–¦ï¼‰"><a href="#å¿«é€Ÿä¿®å¾©ï¼ˆä¸æ¨è–¦ï¼‰" class="headerlink" title="å¿«é€Ÿä¿®å¾©ï¼ˆä¸æ¨è–¦ï¼‰"></a>å¿«é€Ÿä¿®å¾©ï¼ˆä¸æ¨è–¦ï¼‰</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y git openssh-client openssh-server</span></span><br></pre></td></tr></table></figure><p>é›–ç„¶å¯è¡Œï¼Œä½†å®‰è£ SSH ä¼ºæœå™¨æœƒå¢åŠ æ”»æ“Šé¢ã€‚</p><h3 id="æ­£ç¢ºè§£æ³•"><a href="#æ­£ç¢ºè§£æ³•" class="headerlink" title="æ­£ç¢ºè§£æ³•"></a>æ­£ç¢ºè§£æ³•</h3><p>å‡ç´šåŸºåº•æ˜ åƒåˆ°æ”¯æ´ç‰ˆæœ¬ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¾éæœŸç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span>-buster-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡ç´šåˆ°å®‰å…¨ç‰ˆæœ¬  </span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span>-bookworm-slim</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ Dockerfile ä¿®æ”¹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span>-bookworm-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> version=<span class="string">&quot;1.0.12&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> repository=<span class="string">&quot;https://github.com/marsen/hexo-action&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> homepage=<span class="string">&quot;https://blog.marsen.me&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;marsen.lin &lt;admin@marsen.me&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> entrypoint.sh /usr/app/entrypoint.sh</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> sync_deploy_history.js /usr/app/sync_deploy_history.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰å…¨ä¸”æœ€ä½³åŒ–çš„å¥—ä»¶å®‰è£</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &gt; /dev/null &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y git openssh-client &gt; /dev/null &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get clean &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">rm</span> -rf /var/lib/apt/lists/* &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chmod</span> +x /usr/app/entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/usr/app/entrypoint.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><h2 id="é—œéµæ”¹é€²"><a href="#é—œéµæ”¹é€²" class="headerlink" title="é—œéµæ”¹é€²"></a>é—œéµæ”¹é€²</h2><ol><li><p><strong>åŸºåº•æ˜ åƒå‡ç´š</strong>ï¼šbuster-slim â†’ bookworm-slim</p><ul><li>Debian 12 å–ä»£å·² EOL çš„ Debian 10</li><li>æ›´å¥½çš„å®‰å…¨æ€§å’Œé•·æœŸæ”¯æ´</li></ul></li><li><p><strong>æœ€å°æ¬Šé™åŸå‰‡</strong>ï¼šåªå®‰è£ openssh-client</p><ul><li>åŒ…å«æ‰€éœ€çš„ ssh-keyscan å·¥å…·</li><li>ä¸å®‰è£ SSH ä¼ºæœå™¨ï¼Œæ¸›å°‘æ”»æ“Šé¢</li></ul></li><li><p><strong>Docker æœ€ä½³å¯¦è¸</strong>ï¼š</p><ul><li>æ¸…ç† apt å¿«å–æ¸›å°‘æ˜ åƒå¤§å°</li><li>ä½¿ç”¨ &amp;&amp; åˆä½µ RUN æŒ‡ä»¤æ¸›å°‘å±¤æ•¸</li></ul></li></ol><h2 id="é é˜²æªæ–½"><a href="#é é˜²æªæ–½" class="headerlink" title="é é˜²æªæ–½"></a>é é˜²æªæ–½</h2><ul><li>ä½¿ç”¨å…·é«”ç‰ˆæœ¬æ¨™ç±¤è€Œé latest</li><li>å®šæœŸæª¢æŸ¥åŸºåº•æ˜ åƒçš„ç”Ÿå‘½é€±æœŸ</li><li>å»ºç«‹è‡ªå‹•åŒ–æ¸¬è©¦é©—è­‰ä¾è³´å¯ç”¨æ€§</li></ul><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€™æ¬¡å•é¡Œçš„æ ¸å¿ƒæ˜¯åŸºåº•æ˜ åƒéæœŸå°è‡´çš„é€£é–åæ‡‰ã€‚åœ¨å®¹å™¨åŒ–é–‹ç™¼ä¸­ï¼Œå¤–éƒ¨ä¾è³´çš„è®ŠåŒ–å¾€å¾€æœƒå½±éŸ¿æ—¢æœ‰ç³»çµ±ã€‚è§£æ±ºæ–¹æ¡ˆä¸æ˜¯å¿«é€Ÿä¿®å¾©ï¼Œè€Œæ˜¯å¾æ ¹æœ¬ä¸Šå‡ç´šåˆ°å®‰å…¨çš„é•·æœŸæ”¯æ´ç‰ˆæœ¬ã€‚</p><p>é™¤éŒ¯é—œéµæ€è·¯ï¼šåˆ†æã€Œç‚ºä»€éº¼ä¹‹å‰å¯ä»¥ï¼Œç¾åœ¨ä¸è¡Œã€ï¼Œå¾€å¾€èƒ½æ‰¾åˆ°å¤–éƒ¨ç’°å¢ƒè®ŠåŒ–çš„ç·šç´¢ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;GitHub Action &lt;code&gt;marsen/hexo-action@v1.0.11&lt;/code&gt; ä¹‹å‰é‹è¡Œæ­£å¸¸ï¼Œä½†</summary>
      
    
    
    
    
    <category term="è¸©é›·ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] Ollama å®¹å™¨åŒ–èª¿ç ”ç­†è¨˜</title>
    <link href="https://blog.marsen.me/2025/06/22/2025/ai-ollama-containerized/"/>
    <id>https://blog.marsen.me/2025/06/22/2025/ai-ollama-containerized/</id>
    <published>2025-06-22T15:36:35.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘åœ¨æ AI æ¨¡å‹çš„æœ¬åœ°éƒ¨ç½²ï¼Œä¸¦è©¦è‘—å°‡ Ollama å®¹å™¨åŒ–ã€‚<br>ç¶“éä¸€æ®µæ™‚é–“çš„èª¿ç ”å’Œå¯¦æ¸¬ï¼Œæƒ³è¨˜éŒ„ä¸€ä¸‹ç›®å‰çš„é€²åº¦å’Œå°å¹¾å€‹ä¸»æµæ–¹æ¡ˆçš„çœ‹æ³•ã€‚</p><h3 id="ç›®æ¨™"><a href="#ç›®æ¨™" class="headerlink" title="ç›®æ¨™"></a>ç›®æ¨™</h3><ul><li>æ‰¾åˆ°ç©©å®šçš„ Ollama å®¹å™¨åŒ–æ–¹æ¡ˆ</li><li>è©•ä¼°å„ç¨®æ–°èˆˆå·¥å…·çš„å¯ç”¨æ€§</li><li>ç‚ºæœªä¾†çš„ç”¢å“é–‹ç™¼åšæŠ€è¡“é ç ”</li></ul><h3 id="Ollama-ç°¡ä»‹"><a href="#Ollama-ç°¡ä»‹" class="headerlink" title="Ollama ç°¡ä»‹"></a>Ollama ç°¡ä»‹</h3><p>Ollama æ˜¯ä¸€å€‹é–‹æºå·¥å…·ï¼Œè®“ä½ åœ¨æœ¬åœ°é›»è…¦ä¸Šè¼•é¬†é‹è¡Œå¤§å‹èªè¨€æ¨¡å‹ï¼ˆå¦‚ Llamaã€CodeLlamaã€Mistral ç­‰ï¼‰ã€‚<br>å®‰è£ç°¡å–®ï¼Œä¸€è¡ŒæŒ‡ä»¤å°±èƒ½ä¸‹è¼‰å’Œé‹è¡Œå„ç¨® AI æ¨¡å‹ï¼Œç„¡éœ€è¤‡é›œè¨­å®šã€‚æ”¯æ´ macOSã€Linux å’Œ Windowsã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  å®‰è£å¾Œç›´æ¥ç”¨</span></span><br><span class="line">ollama run llama3.2</span><br></pre></td></tr></table></figure><p>é¡ä¼¼ Docker çš„æ¦‚å¿µï¼Œä½†å°ˆé–€ç‚º AI æ¨¡å‹è¨­è¨ˆã€‚<br>é‚„æä¾› REST APIï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•Ÿå‹•å¾Œè‡ªå‹•é–‹å•Ÿ API server (é è¨­ port 11434)</span></span><br><span class="line">curl http://localhost:11434/api/generate \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;model&quot;: &quot;llama3.2&quot;, &quot;prompt&quot;: &quot;Hello&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>æ²’æœ‰ Ollama çš„è©±ï¼Œä½ éœ€è¦ï¼š</p><ul><li>æ‰‹å‹•ä¸‹è¼‰æ¨¡å‹æª”æ¡ˆï¼ˆé€šå¸¸å¥½å¹¾ GBï¼‰</li><li>è™•ç†ä¸åŒæ¨¡å‹æ ¼å¼ï¼ˆGGUFã€GGML ç­‰ï¼‰</li><li>è¨­å®š GPU åŠ é€Ÿç’°å¢ƒ</li><li>å¯«ä»£ç¢¼è¼‰å…¥æ¨¡å‹åˆ°è¨˜æ†¶é«”</li><li>è™•ç† tokenization å’Œ inference</li><li>è‡ªå·±åŒ… API server</li></ul><p>Ollama æŠŠé€™äº›éƒ½å¹«ä½ æå®šäº†ã€‚</p><h2 id="é¸æ“‡"><a href="#é¸æ“‡" class="headerlink" title="é¸æ“‡"></a>é¸æ“‡</h2><h3 id="ç›®å‰æ¡ç”¨ï¼šOllama-Container-æŒ‡ä»¤åˆå§‹åŒ–"><a href="#ç›®å‰æ¡ç”¨ï¼šOllama-Container-æŒ‡ä»¤åˆå§‹åŒ–" class="headerlink" title="ç›®å‰æ¡ç”¨ï¼šOllama Container + æŒ‡ä»¤åˆå§‹åŒ–"></a>ç›®å‰æ¡ç”¨ï¼šOllama Container + æŒ‡ä»¤åˆå§‹åŒ–</h3><p>ç¶“éè©•ä¼°ï¼Œé¸æ“‡ ollama container æ–¹æ¡ˆæœ€ç©©å®šä¸”å½ˆæ€§ä¹Ÿæœ€é«˜ï¼Œ</p><p>åªè¦éœ€è¦é€éæŒ‡ä»¤çš„æ–¹æ³•ä¾†å°±å¯ä»¥ä¾†å–æ¨¡å‹ã€‚</p><p>åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•Ÿå‹• ollama container</span></span><br><span class="line">docker run -d --name ollama -p 11434:11434 ollama/ollama</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è¼‰æ¨¡å‹</span></span><br><span class="line">docker <span class="built_in">exec</span> -it ollama ollama pull llama3.2</span><br></pre></td></tr></table></figure><h3 id="Docker-Model-Runnerï¼šå€¼å¾—é—œæ³¨ä½†æš«ä¸æ¡ç”¨"><a href="#Docker-Model-Runnerï¼šå€¼å¾—é—œæ³¨ä½†æš«ä¸æ¡ç”¨" class="headerlink" title="Docker Model Runnerï¼šå€¼å¾—é—œæ³¨ä½†æš«ä¸æ¡ç”¨"></a>Docker Model Runnerï¼šå€¼å¾—é—œæ³¨ä½†æš«ä¸æ¡ç”¨</h3><p>DMR åœ¨ 2025 å¹´ 3æœˆéš¨ Docker Desktop 4.40 æ¨å‡º Beta ç‰ˆï¼Œ</p><p>çœ‹èµ·ä¾†å¾ˆæœ‰æ½›åŠ›ï¼Œä½†ç›®å‰ä¸æ‰“ç®—ç”¨åœ¨ç”¢å“ä¸Šã€‚</p><p>ä¸»å› å¦‚ä¸‹</p><ul><li>å¹³å°æ”¯æ´éšæ®µæ€§ï¼šæœ€åˆåªæ”¯æ´ Apple Silicon (M1-M4)ï¼Œ5æœˆçš„ Docker Desktop 4.41 æ‰åŠ å…¥ Windows NVIDIA GPU æ”¯æ´</li><li>å¯¦é©—éšæ®µï¼šå·¥å…·è®ŠåŒ–å¿«é€Ÿï¼Œé æœŸæœƒæŒçºŒæ”¹é€²ï¼Œå°ç”¢å“é–‹ç™¼é¢¨éšªè¼ƒé«˜</li><li>Linux æ”¯æ´ï¼šç›®å‰åœ¨ Linux (åŒ…å« WSL2) ä¸Šæ”¯æ´ Docker CEï¼Œä½†æ•´é«”ç”Ÿæ…‹é‚„åœ¨ç™¼å±•ä¸­</li></ul><p>æœƒæŒçºŒè§€å¯Ÿï¼Œæœ€æ–°çš„ Docker Desktop 4.42 ç”šè‡³æ”¯æ´äº† Windows Qualcomm æ™¶ç‰‡ï¼Œç™¼å±•å¾ˆå¿«ã€‚</p><h3 id="Podman-AI-Labï¼šæ¦‚å¿µä¸éŒ¯ä½†æœ‰ä½¿ç”¨é™åˆ¶"><a href="#Podman-AI-Labï¼šæ¦‚å¿µä¸éŒ¯ä½†æœ‰ä½¿ç”¨é™åˆ¶" class="headerlink" title="Podman AI Labï¼šæ¦‚å¿µä¸éŒ¯ä½†æœ‰ä½¿ç”¨é™åˆ¶"></a>Podman AI Labï¼šæ¦‚å¿µä¸éŒ¯ä½†æœ‰ä½¿ç”¨é™åˆ¶</h3><p>Podman AI Lab æä¾›ä¸€ä»½ç²¾é¸çš„é–‹æº AI æ¨¡å‹æ¸…å–®ï¼Œæ¦‚å¿µä¸Šè·Ÿ DMR é¡ä¼¼ï¼Œä½†å¯¦éš›ä½¿ç”¨ä¸Šæœ‰äº›è€ƒé‡ã€‚</p><p>ç¾æ³ æ”¯æ´ GGUFã€PyTorchã€TensorFlow ç­‰å¸¸è¦‹æ ¼å¼</p><p>æä¾›ç²¾é¸çš„ recipe ç›®éŒ„ï¼Œå¹«åŠ©å°èˆª AI ä½¿ç”¨æ¡ˆä¾‹å’Œæ¨¡å‹</p><p>æœ€è¿‘èˆ‡ RamaLama æ•´åˆï¼Œç°¡åŒ–æœ¬åœ° AI æ¨¡å‹åŸ·è¡Œ</p><p>ä½†æ¡ç”¨ç²¾é¸æ¨¡å‹æ¸…å–®çš„ç­–ç•¥ï¼Œå¯èƒ½ä¸åŒ…å«æ‰€æœ‰æƒ³è¦çš„æ¨¡å‹</p><p>ç›¸å°æ–¼ Ollama çš„å»£æ³›æ¨¡å‹æ”¯æ´ï¼Œé¸æ“‡è¼ƒç‚ºæœ‰é™</p><p>ä¸ééš¨è‘— RamaLama èƒ½å¾ä»»ä½•ä¾†æºç°¡åŒ– AI æ¨¡å‹çš„æœ¬åœ°æœå‹™ï¼Œæœªä¾†å¯èƒ½æœƒæ›´éˆæ´»ã€‚</p><h2 id="ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ"><a href="#ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ" class="headerlink" title="ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ"></a>ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ</h2><h3 id="Ollama-Container-å¸¸è¦‹å‘"><a href="#Ollama-Container-å¸¸è¦‹å‘" class="headerlink" title="Ollama Container å¸¸è¦‹å‘"></a>Ollama Container å¸¸è¦‹å‘</h3><ol><li><strong>GPU æ”¯æ´</strong>ï¼šè¨˜å¾—åŠ  <code>--gpus all</code> æˆ–ç”¨ docker-compose è¨­å®š</li><li><strong>æ¨¡å‹è·¯å¾‘</strong>ï¼šé è¨­åœ¨ <code>/root/.ollama</code>ï¼Œè¦æŒä¹…åŒ–è¨˜å¾— mount volume</li><li><strong>ç¶²è·¯è¨­å®š</strong>ï¼šå¦‚æœåœ¨ k8s ç’°å¢ƒï¼Œæ³¨æ„ service çš„ port è¨­å®š</li></ol><h3 id="Docker-Model-Runner-è©•ä¼°å¿ƒå¾—"><a href="#Docker-Model-Runner-è©•ä¼°å¿ƒå¾—" class="headerlink" title="Docker Model Runner è©•ä¼°å¿ƒå¾—"></a>Docker Model Runner è©•ä¼°å¿ƒå¾—</h3><ul><li>ç›®å‰ä¸»è¦åœ¨ macOS Apple Silicon ä¸Šæ¯”è¼ƒç©©å®š</li><li>Linux æ”¯æ´é‚„åœ¨å®Œå–„ä¸­</li><li>Windows æ”¯æ´æ˜¯æœ€è¿‘æ‰åŠ çš„ï¼Œéœ€è¦æ›´å¤šå¯¦æ¸¬</li></ul><h2 id="æŠ€è¡“é¸å‹æ€è€ƒ"><a href="#æŠ€è¡“é¸å‹æ€è€ƒ" class="headerlink" title="æŠ€è¡“é¸å‹æ€è€ƒ"></a>æŠ€è¡“é¸å‹æ€è€ƒ</h2><p>é€™æ¬¡èª¿ç ”è®“æˆ‘æƒ³åˆ°å¹¾å€‹é»ï¼š</p><ol><li><strong>ç©©å®šæ€§ &gt; æ–°åŠŸèƒ½</strong>ï¼šå°ç”¢å“é–‹ç™¼ä¾†èªªï¼Œç©©å®šæ€§æ°¸é æ˜¯ç¬¬ä¸€è€ƒé‡</li><li><strong>ç”Ÿæ…‹å®Œæ•´æ€§</strong>ï¼šå–®ä¸€å·¥å…·å†å¥½ï¼Œç”Ÿæ…‹ä¸å®Œå–„å°±æ˜¯ç¡¬å‚·</li><li><strong>ç¶­è­·æˆæœ¬</strong>ï¼šæ–°æŠ€è¡“é€šå¸¸éœ€è¦æ›´å¤šç¶­è­·å·¥ä½œ</li></ol><h2 id="ä¸‹ä¸€æ­¥"><a href="#ä¸‹ä¸€æ­¥" class="headerlink" title="ä¸‹ä¸€æ­¥"></a>ä¸‹ä¸€æ­¥</h2><p>çŸ­æœŸè¨ˆç•«ï¼š</p><ol><li>æŠŠ Ollama container çš„åˆå§‹åŒ–æµç¨‹è‡ªå‹•åŒ–</li><li>æŒçºŒè¿½è¹¤ DMR ç™¼å±•</li><li>å»ºç«‹æŠ€è¡“æ–¹æ¡ˆè©•ä¼°æ¨™æº–</li></ol><p>ä¸­æœŸç›®æ¨™ï¼š</p><ul><li>ç­‰ DMR ç©©å®šå¾Œå†è©•ä¼°å°å…¥</li><li>ç ”ç©¶å…¶ä»–å®¹å™¨åŒ–æ–¹æ¡ˆ</li><li>æ•´ç†æœ€ä½³å¯¦è¸æ–‡ä»¶</li></ul><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>AI åŸºç¤è¨­æ–½è®ŠåŒ–å¾ˆå¿«ï¼Œå®¹å™¨åŒ–æŠ€è¡“ä¹Ÿåœ¨æ¼”é€²ã€‚ç›®å‰æ²’æœ‰å®Œç¾æ–¹æ¡ˆï¼Œä½†é€™å€‹èª¿ç ”éç¨‹å¾ˆæœ‰åƒ¹å€¼ã€‚</p><p>æŠ€è¡“é¸æ“‡æ˜¯å‹•æ…‹å¹³è¡¡çš„éç¨‹ï¼Œè¦åœ¨ç©©å®šæ€§ã€åŠŸèƒ½æ€§ã€ç¶­è­·æˆæœ¬é–“æ‰¾å¹³è¡¡é»ã€‚</p><p>æœƒæŒçºŒé—œæ³¨é€™é ˜åŸŸçš„ç™¼å±•ï¼Œæœ‰æ–°ç™¼ç¾å†åˆ†äº«ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨æ AI æ¨¡å‹çš„æœ¬åœ°éƒ¨ç½²ï¼Œä¸¦è©¦è‘—å°‡ Ollama å®¹å™¨åŒ–ã€‚&lt;br&gt;ç¶“éä¸€æ®µæ™‚é–“çš„èª¿ç ”å’Œå¯¦æ¸¬ï¼Œæƒ³è¨˜éŒ„ä¸€ä¸‹ç›®å‰çš„é€²åº¦å’Œå°å¹¾</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [ç”Ÿæ´»ç­†è¨˜] 2025 å¸¸ç”¨å·¥å…·æ•´ç† - AI ç¯‡</title>
    <link href="https://blog.marsen.me/2025/06/20/2025/ai-tools/"/>
    <id>https://blog.marsen.me/2025/06/20/2025/ai-tools/</id>
    <published>2025-06-20T11:35:51.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘ AI å·¥å…·å¦‚é›¨å¾Œæ˜¥ç­èˆ¬å†’å‡ºï¼Œæ•´ç†ä¸€äº›ç›®å‰åœ¨ç”¨æˆ–å€¼å¾—é—œæ³¨çš„å·¥å…·ï¼Œä¸»è¦åˆ†ç‚ºå°è©±ã€é–‹ç™¼ã€å°ˆæ¥­æ‡‰ç”¨ä¸‰å¤§é¡ã€‚</p><h2 id="å°è©±èˆ‡é€šç”¨-AI"><a href="#å°è©±èˆ‡é€šç”¨-AI" class="headerlink" title="å°è©±èˆ‡é€šç”¨ AI"></a>å°è©±èˆ‡é€šç”¨ AI</h2><h3 id="Claude"><a href="#Claude" class="headerlink" title="Claude"></a>Claude</h3><ul><li><a href="https://claude.ai/chat/"><strong>Claude Chat</strong></a></li><li>Anthropic é–‹ç™¼çš„ AI åŠ©æ‰‹ï¼Œæ“…é•·å¯«ä½œã€åˆ†æã€ç¨‹å¼é–‹ç™¼</li><li>æ”¯æ´å¤šæ¨¡æ…‹è¼¸å…¥ï¼ˆæ–‡å­—ã€åœ–ç‰‡ã€æ–‡ä»¶ï¼‰</li><li>å…è²»ç‰ˆæœ‰ä½¿ç”¨é™åˆ¶ï¼Œä»˜è²»ç‰ˆæ›´ç©©å®š</li></ul><h3 id="Grok"><a href="#Grok" class="headerlink" title="Grok"></a>Grok</h3><ul><li><a href="https://grok.com/"><strong>Grok</strong></a></li><li>xAI æ¨å‡ºçš„å°è©±å¼ AI</li><li>é¢¨æ ¼æ¯”è¼ƒç›´æ¥çŠ€åˆ©ï¼Œæœƒåæ§½ï¼ˆç‰¹è‰²ï¼‰</li><li>éœ€è¦ X Premium æœƒå“¡æ‰èƒ½ä½¿ç”¨</li></ul><h3 id="Gemini-Google"><a href="#Gemini-Google" class="headerlink" title="Gemini (Google)"></a>Gemini (Google)</h3><ul><li><a href="https://gemini.google.com/"><strong>Gemini</strong></a></li><li>Google æœ€æ–°å¤šæ¨¡æ…‹ AI åŠ©æ‰‹ï¼Œæ”¯æ´æ–‡å­—ã€åœ–ç‰‡ã€ç¨‹å¼ç¢¼ç­‰å¤šç¨®è¼¸å…¥</li><li>å·²æ•´åˆé€² Google Workspaceã€Androidã€Chrome ç­‰ç”Ÿæ…‹ç³»</li></ul><h3 id="Microsoft-Copilot"><a href="#Microsoft-Copilot" class="headerlink" title="Microsoft Copilot"></a>Microsoft Copilot</h3><ul><li><a href="https://copilot.microsoft.com/"><strong>Copilot</strong></a></li><li>å¾®è»Ÿå…¨å®¶æ¡¶ AI åŠ©æ‰‹ï¼Œæ•´åˆæ–¼ Windows 11ã€Edgeã€Office 365</li><li>æ”¯æ´ Wordã€Excelã€PowerPoint ç›´æ¥ AI å”ä½œ</li></ul><h3 id="Perplexity-AI"><a href="#Perplexity-AI" class="headerlink" title="Perplexity AI"></a>Perplexity AI</h3><ul><li><a href="https://www.perplexity.ai/"><strong>Perplexity</strong></a></li><li>å¼·èª¿å³æ™‚ç¶²è·¯æœå°‹èˆ‡å•ç­”ï¼Œæ”¯æ´å¤šèªè¨€ã€å¼•ç”¨ä¾†æº</li><li>é©åˆçŸ¥è­˜æŸ¥è©¢ã€ç ”ç©¶è¼”åŠ©</li></ul><h3 id="Notion-AI"><a href="#Notion-AI" class="headerlink" title="Notion AI"></a>Notion AI</h3><ul><li><a href="https://www.notion.so/product/ai"><strong>Notion AI</strong></a></li><li>æ•´åˆæ–¼ Notion ç­†è¨˜&#x2F;çŸ¥è­˜ç®¡ç†å¹³å°çš„ AI åŠ©æ‰‹</li><li>æ”¯æ´è‡ªå‹•æ‘˜è¦ã€é‡å¯«ã€è…¦åŠ›æ¿€ç›ªç­‰åŠŸèƒ½</li></ul><h3 id="ChatGPT-OpenAI"><a href="#ChatGPT-OpenAI" class="headerlink" title="ChatGPT (OpenAI)"></a>ChatGPT (OpenAI)</h3><ul><li><a href="https://chat.openai.com/"><strong>ChatGPT</strong></a></li><li>OpenAI çš„å°è©±å¼ AIï¼Œæ”¯æ´ GPT-4&#x2F;4oï¼Œæ‡‰ç”¨æ–¼å°è©±ã€ç¨‹å¼ã€è³‡æ–™åˆ†æç­‰</li><li>å…è²»&#x2F;ä»˜è²»ç‰ˆçš†æœ‰</li></ul><h3 id="Kimi-Chatï¼ˆMoonshot-AIï¼‰"><a href="#Kimi-Chatï¼ˆMoonshot-AIï¼‰" class="headerlink" title="Kimi Chatï¼ˆMoonshot AIï¼‰"></a>Kimi Chatï¼ˆMoonshot AIï¼‰</h3><ul><li><a href="https://kimi.moonshot.cn/"><strong>Kimi Chat</strong></a></li><li>ä¸­æ–‡ç¤¾ç¾¤è¨è«–åº¦é«˜ï¼Œæ”¯æ´é•·æ–‡é–±è®€ã€PDF åˆ†æ</li></ul><h3 id="Phind"><a href="#Phind" class="headerlink" title="Phind"></a>Phind</h3><ul><li><a href="https://www.phind.com/"><strong>Phind</strong></a></li><li>å°ˆç‚ºå·¥ç¨‹å¸«è¨­è¨ˆçš„ AI æœå°‹èˆ‡å•ç­”å¹³å°ï¼Œç¨‹å¼ç¢¼è§£é‡‹ã€æŠ€è¡“æ–‡ä»¶æŸ¥æ‰¾å¾ˆå¼·</li></ul><hr><h2 id="ç¨‹å¼é–‹ç™¼å·¥å…·"><a href="#ç¨‹å¼é–‹ç™¼å·¥å…·" class="headerlink" title="ç¨‹å¼é–‹ç™¼å·¥å…·"></a>ç¨‹å¼é–‹ç™¼å·¥å…·</h2><h3 id="ç¨‹å¼ç¢¼ç”Ÿæˆèˆ‡å”åŠ©"><a href="#ç¨‹å¼ç¢¼ç”Ÿæˆèˆ‡å”åŠ©" class="headerlink" title="ç¨‹å¼ç¢¼ç”Ÿæˆèˆ‡å”åŠ©"></a>ç¨‹å¼ç¢¼ç”Ÿæˆèˆ‡å”åŠ©</h3><ul><li><p><a href="https://openai.com/index/introducing-codex/"><strong>OpenAI Codex</strong></a></p><ul><li>é›²ç«¯è»Ÿé«”å·¥ç¨‹ä»£ç†ï¼Œå¯åŒæ™‚è™•ç†å¤šé …é–‹ç™¼ä»»å‹™</li><li>æ”¯æ´åŠŸèƒ½é–‹ç™¼ã€bug ä¿®å¾©ã€é‡æ§‹ç­‰</li></ul></li><li><p><a href="https://docs.github.com/en/copilot"><strong>GitHub Copilot</strong></a></p><ul><li>ç›´æ¥åœ¨ç·¨è¼¯å™¨ä¸­æä¾›ç¨‹å¼ç¢¼å»ºè­°</li><li>å¯ç”Ÿæˆæ•´è¡Œæˆ–æ•´å€‹å‡½æ•¸</li><li>éœ€ä»˜è²»è¨‚é–±</li></ul></li><li><p><a href="https://www.cursor.com/cn/features"><strong>Cursor</strong></a></p><ul><li>AI ç¨‹å¼ç¢¼ç·¨è¼¯å™¨</li><li>å°ˆæ³¨æ–¼æ™ºèƒ½ç¨‹å¼é–‹ç™¼é«”é©—</li><li>æ”¯æ´è‡ªç„¶èªè¨€èˆ‡ç¨‹å¼ç¢¼äº’å‹•</li></ul></li><li><p><a href="https://www.anthropic.com/claude-code"><strong>Claude Code</strong></a></p><ul><li>å®˜æ–¹æ–‡ä»¶ï¼š<a href="https://docs.anthropic.com/zh-TW/docs/claude-code/overview">https://docs.anthropic.com/zh-TW/docs/claude-code/overview</a></li><li>ç”¢å“é é¢ï¼š</li><li>Anthropic çš„å‘½ä»¤åˆ—å·¥å…·</li><li>è®“é–‹ç™¼è€…ç›´æ¥å¾çµ‚ç«¯å§”è¨—ç¨‹å¼é–‹ç™¼ä»»å‹™çµ¦ Claude</li><li>ç›®å‰é‚„åœ¨ç ”ç©¶é è¦½éšæ®µ</li></ul></li><li><p><a href="https://augmentcode.com/"><strong>AugmentCode</strong></a></p><ul><li>AI é©…å‹•çš„ç¨‹å¼ç¢¼æœå°‹èˆ‡ç†è§£å¹³å°</li><li>æ”¯æ´è·¨å°ˆæ¡ˆã€è·¨èªè¨€çš„ç¨‹å¼ç¢¼æŸ¥è©¢ã€æ‘˜è¦èˆ‡è‡ªå‹•è§£é‡‹</li><li>é©åˆå¤§å‹å°ˆæ¡ˆç¶­è­·ã€å”ä½œèˆ‡çŸ¥è­˜å‚³æ‰¿</li></ul></li></ul><h3 id="æ‡‰ç”¨é–‹ç™¼"><a href="#æ‡‰ç”¨é–‹ç™¼" class="headerlink" title="æ‡‰ç”¨é–‹ç™¼"></a>æ‡‰ç”¨é–‹ç™¼</h3><ul><li><p><a href="https://studio.firebase.google.com/"><strong>Firebase Studio</strong></a></p><ul><li>Google çš„æ‡‰ç”¨é–‹ç™¼å¹³å°</li><li>æ•´åˆå¤šç¨®å¾Œç«¯æœå‹™</li></ul></li><li><p><a href="https://deepwiki.com/"><strong>DeepWiki</strong></a></p><ul><li>AI é©…å‹•çš„çŸ¥è­˜æœå°‹èˆ‡æ‘˜è¦å·¥å…·</li><li>æ”¯æ´å¤šèªè¨€ã€å¿«é€Ÿæ•´ç†ä¸»é¡Œé‡é»ï¼Œé©åˆç ”ç©¶ã€å­¸ç¿’ã€è³‡æ–™å½™æ•´</li><li>å¯ç”¨æ–¼æŠ€è¡“ã€å­¸è¡“ã€ç”¢æ¥­ç­‰å¤šç¨®é ˜åŸŸ</li></ul></li></ul><h2 id="é›œä¸ƒé›œå…«"><a href="#é›œä¸ƒé›œå…«" class="headerlink" title="é›œä¸ƒé›œå…«"></a>é›œä¸ƒé›œå…«</h2><h3 id="æ³•å¾‹å°ˆæ¥­-â€”-Harvey-AI"><a href="#æ³•å¾‹å°ˆæ¥­-â€”-Harvey-AI" class="headerlink" title="æ³•å¾‹å°ˆæ¥­ â€” Harvey AI"></a>æ³•å¾‹å°ˆæ¥­ â€” <a href="https://www.harvey.ai/security"><strong>Harvey AI</strong></a></h3><ul><li>å°ˆé–€ç‚ºæ³•å¾‹è¡Œæ¥­è¨­è¨ˆçš„ AI åŠ©æ‰‹</li><li>å¼·èª¿å®‰å…¨æ€§å’Œåˆè¦æ€§ï¼ˆé‡è¦ï¼‰</li></ul><h3 id="æ–‡ä»¶ç ”ç©¶-â€”-NotebookLM"><a href="#æ–‡ä»¶ç ”ç©¶-â€”-NotebookLM" class="headerlink" title="æ–‡ä»¶ç ”ç©¶ â€” NotebookLM"></a>æ–‡ä»¶ç ”ç©¶ â€” <a href="https://notebooklm.google.com/"><strong>NotebookLM</strong></a></h3><ul><li>Google çš„ç­†è¨˜å’Œç ”ç©¶å·¥å…·</li><li>å¯ä»¥åˆ†æå’Œç¸½çµæ–‡ä»¶</li><li>æ”¯æ´å¤šç¨®æ–‡ä»¶æ ¼å¼ä¸Šå‚³</li></ul><h3 id="NVIDIA-Container-Toolkit"><a href="#NVIDIA-Container-Toolkit" class="headerlink" title="NVIDIA Container Toolkit"></a><a href="https://github.com/NVIDIA/nvidia-container-toolkit"><strong>NVIDIA Container Toolkit</strong></a></h3><ul><li>NVIDIA çš„å®¹å™¨åŒ–å·¥å…·åŒ…</li><li>ä¸»è¦ç”¨æ–¼ GPU åŠ é€Ÿçš„å®¹å™¨æ‡‰ç”¨</li></ul><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://claude.ai/chat/">https://claude.ai/chat/</a></li><li><a href="https://openai.com/index/introducing-codex/">https://openai.com/index/introducing-codex/</a></li><li><a href="https://hackmd.io/@fL8pq60EQsG3RplVzWfGWA/SkNhLpNGe">https://hackmd.io/@fL8pq60EQsG3RplVzWfGWA/SkNhLpNGe</a></li><li><a href="https://docs.github.com/en/copilot">https://docs.github.com/en/copilot</a></li><li><a href="https://grok.com/">https://grok.com/</a></li><li><a href="https://github.com/NVIDIA/nvidia-container-toolkit?tab=security-ov-file">https://github.com/NVIDIA/nvidia-container-toolkit?tab=security-ov-file</a></li><li><a href="https://docs.anthropic.com/zh-TW/docs/claude-code/overview">https://docs.anthropic.com/zh-TW/docs/claude-code/overview</a></li><li><a href="https://www.harvey.ai/security">https://www.harvey.ai/security</a></li><li><a href="https://www.cursor.com/cn/features">https://www.cursor.com/cn/features</a></li><li><a href="https://studio.firebase.google.com/">https://studio.firebase.google.com/</a></li><li><a href="https://notebooklm.google.com/">https://notebooklm.google.com/</a></li><li><a href="https://www.anthropic.com/claude-code">https://www.anthropic.com/claude-code</a></li><li><a href="https://gemini.google.com/">https://gemini.google.com/</a></li><li><a href="https://copilot.microsoft.com/">https://copilot.microsoft.com/</a></li><li><a href="https://www.perplexity.ai/">https://www.perplexity.ai/</a></li><li><a href="https://www.notion.so/product/ai">https://www.notion.so/product/ai</a></li><li><a href="https://chat.openai.com/">https://chat.openai.com/</a></li><li><a href="https://kimi.moonshot.cn/">https://kimi.moonshot.cn/</a></li><li><a href="https://www.phind.com/">https://www.phind.com/</a></li></ul><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>ç›®å‰ AI å·¥å…·ç”Ÿæ…‹ç³»çµ±ç™¼å±•è¿…é€Ÿï¼Œå„å®¶éƒ½åœ¨æ¶ä½”ä¸åŒçš„æ‡‰ç”¨å ´æ™¯ã€‚<br>å°è©±é¡å·¥å…·å·²ç¶“ç›¸ç•¶æˆç†Ÿï¼Œç¨‹å¼é–‹ç™¼è¼”åŠ©å·¥å…·ä¹Ÿè¶Šä¾†è¶Šå¯¦ç”¨ï¼Œå°ˆæ¥­é ˜åŸŸçš„ AI æ‡‰ç”¨å‰‡å‰›èµ·æ­¥ä½†æ½›åŠ›å·¨å¤§ã€‚<br>å°æˆ‘å€‹äººè€Œè¨€é‡å»ºè‡ªå·²çš„å·¥ä½œæµç¨‹æ•´åˆ AI å”åŠ©å·²ç¶“åˆ»ä¸å®¹ç·©</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘ AI å·¥å…·å¦‚é›¨å¾Œæ˜¥ç­èˆ¬å†’å‡ºï¼Œæ•´ç†ä¸€äº›ç›®å‰åœ¨ç”¨æˆ–å€¼å¾—é—œæ³¨çš„å·¥å…·ï¼Œä¸»è¦åˆ†ç‚ºå°è©±ã€é–‹ç™¼ã€å°ˆæ¥­æ‡‰ç”¨ä¸‰å¤§é¡ã€‚&lt;/p&gt;
&lt;h2 i</summary>
      
    
    
    
    
    <category term="ç”Ÿæ´»ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] ç”¨ GitLab CI/CD å¯¦ç¾è‡ªå‹•æ‰“ Tagã€Build èˆ‡ Push Docker Image åˆ° Registry</title>
    <link href="https://blog.marsen.me/2025/06/05/2025/gitlab-cicd-to-registry/"/>
    <id>https://blog.marsen.me/2025/06/05/2025/gitlab-cicd-to-registry/</id>
    <published>2025-06-05T11:11:43.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>åœ¨å°ˆæ¡ˆè‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹ä¸­ï¼Œè®“ CI&#x2F;CD pipeline è‡ªå‹•ç”¢ç”Ÿéå¢ tagã€build Docker image ä¸¦æ¨é€åˆ° GitLab Container Registryï¼Œæ˜¯ç¾ä»£ DevOps çš„å¸¸è¦‹éœ€æ±‚ã€‚</p><p>é€™ç¯‡æ–‡ç« è¨˜éŒ„æˆ‘åœ¨ GitLab CI&#x2F;CD ä¸Šå¯¦ä½œé€™ä¸€æµç¨‹çš„ç¶“é©—ã€‚</p><h3 id="ç›®æ¨™"><a href="#ç›®æ¨™" class="headerlink" title="ç›®æ¨™"></a>ç›®æ¨™</h3><ul><li><strong>è‡ªå‹•ç”¢ç”Ÿéå¢ tag</strong>ï¼ˆå¦‚ ver.1.0.1ï¼‰</li><li><strong>è‡ªå‹• build ä¸¦ push Docker image</strong>ï¼Œimage tag èˆ‡ git tag åŒæ­¥</li><li><strong>æ”¯æ´å¤šå°ˆæ¡ˆå…±ç”¨åŒä¸€ä»½ CI è¨­å®š</strong></li><li><strong>åƒ… main åˆ†æ”¯è§¸ç™¼</strong></li></ul><h2 id="å¯¦ä½œ"><a href="#å¯¦ä½œ" class="headerlink" title="å¯¦ä½œ"></a>å¯¦ä½œ</h2><ol><li><p>è®Šæ•¸æŠ½è±¡åŒ–ï¼Œæ”¯æ´å¤šå°ˆæ¡ˆå…±ç”¨</p><p> é¦–å…ˆï¼Œå°‡å°ˆæ¡ˆåç¨±ã€ç¾¤çµ„è·¯å¾‘ç­‰è³‡è¨ŠæŠ½æˆè®Šæ•¸ï¼Œæ–¹ä¾¿ä¸åŒå°ˆæ¡ˆè¤‡ç”¨ï¼š</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">PROJECT_NAME:</span> <span class="string">my-proj</span></span><br><span class="line">  <span class="attr">GROUP_PATH:</span> <span class="string">my-group</span></span><br><span class="line">  <span class="attr">REGISTRY_PATH:</span> <span class="string">registry.gitlab.com/$GROUP_PATH/$PROJECT_NAME</span></span><br></pre></td></tr></table></figure></li><li><p>å¤šéšæ®µ Dockerfile ç²¾ç°¡ image</p><p> ä½¿ç”¨ multi-stage buildï¼Œç¢ºä¿ production image åªåŒ…å«å¿…è¦æª”æ¡ˆèˆ‡ production dependenciesï¼š</p> <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">23</span>-alpine AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">23</span>-alpine AS production</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install --production</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/dist ./dist</span></span><br><span class="line"><span class="keyword">ENV</span> NODE_ENV=production</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br></pre></td></tr></table></figure><p> å»ºè­°æ­é… .dockerignore é¿å…å¤šé¤˜æª”æ¡ˆé€²å…¥ imageã€‚</p></li><li><p>GitLab CI&#x2F;CD Pipeline è¨­å®šåªåœ¨ main åˆ†æ”¯åŸ·è¡Œ</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_COMMIT_BRANCH == &quot;main&quot;&#x27;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">always</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">when:</span> <span class="string">never</span></span><br></pre></td></tr></table></figure></li><li><p>è‡ªå‹•ç”¢ç”Ÿéå¢ tag</p><ol><li>æ¡ç”¨ major.minor.patch çš„ç‰ˆæœ¬è¦å‰‡ï¼Œå•Ÿå§‹ç‰ˆè™Ÿç‚º ver.1.0.0</li><li>å…ˆåŒæ­¥ remote tagï¼Œé¿å…æœ¬åœ°æ®˜ç•™å½±éŸ¿</li><li>å–å¾—æœ€å¤§ patch è™Ÿï¼Œè‡ªå‹• +1</li><li>æª¢æŸ¥ tag æ˜¯å¦å·²å­˜åœ¨ï¼Œç¢ºä¿å”¯ä¸€</li></ol> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">fetch</span> <span class="string">--prune</span> <span class="string">--tags</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">tag</span> <span class="string">-l</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-n</span> <span class="number">1</span> <span class="string">git</span> <span class="string">tag</span> <span class="string">-d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">fetch</span> <span class="string">--tags</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">    prefix=&quot;ver.&quot;</span></span><br><span class="line"><span class="string">    max_patch=$(git tag -l &quot;$&#123;prefix&#125;[0-9]*.[0-9]*.[0-9]*&quot; | grep -oE &#x27;[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -t. -k1,1nr -k2,2nr -k3,3nr | head -n1 | awk -F. &#x27;&#123;print $3&#125;&#x27;)</span></span><br><span class="line"><span class="string">    if [ -z &quot;$max_patch&quot; ]; then</span></span><br><span class="line"><span class="string">      new_tag=&quot;$&#123;prefix&#125;1.0.0&quot;</span></span><br><span class="line"><span class="string">    else</span></span><br><span class="line"><span class="string">      major=$(git tag -l &quot;$&#123;prefix&#125;[0-9]*.[0-9]*.[0-9]*&quot; | grep -oE &#x27;[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -t. -k1,1nr -k2,2nr -k3,3nr | head -n1 | cut -d. -f1)</span></span><br><span class="line"><span class="string">      minor=$(git tag -l &quot;$&#123;prefix&#125;[0-9]*.[0-9]*.[0-9]*&quot; | grep -oE &#x27;[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -t. -k1,1nr -k2,2nr -k3,3nr | head -n1 | cut -d. -f2)</span></span><br><span class="line"><span class="string">      patch=$((max_patch + 1))</span></span><br><span class="line"><span class="string">      new_tag=&quot;$&#123;prefix&#125;$&#123;major&#125;.$&#123;minor&#125;.$&#123;patch&#125;&quot;</span></span><br><span class="line"><span class="string">    fi</span></span><br><span class="line"><span class="string">    # ç¢ºä¿ tag å”¯ä¸€</span></span><br><span class="line"><span class="string">    while git rev-parse &quot;$new_tag&quot; &gt;/dev/null 2&gt;&amp;1; do</span></span><br><span class="line"><span class="string">      patch=$((patch + 1))</span></span><br><span class="line"><span class="string">      new_tag=&quot;$&#123;prefix&#125;$&#123;major&#125;.$&#123;minor&#125;.$&#123;patch&#125;&quot;</span></span><br><span class="line"><span class="string">    done</span></span><br><span class="line"><span class="string">    echo &quot;new tag is $new_tag&quot;</span></span><br><span class="line"><span class="string">    echo &quot;NEW_TAG=$new_tag&quot; &gt;&gt; build.env</span></span><br><span class="line"><span class="string"></span>  <span class="bullet">-</span> <span class="string">source</span> <span class="string">build.env</span></span><br></pre></td></tr></table></figure></li><li><p>è‡ªå‹•æ‰“ tag ä¸¦ push</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;rd@example.com&quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;gitlab-runner&quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">remote</span> <span class="string">set-url</span> <span class="string">origin</span> <span class="string">https://gitlab-runner:$RAG_CICD_TOKEN@gitlab.com/$GITLAB_REPO.git</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">tag</span> <span class="string">&quot;$NEW_TAG&quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">push</span> <span class="string">origin</span> <span class="string">&quot;$NEW_TAG&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>Logingã€Build &amp; Push Docker image</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">&quot;$CI_REGISTRY_USER&quot;</span> <span class="string">-p</span> <span class="string">&quot;$CI_REGISTRY_PASSWORD&quot;</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">$REGISTRY_PATH:$NEW_TAG</span> <span class="string">.</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">$REGISTRY_PATH:$NEW_TAG</span></span><br></pre></td></tr></table></figure></li><li><p>Docker-in-Docker è¨­å®š</p><p> <code>DOCKER_TLS_CERTDIR=&#39;&#39;</code> æ˜¯ç‚ºäº†è®“ dind é—œé–‰ TLSï¼Œè®“ CI job å¯ä»¥ç›´æ¥ç”¨æ˜æ–‡ TCP é€£ç·š docker daemonï¼Œé¿å… TLS æ†‘è­‰éŒ¯èª¤ã€‚</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">DOCKER_HOST:</span> <span class="string">tcp://docker:2375/</span></span><br><span class="line">  <span class="attr">DOCKER_TLS_CERTDIR:</span> <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p> <a href="https://about.gitlab.com/blog/docker-in-docker-with-docker-19-dot-03/">å¯ä»¥åƒè€ƒæœ¬æ–‡</a></p></li><li><p>ä¸€äº›è¦æ³¨æ„çš„å°å•é¡Œ</p></li></ol><ul><li><p><strong>DOCKER_TLS_CERTDIR ä¸èƒ½ä¸è¨­å®šã€‚</strong></p></li><li><p><strong>tag è·³è™Ÿæˆ–é‡è¤‡ï¼Ÿ</strong><br>è«‹å‹™å¿…å…ˆåˆªé™¤æœ¬åœ° tag å† fetch remote tagã€‚</p></li><li><p><strong>ç„¡æ³• push tagï¼Ÿ</strong><br>è«‹ç¢ºèª Deploy Token&#x2F;PAT æ¬Šé™ï¼Œä¸” remote url æ­£ç¢ºã€‚</p></li><li><p><strong>docker build å¤±æ•—ï¼Œdaemon é€£ä¸åˆ°ï¼Ÿ</strong><br>è«‹æª¢æŸ¥ã€€gitlab runner æ˜¯å¦æœ‰ privileged modeï¼Œä¸” dind æœ‰å•Ÿå‹•ã€‚<br>åœ¨<code>/etc/gitlab-runner/config.toml</code>ä¸­</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  <span class="attr">name</span> = <span class="string">&quot;docker-runner&quot;</span></span><br><span class="line">  <span class="attr">executor</span> = <span class="string">&quot;docker&quot;</span></span><br><span class="line">  <span class="section">[runners.docker]</span></span><br><span class="line">    <span class="attr">privileged</span> = <span class="literal">true</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></li></ul><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>å®Œæ•´ .gitlab-ci.yml ç¯„ä¾‹å¦‚ä¸‹ï¼Œ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">PROJECT_NAME:</span> <span class="string">my-proj</span></span><br><span class="line">  <span class="attr">GROUP_PATH:</span> <span class="string">my-group</span></span><br><span class="line">  <span class="attr">REGISTRY_PATH:</span> <span class="string">registry.gitlab.com/$GROUP_PATH/$PROJECT_NAME</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build-image:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">variables:</span></span><br><span class="line">    <span class="attr">DOCKER_HOST:</span> <span class="string">tcp://docker:2375/</span></span><br><span class="line">    <span class="attr">DOCKER_TLS_CERTDIR:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_COMMIT_BRANCH == &quot;main&quot;&#x27;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">always</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">when:</span> <span class="string">never</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">fetch</span> <span class="string">--prune</span> <span class="string">--tags</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">tag</span> <span class="string">-l</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-n</span> <span class="number">1</span> <span class="string">git</span> <span class="string">tag</span> <span class="string">-d</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">fetch</span> <span class="string">--tags</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">      prefix=&quot;ver.&quot;</span></span><br><span class="line"><span class="string">      max_patch=$(git tag -l &quot;$&#123;prefix&#125;[0-9]*.[0-9]*.[0-9]*&quot; | grep -oE &#x27;[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -t. -k1,1nr -k2,2nr -k3,3nr | head -n1 | awk -F. &#x27;&#123;print $3&#125;&#x27;)</span></span><br><span class="line"><span class="string">      if [ -z &quot;$max_patch&quot; ]; then</span></span><br><span class="line"><span class="string">        new_tag=&quot;$&#123;prefix&#125;1.0.0&quot;</span></span><br><span class="line"><span class="string">      else</span></span><br><span class="line"><span class="string">        major=$(git tag -l &quot;$&#123;prefix&#125;[0-9]*.[0-9]*.[0-9]*&quot; | grep -oE &#x27;[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -t. -k1,1nr -k2,2nr -k3,3nr | head -n1 | cut -d. -f1)</span></span><br><span class="line"><span class="string">        minor=$(git tag -l &quot;$&#123;prefix&#125;[0-9]*.[0-9]*.[0-9]*&quot; | grep -oE &#x27;[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -t. -k1,1nr -k2,2nr -k3,3nr | head -n1 | cut -d. -f2)</span></span><br><span class="line"><span class="string">        patch=$((max_patch + 1))</span></span><br><span class="line"><span class="string">        new_tag=&quot;$&#123;prefix&#125;$&#123;major&#125;.$&#123;minor&#125;.$&#123;patch&#125;&quot;</span></span><br><span class="line"><span class="string">      fi</span></span><br><span class="line"><span class="string">      while git rev-parse &quot;$new_tag&quot; &gt;/dev/null 2&gt;&amp;1; do</span></span><br><span class="line"><span class="string">        patch=$((patch + 1))</span></span><br><span class="line"><span class="string">        new_tag=&quot;$&#123;prefix&#125;$&#123;major&#125;.$&#123;minor&#125;.$&#123;patch&#125;&quot;</span></span><br><span class="line"><span class="string">      done</span></span><br><span class="line"><span class="string">      echo &quot;new tag is $new_tag&quot;</span></span><br><span class="line"><span class="string">      echo &quot;NEW_TAG=$new_tag&quot; &gt;&gt; build.env</span></span><br><span class="line"><span class="string"></span>    <span class="bullet">-</span> <span class="string">source</span> <span class="string">build.env</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;rd@example.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;rag-cicd&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">remote</span> <span class="string">set-url</span> <span class="string">origin</span> <span class="string">https://rag-cicd:$RAG_CICD_TOKEN@gitlab.com/$GITLAB_REPO.git</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">tag</span> <span class="string">&quot;$NEW_TAG&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">push</span> <span class="string">origin</span> <span class="string">&quot;$NEW_TAG&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">&quot;$CI_REGISTRY_USER&quot;</span> <span class="string">-p</span> <span class="string">&quot;$CI_REGISTRY_PASSWORD&quot;</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">$REGISTRY_PATH:$NEW_TAG</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">$REGISTRY_PATH:$NEW_TAG</span></span><br></pre></td></tr></table></figure><p>é€™æ¨£è¨­å®šå¾Œï¼Œæ¯æ¬¡ main åˆ†æ”¯æœ‰ commitï¼ŒCI&#x2F;CD å°±æœƒè‡ªå‹•ç”¢ç”Ÿæ–° tagã€build ä¸¦æ¨é€å°æ‡‰ç‰ˆæœ¬çš„ Docker image è®“å¤§å®¶å…±ç”¨ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;åœ¨å°ˆæ¡ˆè‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹ä¸­ï¼Œè®“ CI&amp;#x2F;CD pipeline è‡ªå‹•ç”¢ç”Ÿéå¢ tagã€build Docker imag</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] GCP Cloud Run ç§æœ‰åŒ–éƒ¨ç½²ï¼šé€é Load Balancer å¯¦ç¾å…§ç¶²å­˜å–èˆ‡ IP é™åˆ¶</title>
    <link href="https://blog.marsen.me/2025/06/04/2025/gcp-internal-lb-serivce/"/>
    <id>https://blog.marsen.me/2025/06/04/2025/gcp-internal-lb-serivce/</id>
    <published>2025-06-04T03:42:01.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æˆ‘ç”¨ cloud run å»ºç«‹ä¸€å€‹ api ä¸¦ä¸”æœ‰ webhook çš„åŠŸèƒ½<br>ä¸¦ä¸”å¸Œæœ›æä¾›ä¸€å€‹å°å¤–ç¶²å€çµ¦å®¢æˆ¶ï¼Œè€Œä¸æ˜¯ <code>*.run.app</code> çµå°¾çš„ç¶²å€ã€‚  </p><p>åœ¨æŸäº›å ´æ™¯ä¸‹ï¼Œæˆ‘å€‘ä¸å¸Œæœ› GCP Cloud Run å°å¤–æš´éœ²ï¼Œ</p><p>ä¾‹å¦‚å…§éƒ¨ API Gateway å‘¼å«ã€CI&#x2F;CD ç³»çµ±å…§éƒ¨æµç¨‹ã€æˆ–åƒ…æä¾›çµ¦ VPC å…§ç‰¹å®šæœå‹™å­˜å–çš„å¾®æœå‹™ã€‚</p><p>é€™æ¬¡çš„ä¾‹å­æ˜¯å¸Œæœ›åŠ ä¸Š IP çš„é˜²è­·ï¼Œåªå…è¨±ç‰¹å®šçš„ IP å‘¼å«ï¼Œé€™æ™‚å€™å°±æœƒå¸Œæœ›ï¼š</p><ul><li><p>Cloud Run ä¸å°å¤–å…¬é–‹ï¼ˆPrivateï¼‰</p></li><li><p>åƒ…å…è¨± å…§ç¶² IP æˆ– Internal Load Balancer å­˜å–</p></li></ul><p>çœ‹ä¼¼ç°¡å–®ï¼Œä½† GCP Cloud Run åŸç”Ÿæ˜¯ç„¡ä¼ºæœå™¨æ¶æ§‹ï¼Œé è¨­å°±æ˜¯ã€Œå…¬é–‹ç¶²å€ã€ï¼Œè¦è®“å®ƒåªå°å…§éƒ¨å¯è¦‹ï¼Œéœ€è¦æ­é…ä¸€äº› GCP ç¶²è·¯å…ƒä»¶æ“ä½œã€‚é€™ç¯‡ç­†è¨˜æœƒå¸¶ä½ é€æ­¥è¨­å®šï¼Œä¸¦é¿é–‹ä¸€äº›å¸¸è¦‹å‘æ´ã€‚</p><h2 id="å¯¦ä½œè¨˜éŒ„"><a href="#å¯¦ä½œè¨˜éŒ„" class="headerlink" title="å¯¦ä½œè¨˜éŒ„"></a>å¯¦ä½œè¨˜éŒ„</h2><ol><li><p>å°‡ Cloud Run è¨­ç‚ºã€Œä¸å…¬é–‹ã€<br> é è¨­ Cloud Run æ˜¯å…¬é–‹çš„ï¼Œè¦æ”¹ç‚ºã€Œåªæœ‰æˆæ¬Šçš„ä¸»é«”å¯ä»¥å­˜å–ã€ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gcloud run services update YOUR_SERVICE \</span><br><span class="line">  --ingress internal-and-cloud-load-balancing \</span><br><span class="line">  --allow-unauthenticated \</span><br><span class="line">  --region YOUR_REGION \</span><br><span class="line">  --project YOUR_PROJECT</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> é€™æ¨£åªæœ‰å…§éƒ¨çš„ç¶²è·¯æ‰èƒ½å‘¼å« Cloud Runã€‚</p><p> ä¹Ÿå¯ä»¥é€é GUI è¨­å®šï¼Œé¸æ“‡ä½ çš„ Cloud Run &gt;  </p><p> Networking &gt; Ingress é¸ internal å‹¾é¸ Allow Traffic from external Application Load Balancers</p><p> å¯ä»¥<a href="https://cloud.google.com/run/docs/securing/ingress#gcloud">åƒè€ƒ</a></p></li><li><p>å»ºç«‹ Serverless NEGï¼ˆNetwork Endpoint Groupï¼‰<br>å¯ä»¥ç”¨ GUI å»ºç«‹ Loading Blancer &gt;  </p><p>Edit &gt; Backend configuration &gt;  </p><p>ä¸‹æ‹‰é¸å–®é¸ Create backend service &gt;  </p><p>Backend Type é¸ Serverless network endpoint group  </p><p><em>å› ç‚ºæ˜¯ Cloud Run</em></p></li><li><p>è¨­å®š Loading Blancer çš„ Backend Serviceâ€<br>LB &gt; Edit backend service</p><p>Regions é¸æ“‡ Cloud Run æ‰€åœ¨çš„ Region</p><p>é è¨­æœƒæœ‰ä¸€çµ„ Security Policy</p><p>Cloud Armor policies &gt; æ‰¾åˆ°é€™çµ„ Policy å¯ä»¥ä½œæ›´ç´°ç·»çš„è¨­å®šï¼ŒEx:æŒ‡å®š Ip å‘¼å«</p></li><li><p>Loading Blancer URL Map<br>é€™æ˜¯ä¸€å€‹é¡å¤–çš„è¨­å®šï¼Œæƒ…å¢ƒæ˜¯åŸæœ¬æˆ‘å·²æœ‰ä¸€çµ„ Domain èˆ‡ Backend Service  </p><p>ä¸¦ä¸”å·²ç¶“è¨­å®šåœ¨ LB ä¸Šé¢ï¼Œåœ¨æƒ³è¦å…±ç”¨ Domain çš„æƒ…æ³ä¸‹ï¼Œæˆ‘éœ€è¦è¨­å®š URL Map</p><p>ä¿ç•™ä¸€çµ„ Path è®“æµé‡æ‰“å‘ Cloud Runï¼Œä½†ä»ä¿ç•™å…¶ä»– API å¯ä»¥ç”¨</p><p>LB &gt; Edit &gt; Routing rules &gt; Mode é¸æ“‡ Advanced host and path rule  </p><p>æ‰¾åˆ°æŒ‡å®šçš„ Domainï¼Œè¨­å®šåƒè€ƒå¦‚ä¸‹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">defaultService:</span> <span class="string">projects/my-gcp-proj/global/backendServices/my-api</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">path-matcher-7</span></span><br><span class="line"><span class="attr">pathRules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">paths:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/api/v1/*</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">projects/my-gcp-proj/global/backendServices/my-api</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">paths:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/cloud-run-app/*</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">projects/my-gcp-proj/global/backendServices/my-cloud-run-app</span></span><br><span class="line">    <span class="attr">routeAction:</span></span><br><span class="line">      <span class="attr">urlRewrite:</span></span><br><span class="line">        <span class="attr">pathPrefixRewrite:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><p> ä»¥ä¸Šè¨­å®šç°¡å–®èªªæ˜å¦‚ä¸‹ï¼Œ</p><ul><li>&#x2F;api&#x2F;v1&#x2F;*ï¼šå°å‘ my-apiï¼Œä¿ç•™åŸå§‹è·¯å¾‘ã€‚</li><li>&#x2F;cloud-run-app&#x2F;*ï¼šå°å‘ my-cloud-run-appï¼Œä¸¦å°‡è·¯å¾‘é‡å¯«ç‚ºå»é™¤ &#x2F;cloud-run-app å‰ç¶´ã€‚</li><li>å…¶ä»–è·¯å¾‘ï¼šé è¨­å°å‘ my-apiã€‚</li></ul><p> é€™æ¨£è¨­å®šå¯è®“å¤šå€‹æœå‹™å…±ç”¨åŒä¸€å€‹è² è¼‰å¹³è¡¡å™¨ä¸¦æ”¯æ´ä¹¾æ·¨çš„ URL ç®¡ç†ã€‚</p></li></ol><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://webhook.site/">å¥½ç”¨æ¸¬è©¦ Callback çš„å·¥å…·</a></li><li><a href="https://cloud.google.com/run/docs/securing/ingress#gcloud">Restrict network ingress for Cloud Run</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æˆ‘ç”¨ cloud run å»ºç«‹ä¸€å€‹ api ä¸¦ä¸”æœ‰ webhook çš„åŠŸèƒ½&lt;br&gt;ä¸¦ä¸”å¸Œæœ›æä¾›ä¸€å€‹å°å¤–ç¶²å€çµ¦å®¢æˆ¶ï¼Œè€Œä¸æ˜¯ &lt;</summary>
      
    
    
    
    
    <category term="å­¸ç¿’ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] æˆ‘çš„ Vim è¨­å®š</title>
    <link href="https://blog.marsen.me/2025/05/24/2025/vim_setting/"/>
    <id>https://blog.marsen.me/2025/05/24/2025/vim_setting/</id>
    <published>2025-05-24T05:06:05.000Z</published>
    <updated>2025-08-27T14:25:35.439Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘çš„ Vim å¿«æ·éµè¨­å®šç¸½è¡¨ï¼Œ<strong>IdeaVim èˆ‡ JetBrain</strong>ï¼š</p><hr><table><thead><tr><th>å¿«æ·éµ</th><th>æ¨¡å¼</th><th>åŠŸèƒ½èªªæ˜</th><th>IdeaVim è¨­å®šå¯«æ³•</th></tr></thead><tbody><tr><td>zcc</td><td>n</td><td>æ¸…é™¤æ‰€æœ‰è‡ªè¨‚æ˜ å°„</td><td><code>nmap zcc :mapclear!&lt;CR&gt;</code></td></tr><tr><td>zso</td><td>n</td><td>é‡æ–°è¼‰å…¥ä¸» vimrc</td><td><code>nmap zso :source ~/_ideavimrc&lt;CR&gt;</code></td></tr><tr><td>zf</td><td>n&#x2F;i</td><td>è·³åˆ°å®šç¾©ï¼ˆGoto Declarationï¼‰</td><td><code>nmap zf :action GotoDeclaration&lt;CR&gt;</code><br><code>imap zf &lt;Esc&gt;:action GotoDeclaration&lt;CR&gt;</code></td></tr><tr><td>zrc, zo</td><td>n&#x2F;i</td><td>æ ¼å¼åŒ–ç¨‹å¼ç¢¼ï¼ˆReformat Codeï¼‰</td><td><code>nmap zrc :action ReformatCode&lt;CR&gt;</code><br><code>imap zrc &lt;Esc&gt;:action ReformatCode&lt;CR&gt;</code><br><code>nmap zo :action ReformatCode&lt;CR&gt;</code></td></tr><tr><td>zk</td><td>n&#x2F;i</td><td>è¿”å›ï¼ˆBackï¼‰</td><td><code>nmap zk :action Back&lt;CR&gt;</code><br><code>imap zk &lt;Esc&gt;:action Back&lt;CR&gt;</code></td></tr><tr><td>zj</td><td>n&#x2F;i</td><td>AceActionï¼ˆè‡ªè¨‚å‹•ä½œï¼‰</td><td><code>nmap zj :action AceAction&lt;CR&gt;</code><br><code>imap zj &lt;Esc&gt;:action AceAction&lt;CR&gt;</code></td></tr><tr><td>ztt</td><td>n&#x2F;i</td><td>è¤‡è£½å€å¡Šä¸¦æ ¼å¼åŒ–ï¼ˆè‡ªè¨‚å·¨é›†ï¼‰</td><td><code>nmap ztt y?[F&lt;CR&gt;/&#123;&lt;CR&gt;%o&lt;Esc&gt;p:action ReformatCode&lt;CR&gt;</code><br><code>imap ztt &lt;Esc&gt;y?[F&lt;CR&gt;/&#123;&lt;CR&gt;%o&lt;Esc&gt;p:action ReformatCode&lt;CR&gt;</code></td></tr><tr><td>zn</td><td>n&#x2F;i</td><td>è·³åˆ°ä¸Šä¸€å€‹éŒ¯èª¤ï¼ˆGoto Previous Errorï¼‰</td><td><code>nmap zn :action GotoPreviousError&lt;CR&gt;</code><br><code>imap zn &lt;Esc&gt;:action GotoPreviousError&lt;CR&gt;</code></td></tr><tr><td>zrr</td><td>n&#x2F;i</td><td>é‡æ–°å‘½åï¼ˆRename Elementï¼‰</td><td><code>nmap zrr :action RenameElement&lt;CR&gt;</code><br><code>imap zrr &lt;Esc&gt;:action RenameElement&lt;CR&gt;</code></td></tr><tr><td>zra</td><td>n&#x2F;i</td><td>åŸ·è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦</td><td><code>nmap zra :action RiderUnitTestRunSolutionAction&lt;CR&gt;</code><br><code>imap zra &lt;Esc&gt;:action RiderUnitTestRunSolutionAction&lt;CR&gt;</code></td></tr><tr><td>zrm</td><td>n&#x2F;v</td><td>èƒå–æ–¹æ³•ï¼ˆExtract Methodï¼‰</td><td><code>nmap zrm :action ExtractMethod&lt;CR&gt;</code><br><code>vmap zrm :action ExtractMethod&lt;CR&gt;</code></td></tr><tr><td>zri</td><td>n</td><td>Inlineï¼ˆå…§è¯è®Šæ•¸&#x2F;æ–¹æ³•ï¼‰</td><td><code>map zri :action Inline&lt;CR&gt;&lt;Esc&gt;</code></td></tr><tr><td>zrp</td><td>n</td><td>Introduce Parameterï¼ˆå¼•å…¥åƒæ•¸ï¼‰</td><td><code>map zrp :action IntroduceParameter&lt;CR&gt;</code></td></tr><tr><td>zrv</td><td>n</td><td>Introduce Variableï¼ˆå¼•å…¥è®Šæ•¸ï¼‰</td><td><code>map zrv :action IntroduceVariable&lt;CR&gt;</code></td></tr><tr><td>zrf</td><td>n</td><td>Introduce Fieldï¼ˆå¼•å…¥æ¬„ä½ï¼‰</td><td><code>map zrf :action IntroduceField&lt;CR&gt;</code></td></tr><tr><td>,m</td><td>n</td><td>é¡¯ç¤ºæª”æ¡ˆçµæ§‹</td><td><code>nmap ,m :action FileStructurePopup&lt;CR&gt;</code></td></tr><tr><td>zrt</td><td>n</td><td>æœ€è¿‘æª”æ¡ˆ</td><td><code>nmap zrt :action RecentFiles&lt;CR&gt;</code></td></tr><tr><td>zgc</td><td>n</td><td>é–‹å•Ÿ Commit å·¥å…·è¦–çª—</td><td><code>nmap zgc :action ActivateCommitToolWindow&lt;CR&gt;</code></td></tr><tr><td>zx</td><td>n</td><td>å¿«é€Ÿé‡æ§‹é¸å–®</td><td><code>nmap zx :action Refactorings.QuickListPopupAction &lt;CR&gt;</code></td></tr><tr><td>zae</td><td>n&#x2F;i</td><td>æ’å…¥ Assert.Equal(,);</td><td><code>nmap zae aAssert.Equal(,);&lt;Esc&gt;T(i</code><br><code>imap zae Assert.Equal(,);&lt;Esc&gt;T(i</code></td></tr><tr><td>zrs</td><td>n</td><td>æ–°å¢ class ä¸¦æ ¼å¼åŒ–ï¼ˆè‡ªè¨‚å·¨é›†ï¼‰</td><td><code>nmap zrs &quot;add? class&lt;CR&gt;2w&quot;bywjopublic &lt;Esc&gt;&quot;bpa()&lt;CR&gt;&#123;&lt;Esc&gt;&quot;apo&#125;&lt;Esc&gt;:action ReformatCode&lt;CR&gt;</code></td></tr><tr><td>z;</td><td>n&#x2F;i</td><td>è¡Œå°¾åŠ åˆ†è™Ÿ</td><td><code>nmap z; $a;&lt;Esc&gt;</code><br><code>imap z; &lt;Esc&gt;$a;</code></td></tr><tr><td>,p, ,P</td><td>n</td><td>é»è²¼æš«å­˜å€ 0 çš„å…§å®¹</td><td><code>nmap ,p &quot;0p</code><br><code>nmap ,P &quot;0P</code></td></tr><tr><td>z,p, z,P</td><td>i</td><td>æ’å…¥æš«å­˜å€ 0 çš„å…§å®¹</td><td><code>imap z,p &lt;Esc&gt;&quot;0pa</code><br><code>imap z,P &lt;Esc&gt;&quot;0Pa</code></td></tr><tr><td>z,</td><td>n</td><td>é¸å–æ‹¬è™Ÿå…§å…§å®¹ï¼ˆvi)ï¼‰</td><td><code>:nmap z, vi)</code></td></tr><tr><td>z.</td><td>n</td><td>é¸å–å¤§æ‹¬è™Ÿå…§å…§å®¹ï¼ˆvi}ï¼‰</td><td><code>:nmap z. vi&#125;</code></td></tr><tr><td><Esc></td><td>v</td><td>é€£çºŒå¤šæ¬¡é›¢é–‹é¸å–æ¨¡å¼</td><td><code>:vmap &lt;Esc&gt; &lt;Esc&gt;&lt;Esc&gt;&lt;Esc&gt;</code></td></tr><tr><td>jj</td><td>i</td><td>é€€å‡ºæ’å…¥æ¨¡å¼</td><td><code>:imap jj &lt;Esc&gt;</code></td></tr><tr><td><BS></td><td>n</td><td>åœ¨æ™®é€šæ¨¡å¼ä¸‹æ’å…¥ Backspace</td><td><code>:nmap &lt;BS&gt; a&lt;BS&gt;</code></td></tr><tr><td>zh</td><td>n&#x2F;i</td><td>è·³åˆ°è¡Œé¦–</td><td><code>:nmap zh ^</code><br><code>:imap zh &lt;Esc&gt;^i</code></td></tr><tr><td>zl</td><td>n&#x2F;i</td><td>è·³åˆ°è¡Œå°¾</td><td><code>:nmap zl $</code><br><code>:imap zl &lt;End&gt;</code></td></tr><tr><td>hc</td><td>n</td><td>Ctrl+C</td><td><code>:nmap hc ^C</code></td></tr><tr><td>zb</td><td>n&#x2F;v</td><td>å–®å­—å–ä»£</td><td><code>:nmap zb bcw</code><br><code>:vmap zb &lt;Esc&gt;bcw</code></td></tr><tr><td>zd</td><td>i</td><td>åˆªé™¤ç•¶å‰è¡Œ</td><td><code>:imap zd &lt;Esc&gt;dd</code></td></tr><tr><td>j, k</td><td>n</td><td>è»Ÿæ›è¡Œç§»å‹•</td><td><code>nmap j gj</code><br><code>nmap k gk</code></td></tr><tr><td>qq</td><td>n</td><td>å¼·åˆ¶é—œé–‰æª”æ¡ˆ</td><td><code>nmap qq ZQ</code></td></tr><tr><td>zq</td><td>n</td><td>å„²å­˜ä¸¦é—œé–‰æª”æ¡ˆ</td><td><code>nmap zq :wq&lt;CR&gt;</code></td></tr><tr><td><C-x></td><td>i</td><td>åˆªé™¤ç•¶å‰è¡Œ</td><td><code>:imap &lt;C-x&gt; &lt;Esc&gt;dd</code></td></tr><tr><td><C-a></td><td>i</td><td>å…¨é¸</td><td><code>:imap &lt;C-a&gt; &lt;Esc&gt;ma&lt;CR&gt;ggVG</code></td></tr><tr><td>,i, ,a</td><td>n</td><td>æ›¿æ›å­—å…ƒ</td><td><code>:map ,i &lt;Esc&gt;r</code><br><code>:map ,a &lt;Esc&gt;r</code></td></tr></tbody></table><hr><p><strong>èªªæ˜ï¼š</strong>  </p><ul><li>nï¼šæ™®é€šæ¨¡å¼ï¼ˆnormal modeï¼‰  </li><li>iï¼šæ’å…¥æ¨¡å¼ï¼ˆinsert modeï¼‰  </li><li>vï¼šè¦–è¦ºæ¨¡å¼ï¼ˆvisual modeï¼‰  </li><li><code>&lt;CR&gt;</code> ä»£è¡¨ Enter éµï¼Œ<code>&lt;Esc&gt;</code> ä»£è¡¨ Esc éµ</li></ul><hr><p>ä»¥ä¸‹æ˜¯æˆ‘å°‡ JetBrainsï¼ˆIdeaVimï¼‰Vim å¿«æ·éµç§»æ¤åˆ° VSCodeï¼ˆVSCodeVimï¼‰çš„å°æ‡‰è¡¨ï¼Œ<br>ä¸¦èªªæ˜å“ªäº›å·²æˆåŠŸç§»æ¤ã€å“ªäº›ç„¡æ³•ç§»æ¤åŠåŸå› ï¼š</p><hr><table><thead><tr><th>JetBrains å¿«æ·éµ</th><th>VSCode è¨­å®š (before)</th><th>VSCode æŒ‡ä»¤ (commands)</th><th>åŠŸèƒ½èªªæ˜</th><th>å¯å¦ç§»æ¤</th><th>å‚™è¨»&#x2F;åŸå› </th></tr></thead><tbody><tr><td>zrr</td><td>[â€œzâ€,â€râ€,â€râ€]</td><td>editor.action.rename</td><td>é‡æ–°å‘½å</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zf</td><td>[â€œzâ€,â€fâ€]</td><td>editor.action.revealDefinition</td><td>è·³åˆ°å®šç¾©</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zrc&#x2F;zo</td><td>[â€œzâ€,â€râ€,â€câ€]&#x2F;[â€œzâ€,â€oâ€]</td><td>editor.action.formatDocument</td><td>æ ¼å¼åŒ–ç¨‹å¼ç¢¼</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´ï¼ˆä½ å·²è¨­ zrcï¼Œzo ä¹Ÿå¯åŠ ï¼‰</td></tr><tr><td>zn</td><td>[â€œzâ€,â€nâ€]</td><td>editor.action.marker.prev</td><td>è·³åˆ°ä¸Šä¸€å€‹éŒ¯èª¤</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zrt</td><td>[â€œzâ€,â€râ€,â€tâ€]</td><td>workbench.action.openRecent</td><td>æœ€è¿‘æª”æ¡ˆ</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>,m</td><td>[â€œ,â€,â€mâ€]</td><td>workbench.action.gotoSymbol</td><td>æª”æ¡ˆçµæ§‹&#x2F;å¤§ç¶±</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zx</td><td>[â€œzâ€,â€xâ€]</td><td>editor.action.refactor</td><td>é¡¯ç¤ºé‡æ§‹é¸å–®</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zgc</td><td>[â€œzâ€,â€gâ€,â€câ€]</td><td>workbench.view.scm</td><td>é–‹å•Ÿ Source Control é¢æ¿</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zh</td><td>[â€œzâ€,â€hâ€]</td><td>cursorHome</td><td>è·³åˆ°è¡Œé¦–</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zl</td><td>[â€œzâ€,â€lâ€]</td><td>cursorEnd</td><td>è·³åˆ°è¡Œå°¾</td><td>âœ…</td><td>å®Œå…¨æ”¯æ´</td></tr><tr><td>zrv</td><td>[â€œzâ€,â€râ€,â€vâ€]</td><td>editor.action.codeAction.extract.variable</td><td>èƒå–è®Šæ•¸</td><td>âš ï¸</td><td>VSCodeVim æœ‰é¸å–é™åˆ¶ï¼Œéƒ¨åˆ†æƒ…å¢ƒä¸‹ç„¡æ³•è§¸ç™¼</td></tr><tr><td>zrm</td><td>[â€œzâ€,â€râ€,â€mâ€]</td><td>editor.action.codeAction.extract.method</td><td>èƒå–æ–¹æ³•</td><td>âš ï¸</td><td>VSCodeVim æœ‰é¸å–é™åˆ¶ï¼Œéƒ¨åˆ†æƒ…å¢ƒä¸‹ç„¡æ³•è§¸ç™¼</td></tr><tr><td>zri</td><td>-</td><td>-</td><td>Inlineï¼ˆå…§è¯è®Šæ•¸&#x2F;æ–¹æ³•ï¼‰</td><td>âŒ</td><td>VSCode æ²’æœ‰å…¬é–‹æŒ‡ä»¤ IDï¼Œç„¡æ³• keybinding</td></tr><tr><td>zrp</td><td>-</td><td>-</td><td>Introduce Parameter</td><td>âŒ</td><td>VSCode æ²’æœ‰å…¬é–‹æŒ‡ä»¤ IDï¼Œç„¡æ³• keybinding</td></tr><tr><td>zrf</td><td>-</td><td>-</td><td>Introduce Field</td><td>âŒ</td><td>VSCode æ²’æœ‰å…¬é–‹æŒ‡ä»¤ IDï¼Œç„¡æ³• keybinding</td></tr><tr><td>ztt</td><td>-</td><td>-</td><td>å·¨é›†&#x2F;å¤šæ­¥é©Ÿè‡ªå‹•åŒ–</td><td>âŒ</td><td>VSCode ä¸æ”¯æ´ Vim å·¨é›†æˆ–å¤šæ­¥é©Ÿè‡ªå‹•åŒ–</td></tr><tr><td>zso</td><td>-</td><td>-</td><td>é‡æ–°è¼‰å…¥ vimrc</td><td>âŒ</td><td>VSCodeVim ä¸æ”¯æ´ :source æˆ–é‡æ–°è¼‰å…¥ vimrc</td></tr><tr><td>zra</td><td>[â€œzâ€,â€râ€,â€aâ€]</td><td>testing.runAll</td><td>åŸ·è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦</td><td>âœ…</td><td>éœ€å®‰è£ VSCode å®˜æ–¹ Testing åŠŸèƒ½ï¼Œå·²å¯ keybinding</td></tr></tbody></table><hr><h3 id="è£œå……èªªæ˜"><a href="#è£œå……èªªæ˜" class="headerlink" title="è£œå……èªªæ˜"></a>è£œå……èªªæ˜</h3><ul><li>âœ…ï¼šå®Œå…¨æ”¯æ´ï¼Œå·²å¯ç”¨æ–¼ VSCodeVimã€‚</li><li>âš ï¸ï¼šVSCodeVim æœ‰æŠ€è¡“é™åˆ¶ï¼ˆå¦‚éœ€é¸å–å…§å®¹ï¼Œè§¸ç™¼ä¸ä¸€å®šæˆåŠŸï¼‰ã€‚</li><li>âŒï¼šVSCode&#x2F;VSCodeVim ç„¡å°æ‡‰æŒ‡ä»¤æˆ–åŠŸèƒ½ï¼Œç„¡æ³•ç§»æ¤ã€‚</li><li>ä½ å¯ä»¥æŒçºŒç”¨ VSCode å…§å»ºçš„ <code>Cmd+.</code> æˆ–å³éµé¸å–®è£œè¶³ç„¡æ³• keybinding çš„é‡æ§‹åŠŸèƒ½ã€‚</li><li><strong>zra</strong>ï¼šVSCode 1.59 ä»¥ä¸Šå…§å»º Testing åŠŸèƒ½ï¼ŒæŒ‡ä»¤ç‚º <code>testing.runAll</code>ï¼Œå¯ç›´æ¥ keybindingï¼Œç„¡éœ€é¡å¤–å¤–æ›ã€‚</li></ul><hr><p><strong>ç¸½çµï¼š</strong><br>æˆ‘å·²æˆåŠŸå°‡å¤§éƒ¨åˆ†å¸¸ç”¨ JetBrains Vim å¿«æ·éµç§»æ¤åˆ° VSCodeï¼Œ<br>åƒ…å°‘æ•¸ JetBrains å°ˆå±¬é‡æ§‹ã€å·¨é›†ã€vimrc ç›¸é—œåŠŸèƒ½å›  VSCode é™åˆ¶ç„¡æ³•ç§»æ¤ã€‚  </p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æˆ‘çš„ Vim å¿«æ·éµè¨­å®šç¸½è¡¨ï¼Œ&lt;strong&gt;IdeaVim èˆ‡ JetBrain&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¿«æ·éµ&lt;/th&gt;
&lt;th&gt;æ¨¡å¼&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½èªªæ˜&lt;/th&gt;
&lt;th&gt;IdeaVim è¨­å®šå¯«æ³•</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å­¸ç¿’ç­†è¨˜] TypeScript ä¸åŒå¯«æ³•çš„é™¤éŒ¯é›£æ˜“æ¯”è¼ƒ</title>
    <link href="https://blog.marsen.me/2025/05/17/2025/typescript_error_handle_ways/"/>
    <id>https://blog.marsen.me/2025/05/17/2025/typescript_error_handle_ways/</id>
    <published>2025-05-17T05:23:41.000Z</published>
    <updated>2025-08-27T14:25:35.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘åœ¨æ•´ç†ä¸€å€‹å°ˆæ¡ˆçš„ API è·¯ç”±æ¬Šé™è¨­å®šï¼Œ<br>å°åŒæ¨£çš„è³‡æ–™çµæ§‹ã€ä¸åŒçš„å¯«æ³•ï¼Œå°æ–¼å‹åˆ¥æª¢æŸ¥å’Œé™¤éŒ¯æœ‰ä¸€é»å°å°å¿ƒå¾—ï¼Œç¨å¾®ä½œå€‹è¨˜éŒ„ã€‚</p><h2 id="æƒ…å¢ƒèªªæ˜"><a href="#æƒ…å¢ƒèªªæ˜" class="headerlink" title="æƒ…å¢ƒèªªæ˜"></a>æƒ…å¢ƒèªªæ˜</h2><p>å‡è¨­æˆ‘æœ‰ä¸€å€‹ API æ¬Šé™è¨­å®šå¦‚ä¸‹ï¼Œæ¯å€‹è·¯ç”±å°æ‡‰ä¸€çµ„è§’è‰²æ‰èƒ½è¨ªå•ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">endpoint</span>: <span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">  <span class="attr">roles</span>: [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;superuser&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å¾Œæˆ‘æœ‰ä¸€å€‹å‡½å¼ registerPermissions è¦åƒé€™å€‹è¨­å®šã€‚</p><h3 id="å»ºè­°å¯«æ³•"><a href="#å»ºè­°å¯«æ³•" class="headerlink" title="å»ºè­°å¯«æ³•"></a>å»ºè­°å¯«æ³•</h3><p>å…ˆçµ¦æœ€è¿‘å»ºè­°çš„å¯«æ³•ï¼Œå…ˆå®šç¾©å‹åˆ¥ï¼Œç„¶å¾Œè®Šæ•¸ä¹Ÿå¥—å‹åˆ¥<br>å¥½è™•æ˜¯èƒ½å…·é«”çš„æŠ“åˆ°éŒ¯èª¤ï¼Œå£è™•æ˜¯è¦å¤šè€ƒæ…®ä¸€å€‹å‹åˆ¥(å‘½åã€æ“ºæ”¾ä½ç½®éƒ½æœƒæ˜¯ä¸€å€‹è¦è€ƒé‡çš„é»)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">PermissionConfig</span> = &#123;</span><br><span class="line">  <span class="attr">routes</span>: &#123;</span><br><span class="line">    <span class="attr">endpoint</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">roles</span>: <span class="built_in">string</span>[];</span><br><span class="line">  &#125;[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">permissionConfig</span>: <span class="title class_">PermissionConfig</span> = &#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">endpoint</span>: <span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">      <span class="attr">roles</span>: [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;superuser&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">endpoint</span>: <span class="string">&quot;/profile&quot;</span>,</span><br><span class="line">      <span class="attr">roles</span>: <span class="string">&quot;user&quot;</span>, <span class="comment">// âŒ é¦¬ä¸Šç´…å­—å ±éŒ¯</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">registerPermissions</span> = (<span class="params">config: PermissionConfig</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// è¨»å†Šæ¬Šé™é‚è¼¯</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerPermissions</span>(permissionConfig);</span><br></pre></td></tr></table></figure><h3 id="å…ˆå®šç¾©è®Šæ•¸ï¼Œä½†æ²’å¥—å‹åˆ¥"><a href="#å…ˆå®šç¾©è®Šæ•¸ï¼Œä½†æ²’å¥—å‹åˆ¥" class="headerlink" title="å…ˆå®šç¾©è®Šæ•¸ï¼Œä½†æ²’å¥—å‹åˆ¥"></a>å…ˆå®šç¾©è®Šæ•¸ï¼Œä½†æ²’å¥—å‹åˆ¥</h3><p>é€™æ˜¯æœ€ä¸æ¨è–¦çš„å¯«æ³•ã€‚é›–ç„¶å¯«èµ·ä¾†æœ€å¿«ã€æœ€é †æ‰‹ï¼Œä¸ç”¨è€ƒæ…®å‘½åå’Œæª”æ¡ˆæ“ºæ”¾çš„ä½ç½®ï¼Œä½†éŒ¯èª¤è¨Šæ¯æœƒä¸€å¤§å¨ï¼Œé›£ä»¥é–±è®€ã€‚</p><p>åœ¨ç¾åœ¨é€™å€‹ AI æ™‚ä»£ï¼Œä¹Ÿè¨± AI èƒ½å¹«ä½ æ›´å¿«ç†è§£éŒ¯èª¤ï¼Œä½†æˆ‘é‚„æ˜¯ä¸å»ºè­°é€™éº¼åšã€‚å› ç‚ºä¸€æ—¦ç¿’æ…£é€™ç¨®å¯«æ³•ï¼Œå¾ˆå®¹æ˜“éŒ¯ä¸ŠåŠ éŒ¯ã€‚å–®ä¸€éŒ¯èª¤ AI é‚„èƒ½ç†è§£ï¼Œä½†éŒ¯ä¸­éŒ¯æ™‚ï¼ŒAI ä¹Ÿå¯èƒ½æœƒæä¸æ¸…æ¥šç‹€æ³ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> permissionConfig = &#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">endpoint</span>: <span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">      <span class="attr">roles</span>: [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;superuser&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">endpoint</span>: <span class="string">&quot;/profile&quot;</span>,</span><br><span class="line">      <span class="attr">roles</span>: <span class="string">&quot;user&quot;</span>, <span class="comment">// ğŸ§¨ é€™è£¡æ•…æ„å¯«éŒ¯ï¼Œæ‡‰è©²æ˜¯ array</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">registerPermissions</span> = (<span class="params">config: &#123;</span></span><br><span class="line"><span class="params">  routes: &#123;</span></span><br><span class="line"><span class="params">    endpoint: <span class="built_in">string</span>;</span></span><br><span class="line"><span class="params">    roles: <span class="built_in">string</span>[];</span></span><br><span class="line"><span class="params">  &#125;[];</span></span><br><span class="line"><span class="params">&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// è¨»å†Šæ¬Šé™é‚è¼¯</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerPermissions</span>(permissionConfig);</span><br></pre></td></tr></table></figure><p>é€™ç¨®å¯«æ³•æœƒå™´å‡ºä¸€å †éŒ¯èª¤ã€‚</p><h3 id="å¯«æ³•ä¸‰ï¼šç›´æ¥-inline-å‚³å…¥å‡½å¼"><a href="#å¯«æ³•ä¸‰ï¼šç›´æ¥-inline-å‚³å…¥å‡½å¼" class="headerlink" title="å¯«æ³•ä¸‰ï¼šç›´æ¥ inline å‚³å…¥å‡½å¼"></a>å¯«æ³•ä¸‰ï¼šç›´æ¥ inline å‚³å…¥å‡½å¼</h3><p>å¦‚æœæ²’æœ‰å…±ç”¨å¿…è¦çš„åƒæ•¸ï¼Œæˆ‘é€šå¸¸æœƒæ¨è–¦ inline å¯«æ³•ã€‚ç•¶ç„¶å‰ææ˜¯é€™å€‹æ–¹æ³•çš„è¤‡é›œåº¦è¦å¤ ä½ï¼Œè®“äººå®¹æ˜“ç†è§£ã€‚é€™æ¨£ä¹Ÿå¯ä»¥çœå»å‘½åå’Œå‹åˆ¥æª”æ¡ˆæ“ºæ”¾ä½ç½®çš„ç…©æƒ±ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">registerPermissions</span> = (<span class="params">config: &#123;</span></span><br><span class="line"><span class="params">  routes: &#123;</span></span><br><span class="line"><span class="params">    endpoint: <span class="built_in">string</span>;</span></span><br><span class="line"><span class="params">    roles: <span class="built_in">string</span>[];</span></span><br><span class="line"><span class="params">  &#125;[];</span></span><br><span class="line"><span class="params">&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// è¨»å†Šæ¬Šé™é‚è¼¯</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerPermissions</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">endpoint</span>: <span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">      <span class="attr">roles</span>: [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;superuser&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">endpoint</span>: <span class="string">&quot;/profile&quot;</span>,</span><br><span class="line">      <span class="attr">roles</span>: <span class="string">&quot;user&quot;</span>, <span class="comment">// âŒ é¦¬ä¸Šç´…å­—å ±éŒ¯</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å°çµï¼šæ¨è–¦å¯«æ³•"><a href="#å°çµï¼šæ¨è–¦å¯«æ³•" class="headerlink" title="å°çµï¼šæ¨è–¦å¯«æ³•"></a>å°çµï¼šæ¨è–¦å¯«æ³•</h2><p>æœ€æ¨è–¦ç¬¬ä¸€ç¨®ï¼Œä½†å¯¦å‹™ä¸Šæˆ‘å¯èƒ½æœƒæ›´å¤šçš„é¸æ“‡ç¬¬ä¸‰ç¨®å¯«æ³•ã€‚<br>è¦æœ‰ä¸Šä¸‹æ–‡ï¼Œè«‹åœ˜éšŠä½œå¥½è‡ªå·²çš„åˆ¤æ–·ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨æ•´ç†ä¸€å€‹å°ˆæ¡ˆçš„ API è·¯ç”±æ¬Šé™è¨­å®šï¼Œ&lt;br&gt;å°åŒæ¨£çš„è³‡æ–™çµæ§‹ã€ä¸åŒçš„å¯«æ³•ï¼Œå°æ–¼å‹åˆ¥æª¢æŸ¥å’Œé™¤éŒ¯æœ‰ä¸€é»å°å°å¿ƒå¾—ï¼Œç¨å¾®ä½œå€‹</summary>
      
    
    
    
    
    <category term="å­¸ç¿’ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] Linux NO Password åŸ·è¡ŒæŒ‡ä»¤</title>
    <link href="https://blog.marsen.me/2025/05/09/2025/linux_sudo_no_passwd/"/>
    <id>https://blog.marsen.me/2025/05/09/2025/linux_sudo_no_passwd/</id>
    <published>2025-05-09T08:43:47.000Z</published>
    <updated>2025-08-27T14:25:35.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘åœ¨éƒ¨ç½²æŸå€‹ webapi serverï¼Œ<br>é€™å€‹ webapi æœƒç”¨ä¸€å€‹ç‰¹åˆ¥çš„å¸³è™Ÿå»åŸ·è¡Œï¼Œä½†æ˜¯ä¸æœƒçµ¦ä»–è¨­å®šå¯†ç¢¼ï¼Œ<br>æˆ‘éœ€è¦ä½¿ç”¨ pm2 startup è¨­å®šé–‹æ©Ÿè‡ªå‹•å•Ÿå‹• webapi æœå‹™ã€‚  </p><h2 id="å•é¡Œï¼šåŸ·è¡ŒæŒ‡ä»¤æœƒè¦æ±‚è¼¸å…¥å¯†ç¢¼"><a href="#å•é¡Œï¼šåŸ·è¡ŒæŒ‡ä»¤æœƒè¦æ±‚è¼¸å…¥å¯†ç¢¼" class="headerlink" title="å•é¡Œï¼šåŸ·è¡ŒæŒ‡ä»¤æœƒè¦æ±‚è¼¸å…¥å¯†ç¢¼"></a>å•é¡Œï¼šåŸ·è¡ŒæŒ‡ä»¤æœƒè¦æ±‚è¼¸å…¥å¯†ç¢¼</h2><p>ä½†æ˜¯æˆ‘æ²’æœ‰ä¹Ÿä¸æ‰“ç®—æä¾›å¯†ç¢¼çµ¦å€‹ webapi æœå‹™å¸³è™Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">env</span> PATH=<span class="variable">$PATH</span>:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u marsen --hp /home/marsen</span><br><span class="line">[sudo] password <span class="keyword">for</span> marsen:</span><br></pre></td></tr></table></figure><h2 id="å˜—è©¦è§£æ³•ï¼šç”¨-visudo-å¯«-NOPASSWD"><a href="#å˜—è©¦è§£æ³•ï¼šç”¨-visudo-å¯«-NOPASSWD" class="headerlink" title="å˜—è©¦è§£æ³•ï¼šç”¨ visudo å¯« NOPASSWD"></a>å˜—è©¦è§£æ³•ï¼šç”¨ visudo å¯« NOPASSWD</h2><p>ç‚ºäº†è®“ <code>aiplux</code> å¸³è™ŸåŸ·è¡Œç‰¹å®šæŒ‡ä»¤æ™‚ä¸éœ€è¦è¼¸å…¥å¯†ç¢¼ï¼Œå¯ä»¥é€é <code>visudo</code> ç·¨è¼¯ <code>sudoers</code> æª”æ¡ˆã€‚ä»¥ä¸‹æ˜¯å…·é«”æ­¥é©Ÿï¼š</p><ol><li><p>é–‹å•Ÿ <code>sudoers</code> ç·¨è¼¯å™¨ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æª”æ¡ˆä¸­æ–°å¢ä»¥ä¸‹å…§å®¹ï¼š</p></li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aiplux ALL=(ALL) NOPASSWD: /usr/lib/node_modules/pm2/bin/pm2</span><br></pre></td></tr></table></figure><p>é€™æ¨£çš„è¨­å®šå¯ä»¥ç¢ºä¿ <code>aiplux</code> å¸³è™Ÿåœ¨åŸ·è¡Œ <code>/usr/lib/node_modules/pm2/bin/pm2</code> æ™‚ä¸éœ€è¦è¼¸å…¥å¯†ç¢¼ï¼ŒåŒæ™‚é¿å…é–‹æ”¾éå¤šæ¬Šé™ã€‚</p><h2 id="å°å¿ƒè³‡å®‰é¢¨éšª"><a href="#å°å¿ƒè³‡å®‰é¢¨éšª" class="headerlink" title="å°å¿ƒè³‡å®‰é¢¨éšª"></a>å°å¿ƒè³‡å®‰é¢¨éšª</h2><p>ä¸Šé¢çš„ä½œæ³•æ˜¯æ”¹è‡ªå¦ä¸€ä½åŒäº‹çš„ä½œæ³•ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;marsen ALL=(ALL) NOPASSWD: /usr/bin/apt, /usr/bin/apt-get, /usr/bin/env&quot;</span> | sudo <span class="built_in">tee</span> /etc/sudoers.d/marsen &gt;/dev/null</span><br><span class="line"><span class="built_in">chmod</span> 440 /etc/sudoers.d/marsen</span><br></pre></td></tr></table></figure><p>é€™æ®µè¨­å®šçš„ç›®çš„æ˜¯ï¼š</p><ol><li>å…è¨± <code>marsen</code> è‡ªç”±ä½¿ç”¨ <code>apt</code> å’Œ <code>apt-get</code> å®‰è£å¥—ä»¶ã€‚</li><li>ä½¿ç”¨ <code>env</code> åŒ…è£ PATH æˆ–å…¶ä»–ç’°å¢ƒè®Šæ•¸ä¾†åŸ·è¡Œ <code>pm2</code>ã€‚</li><li>é¿å…å¯†ç¢¼å¡ä½ï¼Œè®“ CI&#x2F;CD æµç¨‹é †åˆ©åŸ·è¡Œã€‚</li></ol><p>é›–ç„¶çµ¦è¶³å¤ çš„æ¬Šé™ï¼Œå¯ä»¥ç„¡å¯†ç¢¼åŸ·è¡Œï¼Œä½†æ˜¯ä¹Ÿå¸¶ä¾†å¾ˆå¤šæ½›åœ¨é¢¨éšªã€‚</p><p>è³‡å®‰å•é¡Œï¼š&#x2F;usr&#x2F;bin&#x2F;env æ˜¯å€‹å±éšªæ´å£</p><p>çœ‹èµ·ä¾†åªæ˜¯æƒ³åŠ ç’°å¢ƒè®Šæ•¸ç”¨ <code>env</code>ï¼Œä½†å…¶å¯¦é€™ä¸€æ¢éå¸¸å±éšªã€‚ç‚ºä»€éº¼ï¼Ÿä¾†çœ‹çœ‹ <code>env</code> çš„æœ¬è³ªï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/env bash</span><br><span class="line">sudo /usr/bin/env node</span><br><span class="line">sudo /usr/bin/env python</span><br></pre></td></tr></table></figure><p>é€™äº›æŒ‡ä»¤æœƒç”¨ root æ¬Šé™åŸ·è¡Œå°æ‡‰çš„ shell æˆ–ç¨‹å¼ï¼Œç­‰æ–¼ä½ çµ¦äº† <code>marsen</code> å®Œæ•´ root åŸ·è¡Œä»»æ„ç¨‹å¼çš„èƒ½åŠ›ï¼Œé€™ååˆ†å±éšªã€‚</p><p>å†çœ‹ <code>/usr/bin/apt</code> å’Œ <code>apt-get</code>ï¼ŒåŒæ¨£æ˜¯é«˜æ¬Šé™æŒ‡ä»¤ã€‚å¦‚æœæ²’æœ‰é™åˆ¶ï¼Œä¹Ÿå¯ä»¥è¢«æ¿«ç”¨ä¾†åˆªé™¤å¥—ä»¶æˆ–æ”¹å‹•ç³»çµ±ã€‚</p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p><strong>å¯©æ…é¸æ“‡é–‹æ”¾çš„æŒ‡ä»¤</strong><br>åœ¨è‡ªå‹•åŒ–æµç¨‹ä¸­ï¼Œç‚ºäº†é¿å… sudo å¯†ç¢¼æ“‹è·¯ï¼Œè¨­å®š <code>NOPASSWD</code> æ˜¯å¸¸è¦‹çš„è§£æ³•ã€‚<br>ä½†åœ¨è¨­å®šæ™‚ï¼Œå‹™å¿…å¯©æ…é¸æ“‡é–‹æ”¾çš„æŒ‡ä»¤ç¯„åœï¼Œé¿å…ä¸€æ™‚åœ–æ–¹ä¾¿ï¼Œæ‰“é–‹æ•´å°ä¸»æ©Ÿçš„å¾Œé–€ã€‚<br>å»ºè­°åªé–‹æ”¾å¿…è¦çš„æŒ‡ä»¤ï¼Œä¸¦æ˜ç¢ºæŒ‡å®šè·¯å¾‘ï¼Œç¢ºä¿å®‰å…¨æ€§ã€‚  </p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨éƒ¨ç½²æŸå€‹ webapi serverï¼Œ&lt;br&gt;é€™å€‹ webapi æœƒç”¨ä¸€å€‹ç‰¹åˆ¥çš„å¸³è™Ÿå»åŸ·è¡Œï¼Œä½†æ˜¯ä¸æœƒçµ¦ä»–è¨­å®šå¯†ç¢¼ï¼Œ&lt;b</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [è¸©é›·ç­†è¨˜] CORS éŒ¯èª¤çš„å…ƒå…‡ç«Ÿç„¶æ˜¯ç€è¦½å™¨å¤–æ›ï¼Ÿ</title>
    <link href="https://blog.marsen.me/2025/05/08/2025/cors_in_browser_exten/"/>
    <id>https://blog.marsen.me/2025/05/08/2025/cors_in_browser_exten/</id>
    <published>2025-05-08T06:31:47.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>æœ€è¿‘åœ¨æœ¬æ©Ÿé–‹ç™¼ä¸€æ”¯ç°¡å–®çš„ä¸Šå‚³ APIï¼Œä½¿ç”¨ Express.js æ­é… TypeScriptã€‚<br>é æœŸåªæ˜¯åœ¨ local ä¸Šåšå€‹æ•´åˆæ¸¬è©¦ï¼Œå‰ç«¯è·‘åœ¨ <code>localhost:5173</code>ï¼Œå¾Œç«¯æ˜¯ <code>localhost:3000</code>ï¼Œç…§ç†ä¾†èªªåªè¦ CORS è¨­å¥½å°±è¬äº‹ OKã€‚</p><p>çµæœâ€”â€”ç‚¸äº†ã€‚</p><h2 id="å•é¡Œç¾è±¡"><a href="#å•é¡Œç¾è±¡" class="headerlink" title="å•é¡Œç¾è±¡"></a>å•é¡Œç¾è±¡</h2><p>ç€è¦½å™¨è·³å‡ºç†Ÿæ‚‰çš„éŒ¯èª¤è¨Šæ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to fetch at <span class="string">&#x27;http://localhost:3000/upload&#x27;</span> from origin <span class="string">&#x27;http://localhost:5173&#x27;</span> has been blocked by CORS policy...</span><br></pre></td></tr></table></figure><p>ä¸€çœ‹å°±æ˜¯ CORS éŒ¯èª¤ï¼Œè€å•é¡Œäº†ï¼Œé¦¬ä¸Šé–‹å§‹æ’æŸ¥ï¼š</p><ul><li>ç¢ºèª <code>cors()</code> middleware æœ‰è¨­å¥½</li><li>æª¢æŸ¥ headers æœ‰ç„¡æ­£ç¢ºè¨­å®š</li><li>æ‡·ç–‘æ˜¯ OPTIONS preflight æ²’è™•ç†å¥½ï¼Œä¹Ÿåšäº†è£œå¼·</li></ul><p>æ€éº¼æ”¹éƒ½ä¸€æ¨£ã€‚</p><p>æ¥è‘—æˆ‘è©¦äº†ç„¡ç—•æ¨¡å¼ï¼Œæ¬¸ï¼Ÿæ²’äº‹äº†ã€‚<br>æ‡·ç–‘æ˜¯ç€è¦½å™¨å¿«å–ä½œæ€ªï¼Œæ¸…é™¤å¾Œé‚„æ˜¯ä¸€æ¨£ã€‚<br>æ›ç”¨ Edgeï¼ˆæ²’è£ä»»ä½•å¤–æ›ï¼‰æ¸¬è©¦ï¼Œæ­£å¸¸ã€‚</p><h2 id="çœŸç›¸å¤§ç™½"><a href="#çœŸç›¸å¤§ç™½" class="headerlink" title="çœŸç›¸å¤§ç™½"></a>çœŸç›¸å¤§ç™½</h2><p>é€™æ™‚æˆ‘å°±å¡é—œäº†ï¼Œå› ç‚ºä¸€åˆ‡è¨­å®šçœ‹èµ·ä¾†éƒ½æ²’å•é¡Œã€‚  </p><p>éš¨å£å•äº†æ–°äººåŒäº‹ï¼Œæåˆ°æœ‰å¯èƒ½æ˜¯ç€è¦½å™¨å¤–æ›çš„å•é¡Œï¼Œæˆ‘å†æ¸¬è©¦ä¸€ä¸‹  </p><p>ç¢ºå®šæ˜¯æˆ‘åœ¨ Brave å®‰è£çš„å¤–æ›ã€ŒPage Assist - A Web UI for Local AI Modelsã€åœ¨æé¬¼ï¼  </p><p>é€™å€‹å¤–æ›å¯èƒ½æœƒå·å·æ³¨å…¥ JS æˆ–æ”¹å¯« request headerï¼Œå°è‡´ CORS é æª¢è«‹æ±‚å‡ºç¾ç•°å¸¸ï¼Œè®“ç€è¦½å™¨èª¤ä»¥ç‚ºæ˜¯ server è¨­å®šå•é¡Œã€‚  </p><p>æˆ‘ä¸€åœç”¨å¤–æ›ï¼Œå†æ¬¡æ¸¬è©¦ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚  </p><h2 id="å¿ƒå¾—èˆ‡æé†’"><a href="#å¿ƒå¾—èˆ‡æé†’" class="headerlink" title="å¿ƒå¾—èˆ‡æé†’"></a>å¿ƒå¾—èˆ‡æé†’</h2><p>é€™æ¬¡çš„ç¶“é©—è®“æˆ‘å†æ¬¡é«”æœƒï¼š</p><blockquote><p>æœ€é›£ debug çš„éŒ¯èª¤ï¼Œå¾€å¾€ä¾†è‡ªä½ ã€Œä»¥ç‚ºä¸æœƒå‡ºéŒ¯ã€çš„åœ°æ–¹ã€‚</p></blockquote><p>çµ¦æœªä¾†çš„è‡ªå·±å¹¾å€‹å»ºè­°ï¼š</p><ul><li><strong>é–‹ç„¡ç—•æ¨¡å¼æ¸¬è©¦</strong>ï¼šèƒ½å¿«é€Ÿæ’é™¤å¿«å–èˆ‡å¤–æ›çš„å¹²æ“¾  </li><li><strong>æ›ä¹¾æ·¨çš„ç€è¦½å™¨</strong>ï¼šæœ‰æ™‚å€™ Edge æˆ– Safari èƒ½æ•‘ä½ ä¸€å‘½  </li><li><strong>æ—©é»æ±‚æ•‘</strong>ï¼šå¡ä½å°±å•ï¼Œåˆ¥ä¸€å€‹äººæµªè²»å¤ªå¤šæ™‚é–“åœ¨éŒ¯çš„åœ°æ–¹æ‰“è½‰ï¼Œåˆ¥äººå¯ä»¥çµ¦ä½ ä¸åŒè§€é»</li></ul><p>é€™é¡å¥‡æ€ªçš„å•é¡Œå…¶å¯¦å¾ˆå¸¸è¦‹ï¼Œä½†ä¹Ÿæ­£å› ç‚ºé›£ä»¥è¤‡è£½èˆ‡é æœŸï¼Œæ‰æ›´å€¼å¾—è¨˜éŒ„ä¸‹ä¾†ã€‚</p><p>ä¸‹æ¬¡é‡åˆ°å¥‡æ€ªçš„ CORS éŒ¯èª¤æ™‚ï¼Œå¯ä»¥è€ƒæ…®æ˜¯<strong>è£çš„å¤–æ›åœ¨æäº‹ã€‚</strong></p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨æœ¬æ©Ÿé–‹ç™¼ä¸€æ”¯ç°¡å–®çš„ä¸Šå‚³ APIï¼Œä½¿ç”¨ Express.js æ­é… TypeScriptã€‚&lt;br&gt;é æœŸåªæ˜¯åœ¨ local</summary>
      
    
    
    
    
    <category term="è¸©é›·ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] Node.js Express éŒ¯èª¤è™•ç†å…¨æ”»ç•¥ï¼šåŒæ­¥ã€éåŒæ­¥èˆ‡ Stream Error</title>
    <link href="https://blog.marsen.me/2025/05/08/2025/express_error_handle/"/>
    <id>https://blog.marsen.me/2025/05/08/2025/express_error_handle/</id>
    <published>2025-05-08T05:47:43.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>Node.js + Express æ˜¯é–‹ç™¼ REST API æ™‚æœ€å¸¸è¦‹çš„çµ„åˆã€‚<br>é€™ç¯‡æ–‡ç« æœƒè©¦è‘—å¯«å‡ºä¸‰å¤§å¸¸è¦‹éŒ¯èª¤é¡å‹çš„è™•ç†æ–¹å¼ï¼š</p><ul><li>åŒæ­¥éŒ¯èª¤ï¼ˆthrowï¼‰</li><li>éåŒæ­¥éŒ¯èª¤ï¼ˆasync&#x2F;awaitï¼‰</li><li>Stream errorï¼ˆä¾‹å¦‚æª”æ¡ˆä¸‹è¼‰ï¼‰</li></ul><p>å¦‚æœä½ ç”¨çš„æ˜¯ Express 5ï¼Œå…¶å¯¦å·²ç¶“æ”¯æ´åŸç”Ÿ async function éŒ¯èª¤æ””æˆªï¼Œé€£ async wrapper éƒ½å¯ä»¥çœä¸‹ï¼</p><h2 id="Express-çš„éŒ¯èª¤è™•ç†-middleware-æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ"><a href="#Express-çš„éŒ¯èª¤è™•ç†-middleware-æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ" class="headerlink" title="Express çš„éŒ¯èª¤è™•ç† middleware æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ"></a>Express çš„éŒ¯èª¤è™•ç† middleware æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ</h2><p>åªè¦ä½ å‘¼å« <code>next(err)</code>ï¼ŒExpress å°±æœƒè·³åˆ°éŒ¯èª¤è™•ç† middlewareï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é€™å€‹ middleware éœ€è¦æœ‰å››å€‹åƒæ•¸ï¼ŒExpress æœƒè‡ªå‹•è¾¨è­˜å®ƒæ˜¯éŒ¯èª¤è™•ç† middlewareã€‚</p><h3 id="åŒæ­¥éŒ¯èª¤æ€éº¼è™•ç†ï¼Ÿ"><a href="#åŒæ­¥éŒ¯èª¤æ€éº¼è™•ç†ï¼Ÿ" class="headerlink" title="åŒæ­¥éŒ¯èª¤æ€éº¼è™•ç†ï¼Ÿ"></a>åŒæ­¥éŒ¯èª¤æ€éº¼è™•ç†ï¼Ÿ</h3><p>é€™ç¨®æœ€ç°¡å–®ï¼Œç›´æ¥ throw å°±å¯ä»¥ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/sync-error&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;åŒæ­¥éŒ¯èª¤&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Express æœƒè‡ªå‹•å¹«ä½ æ•æ‰ï¼Œé€é€²éŒ¯èª¤ middlewareï¼Œä¸éœ€è¦ç‰¹åˆ¥è™•ç†ã€‚</p><h3 id="Express-4-async-await-çš„éŒ¯èª¤è¦å°å¿ƒ"><a href="#Express-4-async-await-çš„éŒ¯èª¤è¦å°å¿ƒ" class="headerlink" title="Express 4 async&#x2F;await çš„éŒ¯èª¤è¦å°å¿ƒ"></a>Express 4 async&#x2F;await çš„éŒ¯èª¤è¦å°å¿ƒ</h3><p>Express 4 çš„æƒ…æ³ï¼š<br>ä½ å¯èƒ½æœƒå¯«é€™æ¨£çš„ codeï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await éŒ¯èª¤&#x27;</span>) <span class="comment">// âŒ ä¸æœƒè¢« Express æ•æ‰</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é€™æ¨£å¯«æœƒç›´æ¥è®“æ•´å€‹ç¨‹å¼ crashï¼Œå› ç‚º Express 4 ä¸æœƒè‡ªå‹•è™•ç† async function è£¡çš„éŒ¯èª¤ã€‚</p><h4 id="è§£æ³•ï¼šè‡ªå·±åŒ…ä¸€å±¤-asyncWrapper"><a href="#è§£æ³•ï¼šè‡ªå·±åŒ…ä¸€å±¤-asyncWrapper" class="headerlink" title="è§£æ³•ï¼šè‡ªå·±åŒ…ä¸€å±¤ asyncWrapper"></a>è§£æ³•ï¼šè‡ªå·±åŒ…ä¸€å±¤ asyncWrapper</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">asyncWrapper</span> = (<span class="params">fn</span>) =&gt; <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fn</span>(req, res, next).<span class="title function_">catch</span>(next)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await éŒ¯èª¤&#x27;</span>)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><p>é€™æ¨£å°±èƒ½å®‰å…¨æŠŠéŒ¯èª¤ä¸Ÿçµ¦éŒ¯èª¤ middleware è™•ç†ã€‚</p><h3 id="Express-5ï¼šåŸç”Ÿæ”¯æ´-async-function"><a href="#Express-5ï¼šåŸç”Ÿæ”¯æ´-async-function" class="headerlink" title="Express 5ï¼šåŸç”Ÿæ”¯æ´ async function"></a>Express 5ï¼šåŸç”Ÿæ”¯æ´ async function</h3><p>å¦‚æœä½ ç”¨çš„æ˜¯ Express 5ï¼Œé‚£æ›´ç°¡å–®äº†ï¼Œç›´æ¥å¯« async functionï¼ŒExpress å°±æœƒè‡ªå‹•æ•æ‰éŒ¯èª¤ï¼Œå®Œå…¨ä¸éœ€è¦ async wrapperï¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getSomeData</span>()</span><br><span class="line">  <span class="keyword">if</span> (!data) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æ‰¾ä¸åˆ°è³‡æ–™&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">json</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯æ¸…çˆ½å¤šäº†ï¼Ÿ</p><p>!!æ³¨æ„ï¼šè¦ç¢ºèªä½ çš„å°ˆæ¡ˆä½¿ç”¨çš„æ˜¯ <a href="mailto:&#x65;&#120;&#x70;&#114;&#101;&#x73;&#115;&#64;&#x35;&#x2e;&#120;">express@5.x</a> ç‰ˆæœ¬ã€‚<br>å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤ç¢ºèª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm list express</span><br></pre></td></tr></table></figure><h3 id="Stream-errorï¼šExpress-æ•ä¸åˆ°"><a href="#Stream-errorï¼šExpress-æ•ä¸åˆ°" class="headerlink" title="Stream errorï¼šExpress æ•ä¸åˆ°"></a>Stream errorï¼šExpress æ•ä¸åˆ°</h3><p>å•é¡Œåœ¨å“ªï¼Ÿ<br>stream éŒ¯èª¤æ˜¯é€é EventEmitter çš„ â€˜errorâ€™ äº‹ä»¶å‚³éï¼ŒExpress æ ¹æœ¬ä¸çŸ¥é“æœ‰é€™å›äº‹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>()</span><br><span class="line">  file.<span class="title function_">createReadStream</span>().<span class="title function_">pipe</span>(res) <span class="comment">// âŒ æ¬Šé™éŒ¯èª¤æœƒ crashï¼ŒExpress ä¸æœƒæ¥åˆ°</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h4 id="æ­£ç¢ºä½œæ³•ï¼šè‡ªå·±ç›£è½-â€˜errorâ€™ï¼Œå†ä¸Ÿçµ¦-next"><a href="#æ­£ç¢ºä½œæ³•ï¼šè‡ªå·±ç›£è½-â€˜errorâ€™ï¼Œå†ä¸Ÿçµ¦-next" class="headerlink" title="æ­£ç¢ºä½œæ³•ï¼šè‡ªå·±ç›£è½ â€˜errorâ€™ï¼Œå†ä¸Ÿçµ¦ next()**"></a>æ­£ç¢ºä½œæ³•ï¼šè‡ªå·±ç›£è½ â€˜errorâ€™ï¼Œå†ä¸Ÿçµ¦ next()**</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>()</span><br><span class="line">  <span class="keyword">const</span> stream = file.<span class="title function_">createReadStream</span>()</span><br><span class="line">  stream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, next)</span><br><span class="line">  stream.<span class="title function_">pipe</span>(res)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h4 id="Bonusï¼šåŒ…æˆä¸€å€‹å·¥å…·å‡½å¼"><a href="#Bonusï¼šåŒ…æˆä¸€å€‹å·¥å…·å‡½å¼" class="headerlink" title="Bonusï¼šåŒ…æˆä¸€å€‹å·¥å…·å‡½å¼"></a>Bonusï¼šåŒ…æˆä¸€å€‹å·¥å…·å‡½å¼</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/streamErrorHandler.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Response</span>, <span class="title class_">NextFunction</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Readable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;stream&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">pipeWithErrorHandler</span>(<span class="params">stream: Readable, res: Response, next: NextFunction</span>) &#123;</span><br><span class="line">  stream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, next)</span><br><span class="line">  stream.<span class="title function_">pipe</span>(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>()</span><br><span class="line">  <span class="title function_">pipeWithErrorHandler</span>(file.<span class="title function_">createReadStream</span>(), res, next)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h2 id="æ•´é«”ç¯„ä¾‹ç¨‹å¼"><a href="#æ•´é«”ç¯„ä¾‹ç¨‹å¼" class="headerlink" title="æ•´é«”ç¯„ä¾‹ç¨‹å¼"></a>æ•´é«”ç¯„ä¾‹ç¨‹å¼</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; asyncWrapper &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/asyncWrapper&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; pipeWithErrorHandler &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/streamErrorHandler&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ“¬ GCS æª”æ¡ˆç‰©ä»¶</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSomeGCSFile</span>(<span class="params">shouldError: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="title class_">Readable</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;stream&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (shouldError) &#123;</span><br><span class="line">    <span class="comment">// æœƒ emit error çš„ stream</span></span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">new</span> <span class="title class_">Readable</span>(&#123;</span><br><span class="line">      <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;stream error æ¸¬è©¦&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">createReadStream</span>: <span class="function">() =&gt;</span> stream</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ­£å¸¸å›å‚³è³‡æ–™</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">createReadStream</span>: <span class="function">() =&gt;</span> <span class="title class_">Readable</span>.<span class="title function_">from</span>([<span class="string">&#x27;Hello World&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæ­¥éŒ¯èª¤</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/sync-error&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;åŒæ­¥éŒ¯èª¤&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éåŒæ­¥éŒ¯èª¤ï¼ˆExpress 4 å¯«æ³•ï¼‰</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error-4&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await éŒ¯èª¤, Express 4.x ä»¥ä¸‹çš„å¯«æ³•&#x27;</span>)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// éåŒæ­¥éŒ¯èª¤ï¼ˆExpress 5 å¯«æ³•ï¼‰</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/async-error&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;async/await éŒ¯èª¤&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream errorï¼ˆæ­£ç¢ºè™•ç†ï¼‰</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="title function_">pipeWithErrorHandler</span>(file.<span class="title function_">createReadStream</span>(), res, next)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// stream errorï¼ˆæ²’è™•ç†æœƒ crashï¼‰</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/file-no-handle&#x27;</span>, <span class="title function_">asyncWrapper</span>(<span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title function_">getSomeGCSFile</span>(<span class="literal">true</span>)</span><br><span class="line">  file.<span class="title function_">createReadStream</span>().<span class="title function_">pipe</span>(res)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// éŒ¯èª¤ middleware</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server started&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç”¨çš„æ˜¯ Express 5ï¼Œå¯ä»¥æŠŠ asyncWrapper éƒ½æ‹¿æ‰ï¼Œç¨‹å¼ç¢¼æœƒæ›´ç°¡æ½”ï¼</p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><table><thead><tr><th>é¡å‹</th><th>æœƒè‡ªå‹•è™•ç†ï¼Ÿ</th><th>è§£æ³•</th></tr></thead><tbody><tr><td>åŒæ­¥éŒ¯èª¤</td><td>âœ… Express è‡ªå‹•è™•ç†</td><td>ç›´æ¥ throw å°±å¥½</td></tr><tr><td>async&#x2F;await éŒ¯èª¤</td><td>âŒ Express 4 ä¸æœƒè™•ç†</td><td>ç”¨ asyncWrapperï¼ˆExpress 4ï¼‰</td></tr><tr><td></td><td>âœ… Express 5 è‡ªå‹•è™•ç†</td><td>æˆ–ç›´æ¥å¯« async functionï¼ˆExpress 5ï¼‰</td></tr><tr><td>Stream error</td><td>âŒ å®Œå…¨ä¸æœƒè™•ç†</td><td>ç›£è½ stream.on(â€˜errorâ€™, next)</td></tr></tbody></table><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://github.com/marsen/express-handle-err">https://github.com/marsen/express-handle-err</a></li><li><a href="https://expressjs.com/en/guide/error-handling.html">https://expressjs.com/en/guide/error-handling.html</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;Node.js + Express æ˜¯é–‹ç™¼ REST API æ™‚æœ€å¸¸è¦‹çš„çµ„åˆã€‚&lt;br&gt;é€™ç¯‡æ–‡ç« æœƒè©¦è‘—å¯«å‡ºä¸‰å¤§å¸¸è¦‹éŒ¯èª¤é¡å‹çš„è™•</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [ç”Ÿæ´»ç­†è¨˜] æˆ‘å€‘ä¸å†éœ€è¦ç¢¼è¾²??</title>
    <link href="https://blog.marsen.me/2025/04/22/2025/should_we_need_rd/"/>
    <id>https://blog.marsen.me/2025/04/22/2025/should_we_need_rd/</id>
    <published>2025-04-22T07:49:41.000Z</published>
    <updated>2025-08-27T14:25:35.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>2023 ç•¶ä¸»ç®¡åˆ°ä»Šå¤©çš„ä¸€äº›é«”æ‚Ÿ, ä¹Ÿæ„Ÿå—åˆ°ä¸€äº›é¢¨å‘çš„è½‰æ›ï¼Œ<br>å…ˆèªªçµè«–ï¼Œåœ¨ï¼“ï½ï¼•å¹´å…§æˆ‘å€‘ä¸éœ€è¦ä½éšå·¥ç¨‹å¸«äº†ã€‚<br>è»ŸæŠ€èƒ½èˆ‡ AI æ‡‰ç”¨èƒ½åŠ›é«˜çš„æ¥­å‹™ã€å¹´è¼•äººå¯ä»¥è¼•æ˜“çš„å–ä»£æ‰é€™ä¸€å±¤äººã€‚</p><h2 id="äººç‰©èˆ‡äº‹ä»¶"><a href="#äººç‰©èˆ‡äº‹ä»¶" class="headerlink" title="äººç‰©èˆ‡äº‹ä»¶"></a>äººç‰©èˆ‡äº‹ä»¶</h2><p><code>ä»¥ä¸‹å…§å®¹ç‚ºå€‹äººè§€å¯Ÿèˆ‡ç¶“é©—åˆ†äº«</code><br><code>å¦‚æœ‰é›·åŒï¼Œç´”å±¬å·§åˆï¼Œç„¡æ„å½±å°„ä»»ä½•ç‰¹å®šå€‹äººæˆ–åœ˜é«”ã€‚</code></p><h3 id="ä¸é¡˜æ„åšè©¦æ–°æŠ€è¡“ï¼Œå®ˆæˆè€…"><a href="#ä¸é¡˜æ„åšè©¦æ–°æŠ€è¡“ï¼Œå®ˆæˆè€…" class="headerlink" title="ä¸é¡˜æ„åšè©¦æ–°æŠ€è¡“ï¼Œå®ˆæˆè€…"></a>ä¸é¡˜æ„åšè©¦æ–°æŠ€è¡“ï¼Œå®ˆæˆè€…</h3><p>æŸäº›ç‰¹å®šæŠ€è¡“æŒæœ‰è€…ï¼Œä¸»è¦çš„æŠ€è¡“ç”¨å¾—å¾ˆç†Ÿï¼Œä½†å°æ–¼æ–°æŠ€è¡“å®Œå…¨ä¸æ„Ÿèˆˆè¶£ï¼Œæ‹’çµ•å­¸ç¿’ã€‚<br>ç†ç”±æ˜¯ã€Œé€™äº›æŠ€è¡“ä¸ç©©å®šï¼Œé‚„æ˜¯ç”¨ç†Ÿæ‚‰çš„æ¯”è¼ƒå¥½ã€ã€‚<br>æˆ–æ˜¯æŠ€è¡“æ¡†æ¶å¾ˆå°ï¼Œåªèƒ½è™•ç†å‰ç«¯æˆ–æ˜¯è³‡æ–™åº«â€¦è«¸å¦‚æ­¤é¡<br>æ™‚ä»£åœ¨è®Šï¼Œç‰¹å®šæŠ€èƒ½çš„éœ€æ±‚é™ä½ä¹‹ï¼Œæˆ–è¨±åªèƒ½è«‹ä»–é›¢é–‹ï¼ˆæ¥­å‹™æ€§è³ªè®Šæ›´ï¼Œæœ‰æ¸›å°‘å‹å·¥ä¹‹å¿…è¦ï¼Œåˆç„¡é©ç•¶å·¥ä½œå¯ä¾›å®‰ç½®æ™‚ã€‚ï¼‰</p><p>ç•¶åœ˜éšŠéœ€è¦ä»–å”åŠ©å¸¶æ–°äººæ™‚ï¼Œä»–çš„æ–¹å¼æ˜¯ã€Œæ”¾è‘—è®“ä»–çœ‹ Codeã€ï¼Œå®Œå…¨ä¸é¡˜æ„æä¾›æŒ‡å°ï¼Œå°è‡´æ–°äººé€²æ­¥ç·©æ…¢ã€‚<br>ç•¶åœ˜éšŠéœ€è¦ä»–æ”¹å–„æµç¨‹æ™‚ï¼Œä»–çš„æ–¹å¼ä»¥æ‹–å¾…è®Šï¼Œä¸æ¨å‹•äº‹å‹™æ”¹è®Šã€‚</p><h3 id="æ²’äº‹å°±ç¡è¦ºï¼Œç¡é­”"><a href="#æ²’äº‹å°±ç¡è¦ºï¼Œç¡é­”" class="headerlink" title="æ²’äº‹å°±ç¡è¦ºï¼Œç¡é­”"></a>æ²’äº‹å°±ç¡è¦ºï¼Œç¡é­”</h3><p>ç¶“å¸¸åœ¨å·¥ä½œæ™‚é–“ç¡è¦ºï¼Œå°å°ˆæ¡ˆé€²åº¦æ¯«ä¸é—œå¿ƒï¼Œæœ€çµ‚å› ç‚ºæ…‹åº¦å•é¡Œè¢«è€é—†é–‹é™¤ã€‚<br>æ˜æ˜å°±æœ‰ä¸€å®šçš„æŠ€è¡“åŠ›ï¼Œä½†å¯èƒ½äººç”Ÿå·²ç¶“ç„¡æ…¾ç„¡æ±‚ï¼Œæ²’æœ‰å‹•åŠ›ã€‚<br>ä¸Šç­åªæ˜¯ä¾†æ‰“ç™¼æ™‚é–“ï¼Œåƒåœ¨ç­‰å¾…ä»€éº¼çµæŸçš„ä¿¡è™Ÿã€‚<br>æ¯å¤©ååœ¨é›»è…¦å‰ï¼Œè¢å¹•äº®è‘—ï¼Œçœ¼ç¥å»ç©ºæ´ï¼Œå½·å½¿èº«é«”é‚„åœ¨è·å ´ï¼Œéˆé­‚æ—©å·²è¾­è·ã€‚<br>ä»–å°çœ‹æ¿çš„ä»»å‹™è¦–è€Œä¸è¦‹ï¼Œå°ç³»çµ±é€šçŸ¥çš„æé†’ç¿’ä»¥ç‚ºå¸¸ï¼Œ<br>å½·å½¿é€™äº›å°ˆæ¡ˆä»»å‹™èˆ‡ä»–æ¯«ç„¡é—œè¯ã€‚<br>å·¥ä½œåˆ°ä¸€åŠï¼Œé ­ä¸€ä½å¥½åƒèµ°äº†â€¦</p><h3 id="ç´™ä¸Šè«‡å…µå­¸é™¢æ´¾ï¼Œç ”ç©¶ç”Ÿ"><a href="#ç´™ä¸Šè«‡å…µå­¸é™¢æ´¾ï¼Œç ”ç©¶ç”Ÿ" class="headerlink" title="ç´™ä¸Šè«‡å…µå­¸é™¢æ´¾ï¼Œç ”ç©¶ç”Ÿ"></a>ç´™ä¸Šè«‡å…µå­¸é™¢æ´¾ï¼Œç ”ç©¶ç”Ÿ</h3><p>é€™ä½å·¥ç¨‹å¸«åŸºæœ¬è¡›ç”Ÿä¸ä½³ï¼Œé›–ç„¶å¾Œå£æ¢å¾ˆå¥½ä½†æ˜¯æœ‰åš´é‡å£è‡­ã€‚<br>ç¶“å¸¸åœ¨æœƒè­°ä¸­ä¾ƒä¾ƒè€Œè«‡ï¼Œé™¤äº†æ°£å‘³ä¸ä½³å¤–ï¼Œå¯¦éš›åŸ·è¡Œèˆ‡èªªå¾—ä¹Ÿæœ‰å¾ˆå¤§çš„å·®è·ã€‚<br>èªªä¸€å¥—ä½œä¸€å¥—ï¼Œç¨‹å¼é›–ç„¶èƒ½é‹è¡Œï¼Œä½†çµæ§‹æ··äº‚ï¼Œé›£ä»¥ç¶­è­·ï¼Œä¸è¦èªªäº¤æ¥ï¼Œéå€‹å¹¾å‘¨ä»–çš„ç¨‹å¼ä»–è‡ªå·²å°±çœ‹ä¸æ‡‚ã€‚ã€€ã€€</p><p>æ­¤å¤–é€£åŸºæœ¬çš„èª å¯¦éƒ½ä½œä¸åˆ°ï¼Œæœ‰ä¸€ä¾‹æ˜¯æ›¾ç¶“æŠŠå¥¶èŒ¶æ‰“ç¿»åˆ°ç­†é›»ä¸Šé€ æˆææ¯€ã€‚ã€€ã€€<br>æœ¬ä¾†ä¸æ˜¯å¤šå¤§çš„éŒ¯èª¤ï¼Œä½†å•ä»–æœ‰æ²’æœ‰ä»€éº¼å¯èƒ½æ€§æ™‚ï¼Œå®Œå…¨æ²’æœ‰æåŠã€‚<br>é›»è…¦å¾Œé€ä¿®æœ‰äººç‚ºæ¯€æè¨¼æ“šæ‰æ‰¿èªï¼›ã€€ã€€<br>ä¸è«–æ˜¯éºå¿˜æˆ–åˆ»æ„ä¸æéƒ½æ˜¯åæ‡‰è‡ªç§èˆ‡ä¸è² è²¬çš„è¡¨ç¾ï¼Œä»¤äººç„¡æ³•ä¿¡è³´ã€‚</p><h3 id="ä½ æ²’èªªç«™èµ·ä¾†è¦ç”¨è…³ï¼Œè¢«å‹•çš„å°å¯¶å¯¶"><a href="#ä½ æ²’èªªç«™èµ·ä¾†è¦ç”¨è…³ï¼Œè¢«å‹•çš„å°å¯¶å¯¶" class="headerlink" title="ä½ æ²’èªªç«™èµ·ä¾†è¦ç”¨è…³ï¼Œè¢«å‹•çš„å°å¯¶å¯¶"></a>ä½ æ²’èªªç«™èµ·ä¾†è¦ç”¨è…³ï¼Œè¢«å‹•çš„å°å¯¶å¯¶</h3><p>é€™é¡å‹çš„å·¥ç¨‹å¸«åœ¨é¢å°è¤‡é›œä»»å‹™æ™‚ï¼Œç¸½æ˜¯ç„¡æ³•å°‡å¤§ç›®æ¨™æ‹†è§£æˆå¯åŸ·è¡Œçš„å°æ­¥é©Ÿï¼Œå°è‡´å·¥ä½œä¸é€æ˜ï¼Œå‰¯ä½œç”¨å°±æ˜¯é€²åº¦ç·©æ…¢ä¸”æ··äº‚ã€‚  </p><p>åªæœƒæŒ‰ç…§æŒ‡ä»¤åŸ·è¡Œï¼Œç¼ºä¹ä¸»å‹•æ€è€ƒèˆ‡è§£æ±ºå•é¡Œçš„èƒ½åŠ›ã€‚<br>ä½ ä¸‹çš„æŒ‡ä»¤è¦ååˆ†ç²¾ç¢ºï¼Œä¾ä»–æ‰€è¦‹ï¼Œæ‰€æœ‰çš„éŒ¯éƒ½æ˜¯åˆ¥äººçš„éŒ¯ï¼Œ<br>åªè¦æœ‰äººçµ¦ä»–å¤ ç²¾ç¢ºçš„æŒ‡ä»¤ï¼Œä»–æ‰ä¸æœƒå¤±æ•—ã€‚<br>ç•¶é‡åˆ°éœ€è¦å»¶ä¼¸æ€è€ƒçš„æƒ…å¢ƒæ™‚ï¼Œç„¡æ³•èˆ‰ä¸€åä¸‰æˆ–è§¸é¡æ—é€šï¼Œåè€Œè²¬æ€ªåˆ¥äººæ²’æœ‰èªªæ¸…æ¥šã€‚  </p><p>èˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä¸»ç®¡è¦æ±‚ä»–ä¿®å¾©ä¸€å€‹åŠŸèƒ½æ™‚ï¼Œä»–åªæœƒä¿®å¾©è¡¨é¢å•é¡Œï¼Œå»å¿½ç•¥äº†ç›¸é—œçš„é‚è¼¯éŒ¯èª¤æˆ–æ½›åœ¨çš„é¢¨éšªï¼Œ<br>æœ€çµ‚å°è‡´å•é¡Œåè¦†å‡ºç¾ï¼Œè¶Šè™•ç†è¶Šæ¨¡ç³Šã€‚</p><p>é€™æ¨£çš„äººå¾€å¾€éœ€è¦ä¸»ç®¡æˆ–åŒäº‹ä¸æ–·æé†’èˆ‡å”åŠ©ï¼Œç„¡æ³•ç¨ç«‹å®Œæˆä»»å‹™ã€‚<br>æ›´åš´é‡çš„æ˜¯ï¼Œä»–å€‘å¸¸å¸¸æ‹–ç´¯é«˜æ•ˆç‡çš„åŒäº‹ï¼Œå½¢æˆèƒ½è€…éå‹çš„åœ˜éšŠæ°›åœã€‚  </p><p><img src="/images/2025/cynefin.png" alt="å·¥ä½œæ‹†è§£çš„ Cynefin"></p><h3 id="åˆ¥äººéƒ½çˆ›æ‰£ï¼Œå°±æˆ‘ç¥ä¹å¥‡æŠ€"><a href="#åˆ¥äººéƒ½çˆ›æ‰£ï¼Œå°±æˆ‘ç¥ä¹å¥‡æŠ€" class="headerlink" title="åˆ¥äººéƒ½çˆ›æ‰£ï¼Œå°±æˆ‘ç¥ä¹å¥‡æŠ€"></a>åˆ¥äººéƒ½çˆ›æ‰£ï¼Œå°±æˆ‘ç¥ä¹å¥‡æŠ€</h3><p>ä»–æ„›æŒ‘åˆ¥äººçš„éŒ¯ï¼Œå»è½ä¸å¾—ä¸€å¥å»ºè­°ã€‚<br>è‡ªå·±å¯«çš„ç¨‹å¼åƒæ‹¼åœ–ï¼Œæ··äº‚åˆé›£ç¶­è­·ï¼Œé‚„è‡ªèª‡æ˜¯ã€Œéˆæ´»ä¸å—é™çš„å¯«æ³•ã€ã€‚  </p><p>ç¢°åˆ°ç¶­é‹å°±é–ƒï¼Œé‡åˆ° bug å°±æ¨ï¼Œå°ˆæ¡ˆè½å¾Œäº†ï¼Œåªæœƒèªªï¼šã€Œä¸€é–‹å§‹è¦åŠƒå°±æœ‰å•é¡Œå§ã€‚ã€<br>å¾ä¸æè§£æ³•ï¼Œåªæœ‰æŠ±æ€¨ã€‚  </p><p>åœ˜éšŠåœ¨å‰é€²ï¼Œä»–å»åƒéŒ¨ï¼ŒæŠŠæ•´è‰˜èˆ¹æ‹–ä½ã€‚<br>ç•¶æŒ‡å‡ºä»–çš„å•é¡Œï¼Œé‚„æœƒæ°£æ€¥æ•—å£ç™¼ç«ã€‚è®“æ•´å€‹æ°£æ°›æ›´åŠ å°·å°¬ã€‚</p><h3 id="çœ‹ä¸æ‡‚è‹±æ–‡æ–‡ä»¶é‚„æƒ³ç•¶å·¥ç¨‹å¸«"><a href="#çœ‹ä¸æ‡‚è‹±æ–‡æ–‡ä»¶é‚„æƒ³ç•¶å·¥ç¨‹å¸«" class="headerlink" title="çœ‹ä¸æ‡‚è‹±æ–‡æ–‡ä»¶é‚„æƒ³ç•¶å·¥ç¨‹å¸«"></a>çœ‹ä¸æ‡‚è‹±æ–‡æ–‡ä»¶é‚„æƒ³ç•¶å·¥ç¨‹å¸«</h3><p>èŠ±äº†ä¸‰å‘¨æä¸å®šä¸€å€‹ API, æ¯æ¬¡éƒ½èªªé€™å€‹é‚£å€‹å¤šè¤‡é›œ, ã€€<br>åˆ¥äººï¼ˆé‚„æ˜¯å…©ä½ï¼‰ï¼‘å°æ™‚å°±æå®šã€‚<br>æœ€å¾Œæ‰æ‰¿èªè‹±æ–‡çœ‹ä¸æ‡‚ã€‚ä¸€æ˜¯ä¸æ‡‚æ‰¿è«¾ï¼ŒäºŒæ˜¯å¡ä½ä¸æ±‚æ•‘  </p><p>é€™æ¨£çš„æƒ…æ³æ€éº¼èƒ½ä¸è®“äººå¤±æœ›ï¼Ÿæ˜æ˜ä¸€é–‹å§‹å°±çŸ¥é“è‡ªå·±æœ‰å›°é›£ï¼Œå»ç¡¬æ˜¯é¸æ“‡éš±çï¼Œ<br>é€™æ¨£çš„æ…‹åº¦æ‰æ˜¯æœ€å¤§çš„å•é¡Œã€‚ä¸æ±‚åŠ©ï¼Œè®“å•é¡Œåƒæ»¾é›ªçƒä¸€æ¨£è¶Šæ»¾è¶Šå¤§ã€‚  </p><p>å•é¡Œä¸åœ¨æ–¼ä»–ç„¡æ³•è§£æ±ºï¼Œè€Œåœ¨æ–¼ä»–é¸æ“‡é€ƒé¿ï¼Œé¸æ“‡ä¸èˆ‡äººåˆä½œï¼Œç”šè‡³ä¸é¡˜æ„æ‰¿èªè‡ªå·±çš„å›°å¢ƒã€‚<br>é€™ç¨®è‡ªæˆ‘å°é–‰çš„æ…‹åº¦ï¼Œè®“ä»–éŒ¯å¤±æ›´å¤šå­¸ç¿’çš„æ©Ÿæœƒä¹Ÿè®“åœ˜éšŠæ‰¿æ“”é¡å¤–çš„é¢¨éšªã€‚  </p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;2023 ç•¶ä¸»ç®¡åˆ°ä»Šå¤©çš„ä¸€äº›é«”æ‚Ÿ, ä¹Ÿæ„Ÿå—åˆ°ä¸€äº›é¢¨å‘çš„è½‰æ›ï¼Œ&lt;br&gt;å…ˆèªªçµè«–ï¼Œåœ¨ï¼“ï½ï¼•å¹´å…§æˆ‘å€‘ä¸éœ€è¦ä½éšå·¥ç¨‹å¸«äº†ã€‚&lt;br&gt;è»Ÿ</summary>
      
    
    
    
    
    <category term="ç”Ÿæ´»ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [ç”Ÿæ´»ç­†è¨˜] First Trade é–‹å¡è¨˜éŒ„</title>
    <link href="https://blog.marsen.me/2025/03/25/2025/firstrade_activate_debit_card/"/>
    <id>https://blog.marsen.me/2025/03/25/2025/firstrade_activate_debit_card/</id>
    <published>2025-03-25T20:31:05.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>First Trade Debit å¡æ˜¯ä¸€å¼µç°½å¸³é‡‘èå¡ï¼Œèˆ‡ä¿¡ç”¨å¡ä¸åŒï¼Œå®ƒç›´æ¥å¾æŠ•è³‡å¸³æˆ¶æ‰£æ¬¾ï¼Œä¸èƒ½è¶…é¡æ¶ˆè²»ã€‚<br>é€™å¼µå¡å¯åœ¨å…¨çƒä»»ä½•æ”¯æ´ VISA çš„å•†åº—èˆ‡ ATM ä½¿ç”¨ï¼Œæ–¹ä¾¿åœ¨ç¾åœ‹å…§å¤–é€²è¡Œäº¤æ˜“èˆ‡ææ¬¾ã€‚<br>First Trade å¯ä»¥åœ¨ç·šä¸Šç”³è«‹ï¼Œç¶²ç«™ä¸Šèªªç´„ä¸€å€‹æœˆçš„å·¥ä½œæ—¥ï¼Œæˆ‘å¤§æ¦‚10å¤©å·¦å³æ”¶åˆ°ã€‚  </p><h2 id="é–‹å¡"><a href="#é–‹å¡" class="headerlink" title="é–‹å¡"></a>é–‹å¡</h2><p>å¡ç‰‡åŒ…è£¹å…§æœƒé™„ä¸Šé–‹å¡èªªæ˜ï¼Œä½†å¦‚æœçœ‹ä¸æ‡‚ï¼Œç›´æ¥è·Ÿè‘—ä»¥ä¸‹æ­¥é©Ÿæ“ä½œå°±å¥½ã€‚</p><ol><li><p>æ’¥æ‰“é–‹å¡é›»è©±<br>  ä½¿ç”¨åœ‹éš›é›»è©±æ’¥æ‰“ First Securities å®¢æœå°ˆç·šï¼š002 1-855-253-1057<br>  é›»è©±éŒ„éŸ³ç‚ºè‹±æ–‡ï¼Œä½†å…¨ç¨‹ç„¡éœ€èªªè©±ï¼Œåªéœ€ä¾æŒ‡ç¤ºè¼¸å…¥æ•¸å­—å³å¯ã€‚</p></li><li><p>é–‹å¡æµç¨‹<br>è¼¸å…¥16ä½å¡è™Ÿï¼šç›´æ¥è¼¸å…¥å¡ç‰‡æ­£é¢16ä½æ•¸ï¼Œä¸éœ€è¦æŒ‰ #ã€‚<br>è¼¸å…¥ç¤¾æœƒå®‰å…¨ç¢¼ï¼ˆSSNï¼‰ï¼šè¼¸å…¥ 5436ã€‚<br>è¼¸å…¥ç”Ÿæ—¥è³‡è¨Šï¼š<br>æ ¼å¼ç‚ºã€ŒMMYYã€ï¼Œä¾‹å¦‚ 1985å¹´2æœˆç”Ÿ â†’ è¼¸å…¥ 0285ã€‚(ç‰¹åˆ¥æ³¨æ„ä¸è¦è¼¸å…¥æˆæœˆæ—¥)<br>è¼¸å…¥å¡ç‰‡èƒŒé¢å®‰å…¨ç¢¼ï¼ˆCVVï¼‰ï¼š3 ä½æ•¸çš„å®‰å…¨ç¢¼ï¼Œä½æ–¼å¡ç‰‡èƒŒé¢ã€‚<br>è¨­å®šææ¬¾&#x2F;äº¤æ˜“å¯†ç¢¼ï¼šè¼¸å…¥ 4 ä½æ•¸å¯†ç¢¼ã€‚<br>ç¢ºèªå¯†ç¢¼ï¼šå†æ¬¡è¼¸å…¥ç›¸åŒå¯†ç¢¼ã€‚</p></li></ol><p>ä»¥ä¸Šå®Œæˆé–‹å¡ï¼Œç´„ï¼‘åˆ†é˜å…§å¯ä»¥å®Œæˆ</p><h2 id="æ³¨æ„äº‹é …"><a href="#æ³¨æ„äº‹é …" class="headerlink" title="æ³¨æ„äº‹é …"></a>æ³¨æ„äº‹é …</h2><p>Firstrade Debit å¡é©åˆé‚£äº›åœ¨ã€€Firstrade è³¬æˆ¶ä¸­æœ‰è‡³å°‘ $25,000 å­˜æ¬¾çš„æŠ•è³‡è€…ã€‚<br>å®ƒå¯å…¨çƒä½¿ç”¨ï¼Œå¯ä»¥ç”¨ä¾†ææ¬¾èˆ‡æ¶ˆè²»ï¼Œä¸¦ä¸”æ¯æœˆé¦–æ¬¡ææ¬¾å…è²»ã€‚<br>ä¾æ“šæ–‡ç« èªªæ˜ï¼Œæ¯å€‹æœˆç¬¬ä¸€æ¬¡çš„ä½¿ç”¨ï¼ˆæé ˜æˆ–æ¶ˆè²»ï¼‰å¯äº«è·¨å¢ƒæ‰‹çºŒè²»è¿”é‚„ã€‚<br>ç”³è«‹äººéœ€é–‹è¨­ç¾é‡‘ç®¡ç†è³¬æˆ¶ä¸¦ä¿æŒæœ€ä½å­˜æ¬¾ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ—¥ææ¬¾é™é¡ç‚º $1,000ï¼Œä¸¦ä¸”éœ€è¦ä¿æŒæœ€ä½é¤˜é¡ã€‚<br>è¶…éå°±è¦æ”¶ 3% æ‰‹çºŒè²»ã€‚<br>æ„Ÿè¦ºå¯¦ç”¨æ€§ä¸é«˜ï¼Œæˆ–è¨±åœ¨åœ‹å¤–ç·Šéœ€ç¾é‡‘æ™‚å¯ä»¥ç”¨ä¾†æ‡‰æ€¥ã€‚</p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://www.firstrade.com/zh-TW/resources/guides/stocks/debit#debit01">https://www.firstrade.com/zh-TW/resources/guides/stocks/debit#debit01</a></li><li><a href="https://rich01.com/how-to-apply-firstrade-debit-card/">https://rich01.com/how-to-apply-firstrade-debit-card/</a></li><li><a href="https://sleepyinvest.com/firstrade-debit-card/">https://sleepyinvest.com/firstrade-debit-card/</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;First Trade Debit å¡æ˜¯ä¸€å¼µç°½å¸³é‡‘èå¡ï¼Œèˆ‡ä¿¡ç”¨å¡ä¸åŒï¼Œå®ƒç›´æ¥å¾æŠ•è³‡å¸³æˆ¶æ‰£æ¬¾ï¼Œä¸èƒ½è¶…é¡æ¶ˆè²»ã€‚&lt;br&gt;é€™å¼µå¡å¯åœ¨</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] è¨­å®š VSCode å¤–æ› CLine(MCP Client) Azure Open AI çš„è¸©é›·ç­†è¨˜</title>
    <link href="https://blog.marsen.me/2025/03/24/2025/ai_Cline_mcp_Azure_open_ai_settings/"/>
    <id>https://blog.marsen.me/2025/03/24/2025/ai_Cline_mcp_Azure_open_ai_settings/</id>
    <published>2025-03-24T09:54:05.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ç¨®å”è­°ï¼Œæœ€è¿‘ç¤¾ç¾¤å¾ˆå¤¯çš„æ±è¥¿ï¼Œ<br>æ‰€ä»¥ç¨å¾®ç ”ç©¶å®ƒä¸€ä¸‹ï¼Œä¸è«–å®ƒæ˜¯å¦åªæ˜¯å€‹ Buzz wordã€‚  </p><p>Cline æ˜¯é–‹æº AI ç¨‹å¼è¨­è¨ˆåŠ©ç†ï¼Œå¯ä»¥å¤–æ›è‡³ VS Codeï¼Œå…·è¨ˆåŠƒ&#x2F;åŸ·è¡Œæ¨¡å¼ï¼Œæ”¯æ´ MCP å”è­°ï¼Œ<br>æ‰€ä»¥æˆ‘é¸æ“‡å®ƒç•¶ä½œå…¥é–€çš„å·¥å…·ä¹‹ä¸€ã€‚  </p><h2 id="å•é¡Œç­†è¨˜"><a href="#å•é¡Œç­†è¨˜" class="headerlink" title="å•é¡Œç­†è¨˜"></a>å•é¡Œç­†è¨˜</h2><p>ä½¿ç”¨ VSCode èˆ‡ Cline ä½œç‚ºèµ·é»æ™‚ï¼Œä¸€å€‹é›·é»å°±æ˜¯ä½¿ç”¨ Azure Open AI ç”¨æˆ¶ï¼Œç©¶ç«Ÿæ‡‰è©²æ€éº¼è¨­å®š?<br>å¾<a href="https://github.com/search?q=repo:cline/cline+OpenAI+Compatible&type=issues">æ­¤è™•</a>å¯ä»¥çœ‹åˆ°å¾ˆå¤šäººçš„è¨è«–ã€‚<br>çœ‹ä¾†æœ‰å¾ˆå¤šäººä¹Ÿå¸¸å¸¸æ’ç‰†ï¼Œé›–ç„¶ç„¡æ³•å…¨é¢çš„æ¸¬è©¦ä¸€è¼ªï¼Œ<br>ä½†ä»¥ä¸‹æ˜¯æˆ‘å° Azure OpenAI æˆåŠŸçš„è¨­ç½®ï¼Œè¨˜éŒ„ä¸‹ä¾†ä½œç‚ºä»¥å¾Œåƒè€ƒç”¨</p><p>API Provider é¸æ“‡ <code>OpenAI Compatible</code><br>Base URL æˆ‘ç›´æ¥å¾ Azure AI Foundry ä¸Šå–å‡º:<br>åœ¨ <a href="https://portal.azure.com/">https://portal.azure.com/</a> æ‰¾åˆ° Azure AI services | Azure OpenAIï¼Œå†å‰å¾€  Azure AI Foundry Portal<br>æ­¤æ™‚ä½ æ‡‰è©²å¯ä»¥åœ¨ Deployments æ‰¾åˆ°ä½ çš„ Targe URIï¼Œé¡ä¼¼å¦‚ä¸‹<br><code>https://&#123;resourcename&#125;.openai.azure.com/openai/deployments/&#123;deployment_name&#125;/chat/completions?api-version=&#123;apiversion&#125;</code><br>API Key å°±ä¸ç”¨å¤šèªªäº†ï¼ŒAzure æœƒæä¾›ä½ å…©æŠŠé‡‘é‘°ï¼Œå¦‚æœæœ‰ç•°å¸¸æ™‚å¯ä»¥æ›¿æ›å®ƒå€‘ï¼Œ<br>Model ID å¯ä»¥åœ¨ deployments &gt; Model name é»æ“Šé€£çµå¾Œæ‰¾åˆ°ï¼Œæœƒé¡ä¼¼ä¸‹é¢é€™æ¨£  </p><p><code>azureml://registries/azure-openai/models/gpt-4o/versions/2024-11-20</code></p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://www.explainthis.io/zh-hant/ai/mcp">https://www.explainthis.io/zh-hant/ai/mcp</a></li><li><a href="https://cline.bot/">https://cline.bot/</a></li><li><a href="https://www.youtube.com/watch?v=McNRkd5CxFY">https://www.youtube.com/watch?v=McNRkd5CxFY</a></li><li><a href="https://modelcontextprotocol.io/quickstart/server">https://modelcontextprotocol.io/quickstart/server</a></li><li><a href="https://www.axtonliu.ai/newsletters/ai-2/posts/claude-mcp-protocol-guide">https://www.axtonliu.ai/newsletters/ai-2/posts/claude-mcp-protocol-guide</a></li></ul><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ç¨®å”è­°ï¼Œæœ€è¿‘ç¤¾ç¾¤å¾ˆå¤¯çš„æ±è¥¿ï¼Œ&lt;br&gt;æ‰€ä»¥ç¨å¾®ç ”ç©¶å®ƒä¸€ä¸‹ï¼Œä¸è«–å®ƒæ˜¯å¦</summary>
      
    
    
    
    
    <category term="å¯¦ä½œç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title> [å¯¦ä½œç­†è¨˜] è¸©é›· GCP Instance Schedules æ’ç¨‹é–‹é—œæ©Ÿ</title>
    <link href="https://blog.marsen.me/2025/02/24/2025/gcp-iam-and-instance-schedule/"/>
    <id>https://blog.marsen.me/2025/02/24/2025/gcp-iam-and-instance-schedule/</id>
    <published>2025-02-24T04:01:41.000Z</published>
    <updated>2025-08-27T14:25:35.438Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><p>å› ç‚ºå‘¨æœ«æ©Ÿå™¨é–’ç½®å¾ˆæµªè²»ï¼Œæƒ³é€éæ’ç¨‹ä¾†é–‹é—œæ©Ÿé”åˆ°ç¯€çœæˆæœ¬çš„æ•ˆæœã€‚<br>ä»¥ç‚ºè¨­å®šæ’ç¨‹é–‹é—œæ©Ÿé€™éº¼ç°¡å–®ï¼Œçµæœåœ¨æ“ä½œéç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€äº›è®“æˆ‘å·®é»æ‘”æ©Ÿçš„å•é¡Œã€‚<br>é€™ç¯‡å°±ä¾†è¨˜éŒ„ä¸€ä¸‹ï¼Œå¾è¨­å®šåˆ°è¸©é›·ï¼Œå†åˆ°å¦‚ä½•è§£æ±ºçš„éç¨‹ã€‚</p><h3 id="å¹¾å€‹ä½œæ³•"><a href="#å¹¾å€‹ä½œæ³•" class="headerlink" title="å¹¾å€‹ä½œæ³•"></a>å¹¾å€‹ä½œæ³•</h3><p>ä¸Šç¶²æ‰¾äº†ä¸€äº›ä½œæ³•ï¼Œå¾—åˆ°ä»¥ä¸‹çš„å»ºè­°<br>æœ€ç°¡å–®çš„æ–¹æ³•ï¼šä½¿ç”¨ Instance Schedules<br>è¼ƒéˆæ´»çš„æ–¹æ³•ï¼šä½¿ç”¨ Cloud Scheduler + Cloud Functions<br>åŸºç¤æ¶æ§‹ç®¡ç†ï¼šä½¿ç”¨ Terraform  </p><p>æˆ‘æ²’æœ‰è¤‡é›œçš„æƒ…å¢ƒï¼Œç•¶ç„¶é¸æœ€ç°¡å–®çš„<br>åªè¦åœ¨ GCP Console ä¸Šé¢æ“ä½œå³å¯ã€‚</p><h3 id="é‡åˆ°å•é¡Œ"><a href="#é‡åˆ°å•é¡Œ" class="headerlink" title="é‡åˆ°å•é¡Œ"></a>é‡åˆ°å•é¡Œ</h3><blockquote><p>Compute Engine System service account <a href="mailto:&#115;&#x65;&#x72;&#x76;&#105;&#x63;&#x65;&#45;&#x59;&#79;&#x55;&#x52;&#45;&#80;&#82;&#x4f;&#74;&#69;&#67;&#84;&#x2d;&#73;&#x44;&#x40;&#x63;&#x6f;&#x6d;&#112;&#117;&#x74;&#101;&#45;&#115;&#121;&#115;&#116;&#101;&#109;&#x2e;&#105;&#97;&#109;&#x2e;&#x67;&#x73;&#x65;&#114;&#118;&#x69;&#99;&#x65;&#97;&#99;&#x63;&#x6f;&#117;&#110;&#116;&#x2e;&#x63;&#x6f;&#x6d;">service-YOUR-PROJECT-ID@compute-system.iam.gserviceaccount.com</a><br>needs to have [compute.instances.start,compute.instances.stop] permissions applied in order to perform this operation.  </p></blockquote><p>è€Œä¸” Console IAM è£¡é¢çœ‹ä¸åˆ°é€™å€‹å¸³è™Ÿ <code>service-YOUR-PROJECT-ID@compute-system.iam.gserviceaccount.com</code><br>é¡ä¼¼çš„å¸³è™Ÿæœ‰<code>YOUR-PROJECT-ID-compute@developer.gserviceaccount.com</code>ä½†å…©è€…ä¸¦ä¸ç›¸åŒ</p><p>å¯¦éš›ä¸Šæ˜¯ GCP æœƒæœ‰ä¸€ç¾¤éš±è—å¸³è™Ÿ<br>æ¸…å–®å¦‚ä¸‹ï¼š<br>ğŸ“Œ Compute Engine â†’ <a href="mailto:&#115;&#x65;&#x72;&#118;&#105;&#99;&#x65;&#x2d;&#x59;&#79;&#x55;&#x52;&#95;&#x50;&#82;&#x4f;&#x4a;&#69;&#x43;&#x54;&#x5f;&#x4e;&#x55;&#x4d;&#66;&#69;&#x52;&#x40;&#x63;&#x6f;&#x6d;&#x70;&#x75;&#116;&#101;&#45;&#115;&#121;&#x73;&#x74;&#x65;&#109;&#46;&#x69;&#x61;&#109;&#46;&#103;&#115;&#101;&#x72;&#118;&#105;&#x63;&#x65;&#97;&#x63;&#x63;&#111;&#117;&#x6e;&#x74;&#46;&#99;&#x6f;&#x6d;">service-YOUR_PROJECT_NUMBER@compute-system.iam.gserviceaccount.com</a><br>ğŸ“Œ App Engine â†’ <a href="mailto:&#x59;&#x4f;&#x55;&#82;&#95;&#x50;&#82;&#x4f;&#x4a;&#69;&#x43;&#x54;&#x5f;&#x49;&#68;&#64;&#x61;&#112;&#x70;&#x73;&#112;&#x6f;&#116;&#46;&#103;&#115;&#x65;&#x72;&#x76;&#x69;&#99;&#101;&#97;&#99;&#x63;&#111;&#x75;&#x6e;&#116;&#x2e;&#x63;&#x6f;&#109;">YOUR_PROJECT_ID@appspot.gserviceaccount.com</a><br>ğŸ“Œ Cloud Run &#x2F; Functions â†’ <a href="mailto:&#89;&#79;&#x55;&#82;&#x5f;&#80;&#82;&#79;&#x4a;&#69;&#67;&#x54;&#95;&#x49;&#x44;&#x2d;&#x63;&#111;&#x6d;&#x70;&#x75;&#x74;&#101;&#x40;&#100;&#x65;&#118;&#101;&#108;&#x6f;&#112;&#101;&#x72;&#46;&#103;&#x73;&#101;&#x72;&#x76;&#x69;&#99;&#x65;&#x61;&#x63;&#99;&#x6f;&#117;&#110;&#x74;&#x2e;&#99;&#111;&#x6d;">YOUR_PROJECT_ID-compute@developer.gserviceaccount.com</a><br>ğŸ“Œ GKE â†’ <a href="mailto:&#115;&#101;&#114;&#x76;&#x69;&#x63;&#x65;&#45;&#89;&#79;&#85;&#82;&#x5f;&#x50;&#x52;&#79;&#x4a;&#x45;&#x43;&#84;&#x5f;&#78;&#x55;&#x4d;&#x42;&#69;&#82;&#64;&#99;&#111;&#x6e;&#x74;&#x61;&#105;&#x6e;&#101;&#114;&#45;&#x65;&#110;&#103;&#105;&#110;&#101;&#45;&#114;&#x6f;&#98;&#111;&#116;&#46;&#105;&#97;&#109;&#46;&#103;&#x73;&#101;&#114;&#118;&#105;&#99;&#101;&#97;&#x63;&#x63;&#x6f;&#117;&#x6e;&#116;&#46;&#99;&#x6f;&#109;">service-YOUR_PROJECT_NUMBER@container-engine-robot.iam.gserviceaccount.com</a><br>ğŸ“Œ Cloud Build â†’ <a href="mailto:&#115;&#101;&#114;&#118;&#x69;&#x63;&#x65;&#x2d;&#x59;&#x4f;&#x55;&#82;&#95;&#80;&#x52;&#79;&#x4a;&#x45;&#x43;&#x54;&#95;&#x4e;&#85;&#x4d;&#66;&#69;&#x52;&#64;&#103;&#99;&#x70;&#x2d;&#115;&#x61;&#45;&#x63;&#108;&#x6f;&#x75;&#x64;&#98;&#117;&#x69;&#108;&#x64;&#46;&#x69;&#97;&#109;&#46;&#x67;&#x73;&#101;&#114;&#118;&#105;&#99;&#x65;&#97;&#x63;&#99;&#x6f;&#117;&#110;&#x74;&#46;&#99;&#x6f;&#x6d;">service-YOUR_PROJECT_NUMBER@gcp-sa-cloudbuild.iam.gserviceaccount.com</a><br>ğŸ“Œ BigQuery â†’ <a href="mailto:&#x73;&#x65;&#114;&#x76;&#105;&#x63;&#101;&#45;&#89;&#x4f;&#85;&#82;&#95;&#x50;&#82;&#79;&#74;&#69;&#67;&#84;&#95;&#78;&#x55;&#77;&#x42;&#x45;&#82;&#x40;&#103;&#99;&#x70;&#45;&#x73;&#97;&#x2d;&#98;&#x69;&#103;&#x71;&#117;&#101;&#114;&#x79;&#x64;&#x61;&#x74;&#x61;&#116;&#114;&#x61;&#110;&#115;&#x66;&#x65;&#x72;&#46;&#105;&#x61;&#109;&#46;&#103;&#x73;&#101;&#114;&#x76;&#x69;&#99;&#x65;&#97;&#x63;&#99;&#111;&#117;&#x6e;&#x74;&#x2e;&#99;&#x6f;&#x6d;">service-YOUR_PROJECT_NUMBER@gcp-sa-bigquerydatatransfer.iam.gserviceaccount.com</a><br>ğŸ“Œ Firestore â†’ <a href="mailto:&#x73;&#x65;&#114;&#x76;&#105;&#99;&#x65;&#x2d;&#x59;&#x4f;&#x55;&#x52;&#x5f;&#x50;&#x52;&#x4f;&#74;&#69;&#67;&#84;&#95;&#78;&#x55;&#77;&#66;&#x45;&#x52;&#x40;&#x67;&#x63;&#112;&#45;&#115;&#x61;&#x2d;&#102;&#x69;&#x72;&#101;&#x73;&#x74;&#111;&#114;&#101;&#x2e;&#105;&#x61;&#109;&#46;&#103;&#115;&#x65;&#x72;&#118;&#x69;&#x63;&#101;&#97;&#x63;&#99;&#x6f;&#117;&#x6e;&#116;&#46;&#99;&#111;&#109;">service-YOUR_PROJECT_NUMBER@gcp-sa-firestore.iam.gserviceaccount.com</a></p><p>ğŸ” æŸ¥è©¢æ–¹å¼ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud projects get-iam-policy YOUR_PROJECT_ID --format=json | jq -r <span class="string">&#x27;.bindings[].members[]&#x27;</span> | grep <span class="string">&#x27;serviceAccount:&#x27;</span></span><br></pre></td></tr></table></figure><p>è§£æ³•ï¼ŒåŠ æ¬Šé™å°±å¥½ï¼Œåœ¨ Console ç›´æ¥åŠ <br>ä½†æ˜¯åœ¨ Console é‚„æ˜¯çœ‹ä¸åˆ°å¸³è™Ÿ, IAM&#x2F;Service Account&#x2F;Roles éƒ½çœ‹ä¸åˆ°</p><p>ä¸éæˆ‘å€‘å¯ä»¥ç”¨ CLI æŸ¥è©¢æ–¹å¼</p><h4 id="å…ˆç¢ºèªç›®å‰æ¬Šé™"><a href="#å…ˆç¢ºèªç›®å‰æ¬Šé™" class="headerlink" title="å…ˆç¢ºèªç›®å‰æ¬Šé™"></a>å…ˆç¢ºèªç›®å‰æ¬Šé™</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud projects get-iam-policy YOUR_PROJECT_ID --format=json | jq <span class="string">&#x27;.bindings[] | select(.members[] | contains(&quot;serviceAccount:ACCOUNT_TO_REMOVE&quot;))&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ç§»é™¤æŒ‡å®šè§’è‰²"><a href="#ç§»é™¤æŒ‡å®šè§’è‰²" class="headerlink" title="ç§»é™¤æŒ‡å®šè§’è‰²"></a>ç§»é™¤æŒ‡å®šè§’è‰²</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcloud projects remove-iam-policy-binding YOUR_PROJECT_ID \</span><br><span class="line">  --member=<span class="string">&quot;serviceAccount:ACCOUNT_TO_REMOVE&quot;</span> \</span><br><span class="line">  --role=<span class="string">&quot;roles/è¦ç§»é™¤çš„è§’è‰²&quot;</span></span><br></pre></td></tr></table></figure><p>âš ï¸ éœ€è¦ç¢ºä¿è©²è§’è‰²æ­£ç¢ºï¼Œå¦å‰‡å¯èƒ½æœƒå½±éŸ¿æœå‹™é‹è¡Œã€‚</p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>åŸæœ¬åªæ˜¯æƒ³é€éæ’ç¨‹ä¾†ç¯€çœæˆæœ¬ï¼Œçµæœé‡åˆ° GCP éš±è—å¸³è™Ÿçš„å•é¡Œï¼Œå°è‡´æ¬Šé™ç„¡æ³•æ­£å¸¸é…ç½®ã€‚<br>æœ€å¾Œé€é CLI æŸ¥è©¢ï¼Œæ‰‹å‹•è£œä¸Šå¿…è¦æ¬Šé™ï¼Œæ‰è®“ Instance Schedules é †åˆ©é‹ä½œã€‚</p><h3 id="é€™æ¬¡çŸ¥é“çš„äº‹"><a href="#é€™æ¬¡çŸ¥é“çš„äº‹" class="headerlink" title="é€™æ¬¡çŸ¥é“çš„äº‹"></a>é€™æ¬¡çŸ¥é“çš„äº‹</h3><p>Console ä¸ä¸€å®šèƒ½çœ‹åˆ°æ‰€æœ‰å¸³è™Ÿï¼ŒCLI æŸ¥è©¢æ›´å¯é ã€‚<br>GCP é è¨­æœ‰è¨±å¤šéš±è—å¸³è™Ÿï¼Œé‡åˆ°æ¬Šé™å•é¡Œæ™‚ï¼Œå…ˆç¢ºèª IAM policyã€‚<br>æ¬Šé™ç®¡ç†æ‡‰è©²ç²¾ç¢ºè¨­å®šï¼Œé¿å…ä¸å¿…è¦çš„é¢¨éšªã€‚<br>é‡åˆ°é¡ä¼¼å•é¡Œæ™‚ï¼Œå…ˆå¾ gcloud projects get-iam-policy ä¸‹æ‰‹ï¼Œèƒ½å°‘èµ°ä¸å°‘å½è·¯ã€‚</p><p>(fin)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;å› ç‚ºå‘¨æœ«æ©Ÿå™¨é–’ç½®å¾ˆæµªè²»ï¼Œæƒ³é€éæ’ç¨‹ä¾†é–‹é—œæ©Ÿé”åˆ°ç¯€çœæˆæœ¬çš„æ•ˆæœã€‚&lt;br&gt;ä»¥ç‚ºè¨­å®šæ’ç¨‹é–‹é—œæ©Ÿé€™éº¼ç°¡å–®ï¼Œçµæœåœ¨æ“ä½œéç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€</summary>
      
    
    
    
    
    <category term="å­¸ç¿’ç­†è¨˜" scheme="https://blog.marsen.me/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
</feed>
