<!DOCTYPE html>
<html>
<head>
  
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NTDGNJZ');</script>
<!-- End Google Tag Manager -->

  
<!-- Google Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RF47NNRE5G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RF47NNRE5G');
</script>
<!-- End Google Analytics -->

  
<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1885096025224905"
     crossorigin="anonymous"></script>
<!-- End Google AdSense -->



  <meta charset="utf-8">
  
  <title>Marsen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Marsen&#39;s Blog">
<meta property="og:url" content="https://blog.marsen.me/index.html">
<meta property="og:site_name" content="Marsen&#39;s Blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Marsen L.">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Marsen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
      
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
  
  
<link rel="stylesheet" href="/css/style.css">

  <meta property ="og:image" content="https://avatars1.githubusercontent.com/u/4269720?s=460&v=4" /> 
<meta name="generator" content="Hexo 8.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="blog-banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Marsen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle"></a>
          <div>
          <span style="width: 20px; height: 10px; background: linear-gradient(to bottom, #005BBB 50%, #FFD700 50%); text-align: center; color: white; font-size: 6px; font-weight: bold; line-height: 100px;">
            #StandWithUkraine
          </span>
          </div>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.marsen.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2025/sdd_spec_kit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/10/29/2025/sdd_spec_kit/" class="article-date">
  <time datetime="2025-10-29T05:06:15.000Z" itemprop="datePublished">2025-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/10/29/2025/sdd_spec_kit/">[學習筆記] SDD 與 Spec Kit - 前言</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>TL;DR</p>
<h2 id="簡介-SDD"><a href="#簡介-SDD" class="headerlink" title="簡介 SDD"></a>簡介 SDD</h2><blockquote>
<p>What is Spec-Driven Development?<br>  Spec-Driven Development flips the script on traditional software development.<br>  For decades, code has been king — specifications were just scaffolding we built and discarded once the “real work” of coding began<br>  Spec-Driven Development changes this: specifications become executable, directly generating working implementations rather than jus<br>  guiding them.  – spec-kit</p>
</blockquote>
<p>什麼是規格驅動開發 ???<br>跟過往的開放方式什麼不同???<br>什麼原因讓它興起 ???  </p>
<h2 id="傳統開發流程-1990之前"><a href="#傳統開發流程-1990之前" class="headerlink" title="傳統開發流程(1990之前)"></a>傳統開發流程(1990之前)</h2><p>回顧軟體開發的歷史，個人電腦時代到網路時代(1975~1990)</p>
<p>大部份是傳統的瀑布式開發（Waterfall）流程是這樣的：</p>
<p>像是接力賽跑一樣一棒接一棒。</p>
<h3 id="需求分析-→-系統設計-→-實作-→-測試-→-部署-→-維護"><a href="#需求分析-→-系統設計-→-實作-→-測試-→-部署-→-維護" class="headerlink" title="需求分析 → 系統設計 → 實作 → 測試 → 部署 → 維護"></a>需求分析 → 系統設計 → 實作 → 測試 → 部署 → 維護</h3><p>每個階段都有明確的交付物：</p>
<p>需求分析:產出需求規格書（SRS），對應的角色會有 PM(產品或專案經理)</p>
<p>系統設計:產出設計文件（HLD&#x2F;LLD），對應的角色會有 SA&#x2F;SD(系統架構師&#x2F;系統設計師)</p>
<p>實作階段:產出程式碼，對應的角色會有 RD(工程師)</p>
<p>測試階段:產出測試報告，對應的角色會有 QA(測試工程師)</p>
<p>這個流程有幾個特點：</p>
<p>線性且不可逆 - 每個階段必須完成才能進入下一階段，很難回頭修改</p>
<p>文件導向 - 大量的文件作為階段間的交接依據</p>
<p>後期才見成果 - 要等到實作階段完成，才能看到實際的軟體</p>
<p>變更成本高 - 越晚發現問題，修改成本越高</p>
<p>在這個模式下，規格文件的角色是契約和藍圖。團隊花費大量時間撰寫詳細的規格，試圖在開始編碼前就想清楚所有細節。</p>
<p>但實務上，這些文件往往：</p>
<ul>
<li>寫完就過時，因為需求會變</li>
<li>與實作脫節，因為開發時會發現新問題</li>
<li>成為負擔，因為要花時間維護卻沒人看</li>
</ul>
<h2 id="敏捷開發流程-1990-至今"><a href="#敏捷開發流程-1990-至今" class="headerlink" title="敏捷開發流程(1990~至今)"></a>敏捷開發流程(1990~至今)</h2><p>敏捷開發（Agile）的出現，是對瀑布式開發的反思。它強調：</p>
<ul>
<li>個人與互動 &gt; 流程與工具</li>
<li>可用的軟體 &gt; 詳盡的文件</li>
<li>客戶合作 &gt; 合約協商</li>
<li>回應變化 &gt; 遵循計劃</li>
</ul>
<p>敏捷的典型流程（以 Scrum 為例）：</p>
<h3 id="Product-Backlog-→-Sprint-Planning-→-Daily-Standup-→-Sprint-Review-→-Sprint-Retrospective"><a href="#Product-Backlog-→-Sprint-Planning-→-Daily-Standup-→-Sprint-Review-→-Sprint-Retrospective" class="headerlink" title="Product Backlog → Sprint Planning → Daily Standup → Sprint Review → Sprint Retrospective"></a>Product Backlog → Sprint Planning → Daily Standup → Sprint Review → Sprint Retrospective</h3><p>這是一個迭代循環，每個 Sprint（通常 2-4 週）都會產出可用的軟體增量。</p>
<ul>
<li>Product Backlog: 對齊高層期望，主要角色 Stackholder&#x2F;Product Owner</li>
<li>Sprint Planning: 對齊實作時程與方式，主要角色 Product Owner&#x2F;Team</li>
<li>Daily Standup: 對齊每日進度，全角色參與</li>
<li>Sprint Review: 對齊結果，全角色參與</li>
<li>Sprint Retrospective: 對齊改善，全角色參與</li>
</ul>
<h3 id="雖然實施部分的Scrum-是可能的，但結果就不是Scrum-了"><a href="#雖然實施部分的Scrum-是可能的，但結果就不是Scrum-了" class="headerlink" title="雖然實施部分的Scrum 是可能的，但結果就不是Scrum 了"></a>雖然實施部分的Scrum 是可能的，但結果就不是Scrum 了</h3><p>敏捷的特點：</p>
<ul>
<li>迭代且增量 - 小步快跑，頻繁交付</li>
<li>溝通導向 - 強調面對面溝通勝過文件</li>
<li>早期且持續交付 - 每個 Sprint 都有可展示的成果</li>
<li>擁抱變化 - 將變更視為常態而非例外</li>
</ul>
<p>在敏捷模式下，規格文件的角色變成了溝通工具和備忘錄。  </p>
<p>User Story、Acceptance Criteria 這些輕量級的規格，主要是為了確保團隊理解一致。</p>
<p>程式碼本身成為了真相的來源 - “Code is the truth”。</p>
<p>在迭代過後，這些文件不再有意義。</p>
<p>這解決了瀑布式的一些問題，但也帶來新的挑戰：</p>
<ul>
<li>知識容易流失（口頭溝通沒有記錄，使用團隊記憶）</li>
<li>技術債累積（快速迭代可能犧牲品質）</li>
<li>規格與實作的差距依然存在</li>
<li>實際上團隊&#x2F;文化等因素，在跑的只是 Scurm-but&#x2F;小瀑布&#x2F;隕石</li>
<li>商業化的行為已經扭曲原意，甚至作為 KOL 老王賣瓜的神主牌 (看看”敏捷社群”)</li>
<li>在大型產品&#x2F;專案仍然不足夠，因而衍生 SAFe&#x2F;LeSS 等方法論</li>
<li>淪為表面功夫</li>
</ul>
<h2 id="隕石開發流程-Alpha-Omega"><a href="#隕石開發流程-Alpha-Omega" class="headerlink" title="隕石開發流程(Alpha~Omega)"></a>隕石開發流程(Alpha~Omega)</h2><p>典型流程</p>
<h3 id="Ideation-→-Prototype-→-All-in-Sprint-→-Crash-Delivery-→-Postmortem"><a href="#Ideation-→-Prototype-→-All-in-Sprint-→-Crash-Delivery-→-Postmortem" class="headerlink" title="Ideation → Prototype → All-in Sprint → Crash Delivery → Postmortem"></a>Ideation → Prototype → All-in Sprint → Crash Delivery → Postmortem</h3><ul>
<li>Ideation：靈感一來就開幹，需求模糊。</li>
<li>Prototype：原型被誤當產品，直接上線。</li>
<li>All-in Sprint：團隊燃燒工時與理智，一次衝到底。</li>
<li>Crash Delivery：產品墜市，問題一齊爆發。</li>
<li>Postmortem：事後檢討變成例行公祭。</li>
</ul>
<h3 id="特點與本質"><a href="#特點與本質" class="headerlink" title="特點與本質"></a>特點與本質</h3><p>高壓短命、方向即興、溝通崩壞、文件失效、驗收模糊。<br>看似混亂，其實是一種生存策略(實用主義)：</p>
<ul>
<li>PM 可保命：有 Demo、有交付，能交差。</li>
<li>行銷能吹噓：原型當 MVP，上媒體先贏聲量。</li>
<li>市場能行（騙）銷：先開賣、後補齊。</li>
<li>老闆能交代：有成果、有故事，股東就安心。</li>
<li>RD 隨便作，洗個經驗跳糟加薪比較快</li>
</ul>
<p>隕石開發不是技術問題，而是組織文化的選擇。</p>
<h2 id="這些流程的異同、優劣與困境"><a href="#這些流程的異同、優劣與困境" class="headerlink" title="這些流程的異同、優劣與困境"></a>這些流程的異同、優劣與困境</h2><p>瀑布、敏捷與隕石開發的差別，反映的是組織文化與生存策略。</p>
<p>瀑布式重規劃與控制，適合穩定需求與高風險專案，但變更成本高、回饋慢。</p>
<p>敏捷式重回饋與溝通，能快速交付並擁抱變化。</p>
<p>隕石式則靠爆發力求生存，短期有成效，不考慮長期品質與維運。</p>
<p>我的看法是新創成長到高原期時，就會從隕石走而敏捷，再大規模就會考慮瀑布&#x2F;LeSS&#x2F;SAFe，</p>
<p>而市場大部份都是中小企業，真的能成長成巨人者(amazon&#x2F;spotify&#x2F;netfilx)，</p>
<p>一定有它的原因，開發流程應該隨著公司業務成長，形成自已的文化，沒有一定的好壞，也不是可以輕易模仿的。</p>
<h2 id="工程師的自我要求"><a href="#工程師的自我要求" class="headerlink" title="工程師的自我要求"></a>工程師的自我要求</h2><p>我個人是傾向 XP 的開發模式，但是它的缺點是學習門檻高，  </p>
<p>對面試沒幫助，更多的公司寧願你寫白板題或刷 LeetCode。</p>
<p>團隊不願意投入，相關的 TDD&#x2F;ATDD&#x2F;BDD 或是測試左移更難導入小團隊之中。</p>
<p>高層如果沒有技術能力，無法識別好壞，就容易被唬弄，導致需求與實作有落差</p>
<h2 id="AI-SDD-流程-2024-未來"><a href="#AI-SDD-流程-2024-未來" class="headerlink" title="AI SDD 流程(2024~未來?)"></a>AI SDD 流程(2024~未來?)</h2><p>AI Agent 或 SDD 出現後能不能帶來改變?</p>
<p>或是可以帶來什麼幫助呢?</p>
<p>對工程師而言</p>
<ul>
<li>內建 TDD，但是工程師仍要學習其觀念</li>
<li>降低學習門檻，可以用更 Clean 的方式實作代碼</li>
<li>全權委託，但是工程師要對架構負責(變得更像 SA ?)</li>
<li>淘汰劣質工程師，ex 轉職班、就業班、刷題仔，但是有的很會行銷自已，會被唬弄過去</li>
</ul>
<p>對產品而言</p>
<ul>
<li>可以縮短想法到實作的距離</li>
<li>保持一定的品質，特別是你的工程師都是來自x成、x匠時…</li>
<li>自已開發，更高的回饋</li>
</ul>
<p>問題，認知的差距，人只能賺到自已認知能力內的錢</p>
<p>之前有一個網紅行銷使用 Agent 開發賣課，犯了最低級的錯誤</p>
<p>這是因為他缺乏資安的認知; 所以原本不是開發的人員會需要快速的學習相關的知識(但是 AI 可以將門檻降低)</p>
<p>另外一些反思，那種工程師看不上眼的程式(普遍社群上的工程師都在嘲諷)，</p>
<p>人家已經拿來行銷賣錢，或許工程師應該反向思考怎麼朝行銷&#x2F;產品靠攏</p>
<p>也或許這個低級錯誤也是行銷手段的一環?</p>
<p>接下來， 我將會用一系列的文章來試作 SDD 並分享我的看法</p>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://eiki.hatenablog.jp/entry/meteo_fall">隕石開發流程</a></li>
<li><a target="_blank" rel="noopener" href="https://bclin.tw/2018/06/01/meteo-fall/">隕石開發流程-中文版</a></li>
<li><a target="_blank" rel="noopener" href="https://martinfowler.com/articles/agile-aus-2018.html">Martin Fowler 澳洲演講筆記-變質的敏捷，回歸初衷。</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.cleancoder.com/uncle-bob/2018/08/28/CraftsmanshipMovement.html">軟體工匠的悲歌 The Tragedy of Craftsmanship.</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/10/29/2025/sdd_spec_kit/" data-id="cuid6CtnF4BSs1WWGBbEI6O0P" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/10/29/2025/sdd_spec_kit/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/" rel="tag">學習筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/ai-refactor-rule-apply-dp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/09/17/2025/ai-refactor-rule-apply-dp/" class="article-date">
  <time datetime="2025-09-17T08:53:43.000Z" itemprop="datePublished">2025-09-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/09/17/2025/ai-refactor-rule-apply-dp/"> [實作筆記] 命令式程式碼重構到函數式 Pipe 流水線</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近有位小朋友在進行中文轉換規則的開發時，遇到了一些典型的程式碼異味。</p>
<p>這些異味提示著我們需要重構，你可以先挑戰看一下有沒有辦法識別。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重構前的程式碼</span></span><br><span class="line"><span class="title function_">apply</span>(<span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> protectedChars = [<span class="string">&#x27;台&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 1. 標記階段</span></span><br><span class="line">  <span class="keyword">let</span> protectedText = text</span><br><span class="line">  protectedChars.<span class="title function_">forEach</span>(<span class="function">(<span class="params">char</span>) =&gt;</span> &#123;</span><br><span class="line">    protectedText = protectedText.<span class="title function_">replaceAll</span>(char, <span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;char&#125;</span>&gt;&gt;&gt;`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 轉換階段</span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="title function_">baseConverter</span>(protectedText)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 還原階段</span></span><br><span class="line">  protectedChars.<span class="title function_">forEach</span>(<span class="function">(<span class="params">char</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> convertedChar = <span class="variable language_">this</span>.<span class="title function_">baseConverter</span>(char)</span><br><span class="line">    result = result.<span class="title function_">replaceAll</span>(<span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;convertedChar&#125;</span>&gt;&gt;&gt;`</span>, char)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 自訂轉換</span></span><br><span class="line">  result = <span class="variable language_">this</span>.<span class="title function_">customConverter</span>(result)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這篇文章記錄重構的過程，讓程式碼變得更加簡潔和易讀。</p>
<p>當然，這只是其中一種可能的重構方式，可能有別的解法，或是單純的接受它。</p>
<h2 id="壞味道"><a href="#壞味道" class="headerlink" title="壞味道"></a>壞味道</h2><p>原始的 <code>ChineseConversionRule</code> 中的 <code>apply</code> 方法存在以下問題：</p>
<ol>
<li><strong>過多中間變數</strong>：<code>text</code> → <code>protectedText</code> → <code>result</code></li>
<li><strong>命令式寫法</strong>：透過變數重新賦值來處理資料流</li>
<li><strong>邏輯分散</strong>：標記保護字符和還原的邏輯內嵌在主方法中</li>
</ol>
<p>過多的中間變數和命令式的寫法讓程式碼顯得冗長且不夠優雅。</p>
<p>protectedText、result、text　都是。</p>
<p>這裡的挑戰是要對原始的字串加工</p>
<p>在不破壞原本邏輯的情況下，保留擴充的彈性，並保持程式結構清晰、可維護。</p>
<p>可能有很多模式可以解決(Decorator &#x2F; Template Method &#x2F; Pipeline)</p>
<p>小朋友寫得也不差了，我們來試著讓它更好</p>
<h2 id="重構過程"><a href="#重構過程" class="headerlink" title="重構過程"></a>重構過程</h2><h3 id="階段一：消除中間變數"><a href="#階段一：消除中間變數" class="headerlink" title="階段一：消除中間變數"></a>階段一：消除中間變數</h3><p>第一步是消除不必要的中間變數，直接在同一個變數上操作：</p>
<p>可以看到修改後，只有 text 一個變數，還是傳入了的</p>
<p>越少變數，越不用花心思思考命名，減少認知負擔，而本質上這些冗餘的變數的確是同質可以刪除的</p>
<p>這是一種隱性的重複壞味道。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">apply</span>(<span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> protectedChars = [<span class="string">&#x27;台&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 直接操作 text 變數，消除 protectedText 和 result</span></span><br><span class="line">  protectedChars.<span class="title function_">forEach</span>(<span class="function">(<span class="params">char</span>) =&gt;</span> &#123;</span><br><span class="line">    text = text.<span class="title function_">replaceAll</span>(char, <span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;char&#125;</span>&gt;&gt;&gt;`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  text = <span class="variable language_">this</span>.<span class="title function_">baseConverter</span>(text)</span><br><span class="line"></span><br><span class="line">  protectedChars.<span class="title function_">forEach</span>(<span class="function">(<span class="params">char</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> convertedChar = <span class="variable language_">this</span>.<span class="title function_">baseConverter</span>(char)</span><br><span class="line">    text = text.<span class="title function_">replaceAll</span>(<span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;convertedChar&#125;</span>&gt;&gt;&gt;`</span>, char)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">customConverter</span>(text)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="階段二：引入-Functional-Programming"><a href="#階段二：引入-Functional-Programming" class="headerlink" title="階段二：引入 Functional Programming"></a>階段二：引入 Functional Programming</h3><p>接下來導入函數式程式設計的概念，使用 pipe 模式來處理資料流：</p>
<p>這裡要先看懂 <code>pipe</code>，簡單理解它把一個初始值依序丟進多個函數，前一個輸出就是下一個的輸入。</p>
<p>可以看到一些明顯的壞味道，<strong>重複的 protectedChars</strong>，1 跟 3 本身是匿名函數，讀起來也沒那麼好理解，</p>
<p>這是重構必經之路，我們再往下走</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">apply</span>(<span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> protectedChars = [<span class="string">&#x27;台&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">pipe</span>(</span><br><span class="line">    text,</span><br><span class="line">    <span class="comment">// 1. 標記階段：將需要保護的字符標記為不轉換</span></span><br><span class="line">    <span class="function">(<span class="params">input</span>) =&gt;</span> protectedChars.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, char</span>) =&gt;</span></span><br><span class="line">      acc.<span class="title function_">replaceAll</span>(char, <span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;char&#125;</span>&gt;&gt;&gt;`</span>), input),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 轉換階段：使用 OpenCC 進行轉換</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseConverter</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 還原階段：將標記的字符還原為原始字符</span></span><br><span class="line">    <span class="function">(<span class="params">input</span>) =&gt;</span> protectedChars.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, char</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> convertedChar = <span class="variable language_">this</span>.<span class="title function_">baseConverter</span>(char)</span><br><span class="line">      <span class="keyword">return</span> acc.<span class="title function_">replaceAll</span>(<span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;convertedChar&#125;</span>&gt;&gt;&gt;`</span>, char)</span><br><span class="line">    &#125;, input),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 使用自訂轉換器進行模糊字詞的修正</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">customConverter</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自製的 pipe 函數</span></span><br><span class="line"><span class="keyword">private</span> pipe&lt;T&gt;(<span class="attr">value</span>: T, ...<span class="attr">fns</span>: <span class="title class_">Array</span>&lt;<span class="function">(<span class="params">arg: T</span>) =&gt;</span> T&gt;): T &#123;</span><br><span class="line">  <span class="keyword">return</span> fns.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, fn</span>) =&gt;</span> <span class="title function_">fn</span>(acc), value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="階段三：職責分離"><a href="#階段三：職責分離" class="headerlink" title="階段三：職責分離"></a>階段三：職責分離</h3><p>將標記和還原邏輯抽取成獨立的私有方法：</p>
<p>將重複出現的 <code>protectedChars</code> 提升為類別屬性：</p>
<p>也不需要把匿名函數寫一坨在 pipe 裡面，這時要煩惱的只有方法的名字要怎麼才達意</p>
<p>但至少我們還有註解。</p>
<p>更進一步可以簡化方法內的參數名，因為 scope 很小，不會有認知負擔</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChineseConversionRule</span> <span class="keyword">implements</span> <span class="title class_">IRule</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">baseConverter</span>: <span class="title class_">ConvertText</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">customConverter</span>: <span class="title class_">ConvertText</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> protectedChars = [<span class="string">&#x27;台&#x27;</span>]  <span class="comment">// 統一管理</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... constructor</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">apply</span>(<span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">pipe</span>(</span><br><span class="line">    text,</span><br><span class="line">    <span class="comment">// 1. 標記階段：將需要保護的字符標記為不轉換</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">markProtectedChars</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 轉換階段：使用 OpenCC 進行轉換</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseConverter</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 還原階段：將標記的字符還原為原始字符</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">restoreProtectedChars</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 使用自訂轉換器進行模糊字詞的修正</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">customConverter</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 標記需要保護的字符</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> markProtectedChars = (<span class="attr">input</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">protectedChars</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, c</span>) =&gt;</span> acc.<span class="title function_">replaceAll</span>(c, <span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;c&#125;</span>&gt;&gt;&gt;`</span>), input)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 還原被標記的保護字符</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> restoreProtectedChars = (<span class="attr">input</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">protectedChars</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, c</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> convertedChar = <span class="variable language_">this</span>.<span class="title function_">baseConverter</span>(c) <span class="comment">// 例如：&#x27;台&#x27; -&gt; &#x27;臺&#x27;</span></span><br><span class="line">      <span class="keyword">return</span> acc.<span class="title function_">replaceAll</span>(<span class="string">`&lt;&lt;&lt;<span class="subst">$&#123;convertedChar&#125;</span>&gt;&gt;&gt;`</span>, c)</span><br><span class="line">    &#125;, input)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="重構成果"><a href="#重構成果" class="headerlink" title="重構成果"></a>重構成果</h2><ol>
<li><strong>簡潔性</strong>：主方法從 20 行縮減到 8 行</li>
<li><strong>可讀性</strong>：資料流向清晰，從上到下一目了然</li>
<li><strong>可測試性</strong>：每個步驟都是純函數，可以獨立測試</li>
<li><strong>可維護性</strong>：職責分離，邏輯集中管理</li>
<li><strong>函數式</strong>：無副作用，符合 FP 原則</li>
</ol>
<h3 id="效能考量"><a href="#效能考量" class="headerlink" title="效能考量"></a>效能考量</h3><ul>
<li>測試結果顯示功能完全正常，262 個測試案例全數通過，這是個大前提，沒有測試沒有重構</li>
<li>重構過程中沒有改變演算法複雜度</li>
<li>Pipe 函數本身的開銷微乎其微</li>
</ul>
<h2 id="關於-Pipe-的選擇"><a href="#關於-Pipe-的選擇" class="headerlink" title="關於 Pipe 的選擇"></a>關於 Pipe 的選擇</h2><p>在重構過程中考慮過使用現成的函式庫：</p>
<ul>
<li><strong>Ramda</strong>：功能最完整的 FP 函式庫</li>
<li><strong>Lodash&#x2F;fp</strong>：輕量級選擇</li>
<li><strong>fp-ts</strong>：型別安全的 FP 函式庫</li>
</ul>
<p>最終選擇自製 pipe 函數的理由：</p>
<p>兩行程式碼，沒有多餘依賴，寫法完全貼合專案需求。</p>
<p>團隊看了就能用，不用再去學新的函式庫。</p>
<p>邏輯也很單純，後續維護起來相對輕鬆。</p>
<p>除非更大範圍的重複發生，不然不需要額外引用套件突增學習成本</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> pipe&lt;T&gt;(<span class="attr">value</span>: T, ...<span class="attr">fns</span>: <span class="title class_">Array</span>&lt;<span class="function">(<span class="params">arg: T</span>) =&gt;</span> T&gt;): T &#123;</span><br><span class="line">  <span class="keyword">return</span> fns.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, fn</span>) =&gt;</span> <span class="title function_">fn</span>(acc), value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RD-反饋"><a href="#RD-反饋" class="headerlink" title="RD 反饋"></a>RD 反饋</h2><p>這次重構讓我深刻體會到函數式程式設計的優雅之處：</p>
<ol>
<li><strong>資料即流水線</strong>：透過 pipe 讓資料在各個函數間流動</li>
<li><strong>純函數的威力</strong>：每個步驟都可預測、可測試</li>
<li><strong>組合勝過繼承</strong>：透過函數組合建構複雜邏輯</li>
<li><strong>漸進式重構</strong>：一步步改善，降低風險</li>
</ol>
<p>從命令式到函數式的重構不僅讓程式碼變得更優雅，也提升了整體的可維護性。</p>
<p>雖然函數式程式設計有一定的學習曲線，但一旦掌握了基本概念，就能寫出更簡潔、更易懂的程式碼。</p>
<p>重構的關鍵在於：<strong>小步快跑，持續改善</strong>。每一次小的改進都讓程式碼朝著更好的方向發展，這正是軟體工藝精神的體現。</p>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>嗯，小朋友很會用 AI 寫作文呢。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/09/17/2025/ai-refactor-rule-apply-dp/" data-id="cuideWdlhaXLDy-RAXP4XxFoK" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/09/17/2025/ai-refactor-rule-apply-dp/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/clean-architecture-avoid-type-hell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/09/11/2025/clean-architecture-avoid-type-hell/" class="article-date">
  <time datetime="2025-09-11T07:23:42.000Z" itemprop="datePublished">2025-09-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/09/11/2025/clean-architecture-avoid-type-hell/"> [實作筆記] Clean Architecture 思考：避免過度設計</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在實作強型別語言，經常會遇到一些僅次於命名的問題：</p>
<p>到底要建立多少層級的 DTO&#x2F;型別？</p>
<p>什麼時候該抽象，什麼時候該保持簡單？</p>
<p>這篇文章記錄一個前端要求帶來的反思，如何在「架構純粹性」與「實用主義」之間找到平衡點？</p>
<h2 id="問題場景"><a href="#問題場景" class="headerlink" title="問題場景"></a>問題場景</h2><p>系統架構為 TypeScript 並實作 Clean Architecture。</p>
<p>我們有一個比對系統，Domain Entity 中的 <code>statusCode</code> 定義為 <code>string | null</code>，</p>
<p>但前端要求 API 必須回傳 <code>string</code> 型別，允許空字串而不處理 null。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Domain Entity</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Comparison</span> &#123;</span><br><span class="line">  <span class="attr">statusCode</span>: <span class="built_in">string</span> | <span class="literal">null</span>  <span class="comment">// 業務邏輯：可能為空</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前端期望的 API 回應</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;statusCode&quot;</span>: <span class="string">&quot;&quot;</span>  <span class="comment">// 必須是 string，不能是 null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解決方案演進"><a href="#解決方案演進" class="headerlink" title="解決方案演進"></a>解決方案演進</h2><h3 id="第一版：UseCase-層建立完整-DTO"><a href="#第一版：UseCase-層建立完整-DTO" class="headerlink" title="第一版：UseCase 層建立完整 DTO"></a>第一版：UseCase 層建立完整 DTO</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立回應 DTO</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ComparisonResponseDTO</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">statusCode</span>: <span class="built_in">string</span>  <span class="comment">// 轉換為 string</span></span><br><span class="line">  <span class="comment">// ... 其他欄位</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立 UseCase 回應型別</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">GetComparisonListResDTO</span> = <span class="title class_">IDataAndCount</span>&lt;<span class="title class_">ComparisonResponseDTO</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UseCase 中處理轉換</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">toResponseDTO</span>(<span class="attr">comparison</span>: <span class="title class_">Comparison</span>): <span class="title class_">ComparisonResponseDTO</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">statusCode</span>: comparison.<span class="property">statusCode</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起來很「Clean Architecture」，但真的有必要嗎？</p>
<p>關鍵觀點，有沒有可能過度設計了？</p>
<h3 id="最終方案：Controller-邊界處理"><a href="#最終方案：Controller-邊界處理" class="headerlink" title="最終方案：Controller 邊界處理"></a>最終方案：Controller 邊界處理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller 直接處理轉換</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getComparisonList</span>(<span class="attr">req</span>: <span class="title class_">Request</span>, <span class="attr">res</span>: <span class="title class_">Response</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, count &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">getComparisonListUseCase</span>.<span class="title function_">execute</span>(input)</span><br><span class="line">  </span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: data.<span class="title function_">map</span>(<span class="function"><span class="params">comparison</span> =&gt;</span> (&#123;</span><br><span class="line">      ...comparison,</span><br><span class="line">      <span class="attr">statusCode</span>: comparison.<span class="property">statusCode</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;)),</span><br><span class="line">    pagination</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="避免型別地獄的原則"><a href="#避免型別地獄的原則" class="headerlink" title="避免型別地獄的原則"></a>避免型別地獄的原則</h2><h3 id="1-YAGNI-原則-You-Aren’t-Gonna-Need-It"><a href="#1-YAGNI-原則-You-Aren’t-Gonna-Need-It" class="headerlink" title="1. YAGNI 原則 (You Aren’t Gonna Need It)"></a>1. YAGNI 原則 (You Aren’t Gonna Need It)</h3><p>不要為了「完整性」而建立無意義的型別包裝</p>
<p>或是建立過多的 Mapper 類別</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 過度抽象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">GetComparisonListResDTO</span> = <span class="title class_">IDataAndCount</span>&lt;<span class="title class_">ComparisonResponseDTO</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 直接使用泛型</span></span><br><span class="line"><span class="title class_">IUseCase</span>&lt;<span class="title class_">GetComparisonListReqDTO</span>, <span class="title class_">IDataAndCount</span>&lt;<span class="title class_">ComparisonResponseDTO</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-什麼時候需要抽象化？"><a href="#2-什麼時候需要抽象化？" class="headerlink" title="2. 什麼時候需要抽象化？"></a>2. 什麼時候需要抽象化？</h3><p>我的判斷，重複的時候，例如，當 2 個以上的 API 需要相同的型別時，才考慮抽象</p>
<p>也不排除可以能轉換極度複雜，這時有一個 Mapper 的導入反而可以減輕負擔時才導入。</p>
<p>架構／Design Pattern 應該服務 RD 而不是折摩 RD</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果只有一個 API 使用，直接 inline</span></span><br><span class="line">data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123; ...item, <span class="attr">statusCode</span>: item.<span class="property">statusCode</span> || <span class="string">&#x27;&#x27;</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果多個 API 都需要，才建立共用函數或型別</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">transformComparison</span> = (<span class="params">item: Comparison</span>) =&gt; (&#123;</span><br><span class="line">  ...item,</span><br><span class="line">  <span class="attr">statusCode</span>: item.<span class="property">statusCode</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-複雜度評估"><a href="#3-複雜度評估" class="headerlink" title="3. 複雜度評估"></a>3. 複雜度評估</h3><p>簡單的轉換邏輯不需要額外抽象：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 簡單轉換，直接處理</span></span><br><span class="line"><span class="attr">statusCode</span>: comparison.<span class="property">statusCode</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 為簡單邏輯建立複雜抽象</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">transformStatusCode</span>(<span class="attr">statusCode</span>: <span class="built_in">string</span> | <span class="literal">null</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> statusCode || <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="實用主義-vs-理論完美"><a href="#實用主義-vs-理論完美" class="headerlink" title="實用主義 vs 理論完美"></a>實用主義 vs 理論完美</h2><h3 id="現代-TypeScript-最佳實踐"><a href="#現代-TypeScript-最佳實踐" class="headerlink" title="現代 TypeScript 最佳實踐"></a>現代 TypeScript 最佳實踐</h3><ol>
<li><strong>直接使用泛型</strong> - 避免不必要的 type alias</li>
<li><strong>減少型別層級</strong> - 除非有明確的業務意義</li>
<li><strong>保持簡潔</strong> - 不為了「完整性」而建立無意義的包裝</li>
</ol>
<h3 id="架構決策的平衡點"><a href="#架構決策的平衡點" class="headerlink" title="架構決策的平衡點"></a>架構決策的平衡點</h3><table>
<thead>
<tr>
<th>考量因素</th>
<th>過度設計</th>
<th>適度設計</th>
<th>設計不足</th>
</tr>
</thead>
<tbody><tr>
<td>型別數量</td>
<td>為每個 UseCase 建專屬 DTO</td>
<td>共用 + 泛型</td>
<td>沒有型別安全</td>
</tr>
<tr>
<td>轉換位置</td>
<td>每層都轉換</td>
<td>邊界處理</td>
<td>隨意放置</td>
</tr>
<tr>
<td>複雜度</td>
<td>型別地獄</td>
<td>恰到好處</td>
<td>難以維護</td>
</tr>
</tbody></table>
<h2 id="進階判斷：何時需要抽象，何時保持簡單？"><a href="#進階判斷：何時需要抽象，何時保持簡單？" class="headerlink" title="進階判斷：何時需要抽象，何時保持簡單？"></a>進階判斷：何時需要抽象，何時保持簡單？</h2><table>
<thead>
<tr>
<th>判斷角度</th>
<th>適合抽象化的情境</th>
<th>適合保持簡單的情境</th>
</tr>
</thead>
<tbody><tr>
<td><strong>使用頻率</strong></td>
<td>多個 UseCase 或 API 重複出現 → 建立共用型別&#x2F;函數</td>
<td>僅在單一 Controller 出現一次 → inline 即可</td>
</tr>
<tr>
<td><strong>業務語意</strong></td>
<td>欄位轉換具有業務意義（例：狀態機的一環） → 抽象進 Domain&#x2F;UseCase</td>
<td>純展示需求（例：<code>null → &quot;&quot;</code>） → 邊界層處理</td>
</tr>
<tr>
<td><strong>團隊規模與可讀性</strong></td>
<td>大團隊、專案壽命長 → 適度抽象，降低未來重構風險</td>
<td>小團隊、短期專案 → 保持簡單，降低溝通成本</td>
</tr>
<tr>
<td><strong>錯誤影響範圍</strong></td>
<td>錯誤會影響商業邏輯（例：金額精度） → 上升到 UseCase&#x2F;Domain</td>
<td>只影響 API 輸出表現（例：空字串 vs. null） → Controller 處理</td>
</tr>
<tr>
<td><strong>演進空間</strong></td>
<td>需求可能持續變化（欄位規則增多&#x2F;不同前端需求） → 抽象留彈性</td>
<td>需求相對穩定 → inline 保持簡潔</td>
</tr>
</tbody></table>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>Clean Architecture 的精神是<strong>將商業邏輯集中在核心，邊界負責格式適配</strong>。</p>
<p>不要被「層級完整性」綁架，重點是：</p>
<ol>
<li><strong>Domain 保持純粹</strong> - 反映真實的業務狀態</li>
<li><strong>UseCase 專注邏輯</strong> - 編排業務流程，不處理格式</li>
<li><strong>Controller 處理邊界</strong> - HTTP 格式轉換在此進行</li>
<li><strong>實用主義優先</strong> - 簡單的需求用簡單的方法</li>
</ol>
<p>記住：<strong>改動越少越好，沒有必要就不要建一大堆型別</strong>。</p>
<p>架構是為了解決問題，不是為了展示理論知識。當實用主義與理論衝突時，選擇能讓團隊更有生產力的方案。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/09/11/2025/clean-architecture-avoid-type-hell/" data-id="cuid8BIsQAsRnw5XUGv4JmQdH" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/09/11/2025/clean-architecture-avoid-type-hell/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/ai-hf-open-model-upload" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/09/05/2025/ai-hf-open-model-upload/" class="article-date">
  <time datetime="2025-09-05T09:43:51.000Z" itemprop="datePublished">2025-09-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/09/05/2025/ai-hf-open-model-upload/"> [實作筆記] PaddleOCR ONNX 模型發布到 Hugging Face Hub</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>專案需要使用 PaddleOCR 進行文字辨識，但原始模型檔案需要從 PaddlePaddle 框架轉換成 ONNX 格式才能在不同環境中使用。</p>
<p>轉換完成後，面臨一個選擇：這些模型檔案要怎麼發布？放在專案內部？還是公開分享？</p>
<p>經過一番討論，決定將轉換後的 ONNX 模型公開發布到 Hugging Face Hub，一方面解決內部使用需求，另一方面也讓社群受益。</p>
<p>這篇記錄整個發布流程的實作過程與踩雷經驗。</p>
<h2 id="目標"><a href="#目標" class="headerlink" title="目標"></a>目標</h2><ul>
<li>將 5 個 PaddleOCR ONNX 模型檔案 (208MB) 發布到 Hugging Face</li>
<li>建立完整的使用文檔與授權聲明  </li>
<li>提供簡單的下載方式給其他開發者</li>
<li>確保版權合規 (原始模型為 Apache 2.0 授權)</li>
</ul>
<h2 id="模型檔案清單"><a href="#模型檔案清單" class="headerlink" title="模型檔案清單"></a>模型檔案清單</h2><p>轉換完成的檔案包含：</p>
<ul>
<li><code>PP-OCRv5_server_det_infer.onnx</code> (84MB) - 文字檢測</li>
<li><code>PP-OCRv5_server_rec_infer.onnx</code> (81MB) - 文字識別  </li>
<li><code>UVDoc_infer.onnx</code> (30MB) - 文檔矯正</li>
<li><code>PP-LCNet_x1_0_doc_ori_infer.onnx</code> (6.5MB) - 文檔方向</li>
<li><code>PP-LCNet_x1_0_textline_ori_infer.onnx</code> (6.5MB) - 文字方向</li>
<li><code>PP-OCRv5_server_rec_infer.yml</code> (145KB) - 配置檔案</li>
</ul>
<h2 id="平台選擇：為什麼是-Hugging-Face？"><a href="#平台選擇：為什麼是-Hugging-Face？" class="headerlink" title="平台選擇：為什麼是 Hugging Face？"></a>平台選擇：為什麼是 Hugging Face？</h2><p>本來考慮幾個選項：</p>
<ul>
<li><strong>GitLab</strong>：現有平台，整合容易</li>
<li><strong>GitHub</strong>：開發者友好，但大檔案處理麻煩  </li>
<li><strong>Hugging Face</strong>：AI 模型專業平台</li>
</ul>
<p>最終選擇 Hugging Face 的原因：</p>
<ul>
<li>✅ 完全免費，50GB 額度綽綽有餘</li>
<li>✅ 原生支援 ONNX 格式</li>
<li>✅ 內建 Git LFS，大檔案處理無痛</li>
<li>✅ 全球 CDN，下載速度快</li>
<li>✅ 社群友好，可能吸引貢獻者</li>
</ul>
<h2 id="實作過程"><a href="#實作過程" class="headerlink" title="實作過程"></a>實作過程</h2><h3 id="Phase-1-準備階段"><a href="#Phase-1-準備階段" class="headerlink" title="Phase 1: 準備階段"></a>Phase 1: 準備階段</h3><p>首先建立 Hugging Face 帳號並設定環境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安裝 HF CLI</span></span><br><span class="line">uv add huggingface_hub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定 Token (需要 Write 權限)</span></span><br><span class="line"><span class="built_in">export</span> HF_TOKEN=<span class="string">&quot;your_token_here&quot;</span></span><br></pre></td></tr></table></figure>

<p>建立模型 Repository：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> huggingface_hub <span class="keyword">import</span> create_repo, whoami</span><br><span class="line"></span><br><span class="line"><span class="comment"># 驗證登入</span></span><br><span class="line">user = whoami()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;登入用戶: <span class="subst">&#123;user[<span class="string">&#x27;name&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立 repository  </span></span><br><span class="line">repo_url = create_repo(</span><br><span class="line">    repo_id=<span class="string">&quot;paddleocr-test&quot;</span>,</span><br><span class="line">    repo_type=<span class="string">&quot;model&quot;</span>,</span><br><span class="line">    private=<span class="literal">False</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Repository 建立成功: <span class="subst">&#123;repo_url&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Phase-2-上傳模型檔案"><a href="#Phase-2-上傳模型檔案" class="headerlink" title="Phase 2: 上傳模型檔案"></a>Phase 2: 上傳模型檔案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HF_TOKEN=your_token</span><br><span class="line">hf upload marsena/paddleocr-test ./model_cache/paddleocr_onnx/ --repo-type=model</span><br></pre></td></tr></table></figure>

<p>實際上傳時間約 3 分鐘，比預期快很多。</p>
<h3 id="Phase-3-撰寫文檔"><a href="#Phase-3-撰寫文檔" class="headerlink" title="Phase 3: 撰寫文檔"></a>Phase 3: 撰寫文檔</h3><p>Hugging Face 的 README.md 比一般 GitHub 專案更重要，因為它就是模型的門面。</p>
<p>撰寫重點：</p>
<ol>
<li><strong>清晰的模型說明</strong>：每個檔案的用途</li>
<li><strong>具體的使用範例</strong>：Python 程式碼示範</li>
<li><strong>完整的授權聲明</strong>：避免版權爭議</li>
<li><strong>技術細節</strong>：系統需求、相容性</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># PaddleOCR ONNX Models</span></span><br><span class="line"></span><br><span class="line">本倉庫提供 PaddleOCR v5 的 ONNX 格式模型檔案...</span><br><span class="line"></span><br><span class="line"><span class="section">## 快速開始</span></span><br><span class="line"></span><br><span class="line"><span class="code">```python</span></span><br><span class="line"><span class="code">from huggingface_hub import hf_hub_download</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 下載檢測模型</span></span><br><span class="line"><span class="code">det_model = hf_hub_download(</span></span><br><span class="line"><span class="code">    repo_id=&quot;marsena/paddleocr-test&quot;,</span></span><br><span class="line"><span class="code">    filename=&quot;PP-OCRv5_server_det_infer.onnx&quot;</span></span><br><span class="line"><span class="code">)</span></span><br></pre></td></tr></table></figure>

<p>需要注意 YAML metadata 的格式問題，HF 會檢查語法：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">onnx</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ocr</span>  </span><br><span class="line"><span class="bullet">-</span> <span class="string">paddleocr</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">computer-vision</span></span><br><span class="line"><span class="attr">license:</span> <span class="string">apache-2.0</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h3 id="Phase-4-測試驗證"><a href="#Phase-4-測試驗證" class="headerlink" title="Phase 4: 測試驗證"></a>Phase 4: 測試驗證</h3><p>上傳完成後務必測試下載功能：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 測試單檔下載</span></span><br><span class="line">hf download marsena/paddleocr-test PP-OCRv5_server_det_infer.onnx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 測試整包下載</span></span><br><span class="line">hf download marsena/paddleocr-test --local-dir ./test_download \</span><br><span class="line">  --exclude <span class="string">&quot;README.md&quot;</span> --exclude <span class="string">&quot;.gitattributes&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="一些要注意的小問題"><a href="#一些要注意的小問題" class="headerlink" title="一些要注意的小問題"></a>一些要注意的小問題</h2><h3 id="HF-Token-權限設定"><a href="#HF-Token-權限設定" class="headerlink" title="HF Token 權限設定"></a>HF Token 權限設定</h3><ul>
<li><strong>Read</strong>：只能下載</li>
<li><strong>Write</strong>：可以上傳模型  </li>
<li><strong>Admin</strong>：可以刪除 repo</li>
</ul>
<p>建立 token 時記得選擇 <strong>Write</strong> 權限。</p>
<h3 id="Git-LFS-檔案大小限制"><a href="#Git-LFS-檔案大小限制" class="headerlink" title="Git LFS 檔案大小限制"></a>Git LFS 檔案大小限制</h3><p>Hugging Face 對單檔大小有限制：</p>
<ul>
<li>一般檔案：&lt; 10MB</li>
<li>LFS 檔案：&lt; 50GB</li>
</ul>
<p>我們的最大檔案 84MB，自動走 LFS 沒問題。</p>
<h3 id="背景上傳的重要性"><a href="#背景上傳的重要性" class="headerlink" title="背景上傳的重要性"></a>背景上傳的重要性</h3><p>大檔案上傳可能需要 10-30 分鐘，SSH 連線容易斷開。務必使用 <code>nohup</code> 或 <code>screen</code>。</p>
<h3 id="README-的-YAML-語法檢查"><a href="#README-的-YAML-語法檢查" class="headerlink" title="README 的 YAML 語法檢查"></a>README 的 YAML 語法檢查</h3><p>Hugging Face 會檢查 YAML metadata 語法，格式錯誤會有警告（但不影響功能）。</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>發布完成後，其他開發者可以這樣使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下載所有模型到專案目錄</span></span><br><span class="line">hf download marsena/paddleocr-test \</span><br><span class="line">  --local-dir ./model_cache/paddleocr_onnx \</span><br><span class="line">  --exclude <span class="string">&quot;README.md&quot;</span> \</span><br><span class="line">  --exclude <span class="string">&quot;.gitattributes&quot;</span></span><br></pre></td></tr></table></figure>

<p>或在 Python 中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> huggingface_hub <span class="keyword">import</span> hf_hub_download</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">model_files = [</span><br><span class="line">    <span class="string">&quot;PP-OCRv5_server_det_infer.onnx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PP-OCRv5_server_rec_infer.onnx&quot;</span>, </span><br><span class="line">    <span class="string">&quot;UVDoc_infer.onnx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PP-LCNet_x1_0_doc_ori_infer.onnx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PP-LCNet_x1_0_textline_ori_infer.onnx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PP-OCRv5_server_rec_infer.yml&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cache_dir = <span class="string">&quot;model_cache/paddleocr_onnx&quot;</span></span><br><span class="line">os.makedirs(cache_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> model_files:</span><br><span class="line">    hf_hub_download(</span><br><span class="line">        repo_id=<span class="string">&quot;marsena/paddleocr-test&quot;</span>,</span><br><span class="line">        filename=file,</span><br><span class="line">        local_dir=cache_dir</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>整個發布流程花費約 5-8 小時：</p>
<ul>
<li><strong>準備和上傳</strong>：2 小時</li>
<li><strong>文檔撰寫</strong>：3 小時  </li>
<li><strong>系統整合</strong>：2 小時</li>
<li><strong>測試驗證</strong>：1 小時</li>
</ul>
<p>Hugging Face Hub 確實是發布 AI 模型的好選擇，特別是：</p>
<ol>
<li><strong>無痛 LFS</strong>：大檔案處理完全自動化</li>
<li><strong>全球加速</strong>：下載速度比自建服務快</li>
<li><strong>社群生態</strong>：容易被發現和使用</li>
<li><strong>版本控制</strong>：Git-based，開發者熟悉</li>
</ol>
<p>如果你也有 ONNX 模型需要分享，不妨考慮 Hugging Face Hub。畢竟專業的事交給專業的平台來做，我們專注在模型本身就好。</p>
<h2 id="參考連結"><a href="#參考連結" class="headerlink" title="參考連結"></a>參考連結</h2><ul>
<li><a target="_blank" rel="noopener" href="https://huggingface.co/marsena/paddleocr-test">發布的模型</a></li>
<li><a target="_blank" rel="noopener" href="https://huggingface.co/docs">Hugging Face 文檔</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/PaddlePaddle/PaddleOCR">PaddleOCR 原始專案</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/09/05/2025/ai-hf-open-model-upload/" data-id="cuida3u3M8HHkwO_ODb9vOAtG" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/09/05/2025/ai-hf-open-model-upload/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/gitlab-python-package-registry" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/09/02/2025/gitlab-python-package-registry/" class="article-date">
  <time datetime="2025-09-02T06:42:42.000Z" itemprop="datePublished">2025-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/09/02/2025/gitlab-python-package-registry/"> [實作筆記] 建立私有 Python Package Registry - 以 ONNX Runtime 為例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在開發 AI 應用時，我們遇到一些特殊的依賴管理需求，需要私有 Registry</p>
<p>在這個專案中，我們遇到了幾個挑戰：</p>
<ol>
<li><strong>平台特化需求</strong>：Jetson 平台需要特製的 <code>onnxruntime-gpu</code> 版本，PyPI 上沒有現成的</li>
<li><strong>版本一致性</strong>：確保所有環境（開發、測試、生產）使用完全相同的依賴版本</li>
<li><strong>安全性考量</strong>：避免依賴外部不穩定的來源，降低供應鏈攻擊風險</li>
<li><strong>內部套件分發</strong>：團隊開發的內部工具需要有管道分發</li>
</ol>
<h2 id="私有-Registry-運作流程"><a href="#私有-Registry-運作流程" class="headerlink" title="私有 Registry 運作流程"></a>私有 Registry 運作流程</h2><p>私有 Package Registry 的運作包含三個階段：</p>
<ol>
<li><p><strong>套件發布階段</strong><br>開發者 → 推送程式碼 → GitLab CI&#x2F;CD → 構建套件 → 推送至 Package Registry</p>
</li>
<li><p><strong>套件管理階段</strong><br>Package Registry ← 特製版本套件（如 onnxruntime-gpu for Jetson）<br>　　　　　　　　　← 內部工具套件<br>　　　　　　　　　← 安全審核過的第三方套件</p>
</li>
<li><p><strong>套件使用階段</strong><br>專案 pyproject.toml → 指定私有來源 → 安裝依賴 → 取得正確版本</p>
</li>
</ol>
<p>這樣確保所有環境都使用一致且可控的套件版本。</p>
<h2 id="實作步驟"><a href="#實作步驟" class="headerlink" title="實作步驟"></a>實作步驟</h2><h3 id="發佈套件到-GitLab-Package-Registry"><a href="#發佈套件到-GitLab-Package-Registry" class="headerlink" title="發佈套件到 GitLab Package Registry"></a>發佈套件到 GitLab Package Registry</h3><p>在設定和使用私有 Registry 之前，我們需要先將套件上傳到 GitLab Package Registry。</p>
<h4 id="使用-twine-上傳套件"><a href="#使用-twine-上傳套件" class="headerlink" title="使用 twine 上傳套件"></a>使用 twine 上傳套件</h4><p>twine 是 Python 官方推薦的套件上傳工具，會自動從 wheel 檔案中提取 metadata：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安裝 twine</span></span><br><span class="line">pip install twine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上傳到 GitLab PyPI registry</span></span><br><span class="line">twine upload --repository-url https://gitlab.com/api/v4/projects/&#123;PROJECT_ID&#125;/packages/pypi \</span><br><span class="line">             --username gitlab+deploy-token-&#123;TOKEN_ID&#125; \</span><br><span class="line">             --password &#123;TOKEN&#125; \</span><br><span class="line">             your_package.whl</span><br></pre></td></tr></table></figure>

<p>實際範例（以 ONNX Runtime 為例）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">twine upload --repository-url https://gitlab.com/api/v4/projects/70410750/packages/pypi \</span><br><span class="line">             --username gitlab+deploy-token-9097451 \</span><br><span class="line">             --password gldt-tQVwLxzydZBhn3WWnwtt \</span><br><span class="line">             onnxruntime_gpu-1.23.0-cp310-cp310-linux_aarch64.whl</span><br></pre></td></tr></table></figure>

<h3 id="設定-GitLab-Package-Registry"><a href="#設定-GitLab-Package-Registry" class="headerlink" title="設定 GitLab Package Registry"></a>設定 GitLab Package Registry</h3><p>首先，在 GitLab 專案中啟用 Package Registry，並建立 Deploy Token：</p>
<p>在 GitLab 專案設定中建立 Deploy Token, Settings → Repository → Deploy Tokens</p>
<p>權限：read_package_registry, write_package_registry</p>
<p>記下 token ID 和 token 值，格式如下：</p>
<ul>
<li><p>Token ID: deploy-token-{ID}</p>
</li>
<li><p>Token: {TOKEN}</p>
</li>
</ul>
<h3 id="取得-Project-ID"><a href="#取得-Project-ID" class="headerlink" title="取得 Project ID"></a>取得 Project ID</h3><p>有三種方式可以找到 GitLab Project ID：</p>
<p>從專案首頁：</p>
<p>進入你的 GitLab 專案首頁<br>Project ID 會顯示在專案名稱下方<br>例如：Project ID: 12345678</p>
<p>從專案設定頁面：</p>
<p>進入 Settings → General<br>在最上方的 “General project settings” 區塊<br>可以看到 Project ID</p>
<p>從 GitLab API：</p>
<p>如果你在 CI&#x2F;CD pipeline 中，可以直接使用環境變數 $CI_PROJECT_ID<br>這個變數會自動帶入當前專案的 ID</p>
<h3 id="配置專案的依賴管理"><a href="#配置專案的依賴管理" class="headerlink" title="配置專案的依賴管理"></a>配置專案的依賴管理</h3><p>在 <code>pyproject.toml</code> 中設定私有 registry：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定義私有 index</span></span><br><span class="line"><span class="section">[[tool.uv.index]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;onnx&quot;</span></span><br><span class="line"><span class="attr">url</span> = <span class="string">&quot;https://gitlab+deploy-token-&#123;TOKEN_ID&#125;:&#123;TOKEN&#125;@gitlab.com/api/v4/projects/&#123;PROJECT_ID&#125;/packages/pypi/simple&quot;</span></span><br><span class="line"><span class="attr">default</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定套件來源</span></span><br><span class="line"><span class="section">[tool.uv.sources]</span></span><br><span class="line"><span class="attr">onnxruntime-gpu</span> = &#123; index = <span class="string">&quot;onnx&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多平台依賴策略</span></span><br><span class="line"><span class="attr">dependencies</span> = [</span><br><span class="line">    <span class="comment"># macOS ARM64 使用 CPU 版本</span></span><br><span class="line">    <span class="string">&quot;onnxruntime==1.19.0; sys_platform == &#x27;darwin&#x27; and platform_machine == &#x27;arm64&#x27;&quot;</span>,</span><br><span class="line">    <span class="comment"># Jetson 使用私有倉庫的 GPU 版本</span></span><br><span class="line">    <span class="string">&quot;onnxruntime-gpu; sys_platform == &#x27;linux&#x27; and platform_machine == &#x27;aarch64&#x27;&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>這裡的關鍵是使用條件依賴，根據不同平台安裝不同版本的套件。</p>
<h3 id="開發者使用私有-Registry"><a href="#開發者使用私有-Registry" class="headerlink" title="開發者使用私有 Registry"></a>開發者使用私有 Registry</h3><p>根據專案的安全策略，RD 有幾種方式存取私有 registry：</p>
<h4 id="選項-1：Token-內嵌在-pyproject-toml（簡單但不安全）"><a href="#選項-1：Token-內嵌在-pyproject-toml（簡單但不安全）" class="headerlink" title="選項 1：Token 內嵌在 pyproject.toml（簡單但不安全）"></a>選項 1：Token 內嵌在 pyproject.toml（簡單但不安全）</h4><p>如果 <code>pyproject.toml</code> 中已經包含完整的認證 URL：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接安裝依賴</span></span><br><span class="line">uv <span class="built_in">sync</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用 pip</span></span><br><span class="line">pip install -e .</span><br></pre></td></tr></table></figure>

<h4 id="選項-2：使用環境變數（推薦）"><a href="#選項-2：使用環境變數（推薦）" class="headerlink" title="選項 2：使用環境變數（推薦）"></a>選項 2：使用環境變數（推薦）</h4><p>在 <code>pyproject.toml</code> 中使用佔位符：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url</span> = <span class="string">&quot;https://deploy-token-&#123;TOKEN_ID&#125;:$&#123;GITLAB_TOKEN&#125;@gitlab.com/api/v4/projects/&#123;PROJECT_ID&#125;/packages/pypi/simple&quot;</span></span><br></pre></td></tr></table></figure>

<p>RD 需要設定環境變數：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GITLAB_TOKEN=your_deploy_token</span><br><span class="line">uv <span class="built_in">sync</span></span><br></pre></td></tr></table></figure>

<h4 id="選項-3：使用認證檔案"><a href="#選項-3：使用認證檔案" class="headerlink" title="選項 3：使用認證檔案"></a>選項 3：使用認證檔案</h4><p>設定 pip 或 uv 的認證檔案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立 pip 配置</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ~/.pip/pip.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[global]</span></span><br><span class="line"><span class="string">extra-index-url = https://deploy-token-&#123;TOKEN_ID&#125;:&#123;TOKEN&#125;@gitlab.com/api/v4/projects/&#123;PROJECT_ID&#125;/packages/pypi/simple</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h4 id="選項-4：企業內網存取"><a href="#選項-4：企業內網存取" class="headerlink" title="選項 4：企業內網存取"></a>選項 4：企業內網存取</h4><p>如果使用企業內網或 VPN：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 連接 VPN 後直接使用</span></span><br><span class="line">uv <span class="built_in">sync</span></span><br></pre></td></tr></table></figure>

<h3 id="CI-CD-中存取私有-Registry"><a href="#CI-CD-中存取私有-Registry" class="headerlink" title="CI&#x2F;CD 中存取私有 Registry"></a>CI&#x2F;CD 中存取私有 Registry</h3><p>專案在 GitLab CI&#x2F;CD 中需要存取私有 Registry 時，有以下幾種方式：</p>
<h4 id="方法-1：使用-CI-JOB-TOKEN（推薦）"><a href="#方法-1：使用-CI-JOB-TOKEN（推薦）" class="headerlink" title="方法 1：使用 CI_JOB_TOKEN（推薦）"></a>方法 1：使用 CI_JOB_TOKEN（推薦）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .gitlab-ci.yml</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">PIP_INDEX_URL:</span> <span class="string">https://gitlab-ci-token:$&#123;CI_JOB_TOKEN&#125;@gitlab.com/api/v4/projects/$&#123;REGISTRY_PROJECT_ID&#125;/packages/pypi/simple</span></span><br><span class="line">  <span class="attr">PIP_EXTRA_INDEX_URL:</span> <span class="string">https://pypi.org/simple</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pip</span> <span class="string">install</span> <span class="string">-e</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="comment"># 其他構建步驟</span></span><br></pre></td></tr></table></figure>

<h4 id="方法-2：使用-Deploy-Token"><a href="#方法-2：使用-Deploy-Token" class="headerlink" title="方法 2：使用 Deploy Token"></a>方法 2：使用 Deploy Token</h4><p>在 CI&#x2F;CD 變數中設定 <code>GITLAB_DEPLOY_TOKEN</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">PIP_INDEX_URL=&quot;https://deploy-token-&#123;TOKEN_ID&#125;:$&#123;GITLAB_DEPLOY_TOKEN&#125;@gitlab.com/api/v4/projects/$&#123;REGISTRY_PROJECT_ID&#125;/packages/pypi/simple&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pip</span> <span class="string">install</span> <span class="string">-e</span> <span class="string">.</span></span><br></pre></td></tr></table></figure>

<h4 id="方法-3：配合-uv-使用"><a href="#方法-3：配合-uv-使用" class="headerlink" title="方法 3：配合 uv 使用"></a>方法 3：配合 uv 使用</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">GITLAB_TOKEN=$&#123;CI_JOB_TOKEN&#125;</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">uv</span> <span class="string">sync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="comment"># 其他構建步驟</span></span><br></pre></td></tr></table></figure>

<h2 id="常見問題與解決方案"><a href="#常見問題與解決方案" class="headerlink" title="常見問題與解決方案"></a>常見問題與解決方案</h2><h3 id="Deploy-Token-權限不足？"><a href="#Deploy-Token-權限不足？" class="headerlink" title="Deploy Token 權限不足？"></a>Deploy Token 權限不足？</h3><p>確保 Deploy Token 有 <code>read_package_registry</code> 和 <code>write_package_registry</code> 權限。</p>
<h3 id="套件版本衝突？"><a href="#套件版本衝突？" class="headerlink" title="套件版本衝突？"></a>套件版本衝突？</h3><p>使用 <code>uv</code> 的 resolution markers 功能，明確指定版本解析策略。</p>
<h3 id="Registry-URL-格式錯誤？"><a href="#Registry-URL-格式錯誤？" class="headerlink" title="Registry URL 格式錯誤？"></a>Registry URL 格式錯誤？</h3><p>GitLab PyPI registry URL 格式為：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gitlab.com/api/v4/projects/&#123;PROJECT_ID&#125;/packages/pypi/simple</span><br></pre></td></tr></table></figure>

<p>注意將 <code>{PROJECT_ID}</code> 替換為實際的專案 ID。</p>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>透過建立私有 Package Registry，我們成功解決了：</p>
<ul>
<li><strong>特製版本管理</strong>：Jetson 平台的特殊 ONNX Runtime 版本需求</li>
<li><strong>依賴一致性</strong>：所有環境使用相同版本的套件</li>
<li><strong>安全性提升</strong>：減少對外部來源的依賴</li>
<li><strong>存取便利性</strong>：開發者和 CI&#x2F;CD 都能輕鬆存取私有套件</li>
</ul>
<p>這個架構不僅適用於 ONNX Runtime，也可以擴展到其他需要特殊管理的依賴套件。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/09/02/2025/gitlab-python-package-registry/" data-id="cuidjcUfWThoPsHrUduoI3bNM" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/09/02/2025/gitlab-python-package-registry/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/brevo_smtp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/08/27/2025/brevo_smtp/" class="article-date">
  <time datetime="2025-08-27T14:19:02.000Z" itemprop="datePublished">2025-08-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/08/27/2025/brevo_smtp/"> [實作筆記] 怎麼建立一個網站？(四) - 自訂網域 EMail 收寄信(使用 Cloudflare 與 Brevo)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>四年前「<a href="https://blog.marsen.me/2020/10/22/2020/google_domain_forward_mail/">怎麼建立一個網站？(四) - 自訂網域 EMail</a>」已過時了，<br>當時透過 Google Domain 設定了自己的網域信箱，那種擁有 <code>admin@marsen.me</code> 的專業度真的是滿到溢出來。</p>
<p>但是，現實總是殘酷的。</p>
<p>2023 年 Google Domain 宣布停止營運，我選擇轉移到了 Cloudflare。</p>
<p>更悲劇的是，Gmail 的應用程式密碼也在安全性考量下越來越不被推薦使用。</p>
<p>Google 對 Gmail SMTP 的使用限制越來越嚴格。</p>
<p>在開啟 2FA 的情況下，只能使用應用程式密碼，但是 Google 本身也不推薦這樣使用密碼。</p>
<h2 id="問題分析"><a href="#問題分析" class="headerlink" title="問題分析"></a>問題分析</h2><p>現有問題：</p>
<ul>
<li>Google Domain 停止服務，Cloudflare 雖然接管了域名，但沒有提供類似的信箱轉發服務</li>
<li>Gmail 無法繼續使用 Email Forwarding 的密碼方式不再被推薦使用，我也沒有查到替代方案</li>
</ul>
<p>需求：</p>
<ul>
<li>能夠使用 <code>admin@marsen.me</code> 收信，已完成(在 Cloudflare 設定 Email Forwarding)</li>
<li>能夠以 <code>admin@marsen.me</code> 寄信，而且不會被標記為可疑郵件</li>
<li>免費或便宜的解決方案</li>
<li>設定要簡單快速</li>
</ul>
<h2 id="技術選擇的思考"><a href="#技術選擇的思考" class="headerlink" title="技術選擇的思考"></a>技術選擇的思考</h2><p>經過一番調研，我把目標鎖定在幾個主流的 SMTP 服務：</p>
<ol>
<li><strong>Brevo (原 Sendinblue)</strong>：免費額度每天 300 封信，付費方案 $25&#x2F;月</li>
<li><strong>Mailjet</strong>：免費額度每天 200 封信，付費方案 $17&#x2F;月</li>
<li><strong>SendGrid</strong>：免費額度每天 100 封信</li>
<li><strong>Amazon SES</strong>：按量計費，超便宜但設定複雜</li>
</ol>
<p>綜合考量下，我選擇 <strong>Brevo</strong> 的理由：</p>
<ul>
<li><strong>價格最划算</strong>：免費額度最高（300封&#x2F;天），對個人使用綽綽有餘</li>
<li><strong>功能完整</strong>：不只是 SMTP，還有完整的郵件行銷功能</li>
<li><strong>設定超快</strong>：API 整合簡單，文件齊全</li>
<li><strong>信譽良好</strong>：歐洲公司，GDPR 合規，信件到達率高</li>
</ul>
<p>備案是 Mailjet，但既然 Brevo 實際使用很順利，我就沒有去試了。</p>
<h2 id="實作過程"><a href="#實作過程" class="headerlink" title="實作過程"></a>實作過程</h2><h3 id="Step-1-註冊-Brevo-帳號"><a href="#Step-1-註冊-Brevo-帳號" class="headerlink" title="Step 1: 註冊 Brevo 帳號"></a>Step 1: 註冊 Brevo 帳號</h3><p>前往 <a target="_blank" rel="noopener" href="https://brevo.com/">Brevo 官網</a> 註冊免費帳號，過程很簡單，不需要信用卡。</p>
<p>可以用 Google 帳號註冊，但是填寫一些資料，總體來說並不冗長繁瑣。</p>
<h3 id="Step-2-設定-Sending-Domain"><a href="#Step-2-設定-Sending-Domain" class="headerlink" title="Step 2: 設定 Sending Domain"></a>Step 2: 設定 Sending Domain</h3><p>登入後台，進入「Senders &amp; IP」→「Domains」，添加你的域名（如 <code>marsen.me</code>）。</p>
<p>Brevo 會要求你在 DNS 域名設定中添加幾筆記錄(我是使用 Cloudflare)來驗證域名擁有權：</p>
<p>設定過程也很傻瓜點擊跟著操作就會引導你登入 Cloudflare 的後台，不保証其他域名商有這麼方便，</p>
<p>會在 Cloudflare DNS 管理中添加：2 筆 CNAME 與 2 筆 TXT 記錄，應該是讓 Brevo 驗証網域所有權的。</p>
<p>DNS 生效後，Brevo 就會驗證通過。</p>
<h3 id="Step-3-設定收信"><a href="#Step-3-設定收信" class="headerlink" title="Step 3: 設定收信"></a>Step 3: 設定收信</h3><p>設定 Email Forwarding 這部分我直接在 Cloudflare 設定：</p>
<p>「Email」→「Email Routing」→「Routes」</p>
<p>添加轉發規則：</p>
<p>從：<code>admin@marsen.me</code> 到我的 gmail</p>
<p>這樣就能收到寄往自訂域名的信了。</p>
<h3 id="Step-4-設定-Gmail-使用-Brevo-SMTP"><a href="#Step-4-設定-Gmail-使用-Brevo-SMTP" class="headerlink" title="Step 4: 設定 Gmail 使用 Brevo SMTP"></a>Step 4: 設定 Gmail 使用 Brevo SMTP</h3><p>進入 Gmail 設定 &gt; 帳戶和匯入 &gt; 新增另一個電子郵件地址：</p>
<ul>
<li>名稱：Marsen</li>
<li>電子郵件地址：<code>admin@marsen.me</code></li>
<li>SMTP 伺服器：<code>smtp-relay.brevo.com</code></li>
<li>通訊埠：587</li>
<li>使用者名稱：你的 Brevo 帳號 email</li>
<li>密碼：去 Brevo 後台「Account Settings」→「SMTP &amp; API」生成的 SMTP Key</li>
<li>設定完成後，Gmail 會寄驗證信，確認後收到的信才不會有警告。</li>
</ul>
<h2 id="實測結果"><a href="#實測結果" class="headerlink" title="實測結果"></a>實測結果</h2><p>設定完成實測：</p>
<ul>
<li>✅ 收信正常：寄到 <code>admin@marsen.me</code> 的信都能在 Gmail 收到</li>
<li>✅ 寄信正常：從 Gmail 可以選擇用 <code>admin@marsen.me</code> 寄信</li>
<li>✅ 信譽良好：收件者不會看到「未驗證」警告</li>
</ul>
<p>整個設定過程不到 20 分鐘。</p>
<h2 id="一些要注意的小問題"><a href="#一些要注意的小問題" class="headerlink" title="一些要注意的小問題"></a>一些要注意的小問題</h2><p><strong>DNS 生效時間</strong><br>SPF、DKIM 記錄可能需要幾個小時才會完全生效，不要急著測試。</p>
<p>但是我實測約幾分鐘就生效了。</p>
<p><strong>SMTP Key 不是密碼</strong><br>Brevo 的 SMTP Key 是專門給 API 和 SMTP 用的，不是你登入密碼。</p>
<p><strong>免費額度限制</strong><br>每天 300 封信對我個人使用很夠，但如果你要大量寄信，記得升級付費方案。</p>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://brevo.com/">Brevo 官方網站</a></li>
<li><a target="_blank" rel="noopener" href="https://support.google.com/accounts/answer/185833">重要事項：我們不建議使用應用程式密碼</a></li>
<li><a href="https://blog.marsen.me/2020/10/22/2020/google_domain_forward_mail/">怎麼建立一個網站？(四) - 自訂網域 EMail</a> (2020年舊文)</li>
</ul>
<h2 id="系列文章"><a href="#系列文章" class="headerlink" title="系列文章"></a>系列文章</h2><ul>
<li><a href="https://blog.marsen.me/2016/08/21/2016/setting_DNS_with_google/">怎麼建立一個網站？(一)</a></li>
<li><a href="https://blog.marsen.me/2016/08/28/2016/how_to_use_github_page/">怎麼建立一個網站？(二)</a></li>
<li><a href="https://blog.marsen.me/2016/09/04/2016/http2_by_cloudflare/">怎麼建立一個網站？(三)</a></li>
<li><del><a href="https://blog.marsen.me/2020/10/22/2020/google_domain_forward_mail/">怎麼建立一個網站？(四)</a></del></li>
<li><a href="https://blog.marsen.me/2025/08/27/2025/brevo_smtp/">怎麼建立一個網站？(四)</a></li>
<li><a href="https://blog.marsen.me/2021/04/06/2021/create_404/">怎麼建立一個網站？(五)</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/08/27/2025/brevo_smtp/" data-id="cuidNBGp6wgvwsXHF4VZGKFvf" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/08/27/2025/brevo_smtp/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/backend-architecture-layer-design-principles" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/08/12/2025/backend-architecture-layer-design-principles/" class="article-date">
  <time datetime="2025-08-12T05:29:15.000Z" itemprop="datePublished">2025-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/08/12/2025/backend-architecture-layer-design-principles/"> [架構筆記] Clean Architecture 分層職責的反思</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>最近在 Code Review 時遇到一個有趣的題目：</p>
<p>檔案上傳功能中，檔案編碼修復應該放在 Middleware 還是 UseCase？</p>
<p>這個問題引發了我對 Clean Architecture 分層職責的重新思考，與團隊背後的設計哲學。</p>
<h2 id="問題背景"><a href="#問題背景" class="headerlink" title="問題背景"></a>問題背景</h2><p>在一個採用 Clean Architecture 的專案中，我們有兩個檔案上傳功能：</p>
<ul>
<li><strong>知識庫檔案上傳</strong> - 支援 PDF、Word、圖片等多種格式</li>
<li><strong>合約檔案上傳</strong> - 原始合約支援 PDF&#x2F;Word，簽署後合約只支援 PDF</li>
</ul>
<p>當前系統架構包含：</p>
<ul>
<li><strong>Middleware</strong> - Express 中介軟體層</li>
<li><strong>Controller</strong> - HTTP 請求處理層  </li>
<li><strong>UseCase</strong> - 業務邏輯層</li>
<li><strong>Service</strong> - 基礎設施服務層</li>
</ul>
<h2 id="核心問題：分層職責如何劃分？"><a href="#核心問題：分層職責如何劃分？" class="headerlink" title="核心問題：分層職責如何劃分？"></a>核心問題：分層職責如何劃分？</h2><p>以下邏輯應該放在哪一層？</p>
<ol>
<li><strong>檔案編碼修復</strong> - 解決中文檔名亂碼問題 (latin1 → utf8)</li>
<li><strong>檔案類型驗證</strong> - 檢查 MIME type 是否符合業務需求  </li>
<li><strong>檔案大小限制</strong> - 根據不同業務場景設定不同大小限制</li>
<li><strong>JWT Token 驗證</strong> - 檢查使用者身份</li>
<li><strong>檔案內容解析</strong> - 提取 PDF&#x2F;Word 文件內容</li>
</ol>
<p>分析思路 — 職責角度</p>
<h3 id="Middleware-的職責：偏向基礎設施"><a href="#Middleware-的職責：偏向基礎設施" class="headerlink" title="Middleware 的職責：偏向基礎設施"></a>Middleware 的職責：偏向基礎設施</h3><p>控制進出流程 → 例：API 請求進來先檢查 Token</p>
<p>過濾與轉換資料 → 例：將日期字串轉成標準格式</p>
<p>保護系統邊界 → 例：攔截未授權的存取</p>
<p>以下不舉例:</p>
<ul>
<li><strong>跨領域技術問題</strong> (認證、編碼、錯誤處理)</li>
<li><strong>HTTP 協議相關</strong> (請求解析、回應格式)  </li>
<li><strong>基礎設施關注點</strong> (日誌、監控、安全)</li>
<li><strong>與業務無關的技術細節</strong></li>
</ul>
<h3 id="Use-Case-的職責：偏向商業邏輯"><a href="#Use-Case-的職責：偏向商業邏輯" class="headerlink" title="Use Case 的職責：偏向商業邏輯"></a>Use Case 的職責：偏向商業邏輯</h3><p>驅動核心行為 → 例：建立一筆訂單流程</p>
<p>執行業務規則 → 例：檢查庫存是否足夠</p>
<p>協調內外資源 → 例：呼叫付款服務並更新資料庫</p>
<p>以下不舉例:</p>
<ul>
<li><strong>特定業務場景的規則</strong> (不同業務有不同檔案限制)</li>
<li><strong>領域知識驗證</strong> (合約標題、內容檢查)</li>
<li><strong>業務流程邏輯</strong> (檔案處理、資料儲存)</li>
<li><strong>動態配置的業務參數</strong> (從環境變數讀取的業務限制)</li>
</ul>
<h2 id="實際案例分析"><a href="#實際案例分析" class="headerlink" title="實際案例分析"></a>實際案例分析</h2><h3 id="檔案編碼問題"><a href="#檔案編碼問題" class="headerlink" title="檔案編碼問題"></a>檔案編碼問題</h3><p>技術問題 → 整個系統一體適用，選 Middleware ✅</p>
<p>細節分析:</p>
<ul>
<li>這是 HTTP 上傳過程中的技術問題，不是業務邏輯</li>
<li>所有檔案上傳都需要這個處理，跨多個 UseCase</li>
<li>屬於請求處理層面的責任</li>
</ul>
<h3 id="檔案類型限制"><a href="#檔案類型限制" class="headerlink" title="檔案類型限制"></a>檔案類型限制</h3><p>業務邏輯 → 不同的上傳任務有不同限制，屬商業邏輯，選 UseCase ✅</p>
<p>細節分析:</p>
<ul>
<li>不同業務場景有不同的檔案類型限制</li>
<li>這是領域知識，需要業務邏輯判斷</li>
<li>可能隨著業務需求變化而調整</li>
</ul>
<h3 id="這頭給你想"><a href="#這頭給你想" class="headerlink" title="這頭給你想"></a>這頭給你想</h3><p>如果檔案大小限制要動態調整呢？</p>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>好的架構設計不是憑感覺，而是要有明確的原則：</p>
<ul>
<li><strong>Middleware</strong> &#x3D; 技術基礎設施，處理 HTTP 層面的問題</li>
<li><strong>UseCase</strong> &#x3D; 業務邏輯驗證，處理領域相關的規則</li>
</ul>
<p>這種分層不只讓程式碼更好維護，也讓測試更容易撰寫，更符合單一職責原則。</p>
<p>下次在設計架構時，不妨問問自己：</p>
<ul>
<li>這個邏輯是技術問題還是業務問題？</li>
<li>這個規則會因為業務需求變化嗎？</li>
<li>這個處理邏輯需要在多個地方重複嗎？</li>
</ul>
<p>Clean Architecture 的精神就在於：<strong>讓業務邏輯獨立於技術細節</strong>。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/08/12/2025/backend-architecture-layer-design-principles/" data-id="cuido9MW9LCHMveg2SZsFM7Hj" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/08/12/2025/backend-architecture-layer-design-principles/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/" rel="tag">學習筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/race-condition-in-file-storage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/08/07/2025/race-condition-in-file-storage/" class="article-date">
  <time datetime="2025-08-07T05:15:41.000Z" itemprop="datePublished">2025-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/08/07/2025/race-condition-in-file-storage/"> [學習筆記] Node.js 檔案操作 mkdir 的正確姿勢</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在 code review 中 RD 寫了以下的程式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">exists</span>(fullPath)) &#123;</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看似合理的「檢查然後執行」（Check-Then-Act）模式可能導致的併發問題。</p>
<p>假設兩個請求同時上傳檔案到同一個不存在的目錄：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">時間線：</span><br><span class="line">T1: 請求A 執行 this.exists(fullPath) → 返回 false (目錄不存在)</span><br><span class="line">T2: 請求B 執行 this.exists(fullPath) → 返回 false (目錄不存在)</span><br><span class="line">T3: 請求A 執行 mkdir(fullPath) → 成功建立目錄</span><br><span class="line">T4: 請求B 執行 mkdir(fullPath) → 可能拋出 EEXIST 錯誤(fs.promises.mkdir 已在底層排除這個問題)</span><br></pre></td></tr></table></figure>

<p>雖然使用了 <code>recursive: true</code>，那前面的檢查很可能是不必要的行為。</p>
<h3 id="為什麼會這樣？"><a href="#為什麼會這樣？" class="headerlink" title="為什麼會這樣？"></a>為什麼會這樣？</h3><p>問題的根源在於<strong>時間窗口</strong>。兩個步驟之間存在時間差，而這個時間差就是競態條件的溫床：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 有時間窗口的寫法</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">exists</span>(fullPath)) &#123;  <span class="comment">// 步驟1: 檢查</span></span><br><span class="line">  <span class="comment">// 👆 這裡到下面之間就是危險的時間窗口</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)  <span class="comment">// 步驟2: 執行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解決方案"><a href="#解決方案" class="headerlink" title="解決方案"></a>解決方案</h2><h3 id="方法1-直接使用-mkdir（推薦）"><a href="#方法1-直接使用-mkdir（推薦）" class="headerlink" title="方法1: 直接使用 mkdir（推薦）"></a>方法1: 直接使用 mkdir（推薦）</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">uploadFile</span>(<span class="attr">file</span>: <span class="title class_">UploadedFile</span>, pathToStore?: <span class="string">`/<span class="subst">$&#123;<span class="built_in">string</span>&#125;</span>`</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fullPath = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.uploadDir&#125;</span><span class="subst">$&#123;pathToStore ?? <span class="string">&#x27;&#x27;</span>&#125;</span>`</span></span><br><span class="line">  <span class="comment">// 直接建立目錄，recursive: true 會自動處理已存在的情況</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="keyword">const</span> uploadPath = path.<span class="title function_">join</span>(fullPath, file.<span class="property">originalName</span>)</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">writeFile</span>(uploadPath, file.<span class="property">buffer</span>)</span><br><span class="line">  <span class="keyword">return</span> uploadPath</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="為什麼-recursive-true-已經足夠"><a href="#為什麼-recursive-true-已經足夠" class="headerlink" title="為什麼 recursive: true 已經足夠"></a>為什麼 recursive: true 已經足夠</h2><p>根據 Node.js 官方文件，<code>fs.promises.mkdir(path, { recursive: true })</code> 具有以下特性：</p>
<ol>
<li><strong>自動建立父目錄</strong>：如果父目錄不存在會自動建立</li>
<li><strong>處理已存在目錄</strong>：當 <code>recursive</code> 為 <code>true</code> 時，如果目錄已存在不會拋出錯誤</li>
<li><strong>簡化錯誤處理</strong>：避免了手動檢查目錄是否存在的需要</li>
</ol>
<p>官方範例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mkdir &#125; <span class="keyword">from</span> <span class="string">&#x27;node:fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create ./tmp/a/apple, regardless of whether ./tmp and ./tmp/a exist.</span></span><br><span class="line"><span class="title function_">mkdir</span>(<span class="string">&#x27;./tmp/a/apple&#x27;</span>, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">這就像餐廳點餐的差別：</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`typescript</span></span><br><span class="line"><span class="string">// ❌ 競態條件版本（不好的做法）</span></span><br><span class="line"><span class="string">if (餐廳沒有準備我要的餐) &#123;  // 檢查</span></span><br><span class="line"><span class="string">  請廚師準備這道餐        // 執行</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// 問題：兩個客人可能同時檢查到「沒有」，然後都要求準備</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// ✅ 直接執行版本（好的做法）</span></span><br><span class="line"><span class="string">請廚師準備這道餐，如果已經有了就不用重複準備</span></span><br><span class="line"><span class="string">// 廚師會自己判斷是否需要準備，避免重複工作</span></span><br></pre></td></tr></table></figure>

<h2 id="效能優勢"><a href="#效能優勢" class="headerlink" title="效能優勢"></a>效能優勢</h2><p>修復後還有意外的效能提升：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修復前：2次系統調用</span></span><br><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">exists</span>(fullPath)  <span class="comment">// 系統調用1: stat()</span></span><br><span class="line"><span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>()    <span class="comment">// 系統調用2: mkdir()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修復後：1次系統調用  </span></span><br><span class="line"><span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">mkdir</span>(fullPath, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;)  <span class="comment">// 系統調用1: mkdir()</span></span><br></pre></td></tr></table></figure>

<h2 id="經驗教訓"><a href="#經驗教訓" class="headerlink" title="經驗教訓"></a>經驗教訓</h2><ol>
<li><strong>避免 Check-Then-Act 模式</strong>：這是併發程式設計的經典陷阱，不過這次案例，執行的底層實作已處理好，所以不會有問題</li>
<li><strong>信任系統調用</strong>：現代 API 通常已經考慮了併發場景</li>
<li><strong>簡單就是美</strong>：移除不必要的檢查邏輯，程式碼更簡潔也更安全</li>
</ol>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/api/fs.html#fsmkdirpath-options-callback">Nodejs - fsPromises.mkdir(path[, options])</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/08/07/2025/race-condition-in-file-storage/" data-id="cuidI3jdCiYWHovWEp6oTTMfx" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/08/07/2025/race-condition-in-file-storage/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/" rel="tag">學習筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/ai_google_search_api" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/07/31/2025/ai_google_search_api/" class="article-date">
  <time datetime="2025-07-31T08:51:10.000Z" itemprop="datePublished">2025-07-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/07/31/2025/ai_google_search_api/"> [實作筆記] AI Agent 實作 Web Search API：從設計到部署的完整記錄</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>最近購買 Claude Code，在此同時也有試用 Github Copilot &#x2F; Gitlab Duo &#x2F; Gemini &#x2F; Amazon Q</p>
<p>剛好手上有需求，是簡單的 API 串接，但是我們的系統架構有一些只有團隊知道的 Know How。</p>
<p>我想試試用 AI Agent 來協助我處理這些開發，需求簡單明確，但是技術細節並不少，</p>
<p>如果是新進 RD(即使有開發經驗)也不見得能掌握得很好，我來試試看 AI Agent 能作什麼程度。</p>
<p>這篇文章記錄我在基於 Clean Architecture 的 Node.js API 系統中實作 Web Search 功能的完整過程，包含架構設計、權限管理、錯誤處理等細節。</p>
<h2 id="系統架構背景"><a href="#系統架構背景" class="headerlink" title="系統架構背景"></a>系統架構背景</h2><p>專案採用 <strong>Clean Architecture</strong> 搭配 <strong>依賴注入 (Inversify)</strong>，技術棧包含：</p>
<ul>
<li>TypeScript + Express.js</li>
<li>TypeORM (資料庫 ORM)</li>
<li>Inversify (依賴注入容器)</li>
<li>JWT (身份驗證)</li>
<li>Zod (參數驗證)</li>
</ul>
<p>架構分為四個主要層級：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">├── adapters/          # 外部介面層 - 控制器</span><br><span class="line">├── domain/           # 領域層 - 核心業務邏輯  </span><br><span class="line">├── infrastructure/   # 基礎設施層 - 外部依賴實作  </span><br><span class="line">└── useCases/        # 應用層 - 業務用例</span><br></pre></td></tr></table></figure>

<h2 id="需求分析與設計決策"><a href="#需求分析與設計決策" class="headerlink" title="需求分析與設計決策"></a>需求分析與設計決策</h2><h3 id="API-規格定義"><a href="#API-規格定義" class="headerlink" title="API 規格定義"></a>API 規格定義</h3><ul>
<li><strong>端點</strong>: <code>GET /api/v1/websearch?keyword=關鍵字</code></li>
<li><strong>輸入</strong>: Query 參數 <code>{ keyword: string }</code></li>
<li><strong>輸出</strong>: <code>{ data: [{ title: string, url: string, description: string }] }</code></li>
<li><strong>結果數</strong>: 10 筆</li>
<li><strong>權限</strong>: 所有 API 都需要權限檢查(我們之前開發好的 RBAC 權限系統 )，一個功能對應一個權限，為此我需要新增 <code>web_search</code> 權限</li>
</ul>
<h3 id="關鍵設計決策"><a href="#關鍵設計決策" class="headerlink" title="關鍵設計決策"></a>關鍵設計決策</h3><p><strong>1. 控制器選擇</strong>  </p>
<p>決定將功能放在 <code>BasicController</code> 而非 <code>ProjController</code>，因為這是通用功能而非特定業務邏輯。</p>
<p>| 這裡我在需求上有明確告知 AI，實作上也沒有問題</p>
<p><strong>2. 依賴關係</strong><br>嚴格遵循 Clean Architecture 的依賴規則：</p>
<p>| 也有寫入 CLAUDE.md 的開發準則中，但 AI 會常常忘記這件事</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Controller → UseCase → Service → External API</span><br></pre></td></tr></table></figure>

<p><strong>3. 環境變數策略</strong>  </p>
<p>將 Google API 設定為非必要欄位，未設定時警告但不中斷其他服務。</p>
<p>| AI 提供很好的建議並快速完成開發</p>
<p><strong>4. 錯誤處理設計</strong>  </p>
<ul>
<li>503: API 未設定</li>
<li>502: API 呼叫失敗  </li>
<li>400: 參數錯誤 (Zod 驗證)</li>
</ul>
<h2 id="實作步驟詳解"><a href="#實作步驟詳解" class="headerlink" title="實作步驟詳解"></a>實作步驟詳解</h2><h3 id="Phase-1-環境設定擴充"><a href="#Phase-1-環境設定擴充" class="headerlink" title="Phase 1: 環境設定擴充"></a>Phase 1: 環境設定擴充</h3><p>首先擴充環境變數設定，新增 Google Search API 相關設定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env.example</span></span><br><span class="line"><span class="comment"># Google Search API Configuration</span></span><br><span class="line">GOOGLE_API_KEY=your_google_api_key</span><br><span class="line">GOOGLE_SEARCH_ENGINE_ID=your_search_engine_id  </span><br><span class="line">GOOGLE_SEARCH_API_URL=https://www.googleapis.com/customsearch/v1</span><br><span class="line">GOOGLE_SEARCH_RESULTS_COUNT=10</span><br></pre></td></tr></table></figure>

<p><strong>修改 envConfigService.ts</strong><br>新增 <code>getOptional()</code> 方法支援可選配置：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">getOptional</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="literal">undefined</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> process.<span class="property">env</span>[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Phase-2-權限系統整合"><a href="#Phase-2-權限系統整合" class="headerlink" title="Phase 2: 權限系統整合"></a>Phase 2: 權限系統整合</h3><p>建立資料庫遷移檔案，新增 <code>web_search</code> 權限：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> permissions (name, description) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;web_search&#x27;</span>, <span class="string">&#x27;Web Search API access permission&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分配給 admin 和 member 角色</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> role_permissions (role_id, permission_id) </span><br><span class="line"><span class="keyword">SELECT</span> r.id, p.id <span class="keyword">FROM</span> roles r, permissions p </span><br><span class="line"><span class="keyword">WHERE</span> r.name <span class="keyword">IN</span> (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;member&#x27;</span>) <span class="keyword">AND</span> p.name <span class="operator">=</span> <span class="string">&#x27;web_search&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Phase-3-核心架構實作"><a href="#Phase-3-核心架構實作" class="headerlink" title="Phase 3: 核心架構實作"></a>Phase 3: 核心架構實作</h3><h4 id="1-定義領域介面"><a href="#1-定義領域介面" class="headerlink" title="1. 定義領域介面"></a>1. 定義領域介面</h4><p><strong>src&#x2F;domain&#x2F;interfaces&#x2F;webSearchService.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">WebSearchService</span> &#123;</span><br><span class="line">  <span class="title function_">search</span>(<span class="attr">keyword</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">WebSearchResult</span>[]&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">WebSearchResult</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">url</span>: <span class="built_in">string</span>  </span><br><span class="line">  <span class="attr">description</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Google-Search-Service-實作"><a href="#2-Google-Search-Service-實作" class="headerlink" title="2. Google Search Service 實作"></a>2. Google Search Service 實作</h4><p><strong>src&#x2F;infrastructure&#x2F;services&#x2F;googleSearchService.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GoogleSearchService</span> <span class="keyword">implements</span> <span class="title class_">WebSearchService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TYPES.HttpClient) <span class="keyword">private</span> <span class="keyword">readonly</span> httpClient: IHttpClient,</span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TYPES.EnvConfigService) <span class="keyword">private</span> <span class="keyword">readonly</span> envConfig: IEnvConfigService</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">search</span>(<span class="attr">keyword</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">WebSearchResult</span>[]&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> apiKey = <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">getOptional</span>(<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> searchEngineId = <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">getOptional</span>(<span class="string">&#x27;GOOGLE_SEARCH_ENGINE_ID&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!apiKey || !searchEngineId) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppError</span>(<span class="string">&#x27;Google Search API 未設定&#x27;</span>, <span class="number">503</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      <span class="attr">key</span>: apiKey,</span><br><span class="line">      <span class="attr">cx</span>: searchEngineId, </span><br><span class="line">      <span class="attr">q</span>: keyword,</span><br><span class="line">      <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">get</span>(<span class="string">&#x27;GOOGLE_SEARCH_RESULTS_COUNT&#x27;</span>, <span class="string">&#x27;10&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">httpClient</span>.<span class="title function_">get</span>(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">envConfig</span>.<span class="title function_">get</span>(<span class="string">&#x27;GOOGLE_SEARCH_API_URL&#x27;</span>), </span><br><span class="line">        &#123; params &#125;</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">transformGoogleResponse</span>(response.<span class="property">data</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AppError</span>(<span class="string">&#x27;搜尋服務暫時無法使用&#x27;</span>, <span class="number">502</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">transformGoogleResponse</span>(<span class="attr">data</span>: <span class="built_in">any</span>): <span class="title class_">WebSearchResult</span>[] &#123;</span><br><span class="line">    <span class="keyword">if</span> (!data.<span class="property">items</span>) <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">items</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">title</span>: item.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">url</span>: item.<span class="property">link</span>,</span><br><span class="line">      <span class="attr">description</span>: item.<span class="property">snippet</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-UseCase-層實作"><a href="#3-UseCase-層實作" class="headerlink" title="3. UseCase 層實作"></a>3. UseCase 層實作</h4><p><strong>src&#x2F;useCases&#x2F;ExecuteWebSearch.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ExecuteWebSearch</span> <span class="keyword">implements</span> <span class="title class_">IUseCase</span>&lt;<span class="title class_">ExecuteWebSearchDTO</span>, <span class="title class_">WebSearchResponseDTO</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TYPES.WebSearchService) <span class="keyword">private</span> <span class="keyword">readonly</span> webSearchService: WebSearchService</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">execute</span>(<span class="attr">input</span>: <span class="title class_">ExecuteWebSearchDTO</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">WebSearchResponseDTO</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">webSearchService</span>.<span class="title function_">search</span>(input.<span class="property">keyword</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">data</span>: results &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DTO 定義</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ExecuteWebSearchDTO</span> &#123;</span><br><span class="line">  <span class="attr">keyword</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">WebSearchResponseDTO</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">WebSearchResult</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-Controller-層實作"><a href="#4-Controller-層實作" class="headerlink" title="4. Controller 層實作"></a>4. Controller 層實作</h4><p><strong>src&#x2F;adapters&#x2F;controllers&#x2F;basicController.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; z &#125; <span class="keyword">from</span> <span class="string">&#x27;zod&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Zod 驗證 schema</span></span><br><span class="line"><span class="keyword">const</span> webSearchQuerySchema = z.<span class="title function_">object</span>(&#123;</span><br><span class="line">  <span class="attr">keyword</span>: z.<span class="title function_">string</span>().<span class="title function_">min</span>(<span class="number">1</span>, <span class="string">&#x27;keyword 參數為必填且不能為空字串&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">webSearch</span>(<span class="attr">req</span>: <span class="title class_">Request</span>, <span class="attr">res</span>: <span class="title class_">Response</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// 使用 Zod 進行參數驗證</span></span><br><span class="line">  <span class="keyword">const</span> &#123; keyword &#125; = webSearchQuerySchema.<span class="title function_">parse</span>(req.<span class="property">query</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="attr">input</span>: <span class="title class_">ExecuteWebSearchDTO</span> = &#123; keyword &#125;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">executeWebSearch</span>.<span class="title function_">execute</span>(input)</span><br><span class="line">  </span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-路由設定"><a href="#5-路由設定" class="headerlink" title="5. 路由設定"></a>5. 路由設定</h4><p><strong>src&#x2F;infrastructure&#x2F;routes&#x2F;basicRouter.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 註冊路由，先執行權限檢查，再執行業務邏輯</span></span><br><span class="line">r.<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;basePath&#125;</span>/websearch`</span>, </span><br><span class="line">  auth.<span class="title function_">user</span>(<span class="string">&#x27;web_search&#x27;</span>),  <span class="comment">// 權限中介軟體</span></span><br><span class="line">  <span class="title function_">asyncWrapper</span>(basicController.<span class="property">webSearch</span>.<span class="title function_">bind</span>(basicController))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Phase-4-依賴注入設定"><a href="#Phase-4-依賴注入設定" class="headerlink" title="Phase 4: 依賴注入設定"></a>Phase 4: 依賴注入設定</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="comment">// 註冊 UseCase</span></span><br><span class="line">container.<span class="property">bind</span>&lt;<span class="title class_">IUseCase</span>&lt;<span class="title class_">ExecuteWebSearchDTO</span>, <span class="title class_">WebSearchResponseDTO</span>&gt;&gt;(</span><br><span class="line">  <span class="variable constant_">TYPES</span>.<span class="property">ExecuteWebSearch</span></span><br><span class="line">).<span class="title function_">to</span>(<span class="title class_">ExecuteWebSearch</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 註冊 Service</span></span><br><span class="line">container.<span class="property">bind</span>&lt;<span class="title class_">WebSearchService</span>&gt;(</span><br><span class="line">  <span class="variable constant_">TYPES</span>.<span class="property">WebSearchService</span></span><br><span class="line">).<span class="title function_">to</span>(<span class="title class_">GoogleSearchService</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新 TYPES 常數</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">TYPES</span> = &#123;</span><br><span class="line">  <span class="comment">// ... existing types</span></span><br><span class="line">  <span class="title class_">ExecuteWebSearch</span>: <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;ExecuteWebSearch&#x27;</span>),</span><br><span class="line">  <span class="title class_">WebSearchService</span>: <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;WebSearchService&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="測試與驗證"><a href="#測試與驗證" class="headerlink" title="測試與驗證"></a>測試與驗證</h2><h3 id="準備測試環境-–-取得測試-Token"><a href="#準備測試環境-–-取得測試-Token" class="headerlink" title="準備測試環境 – 取得測試 Token"></a>準備測試環境 – 取得測試 Token</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X <span class="string">&#x27;POST&#x27;</span> <span class="string">&#x27;http://localhost:4578/api/v1/auth/login&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;accept: application/json&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;account&quot;: &quot;test_act&quot;, &quot;password&quot;: &quot;test_pwd&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="測試案例設計"><a href="#測試案例設計" class="headerlink" title="測試案例設計"></a>測試案例設計</h3><p>| AI　會自動幫我跑 End To End 測試（本來是 RD 用curl 或 postman 進行的工作）<br>| 案例的設計上也很細心，很多 RD 是只測試 Happy Case 的</p>
<h4 id="正常功能測試-happy-case"><a href="#正常功能測試-happy-case" class="headerlink" title="正常功能測試(happy case)"></a>正常功能測試(happy case)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch?keyword=nodejs&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"><span class="comment"># 預期: Google 搜尋結果 JSON</span></span><br></pre></td></tr></table></figure>

<h4 id="權限檢查失敗測試"><a href="#權限檢查失敗測試" class="headerlink" title="權限檢查失敗測試"></a>權限檢查失敗測試</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch?keyword=test&quot;</span></span><br><span class="line"><span class="comment"># 預期: &#123;&quot;error&quot;:&quot;Authentication invalid&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="參數驗證測試"><a href="#參數驗證測試" class="headerlink" title="參數驗證測試"></a>參數驗證測試</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 缺少參數</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"><span class="comment"># 預期: Zod 驗證錯誤，400 status</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 空參數</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://localhost:4578/api/v1/websearch?keyword=&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"><span class="comment"># 預期: &#123;&quot;error&quot;:[&#123;...,&quot;message&quot;:&quot;keyword 參數為必填且不能為空字串&quot;&#125;]&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="錯誤處理機制"><a href="#錯誤處理機制" class="headerlink" title="錯誤處理機制"></a>錯誤處理機制</h2><h3 id="Zod-驗證整合"><a href="#Zod-驗證整合" class="headerlink" title="Zod 驗證整合"></a>Zod 驗證整合</h3><blockquote>
<p>專案已內建 Zod 在 req&#x2F;res 檢查參數與錯誤處理有很好的表現，是團隊的開發工具之一<br>但要提醒 AI 不然他會手刻一個錯誤處理給你（刻得也不差就是了）</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// errorHandler.ts 已支援</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">ZodError</span>,</span><br><span class="line">  <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">  <span class="attr">log</span>: <span class="string">&#x27;Zod validation error&#x27;</span>,</span><br><span class="line">  <span class="attr">getMsg</span>: <span class="function">(<span class="params">err: ZodError</span>) =&gt;</span> err.<span class="property">errors</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="❌-錯誤方式：AI-手刻錯誤處理"><a href="#❌-錯誤方式：AI-手刻錯誤處理" class="headerlink" title="❌ 錯誤方式：AI 手刻錯誤處理"></a>❌ 錯誤方式：AI 手刻錯誤處理</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!keyword || <span class="keyword">typeof</span> keyword !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;keyword 參數為必填且必須是字串&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="✅-正確方式：使用-Zod"><a href="#✅-正確方式：使用-Zod" class="headerlink" title="✅ 正確方式：使用 Zod"></a>✅ 正確方式：使用 Zod</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keyword &#125; = webSearchQuerySchema.<span class="title function_">parse</span>(req.<span class="property">query</span>)</span><br></pre></td></tr></table></figure>

<p>使用 Zod 的好處：</p>
<ul>
<li>統一的錯誤格式</li>
<li>自動整合到全域錯誤處理器</li>
<li>型別安全保證</li>
</ul>
<h3 id="中介軟體執行順序"><a href="#中介軟體執行順序" class="headerlink" title="中介軟體執行順序"></a>中介軟體執行順序</h3><blockquote>
<p>重構算是這次需求的大目標，只要提示詞寫得夠好 AI 可以提供很完整的路由列表<br>而且重構的狀態也很正確，不過我的專案不大只有 30 隻左右的 API 參加價值可能不高</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">請求 → auth.user(&#x27;web_search&#x27;) → asyncWrapper → zod.parse() → 業務邏輯</span><br></pre></td></tr></table></figure>

<p>這個順序確保：</p>
<ol>
<li>先檢查身份權限</li>
<li>再進行參數驗證  </li>
<li>最後執行業務邏輯</li>
</ol>
<h2 id="Google-Custom-Search-API-整合要點"><a href="#Google-Custom-Search-API-整合要點" class="headerlink" title="Google Custom Search API 整合要點"></a>Google Custom Search API 整合要點</h2><blockquote>
<p>商業需求的主邏輯，我一行程式沒寫只與 AI 互動就完成了這個功能，包含點對點的測試<br>不過在零信任原則下，還是請其他 RD 再作一次 Code Review 與完整測試</p>
</blockquote>
<h3 id="必要參數說明"><a href="#必要參數說明" class="headerlink" title="必要參數說明"></a>必要參數說明</h3><ul>
<li><code>key</code>: Google API Key</li>
<li><code>cx</code>: Custom Search Engine ID  </li>
<li><code>q</code>: 搜尋關鍵字</li>
<li><code>num</code>: 結果數量</li>
</ul>
<h3 id="API-回應轉換"><a href="#API-回應轉換" class="headerlink" title="API 回應轉換"></a>API 回應轉換</h3><p>Google API 回應結構：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜尋結果標題&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;snippet&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜尋結果摘要&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>轉換為系統格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜尋結果標題&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜尋結果摘要&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>這次實作讓我深度體驗了 AI 與優良架構在實際專案中的運用。幾個關鍵收穫：</p>
<h3 id="架構優勢"><a href="#架構優勢" class="headerlink" title="架構優勢"></a>架構優勢</h3><ul>
<li>清晰的分層讓職責分明，測試容易</li>
<li>依賴注入讓元件可抽換，符合開放封閉原則</li>
<li>統一的錯誤處理機制，維護成本低</li>
</ul>
<p>上面是原本的優勢，加上 AI 判讀後，可以高效產生 Clean Code  </p>
<p>不太確定不良代碼會有什麼結果，很幸運是我不在那種環境之中  </p>
<p>現在三個圈圈是有交集的，好又快又便宜(產出／單位時間)，  </p>
<p>依照 AI 帶來的生產力與現有的 RD 相比，其實是很便宜的選擇。</p>
<p>良好的設計結合工具(AI)是提昇效率的手段,  </p>
<p>3 個人可以當 ７ 個人用。至於為什麼是３個人，有機會再說了。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/07/31/2025/ai_google_search_api/" data-id="cuidsTceucLX3KPyYFD09mjQp" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/07/31/2025/ai_google_search_api/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2025/ai-eai-browser-install-flatpak-solution" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2025/07/29/2025/ai-eai-browser-install-flatpak-solution/" class="article-date">
  <time datetime="2025-07-29T05:51:36.000Z" itemprop="datePublished">2025-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2025/07/29/2025/ai-eai-browser-install-flatpak-solution/"> [實作筆記] EAI 機器瀏覽器安裝問題與解決方案</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>最近拿到一個地端資源 <a target="_blank" rel="noopener" href="https://www.lannerinc.com/products/edge-ai-appliance/deep-learning-inference-appliances/eai-i233">EAI-I233</a> 開發地端 AI 應用。<br>過程中遇到了安裝瀏覽器(firefox)無法正常運作的問題。<br>經過查找資料，發現這是 Jetson Orin Nano 上的已知問題，不是個案。<br>記錄一下如何透過 Flatpak 安裝 Chromium 在 EAI 機器上，以解決瀏覽器問題。</p>
<h2 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h2><p>在 Jetson Orin Nano 等 EAI 設備上，透過 snap 安裝的 Chromium 瀏覽器會出現無法正常啟動或運行不穩定的狀況。<br>這個問題並非個案，在 NVIDIA 開發者論壇上有許多用戶回報類似問題。  </p>
<h2 id="解決方案"><a href="#解決方案" class="headerlink" title="解決方案"></a>解決方案</h2><h3 id="移除現有的-snap-版本-Chromium"><a href="#移除現有的-snap-版本-Chromium" class="headerlink" title="移除現有的 snap 版本 Chromium"></a>移除現有的 snap 版本 Chromium</h3><p>首先移除透過 snap 安裝的 Chromium：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap remove chromium</span><br></pre></td></tr></table></figure>

<h3 id="安裝與設定-Flatpak"><a href="#安裝與設定-Flatpak" class="headerlink" title="安裝與設定 Flatpak"></a>安裝與設定 Flatpak</h3><p>更新套件管理器並安裝 Flatpak：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install flatpak</span><br></pre></td></tr></table></figure>

<p>添加 Flathub 儲存庫：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo</span><br></pre></td></tr></table></figure>

<h3 id="重開機並安裝-Chromium"><a href="#重開機並安裝-Chromium" class="headerlink" title="重開機並安裝 Chromium"></a>重開機並安裝 Chromium</h3><p>重新啟動機器後，透過 Flatpak 安裝 Chromium：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重開機後執行</span></span><br><span class="line">flatpak install flathub org.chromium.Chromium</span><br></pre></td></tr></table></figure>

<h2 id="為什麼要用-Flatpak？"><a href="#為什麼要用-Flatpak？" class="headerlink" title="為什麼要用 Flatpak？"></a>為什麼要用 Flatpak？</h2><p>相比於 snap，Flatpak 在 ARM 架構的設備上有更好的相容性。<br>特別是在 Jetson 系列開發板上，Flatpak 能夠提供更穩定的套件執行環境，避免因為 snap 沙盒機制與硬體驅動互動時產生的問題。  </p>
<h2 id="一些要注意的小問題"><a href="#一些要注意的小問題" class="headerlink" title="一些要注意的小問題"></a>一些要注意的小問題</h2><p><strong>重開機是必要的</strong><br>在安裝完 Flatpak 後，務必重開機再安裝 Chromium，確保所有相依服務正確啟動。</p>
<p><strong>權限問題</strong><br>如果遇到權限問題，確認當前使用者已加入相關群組：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G sudo <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/jetson-orin-nano-browser-issue/338580/44">Jetson Orin Nano Browser Issue - NVIDIA Developer Forum</a></li>
<li><a target="_blank" rel="noopener" href="https://jetsonhacks.com/2025/07/12/why-chromium-suddenly-broke-on-jetson-orin-and-how-to-bring-it-back/">JetsonHacks: Why Chromium Suddenly Broke on Jetson Orin</a></li>
</ul>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>透過 Flatpak 安裝 Chromium 是目前在 EAI 設備上最穩定的解決方案。<br>雖然需要額外的設定步驟，但能夠有效解決 snap 版本在 ARM 架構上的相容性問題。<br>這個解決方案不僅適用於 Jetson Orin Nano，也可以應用到其他類似的 ARM 架構開發板上。<br>有機會拿到別的機器再來試試。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2025/07/29/2025/ai-eai-browser-install-flatpak-solution/" data-id="cuidOHD4l5L0Y5hsAO3szVoyh" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2025/07/29/2025/ai-eai-browser-install-flatpak-solution/#disqus_thread" class="article-comment-link">留言</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/2/">下一頁 →</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/10/29/2025/sdd_spec_kit/">[學習筆記] SDD 與 Spec Kit - 前言</a>
          </li>
        
          <li>
            <a href="/2025/09/17/2025/ai-refactor-rule-apply-dp/"> [實作筆記] 命令式程式碼重構到函數式 Pipe 流水線</a>
          </li>
        
          <li>
            <a href="/2025/09/11/2025/clean-architecture-avoid-type-hell/"> [實作筆記] Clean Architecture 思考：避免過度設計</a>
          </li>
        
          <li>
            <a href="/2025/09/05/2025/ai-hf-open-model-upload/"> [實作筆記] PaddleOCR ONNX 模型發布到 Hugging Face Hub</a>
          </li>
        
          <li>
            <a href="/2025/09/02/2025/gitlab-python-package-registry/"> [實作筆記] 建立私有 Python Package Registry - 以 ONNX Runtime 為例</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">十月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">九月 2025</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">八月 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">七月 2025</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">六月 2025</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">五月 2025</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">四月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">三月 2025</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">二月 2025</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a><span class="archive-list-count">3</span></li><span id='list_archives2' style='display:none'><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">九月 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">八月 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">八月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">6</span></li></span><span id=''></span><span onclick="var d=document.getElementById('list_archives2'); d.style.display===''?d.style='display:none':d.style=''">toggle...</span></ul>
    </div>
  </div>


  
    <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/3.0/tw/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/tw/88x31.png" />
</a>
  <br />
This work is licensed under a 
<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/3.0/tw/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Taiwan License</a>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/Net-Framework/" style="font-size: 14.67px;">.Net Framework</a> <a href="/tags/API/" style="font-size: 11.33px;">API</a> <a href="/tags/AWS/" style="font-size: 13.33px;">AWS</a> <a href="/tags/Agile/" style="font-size: 17.33px;">Agile</a> <a href="/tags/CI-CD/" style="font-size: 19.33px;">CI/CD</a> <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/Coding-Standard/" style="font-size: 10px;">Coding Standard</a> <a href="/tags/Container/" style="font-size: 12px;">Container</a> <a href="/tags/Database/" style="font-size: 12.67px;">Database</a> <a href="/tags/Design-Pattern/" style="font-size: 10.67px;">Design Pattern</a> <a href="/tags/Docker/" style="font-size: 12px;">Docker</a> <a href="/tags/Entity-Framework/" style="font-size: 10.67px;">Entity Framework</a> <a href="/tags/Firebase/" style="font-size: 10px;">Firebase</a> <a href="/tags/Git/" style="font-size: 10.67px;">Git</a> <a href="/tags/Golang/" style="font-size: 11.33px;">Golang</a> <a href="/tags/Google/" style="font-size: 11.33px;">Google</a> <a href="/tags/GulpJs/" style="font-size: 10.67px;">GulpJs</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 15.33px;">Hexo</a> <a href="/tags/IIS/" style="font-size: 10px;">IIS</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/Integrated-Testing/" style="font-size: 10px;">Integrated Testing</a> <a href="/tags/Jenkins/" style="font-size: 12px;">Jenkins</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Linux/" style="font-size: 10.67px;">Linux</a> <a href="/tags/Mongodb/" style="font-size: 10px;">Mongodb</a> <a href="/tags/MsSQL/" style="font-size: 11.33px;">MsSQL</a> <a href="/tags/MsTest/" style="font-size: 10px;">MsTest</a> <a href="/tags/Mutation-Testing/" style="font-size: 10px;">Mutation Testing</a> <a href="/tags/Nodejs/" style="font-size: 15.33px;">Nodejs</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/OOP/" style="font-size: 11.33px;">OOP</a> <a href="/tags/Openshift/" style="font-size: 10.67px;">Openshift</a> <a href="/tags/PowerShell/" style="font-size: 11.33px;">PowerShell</a> <a href="/tags/React/" style="font-size: 12px;">React</a> <a href="/tags/Redis/" style="font-size: 10.67px;">Redis</a> <a href="/tags/SQL/" style="font-size: 12px;">SQL</a> <a href="/tags/Scrum/" style="font-size: 16.67px;">Scrum</a> <a href="/tags/Shell/" style="font-size: 10.67px;">Shell</a> <a href="/tags/Specflow/" style="font-size: 10px;">Specflow</a> <a href="/tags/StyleCop/" style="font-size: 10px;">StyleCop</a> <a href="/tags/TDD/" style="font-size: 16px;">TDD</a> <a href="/tags/Testing/" style="font-size: 14px;">Testing</a> <a href="/tags/Thread/" style="font-size: 10.67px;">Thread</a> <a href="/tags/Trello/" style="font-size: 10px;">Trello</a> <a href="/tags/TypeScript/" style="font-size: 13.33px;">TypeScript</a> <a href="/tags/Unit-Testing/" style="font-size: 18.67px;">Unit Testing</a> <a href="/tags/Unix/" style="font-size: 10.67px;">Unix</a> <a href="/tags/Vim/" style="font-size: 10px;">Vim</a> <a href="/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/post/" style="font-size: 10px;">post</a> <a href="/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/" style="font-size: 18px;">學習筆記</a> <a href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" style="font-size: 20px;">實作筆記</a> <a href="/tags/%E6%99%82%E9%96%93%E7%AE%A1%E7%90%86/" style="font-size: 10.67px;">時間管理</a> <a href="/tags/%E6%B4%BB%E5%8B%95%E7%AD%86%E8%A8%98/" style="font-size: 12.67px;">活動筆記</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/" style="font-size: 16.67px;">生活筆記</a> <a href="/tags/%E8%A8%98%E9%8C%84/" style="font-size: 11.33px;">記錄</a> <a href="/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/" style="font-size: 16px;">踩雷筆記</a> <a href="/tags/%E9%87%8D%E6%A7%8B/" style="font-size: 12px;">重構</a> <a href="/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98/" style="font-size: 18px;">閱讀筆記</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Net-Framework/" rel="tag">.Net Framework</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/" rel="tag">API</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/" rel="tag">AWS</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Agile/" rel="tag">Agile</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/" rel="tag">Cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coding-Standard/" rel="tag">Coding Standard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Container/" rel="tag">Container</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/" rel="tag">Database</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Pattern/" rel="tag">Design Pattern</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Entity-Framework/" rel="tag">Entity Framework</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Firebase/" rel="tag">Firebase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google/" rel="tag">Google</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GulpJs/" rel="tag">GulpJs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IIS/" rel="tag">IIS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Integrated-Testing/" rel="tag">Integrated Testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mongodb/" rel="tag">Mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MsSQL/" rel="tag">MsSQL</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MsTest/" rel="tag">MsTest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mutation-Testing/" rel="tag">Mutation Testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/" rel="tag">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/" rel="tag">OOP</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PowerShell/" rel="tag">PowerShell</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrum/" rel="tag">Scrum</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Specflow/" rel="tag">Specflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StyleCop/" rel="tag">StyleCop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TDD/" rel="tag">TDD</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Testing/" rel="tag">Testing</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thread/" rel="tag">Thread</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Trello/" rel="tag">Trello</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unit-Testing/" rel="tag">Unit Testing</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix/" rel="tag">Unix</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Visual-Studio/" rel="tag">Visual Studio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/post/" rel="tag">post</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/" rel="tag">學習筆記</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a><span class="tag-list-count">131</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%82%E9%96%93%E7%AE%A1%E7%90%86/" rel="tag">時間管理</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B4%BB%E5%8B%95%E7%AD%86%E8%A8%98/" rel="tag">活動筆記</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/" rel="tag">生活筆記</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A8%98%E9%8C%84/" rel="tag">記錄</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/" rel="tag">踩雷筆記</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%A7%8B/" rel="tag">重構</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98/" rel="tag">閱讀筆記</a><span class="tag-list-count">15</span></li></ul>
    </div>
  </div>


  
    

  
    <div class="widget-wrap">
    <h3 class="widget-title">多語系</h3>
    <div class="widget">
        <div id="ytWidget"></div>
    </div>
</div>
<script src="https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=zh&widgetTheme=dark&autoMode=false" type="text/javascript"></script>
  
    <div class="widget-wrap">
    <h3 class="widget-title">BADGES</h3>
    <div class="widget">
        <a target="_blank" rel="noopener" href="https://bcert.me/bc/html/show-badge.html?b=uufxvngl">
            <img src="/images/2018/csm/seal-csm.png" alt="Certified ScrumMaster®">
        </a>
    </div>
</div>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 Marsen L.<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>



<script src="/js/sayings.js?v=0.js"></script>
  

<script src="/js/script.js?v=0.js"></script>

<div id="likecoin">
Please enable JavaScript to view the LikeCoin. :P
</div>
<script>

  (function(){
    var ifrm = document.createElement("iframe");
    ifrm.setAttribute("src", "https://button.like.co/in/embed/marsenlin/button?referrer=undefined");      
    ifrm.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox");
    ifrm.frameborder = "0";
    ifrm.scrolling = "no";
    (document.getElementById("likecoin").replaceChild(ifrm, document.getElementById("likecoin").childNodes[0]));
  })();

</script>
<script>

  var disqus_shortname = 'marsenlin';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

  </div>
    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NTDGNJZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

</body>
</html>