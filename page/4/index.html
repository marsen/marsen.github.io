<!DOCTYPE html>
<html>
<head>
  
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NTDGNJZ');</script>
<!-- End Google Tag Manager -->

  
<!-- Google Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RF47NNRE5G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RF47NNRE5G');
</script>
<!-- End Google Analytics -->

  
<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1885096025224905"
     crossorigin="anonymous"></script>
<!-- End Google AdSense -->



  <meta charset="utf-8">
  
  <title>Marsen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Marsen&#39;s Blog">
<meta property="og:url" content="https://blog.marsen.me/page/4/index.html">
<meta property="og:site_name" content="Marsen&#39;s Blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Marsen L.">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Marsen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
      
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
  
  
<link rel="stylesheet" href="/css/style.css">

  <meta property ="og:image" content="https://avatars1.githubusercontent.com/u/4269720?s=460&v=4" /> 
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="blog-banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Marsen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle"></a>
          <div>
          <span style="width: 20px; height: 10px; background: linear-gradient(to bottom, #005BBB 50%, #FFD700 50%); text-align: center; color: white; font-size: 6px; font-weight: bold; line-height: 100px;">
            #StandWithUkraine
          </span>
          </div>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.marsen.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2023/github_action_output_console_logs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/07/14/2023/github_action_output_console_logs/" class="article-date">
  <time datetime="2023-07-14T10:12:02.000Z" itemprop="datePublished">2023-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/07/14/2023/github_action_output_console_logs/">[實作筆記] GitHub Actions：停用 save-state 和 set-output 命令的措施</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>GitHub Actions 是一個強大的自動化工作流程工具，可讓您在 GitHub 存儲庫中執行各種自動化任務。<br>它允許您根據事件觸發工作流程，例如提交代碼或創建拉取請求。<br>您可以使用預設的操作或自定義操作來建立工作流程，並將其用於自動化測試、部署、持續集成等開發流程。<br>GitHub Actions 提供了一個靈活、可擴展和可自訂的方式來增強您的開發工作流程。</p>
<p>而我實務上的情境是用來寫 Blog，並進行自動部署，而我注意到了一個警告訊息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: The `set-output` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/</span><br></pre></td></tr></table></figure>

<h2 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h2><p>在 Github 的官方 Blog 指出，自 CI Runner 版本 2.298.2 起，<br>如果用戶在使用 save-state 或 set-output 將開始發出警告。<br>並計劃在 2023 年 5 月 31 日完全禁用它們。<br>從 2023 年 6 月 1 日開始，使用 <code>save-state</code> 或 <code>set-output</code> 命令的工作流程將因錯誤而失敗。</p>
<h3 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h3><p>實際上根據 Github 觀測數據顯示，這些命令的使用率相當高。<br>考慮到受影響的客戶數量，而推遲了移除的時間。</p>
<h2 id="我的情況"><a href="#我的情況" class="headerlink" title="我的情況"></a>我的情況</h2><p>為什麼我會用到這值呢？看看我的 CD 部署檔</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Skip ...</span></span><br><span class="line"><span class="attr">step:</span></span><br><span class="line">  <span class="comment"># Deploy hexo blog website.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">deploy</span></span><br><span class="line">    <span class="attr">uses:</span> <span class="string">marsen/hexo-action@v1.0.8</span></span><br><span class="line">    <span class="attr">with:</span></span><br><span class="line">      <span class="attr">deploy_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">the</span> <span class="string">output</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      echo &quot;$&#123;&#123; steps.deploy.outputs.notify &#125;&#125;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment">## Skip ...</span></span><br></pre></td></tr></table></figure>

<p>在我這裡有兩步驟，Deploy 　與 Get the output<br>Deploy 直接用了我的另一專案進行部署，內部的工作簡單的說明如下：</p>
<ol>
<li>用 Dockerfile 建立執行環境</li>
<li>拉取 Hexo Blog</li>
<li>執行相關指令 ex: <code>hexo g</code></li>
<li>部署完成印出成功訊息</li>
</ol>
<p>問題就出在這個第四步，在 Github Runner 啟動的 image 執行過程的輸出，<br>並不會顯示在 Action Steps 的 Output 資料之中。<br>所以在這個專案多作一步 <code>Get the output</code> 來印出這個訊息。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">the</span> <span class="string">output</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">echo</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; steps.deploy.outputs.notify &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>可以知道我們的訊息是放在 <code>steps.deploy.outputs.notify</code> 之中，<br>而原始接出資料的方式如下，這個作法即將被逃汰了(為了避免無意間的資訊外洩)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo ::set-output name=notify::&quot;Deploy complate.&quot;</span><br></pre></td></tr></table></figure>

<h2 id="解決方式"><a href="#解決方式" class="headerlink" title="解決方式"></a>解決方式</h2><p>如果官方 Blog 所說，你只要將 key-value 用以下的形式設定到環境變數 <code>$GITHUB_OUTPUT</code> 即可，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&#123;key&#125;=&#123;value&#125;&quot; &gt;&gt; $GITHUB_OUTPUT</span><br></pre></td></tr></table></figure>

<p>舉例來說:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result=&quot;Deploy complate.&quot;</span><br><span class="line">echo &quot;notify=$result&quot; &gt;&gt; $GITHUB_OUTPUT</span><br></pre></td></tr></table></figure>

<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/">GitHub Actions: Deprecating save-state and set-output commands</a></li>
<li><a href="https://blog.marsen.me/2022/09/26/2022/Hexo_CICD/">[實作筆記] Hexo CI&#x2F;CD 設置</a></li>
<li><a href="https://blog.marsen.me/2022/09/26/2022/Hexo_CICD/">[實作筆記] Hexo CI 自動執行 ncu -u 更新相依套件</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/07/14/2023/github_action_output_console_logs/" data-id="cly78744a00d82sjw1mbna3ut" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/07/14/2023/github_action_output_console_logs/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/gcp_vm_upload_file_to_gcs_answer_is_vpc_settings" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/07/12/2023/gcp_vm_upload_file_to_gcs_answer_is_vpc_settings/" class="article-date">
  <time datetime="2023-07-12T09:57:23.000Z" itemprop="datePublished">2023-07-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/07/12/2023/gcp_vm_upload_file_to_gcs_answer_is_vpc_settings/">[踩雷筆記] 移除 VM 外部 IP 後 GCS 檢查異常的問題</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>我們使用 GCP Compute Engine 建立 VM，並且配置了一個對外的 IP(External IP)，<br>同時設定了一個排程，定期將 VM 上產生的資料轉存到 GCS(Google Cloud Storage)，<br>我們主要使用的工具是 <code>gcloud</code> 並且在 VM 上設定了某個 Service Account，<br>並且一切運作順利。</p>
<p>某日因為資安考量我們移除了 VM 的 External IP，而搬檔到 GSC 的排程就異常了。<br>我們簡單使用以下指令作檢查</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud storage ls</span><br></pre></td></tr></table></figure>

<p>這個指令會列出我們 GCS 上的資源，<br>當 VM 有 External IP 時一切運作正常，而移除時會無回應。</p>
<h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><p>這裡只需要修改 GCP 的 VPC 設定，<br>選擇 subnet (ex:asia-east1，看你的 VM 在哪個 Zone)<br>啟用 Private Google access 為 On 然後存檔</p>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/54984713/how-to-read-from-a-storage-bucket-from-a-gce-vm-with-no-external-ip">How to read from a Storage bucket from a GCE VM with no External IP?</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/07/12/2023/gcp_vm_upload_file_to_gcs_answer_is_vpc_settings/" data-id="cly78744900d32sjw2z1cb13b" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/07/12/2023/gcp_vm_upload_file_to_gcs_answer_is_vpc_settings/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/" rel="tag">踩雷筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/gcp_iap_and_iam" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/07/10/2023/gcp_iap_and_iam/" class="article-date">
  <time datetime="2023-07-10T08:23:19.000Z" itemprop="datePublished">2023-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/07/10/2023/gcp_iap_and_iam/"> [實作筆記] GCP 使用 IAP 連線 VM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="簡介-IAP（Identity-Aware-Proxy"><a href="#簡介-IAP（Identity-Aware-Proxy" class="headerlink" title="簡介 IAP（Identity-Aware Proxy"></a>簡介 IAP（Identity-Aware Proxy</h2><p>GCP 的 IAP（Identity-Aware Proxy）是一個身份驗證和授權服務，<br>用於保護和管理對 Google Cloud 資源的訪問。<br>它提供了對虛擬機器（VM）實例的安全連接和控制，並可用於 SSH、RDP 等流量的安全轉發(Forwarding)。</p>
<p>通過 IAP，我們可以實現零信任訪問模型，僅允許經過身份驗證和授權的用戶訪問資源，<br>並且可以根據用戶的身份和上下文進行細粒度的訪問控制。<br>這提高了資源的安全性並減少了潛在的安全風險。</p>
<h3 id="零信任訪問模型"><a href="#零信任訪問模型" class="headerlink" title="零信任訪問模型"></a>零信任訪問模型</h3><p>零信任訪問模型（Zero Trust Access Model）是一種安全設計方法，該方法不假設內部網絡是可信的，<br>並對每個訪問請求進行驗證和授權，無論該請求來自內部還是外部網絡。<br>在零信任模型中，所有訪問都需要通過驗證和授權，並且需要進一步的身份驗證和授權步驟，<br>以確定用戶是否具有訪問資源的權限，更多可以查看參考資料。</p>
<h3 id="比較-VPN-與-RDP"><a href="#比較-VPN-與-RDP" class="headerlink" title="比較 VPN 與 RDP"></a>比較 VPN 與 RDP</h3><p>其他常見的連線方式包括傳統的虛擬專用網絡（VPN）和遠程桌面協議（RDP），<br>它們通常用於在企業內部建立安全連接，但對於雲環境和遠程用戶來說，這些方法可能不夠靈活和安全。</p>
<p>IAP 提供了一個更強大和安全的連接方式。<br>它在零信任訪問模型下工作，通過驗證和授權機制確保只有經過驗證的用戶可以訪問資源。<br>以下是 IAP 的優勢：</p>
<ul>
<li>精確的身份驗證和授權：IAP 可以根據用戶的身份和上下文進行細粒度的訪問控制，僅允許授權的用戶訪問資源。</li>
<li>無需公開 IP 地址：IAP 通過提供 IAP 隧道和代理服務，不需要公開資源的實際 IP 地址，增強了安全性。</li>
<li>雲原生和易於使用：IAP 是 GCP 的原生服務，與其他 GCP 服務整合，易於設置和管理。</li>
</ul>
<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>客戶在 GCP 上部署了多台 VM，每個 VM 都有公開的外部 IP 地址，並允許開發者使用 SSH 進行連線。<br>這樣的設置存在著安全風險，也需要為這些公開的 IP 付出額外的成本。</p>
<p>為了提高安全性並解決這個問題，我們使用 GCP 的 IAP（Identity-Aware Proxy）。<br>透過 IAP，我可以實現更安全的連線方式，不需要使用 Public IP 。<br>IAP 提供了精確的身份驗證和授權，只有經過驗證的使用者才能訪問 VM。<br>這種設置符合零信任訪問模型，提高了資源的安全性，同時減少了潛在的安全風險。</p>
<h3 id="實務操作"><a href="#實務操作" class="headerlink" title="實務操作"></a>實務操作</h3><p>我有一台測試用的 VM <code>beta</code> 已經拔除了 public IP,</p>
<ol>
<li><p>首先啟用(enable) Cloud Identity-Aware Proxy API,「Security」-&gt;「Identity-Aware Proxy」</p>
</li>
<li><p>在 IAM &gt; Permissions 找到需要登入 VM 主機的帳戶加上「IAP-secured Tunnel User」這個角色</p>
</li>
<li><p>防火牆規則，IP Range: <code>35.235.240.0/20</code>, 開通指定的 Protocols and ports，比如我們要 SSH 連線，就開通 <code>tcp:22</code>，Targets 設為 <code>Specified targets tags</code> Target tags 為 <code>ingress-from-iap</code>,</p>
</li>
<li><p>需要登入 VM 加上 tag <code>ingress-from-iap</code></p>
</li>
<li><p>可以用以下語法測試連線</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud compute ssh beta --project=my-project --zone=asia-east1-c --troubleshoot --tunnel-through-iap</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>排除所有問題後嚐試連線</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud compute ssh beta --project=my-project --zone=asia-east1-c --tunnel-through-iap</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h3 id="補充說明"><a href="#補充說明" class="headerlink" title="補充說明"></a>補充說明</h3><ul>
<li>開發環境在連線時已經透過 <code>gcloud auth login</code> 取得權限了。</li>
<li>連線的目標主機仍然需要設定 SSH 金鑰</li>
<li><code>35.235.240.0/20</code> 是 GCP 中 IAP 使用的特定 IP 範圍，不可修改</li>
</ul>
<h4 id="20230711-補充"><a href="#20230711-補充" class="headerlink" title="20230711 補充"></a>20230711 補充</h4><p>透過 IAP 連線會出現　“Increasing the IAP TCP upload bandwidth”　的警告<br>可以參考<a target="_blank" rel="noopener" href="https://cloud.google.com/iap/docs/using-tcp-forwarding#increasing_the_tcp_upload_bandwidth">官方文件</a></p>
<p>下載 Numpy</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(gcloud info --format=<span class="string">&quot;value(basic.python_location)&quot;</span>) -m pip install numpy</span></span><br></pre></td></tr></table></figure>

<p>設定環境變數</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CLOUDSDK_PYTHON_SITEPACKAGES=1</span><br></pre></td></tr></table></figure>

<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/iap/docs/concepts-overview">IAP Concepts Overview</a> ‘</li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/iap/docs/using-tcp-forwarding#preparing_your_project_for_tcp_forwarding">Preparing your project for IAP TCP forwarding</a></li>
<li><a target="_blank" rel="noopener" href="https://www.webcomm.com.tw/blog/zero-trust-security-model/">新世代資安概念：零信任安全模型介紹(Zero Trust)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-tw/learning/security/glossary/what-is-zero-trust/">Zero Trust 安全性 | 什麼是 Zero Trust 網路？</a></li>
<li><a target="_blank" rel="noopener" href="https://joehuang-pop.github.io/2020/10/25/GCP-%E4%BD%A0%E9%82%84%E5%9C%A8%E7%94%A8VPN%E9%80%A3%E7%B7%9A%E5%97%8E%EF%BC%9F-%E5%BF%AB%E9%BB%9E%E8%A9%A6%E8%A9%A6Cloud-IAP%EF%BC%8C%E8%B3%87%E5%AE%89%E6%89%8B%E6%B3%95%E5%A4%A7%E9%96%8B%E5%85%AC-Giving-it-a-Try-to-let-Cloud-IAP-protect-your-system-%E4%B8%8A/">[GCP] 你還在用 VPN 連線嗎？ 快點試試 Cloud IAP，資安手法大開公 | Giving it a Try to let Cloud IAP protect your system (上)</a></li>
<li><a target="_blank" rel="noopener" href="https://joehuang-pop.github.io/2020/10/25/GCP-%E7%B6%B2%E9%A0%81%E9%80%8F%E9%81%8ECloud-IAP%E4%BF%9D%E8%AD%B7-Giving-it-a-Try-to-let-Cloud-IAP-protect-your-system-%E4%B8%8B/">[GCP] 網頁透過 Cloud IAP 保護 | Giving it a Try to let Cloud IAP protect your system (下)</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/07/10/2023/gcp_iap_and_iam/" data-id="cly78744800cy2sjwg5imd4hs" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/07/10/2023/gcp_iap_and_iam/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/mongo_atlas_peering_gcp_vpc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/27/2023/mongo_atlas_peering_gcp_vpc/" class="article-date">
  <time datetime="2023-06-27T10:19:33.000Z" itemprop="datePublished">2023-06-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/27/2023/mongo_atlas_peering_gcp_vpc/"> [實作筆記] MongoDB 解決方案評估-- Mongo Atlas</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>最近在 VM 部署了 MongoDB, 不知道為什麼同事在 QA 與正式環境採取了兩個不同的作法，<br>因此產生了一些版本不一致的問題。<br>為此需要更換 MongoDB 版本，進而有一些討論，　　<br>決策的考量主要有兩個面向，一、維運的成本。二、實際應付的帳務成本。<br>可行的方案比較如下，</p>
<ul>
<li>VM 部署 MongoDB<ul>
<li>GCP</li>
<li>Azure</li>
<li>Other Cloud …</li>
</ul>
</li>
<li>Mongo Atlas(Start from GCP Marketing)<ul>
<li>GCP VM with MongoDB(Pay as You Go)</li>
<li>Azure VM with MongoDB</li>
</ul>
</li>
<li>Azure CosmosDB</li>
</ul>
<h2 id="實作隨筆：Mongo-Atlas-Start-from-GCP-Marketing"><a href="#實作隨筆：Mongo-Atlas-Start-from-GCP-Marketing" class="headerlink" title="實作隨筆：Mongo Atlas(Start from GCP Marketing)"></a>實作隨筆：Mongo Atlas(Start from GCP Marketing)</h2><h3 id="測試規劃"><a href="#測試規劃" class="headerlink" title="測試規劃"></a>測試規劃</h3><p><img src="/../../images/2023/mongo_atlas_test_infra.png" alt="mongo atlas 連線的測試架構"></p>
<p>如圖，為了不影響原有的環境，我打算建一組新的 VPC Network 進行實驗，<br>並在這個網路中建立一台實體的 VM 機器，待 Mongo Atlas 設定完成後，<br>進行連線的測試。</p>
<p>測試的方法，由於 MongoDB Atlas 採用一種安全性較高的連線政策，<br>必需使用以下連線集群的三種方式才可以連到資料庫:<br>第一種，IP Access List，使用 GUI 建立 Cluster 的當下會自動加入一組你所在網路對外的 IP，<br>如果不是固定 IP 可能會有問題<br>第二種，Peering ，要付錢的版本 M10 以上才可用，也是我們這次實作的重點目標<br>最後一種，Create a Private Endpoint，也是<br>M10 以上才可用，但是不是我們這次的主要實作項目，所以不過多的展開。</p>
<h3 id="從-GCP-Marketing-建立-Mongo-Atlas"><a href="#從-GCP-Marketing-建立-Mongo-Atlas" class="headerlink" title="從 GCP Marketing 建立 Mongo Atlas"></a>從 GCP Marketing 建立 Mongo Atlas</h3><p>在 GCP 的 Marketing 搜尋並訂閱 Mongo Atlas 後點擊 <code>MANAGE ON PROVIDER</code><br>在 Mongo Atlas 建立 Cluster，也可以建立 Project 與 User 作更細緻的管控。<br>這時候可以到 Network Access 查看 IP Access List 的清單，應該會有你網路上設定的對外 IP,<br>這個流程是自動化的，但是我個人認為不是固定 IP 的話可能會有問題，如果有人可以給我一些提點會十分感激。</p>
<p><img src="/../../images/2023/mongo_atlas_ip_access_list.png" alt="IP Access List"></p>
<h3 id="建立-VM"><a href="#建立-VM" class="headerlink" title="建立 VM"></a>建立 VM</h3><p><a target="_blank" rel="noopener" href="https://cloud.google.com/compute/docs/instances/create-start-instance">GCP 建立 VM</a> 是十分簡單的，就不多作說明。<br>同時記得安裝我們的<a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/mongodb-shell/install/">測試工具 - mongosh</a></p>
<h3 id="Mongo-DB-相關"><a href="#Mongo-DB-相關" class="headerlink" title="Mongo DB 相關"></a>Mongo DB 相關</h3><h4 id="切換-db"><a href="#切換-db" class="headerlink" title="切換 db"></a>切換 db</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mydb</span><br></pre></td></tr></table></figure>

<h4 id="查詢目前-DB-狀態"><a href="#查詢目前-DB-狀態" class="headerlink" title="查詢目前 DB 狀態"></a>查詢目前 DB 狀態</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.status()</span><br></pre></td></tr></table></figure>

<h4 id="Create-User"><a href="#Create-User" class="headerlink" title="Create User"></a>Create User</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(&#123; <span class="keyword">user</span>: &quot;username&quot;, pwd: &quot;password&quot;, roles: [&#123; role: &quot;roleName&quot;, db: &quot;databaseName&quot; &#125;] &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="Drop-User"><a href="#Drop-User" class="headerlink" title="Drop User"></a>Drop User</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropUser(&quot;username&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="查詢-User"><a href="#查詢-User" class="headerlink" title="查詢 User"></a>查詢 User</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getUsers()</span><br></pre></td></tr></table></figure>

<h4 id="User-加入角色"><a href="#User-加入角色" class="headerlink" title="User 加入角色"></a>User 加入角色</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grantRolesToUser(&quot;username&quot;, [&#123; role: &quot;readWriteAnyDatabase&quot;, db: &quot;mydb&quot; &#125;])</span><br></pre></td></tr></table></figure>

<h4 id="User-移除角色"><a href="#User-移除角色" class="headerlink" title="User 移除角色"></a>User 移除角色</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.revokeRolesFromUser(&quot;usernmae&quot;, [&#123; role: &quot;readWrite&quot;, db: &quot;admin&quot; &#125;])</span><br></pre></td></tr></table></figure>

<h3 id="前置作業-GCP-VPC-與-Firewall-Rules-設定"><a href="#前置作業-GCP-VPC-與-Firewall-Rules-設定" class="headerlink" title="前置作業: GCP VPC 與 Firewall Rules 設定"></a>前置作業: GCP VPC 與 Firewall Rules 設定</h3><p>為了避免影響原有的系統，<br>建立 GCP 一組新的 VPC Network : <code>vpc-lab</code>，一般來說 GCP 的專案會有自動建立一組 <code>default</code> VPC Network，<br>而 <code>default</code> VPC Network 會預設建立以下的防火牆規則</p>
<ul>
<li>default-allow-icmp – 允許來自任何來源對所有網路 IP 進行存取。ICMP 協議主要用於對目標進行 ping 測試。</li>
<li>default-allow-internal – 允許在任何埠口上的實例之間建立連接。</li>
<li>default-allow-rdp – 允許從任何來源連接到 Windows 伺服器的 RDP 會話。</li>
<li>default-allow-ssh – 允許從任何來源連接到 UNIX 伺服器的 SSH 會話。</li>
</ul>
<p>與此對應，我也建立相同的規則給<code>vpc-lab</code>，如下:</p>
<ul>
<li>vpc-lab-allow-icmp</li>
<li>vpc-lab-allow-internal</li>
<li>vpc-lab-allow-rdp</li>
<li>vpc-lab-allow-ssh</li>
</ul>
<p>可以用以下的語法測試一下網路是否能連，如果可以連線再進行 mongodb connection 的測試</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping &#123;ip address&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet &#123;ip address&#125; &#123;port&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv &#123;ip address&#125;</span><br></pre></td></tr></table></figure>

<h3 id="測試連線用的語法"><a href="#測試連線用的語法" class="headerlink" title="測試連線用的語法"></a>測試連線用的語法</h3><p>如果網路測試沒有問題，再進行 mongodb 的連線，由於目前沒有設定 Peering 連線，<br>所以在開發機上可以(網路環境需要在 IP Access List 內)，而使用 GCP VM 會無法連線，<br>開發機連線 GCP MongoDB 語法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongosh mongodb://&#123;user:pwd&#125;@&#123;mongodb_ip&#125;:27017/my_db</span><br></pre></td></tr></table></figure>

<p>開發機連線 MongoDB Atlas 語法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongosh mongodb+srv://&#123;user:pwd&#125;@&#123;atlas_cluster_name&#125;.mongodb.net/my_db</span><br></pre></td></tr></table></figure>

<h3 id="Peering-實作"><a href="#Peering-實作" class="headerlink" title="Peering 實作"></a>Peering 實作</h3><p>首先需要在 Mongo Atlas 進行設定，<br>Network Access &gt; Peering &gt; Add Peering Connection<br>在 Cloud Provider 中選擇 GCP，</p>
<p><img src="/../../images/2023/mongo_atlas_settings.png" alt="Mongo Atlas Setting"></p>
<p>設定 Project ID、VPC Name 與 Atlas CIDR，<br>比較特殊的是 Atlas CIDR 在 GUI 的說明是</p>
<blockquote>
<p>An Atlas GCP CIDR block must be a &#x2F;18 or larger.<br>You cannot modify the CIDR block if you have an existing cluster.</p>
</blockquote>
<p><strong>但我遇到的狀況是，無法修改預設值為 <code>192.168.0.0/16</code></strong><br>建立後會產生一組 Peering 的資料，請記住 Atlas GCP Project ID 與 Atlas VPC Name</p>
<p><img src="/../../images/2023/mongo_atlas_peering.png" alt="Mongo Atlas Peering"></p>
<p>接下來到 GCP &gt; VPC Network &gt; GCP Network Peering 選擇 Create peering connection<br>在 Peered VPC network 中選擇 Other Project，並填入上面的 Atlas GCP Project ID 與 Atlas VPC Name</p>
<p>大概等待一下子就會生效了(網路上寫 10 分鐘，實測不到 3 分鐘)</p>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/atlas/security-vpc-peering/">Set Up a Network Peering Connection</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.cloud-ace.tw/database/gcp-mongodb-atlas/">在 GCP 中使用 MongoDB Atlas 服務</a></li>
<li><a target="_blank" rel="noopener" href="https://geekflare.com/gcp-firewall-configuration/">How to Configure Firewall Rules in Google Cloud Platform(GCP)</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/06/27/2023/mongo_atlas_peering_gcp_vpc/" data-id="cly78744h00e92sjw38ob226p" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/06/27/2023/mongo_atlas_peering_gcp_vpc/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/100vh_problem_with_rwd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/15/2023/100vh_problem_with_rwd/" class="article-date">
  <time datetime="2023-06-15T09:05:57.000Z" itemprop="datePublished">2023-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/15/2023/100vh_problem_with_rwd/"> [實作筆記] RWD 設計與 100vh 在行動裝置瀏覽器上的誤區</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>參考圖片</p>
<p><img src="/images/2023/100vh_rwd.png" alt="RWD 設計與 100vh 在行動裝置瀏覽器上的誤區"></p>
<p>我的網頁有作 RWD 的設計，需求大概是這樣，<br>綠色是在網頁底部懸浮的選單功能，<br>紅色區塊是一個控制面版，許多的功能、按鈕、連結都設定在上面。</p>
<p>我最一開始的設定方法如下，</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">height</span>: <span class="number">100vh</span>;</span><br></pre></td></tr></table></figure>

<p>在瀏覽器上使用模擬器顯示正常，但是在手機上就會出現異常<br>主要是手機上的 Chrome 和 Firefox 瀏覽器通常在頂部有一個 UI（例如導覽列及網址列等）　　<br>而 Safari 更不同網址列在底部，這使得情況變得更加棘手。<br>不同的瀏覽器擁有不同大小的視窗，手機會計算瀏覽器視窗為（頂部工具列 + 文件 + 底部工具列）&#x3D; 100vh。<br>使用 100vh 將整個文件填充到頁面上時可能導致顯示問題，因為內容可能超出視窗範圍或被遮擋。<br>因此，在移動設備上進行響應式設計時，應該避免使用 100vh 單位。</p>
<h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><p>解決的方法有好幾種，</p>
<h3 id="JS-計算"><a href="#JS-計算" class="headerlink" title="JS 計算"></a>JS 計算</h3><p>使用 JavaScript 監聽事件，動態計算高度，缺點是效能較差，在主流的框架(EX:React)要小心觸發重新渲染的行為</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">documentHeight</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"> <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="property">documentElement</span></span><br><span class="line"> doc.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--doc-height&#x27;</span>, <span class="string">`<span class="subst">$&#123;<span class="variable language_">window</span>.innerHeight&#125;</span>px`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(‘resize’, documentHeight)</span><br><span class="line"><span class="title function_">documentHeight</span>()</span><br></pre></td></tr></table></figure>

<h3 id="CSS-變數"><a href="#CSS-變數" class="headerlink" title="CSS 變數"></a>CSS 變數</h3><p>使用 CSS 變數</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attr">--doc-height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>; <span class="comment">/* fallback for Js load */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">var</span>(--doc-height);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="min-height-與-overflow-y"><a href="#min-height-與-overflow-y" class="headerlink" title="min-height 與 overflow-y"></a>min-height 與 overflow-y</h3><p>留言有人提到使用<code>min-height</code> 與 <code>overflow-y</code><br>但我的情境不適合，而且這個作法會產生捲軸</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line"><span class="attribute">overflow-y</span>: scroll;</span><br></pre></td></tr></table></figure>

<p>進一步依照不同的使用情境也許我們需要 <code>@supports</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@supports</span> (<span class="attribute">-moz-appearance</span>: meterbar) &#123;</span><br><span class="line">  <span class="comment">/* We&#x27;re on Mozilla! */</span></span><br><span class="line">  <span class="attribute">min-height</span>: <span class="built_in">calc</span>(<span class="number">100vh</span> - <span class="number">20px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或是 Browser Hacks 的手法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">-ms-high-contrast</span>: active), (<span class="attribute">-ms-high-contrast</span>: none) &#123;</span><br><span class="line">  <span class="comment">/* We are on Internet Explorer! */</span></span><br><span class="line">  <span class="attribute">min-height</span>: <span class="built_in">calc</span>(<span class="number">100vh</span> - <span class="number">10px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="position-fixed-的作法"><a href="#position-fixed-的作法" class="headerlink" title="position:fixed 的作法"></a>position:fixed 的作法</h3><p>下面的方法可以將元素固定在畫面底部</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">position</span>: fixed;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">bottom</span>: <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>這是我最後選擇的方法，原文的討論相當精彩有趣，<br>但是我需要的其實是置底，而不是捲軸。<br>順帶一提我的專是基於 vue 與 tailwindcss，所以下面是 vue 與 tailwindcss 的寫法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;fixed bottom-0 top-0&quot;&gt;</span><br><span class="line">  &lt;!--HERE THE FEATURES--&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dev.to/nirazanbasnet/dont-use-100vh-for-mobile-responsive-3o97">Don’t use 100vh for mobile responsive</a></li>
<li><a target="_blank" rel="noopener" href="https://tools.wingzero.tw/article/sn/1463">解決手機瀏覽器(Chrome, Safari) 上設定 100vh 但會被導覽列及網址列遮掉的問題</a></li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/06/15/2023/100vh_problem_with_rwd/" data-id="cly78744000bz2sjwfugv10a8" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/06/15/2023/100vh_problem_with_rwd/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/disk_space_management:_tips_for_linux_hosts_and_gcp_vms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/09/2023/disk_space_management:_tips_for_linux_hosts_and_gcp_vms/" class="article-date">
  <time datetime="2023-06-09T06:04:02.000Z" itemprop="datePublished">2023-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/09/2023/disk_space_management:_tips_for_linux_hosts_and_gcp_vms/"> [實作筆記] 管理 Linux 主機與 GCP VM 的磁碟</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在 GCP VM 上建立的 GitLab Runner 空間不足，導致執行失敗。<br>我們需要確保 GitLab Runner 有足夠的存儲空間來運行 CI 的 Jobs 。<br>有兩個解決方案可供選擇：<br>一、是清理磁碟空間<br>透過清理磁碟空間，可以移除不需要的文件和暫存資料，釋放寶貴的儲存空間。<br>二、是擴展磁碟空間<br>而擴展磁碟空間則是增加磁碟的容量，讓 GitLab Runner 可以持續運行而不受空間限制。<br>根據具體情況，可以選擇其中一種或兩種方案來解決空間不足的問題</p>
<h2 id="第一部分：查詢與清理磁碟空間"><a href="#第一部分：查詢與清理磁碟空間" class="headerlink" title="第一部分：查詢與清理磁碟空間"></a>第一部分：查詢與清理磁碟空間</h2><p>要查詢 Linux 主機的磁碟空間，可以使用 df 命令。下面是使用 df 命令查詢磁碟空間的語法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>

<p>這將顯示磁碟空間的使用情況，包括每個檔案系統的大小、已使用的空間、可用的空間以及使用百分比。<br>要查詢特定目錄或資料夾的磁碟使用情況，可以使用 du 命令。以下是使用 du 命令查詢磁碟使用情況的語法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -h --max-depth=1 /path/to/directory</span><br></pre></td></tr></table></figure>

<p>這將顯示指定目錄或資料夾的磁碟使用情況，並以人類可讀的格式顯示結果。<br>可以查詢到一些 cache 或是 log 如果沒有必要的話，可以將之刪除。</p>
<p>要清除 Docker 的磁碟空間，可以使用以下語法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune -f</span><br></pre></td></tr></table></figure>

<h2 id="第二部分：擴展-GCP-VM-的磁碟空間"><a href="#第二部分：擴展-GCP-VM-的磁碟空間" class="headerlink" title="第二部分：擴展 GCP VM 的磁碟空間"></a>第二部分：擴展 GCP VM 的磁碟空間</h2><p>要在 GCP VM 上垂直擴展 boot 磁碟空間，可以按照以下步驟進行操作：</p>
<p>在 GCP 控制台上，找到並選擇要擴展的 VM 實例。</p>
<ul>
<li>停止 VM:前往 VM instances 找到要停止的 VM，勾選後 STOP</li>
<li>調整:前往 Disks，找到要 VM instances 所用的 Disk，點擊 Edit 後增加磁碟的大小。</li>
<li>啟動 VM 實例。</li>
</ul>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>無論是清理磁碟空間還是擴展磁碟空間，都是為了讓我能確保足夠的空間供 GitLab Runner 使用，<br>確保順利運行 CI Jobs！</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/06/09/2023/disk_space_management:_tips_for_linux_hosts_and_gcp_vms/" data-id="cly78744500cj2sjw9e8rd9au" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/06/09/2023/disk_space_management:_tips_for_linux_hosts_and_gcp_vms/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/hexo_styl_parse_failure" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/02/2023/hexo_styl_parse_failure/" class="article-date">
  <time datetime="2023-06-02T08:02:33.000Z" itemprop="datePublished">2023-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/02/2023/hexo_styl_parse_failure/">[踩雷筆記] Hexo 網站跑版</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>我的部落格是基於 Hexo 建立的靜態網站，<br>前幾天，我發佈了一篇新文章，但樣式出現了錯亂。<br>為了了解發生的問題與解決方案，必須先知道我們的架構，<br>相關的有三個儲存庫：</p>
<p><img src="/images/2023/github_page_hexo-action.png" alt="Gitlab Group"></p>
<h3 id="Github-Page"><a href="#Github-Page" class="headerlink" title="Github Page"></a><a target="_blank" rel="noopener" href="https://github.com/marsen/marsen.github.io">Github Page</a></h3><p>這是部落格的主要內容，使用 Github Page 部署。<br>通常情況下，我們不會直接對它進行修改，因為大部分的更動都是透過串接的 Github Action 自動完成的。<br>這個儲存庫代表了整個流程的最終成果。</p>
<h3 id="hexo-action"><a href="#hexo-action" class="headerlink" title="hexo action"></a><a target="_blank" rel="noopener" href="https://github.com/marsen/hexo-action">hexo action</a></h3><p>這是我們的自動化工具，結合 Github Action 可以實現持續集成與部署（CI&#x2F;CD）。<br>雖然平時不太需要特別注意，但它是相當重要的一環。</p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a><a target="_blank" rel="noopener" href="https://github.com/marsen/Marsen.Node.Hexo">Source</a></h3><p>這是我們撰寫文章的主要地方，也是整個部落格的功能和版面設計的編排處。</p>
<h2 id="問題追蹤記錄"><a href="#問題追蹤記錄" class="headerlink" title="問題追蹤記錄"></a>問題追蹤記錄</h2><p>首先檢查了網頁載入的樣式，發現找不到 <code>style.css</code> 檔案，但有 <code>style.styl</code>。<br>為了緊急處理，我先提供一個正確的 <code>style.css</code>。</p>
<p>幸好我在本地端能夠生成正確的 <code>style.css</code> 檔案，所以我先緊急上傳了一個版本到 <a target="_blank" rel="noopener" href="https://github.com/marsen/marsen.github.io">Github Page</a>。<br>重新執行本地端的測試，一切正常。再次進行部署，結果樣式又跑掉了。<br>於是我再次手動修正了 <a target="_blank" rel="noopener" href="https://github.com/marsen/marsen.github.io">Github Page</a> 的問題。</p>
<p>追查了一下 Github Action，發現在這個 commit 之後，異常情況開始發生：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&quot;hexo-renderer-stylus&quot;: &quot;^2.1.0&quot;,</span><br><span class="line">+&quot;hexo-renderer-stylus&quot;: &quot;^3.0.0&quot;,</span><br></pre></td></tr></table></figure>

<p>從這個記錄中可以得知，問題出在 <code>hexo-renderer-stylus</code> 的更新，而且是一個較大的版本變動。<br>接下來我嘗試在本地端測試，但卻沒有發現問題。<br>我開始思考是不是我的部署環境(CI&#x2F;CD)與本機環境的差異，<br>第一個是 Node 版本太舊了（12.x.x），所以我先更新了本機的 Node 版本到 20.x.x。<br>所以我修改了 <a target="_blank" rel="noopener" href="https://github.com/marsen/hexo-action">hexo action</a>，使用最新的 Node 20.x 版本的映像檔。<br>然而，重新執行部落格的持續部署作業仍然失敗，無法產生 <code>style.css</code>。</p>
<h2 id="盲點與解決方式"><a href="#盲點與解決方式" class="headerlink" title="盲點與解決方式"></a>盲點與解決方式</h2><p>在這裡我卡住了很久，始終找不到原因。<br>再次梳理持續部署的流程，結果發現我使用的 hexo-action 版本為 v1.0.5。<br>原來我忽略了一個步驟，需要為 <a target="_blank" rel="noopener" href="https://github.com/marsen/hexo-action">hexo action</a> 添加新的標籤。<br>此外，在我們的 <a target="_blank" rel="noopener" href="https://github.com/marsen/Marsen.Node.Hexo">Source</a> 的流程中(.github&#x2F;workflows)，<br>也需要修改為新的 action 標籤 <code>uses: marsen/hexo-action@v1.0.6</code>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"># Deploy hexo blog website.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">deploy</span></span><br><span class="line"><span class="bullet">-</span>     <span class="attr">uses:</span> <span class="string">marsen/hexo-action@v1.0.6</span></span><br><span class="line"><span class="string">+</span>     <span class="attr">uses:</span> <span class="string">marsen/hexo-action@v1.0.6</span></span><br></pre></td></tr></table></figure>

<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/06/02/2023/hexo_styl_parse_failure/" data-id="cly78744f00dz2sjw718ubnw5" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/06/02/2023/hexo_styl_parse_failure/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/" rel="tag">踩雷筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/docker_image_with_gitlab_registry" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/01/2023/docker_image_with_gitlab_registry/" class="article-date">
  <time datetime="2023-06-01T09:05:57.000Z" itemprop="datePublished">2023-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/01/2023/docker_image_with_gitlab_registry/"> [實作筆記] 基於 Docker 的 CI Docker 映像檔加速構建流程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在現代軟體開發的流程中，持續整合（Continuous Integration，簡稱 CI）是一個重要的概念，<br>它可以幫助開發團隊在頻繁的程式碼變更中保持項目的穩定性和品質。<br>而 Docker 作為一個輕量級的容器技術，在 CI 中也扮演著重要的角色。<br>本篇文章將介紹一個基於 Docker 的 CI Docker 映像檔（Dockerfile_project）的實作記錄(手動，未來將調整為自動化)。</p>
<h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><p>首先，這個 CI Docker 映像檔是基於 php:8.x 映像檔建立的，並且預先安裝了 composer 和 ext-mongodb 擴展。<br>這樣開發團隊在進行 PHP 項目的 CI 時，就可以直接使用這個映像檔，而不需要額外安裝這些依賴。</p>
<p>在開始使用之前，我們需要訪問 GitLab 的 Docker Registry，所以我們首先需要創建一個 Token。<br>在 GitLab 的項目設置中，可以找到「Settings &gt; Repository &gt; Deploy tokens」，<br>在這裡我們需要勾選「read_registry」和「write_registry」權限，以便於讀取和寫入映像檔。</p>
<p>接下來，我們需要使用以下指令來登錄到 GitLab 的 Docker Registry：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login $GITLAB_REGISTRY_URL -u $GITLAB_REGISTRY_USERNAME -p $GITLAB_REGISTRY_TOKEN</span><br></pre></td></tr></table></figure>

<p>登錄成功後，我們就可以開始建立映像檔了。使用以下指令可以建立映像檔：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t registry.gitlab.com/my_group/subgroup/project .</span><br></pre></td></tr></table></figure>

<p>如果你的電腦跟我一樣是 Mac M2 晶片，可以使用以下指令進行建立：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx build --platform linux/amd64 -t registry.gitlab.com/my_group/subgroup/project --load .</span><br></pre></td></tr></table></figure>

<p>最後，我們需要將建立的映像檔推送到 GitLab 的 Docker Registry 中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push registry.gitlab.com/my_group/subgroup/project</span><br></pre></td></tr></table></figure>

<p>至此，我們已經完成了 CI Docker 映像檔的建立和推送的過程。<br>現在開發團隊可以在持續整合的過程中使用這個映像檔，從而確保項目的穩定性和品質。</p>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>在本文中，我們介紹了一個基於 Docker 的 CI Docker 映像檔（Dockerfile_project）的實作步驟。<br>透過這個映像檔的建立和使用，開發團隊在持續整合（CI）過程中取得了顯著的效率提升。</p>
<p>使用這個新的 Docker 映像檔後，我們見證了從原本的 4 分鐘大幅改進至僅需 30 秒的驚人效果。<br>這意味著開發團隊現在能夠更快速地完成整個 CI 流程，並且在更短的時間內獲得即時的反饋。</p>
<p>這種效率的提升主要歸功於 Docker 的輕量級容器技術，以及映像檔中預先安裝的依賴（如 composer 和 ext-mongodb）。<br>透過這些優勢，開發團隊可以在相同的硬體資源下更有效地執行構建和測試操作，從而節省了寶貴的時間。</p>
<p>因此，使用這個新的 Docker 映像檔對於任何需要進行持續整合的專案來說都是一個明智的選擇。<br>它不僅能提升開發團隊的效率，同時也能確保項目的穩定性和品質。</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/06/01/2023/docker_image_with_gitlab_registry/" data-id="cly78744600cq2sjw2g4r6cxe" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/06/01/2023/docker_image_with_gitlab_registry/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/m2_docker_image" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/06/01/2023/m2_docker_image/" class="article-date">
  <time datetime="2023-06-01T08:33:41.000Z" itemprop="datePublished">2023-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/06/01/2023/m2_docker_image/"> [實作筆記] Mac M2 建立 Docker Image</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在我的 Gitlab-CI 當中有個步驟 — 建立 Php Image — 十分的冗贅,<br>需要花３分鐘左右安裝 ext-mongo 與 composer,<br>如果可以找到已經安裝好的 Image 版本就可以省下這３分鐘。<br>但是找不到,所以我決定自已建一個 Image 吧</p>
<h2 id="遇到的問題"><a href="#遇到的問題" class="headerlink" title="遇到的問題"></a>遇到的問題</h2><p>在構建 GitLab CI 流程時,我遇到了一個問題。<br>我在開發機上建立了 PHP 的 Docker Image,但在 Gitlab-CI Runner 運行 Image 時,<br>出現了 <em>“standard_init_linux.go:219: exec user process caused: exec format error”</em> 的錯誤。<br>這個錯誤表示容器內部執行的可執行文件格式不正確或無效。</p>
<p>進一步分析後,我意識到問題可能是由於容器映像與主機操作系統的處理器架構不兼容引起的。<br>由於我的筆電是基於 Apple M2 晶片的 Mac,它使用的是 ARM 架構,而我的 CI 使用的容器映像可能是針對 x86 架構設計的。</p>
<h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><p>Docker for Mac 提供了一個功能稱為「多架構建置（Buildx）」,它允許我們在具有不同處理器架構的環境中建立 Docker Image。<br>以下是在 Mac 上建立 x86 架構的 Docker Image 的步驟：<br>確保您已安裝 Docker for Mac,並確保 Docker 客戶端已啟用 Buildx 功能。<br>可以使用以下命令來檢查是否啟用了 Buildx：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx version</span><br></pre></td></tr></table></figure>

<p>如果 Buildx 功能已啟用,您應該能夠看到有關 Buildx 的相關訊息。</p>
<p>創建一個新的 Buildx builder,指定 x86 架構。使用以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker buildx create --name mybuilder --use</span><br><span class="line">docker buildx inspect --bootstrap</span><br></pre></td></tr></table></figure>

<p>這將創建一個名為 “mybuilder” 的 Buildx builder,並將其設置為當前使用的 builder。</p>
<p>使用新建立的 builder 建立 Docker Image。<br>在 Dockerfile 所在的目錄中執行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx build --platform linux/amd64 -t Image-name:tag .</span><br></pre></td></tr></table></figure>

<p>在這個命令中,–platform linux&#x2F;amd64 指定要建立的架構為 x86 架構。</p>
<p>為了將結果映像推送到容器倉庫,您可以加上 –push 選項,例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx build --platform linux/amd64 -t Image-name:tag --push .</span><br></pre></td></tr></table></figure>

<p>這將在建置完成後將映像推送到指定的容器倉庫。</p>
<p>如果您只是想將映像載入到本地的 Docker 中,您可以使用 –load 選項,例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx build --platform linux/amd64 -t Image-name:tag --load .</span><br></pre></td></tr></table></figure>

<p>實際上使用 <code>--load</code> 在本地端建立的 Image 因為架構不同也無法在本地端執行。</p>
<h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>使用了 Docker for Mac 的「多架構建置（Buildx）」功能,<br>讓我在 M2 Mac 上也可以成功建立 x86 架構的 Docker Image。<br>使用這個 Image 讓我可以省下 89% 的時間(3 分鐘 →20 秒)</p>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/06/01/2023/m2_docker_image/" data-id="cly78744g00e12sjwcqrzd5wy" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/06/01/2023/m2_docker_image/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2023/gitlab_ci_and_gcp_vm_secret_config" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/05/29/2023/gitlab_ci_and_gcp_vm_secret_config/" class="article-date">
  <time datetime="2023-05-29T08:41:02.000Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/05/29/2023/gitlab_ci_and_gcp_vm_secret_config/"> [實作筆記] Gitlab CI/CD 與 GCP - 機敏資料的處理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>請參考<a href="https://blog.marsen.me/2023/04/13/2023/gitlab_ci_and_gcp_vm/">前篇</a> 架構,<br>我們已經可以部署程式了.<br>更進一步討論一些實務上的狀況,這篇我們來討論如何處理一些特別的環境設定。</p>
<h2 id="功能、組態與祕密"><a href="#功能、組態與祕密" class="headerlink" title="功能、組態與祕密"></a>功能、組態與祕密</h2><p>我們的程式有時會有一些設定,依照不同情境我的分類如下：<br>功能,是指提供給使用者的設定,簡單的有訂閱通知的開關,或是回呼的 callback url 等.<br>組態,不牽扯商業邏輯,純屬系統的設定,例如：站台第三方交互的網址,Stage 的名稱等.<br>祕密,相當於組態,但是不可以外留,否則有資安風險,例如：ClientId、Token、Secret 等.</p>
<p>今天討論的會是組態與祕密,然後我想參考一些資料,<br>一個是分散系統的建議作法 <a target="_blank" rel="noopener" href="https://12factor.net/config">12 Factors - Config</a></p>
<blockquote>
<p>The twelve-factor app stores config in environment variables (often shortened to env vars or env).<br>Env vars are easy to change between deploys without changing any code; unlike config files,<br>there is little chance of them being checked into the code repo accidentally; and unlike custom config files,<br>or other config mechanisms such as Java System Properties, they are a language- and OS-agnostic standard.</p>
</blockquote>
<p>另一個是 Php Laravel 的官方作法</p>
<blockquote>
<p>Laravel utilizes the DotEnv PHP library. In a fresh Laravel installation,<br>the root directory of your application will contain a .env.example file that defines many common environment variables.<br>During the Laravel installation process, this file will automatically be copied to .env.</p>
</blockquote>
<h2 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h2><p>理想上、長遠上來我想要走到符合 12 Factory 的建議,<br>實務上考慮到現實情況和時間限制,加上我對 PHP 和 Laravel 不太熟悉：<br>現有系統的架構又不是分散式,我決定優先處理減少人為部署的工,而選擇以下的解決方案,</p>
<ol>
<li>使用 Gitlab CI&#x2F;CD 變數來保護敏感資料：<br>Gitlab 提供了 CI&#x2F;CD Variables 功能,可以將敏感資料儲存在 Group Variables 變數中</li>
<li>在 CI 過程中置換這些變數。<br>這樣可以避免將敏感資料直接寫入到 .env 檔案中,提高了安全性(至少機敏資料不會在 Teams 或 Slack 中丟來丟去,或是寫入版控)。<br>使用讀取 .env.example 檔案的方式,然後根據需要替換其中的參數值。<br>這樣一來,我們可以根據不同的環境需求,動態生成 .env 檔案,而不需要手動修改原始 .env 檔案。</li>
</ol>
<p>這樣的解決方案結合了 Gitlab CI&#x2F;CD 的變數功能和動態生成 .env 檔案的方式,使得我們能夠更安全和靈活地管理參數。<br>雖然這不是 Laravel 官方的最佳實踐,但在缺乏 Laravel 經驗的情況下,這是一個可行且有效的解決方案。</p>
<p>重要的是,這個解決方案能夠讓我們在開發過程中保護敏感資料,同時又不需要深入理解 Laravel 的配置機制。<br>希望這個解決方案能對其他面臨相同問題的開發者有所幫助。<br>如果你對於 Laravel 的配置機制比較熟悉,當然也可以探索更適合的方法來保護參數。</p>
<h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><p><img src="/images/2023/gitlab_group.png" alt="Gitlab Group"><br>如圖,GitLab Group 是 GitLab 平台上的一個功能,它允許用戶在同一組織或專案的上下文中管理多個項目,方便協作、權限管理和組織層次的控制。</p>
<p>在 GitLab 中,Group 除了提供組織和專案的管理功能外,還可以使用 CI&#x2F;CD Variables（持續整合&#x2F;持續部署變數）來保護敏感資料。<br>CI&#x2F;CD Variables 是在 GitLab CI&#x2F;CD 過程中使用的環境變數,可以在項目層級或 Group 層級定義。</p>
<p>通過 Group 層級的 CI&#x2F;CD Variables,你可以在整個 Group 內的多個專案中共享和管理變數。<br>這樣可以方便地保護和管理敏感資訊,例如 API 金鑰、密碼、配置設定等。<br>透過使用 Group 層級的 CI&#x2F;CD Variables,你可以在所有專案中統一管理這些敏感資料。</p>
<p>而下面是一段 gitlab-ci 的範例,CI 過程中讀取 Gitlab 的 Group Variables 的並生成 .env 檔</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">sed</span> <span class="string">-e</span> <span class="string">&quot;s|#&#123;APP_KEY&#125;|$APP_KEY|&quot;</span></span><br><span class="line">  <span class="string">-e</span> <span class="string">&quot;s|#&#123;GOOGLE_CLIENT_ID&#125;|$GOOGLE_CLIENT_ID|&quot;</span></span><br><span class="line">  <span class="string">-e</span> <span class="string">&quot;s|#&#123;GOOGLE_CLIENT_SECRET&#125;|$GOOGLE_CLIENT_SECRET|&quot;</span></span><br><span class="line">  <span class="string">.env.qa</span> <span class="string">&gt;</span> <span class="string">.env</span></span><br></pre></td></tr></table></figure>

<p>然後在 GCP 的 VM 加上 IAM 設定,Gitlab 對每個帳號設定適合的角色,<br>初步達成自動化與安全限制。</p>
<h2 id="可能的-更好的作法"><a href="#可能的-更好的作法" class="headerlink" title="可能的(?)更好的作法"></a>可能的(?)更好的作法</h2><ul>
<li>環境變數與分散式系統 ???</li>
<li>使用雲服務的 Secret Management ???</li>
<li>實作 Laravel Best Practice ???</li>
</ul>
<p>如果你更好的作法請推薦給我</p>
<h2 id="20230607-補充"><a href="#20230607-補充" class="headerlink" title="20230607 補充"></a>20230607 補充</h2><p>使用 CI 建置不同環境的 <code>.env</code> 檔是一件痛苦的事，再更好的方法出現前，我只能儘量減少重複，<br>下面是一個例子，我需要建立 QA 與 Production 的 <code>.env</code> 檔，<br>而我目前的作法會在 Gitlab 的 CI&#x2F;CD Variables 建立不同的 Key,<br>像是 <code>MY_QA_APP_KEY</code> 與 <code>MY_PROD_APP_KEY</code>，<br>而基礎的設定值又來自不同的檔案 <code>.env.qa</code>　與 <code>.env.production</code> apl<br>這真是一個糟糕的實作，不過為了動態組出不同的 key，<br>可以參考以下的寫法，<a target="_blank" rel="noopener" href="https://phoenixnap.com/kb/bash-single-vs-double-quotes"><strong>注意單雙引號有不同行為</strong></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.config_temp:</span> <span class="meta">&amp;config_script</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="comment"># Create Env</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;KEY:$(eval echo &#x27;$&#123;&#x27;$&#123;PREFIX&#125;&#x27;APP_KEY&#125;&#x27;)&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sed</span> <span class="string">-e</span> <span class="string">&quot;s|#&#123;APP_KEY&#125;|$(eval echo &#x27;$&#123;&#x27;$&#123;PREFIX&#125;&#x27;APP_KEY&#125;&#x27;)|&quot;</span></span><br><span class="line">      <span class="string">-e</span> <span class="string">&quot;s|#&#123;GOOGLE_CLIENT_ID&#125;|$(eval echo &#x27;$&#123;&#x27;$&#123;PREFIX&#125;&#x27;GOOGLE_CLIENT_ID&#125;&#x27;)|&quot;</span></span><br><span class="line">      <span class="string">-e</span> <span class="string">&quot;s|#&#123;GOOGLE_CLIENT_SECRET&#125;|$(eval echo &#x27;$&#123;&#x27;$&#123;PREFIX&#125;&#x27;GOOGLE_CLIENT_SECRET&#125;&#x27;)|&quot;</span></span><br><span class="line">      <span class="string">.env.$&#123;suffix&#125;</span> <span class="string">&gt;</span> <span class="string">.env</span></span><br><span class="line"><span class="comment"># 中略</span></span><br><span class="line"><span class="attr">config-qa:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">variables:</span></span><br><span class="line">    <span class="attr">PREFIX:</span> <span class="string">&quot;MY_QA_&quot;</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">&quot;qa&quot;</span></span><br><span class="line">  <span class="attr">needs:</span> [<span class="string">build</span>]</span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*config_script</span></span><br><span class="line"></span><br><span class="line"><span class="attr">config-production:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">variables:</span></span><br><span class="line">    <span class="attr">PREFIX:</span> <span class="string">&quot;MY_PROD_&quot;</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">&quot;production&quot;</span></span><br><span class="line">  <span class="attr">needs:</span> [<span class="string">build</span>]</span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*config_script</span></span><br></pre></td></tr></table></figure>

<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.consul.io/">Consul</a></li>
<li><a target="_blank" rel="noopener" href="https://12factor.net/config">12 Factors - Config</a></li>
<li><a target="_blank" rel="noopener" href="https://laravel.com/docs/10.x/configuration">Laravel Configuration</a></li>
<li>[實作筆記] Gitlab CI&#x2F;CD 與 GCP 相關文章<ul>
<li><a href="https://blog.marsen.me/2023/04/13/2023/gitlab_ci_and_gcp_vm/">架構全貌</a></li>
<li><a href="https://blog.marsen.me/2023/04/14/2023/gitlab_ci_and_gcp_vm_create_server/">建立 Web Server VM</a></li>
<li><a href="https://blog.marsen.me/2023/04/14/2023/gitlab_ci_and_gcp_vm_cretae_runner/">建立 Gitlab Runner VM</a></li>
<li><a href="https://blog.marsen.me/2023/04/14/2023/gitlab_ci_and_gcp_vm_firewall/">防火牆設定</a></li>
<li><a href="https://blog.marsen.me/2023/04/24/2023/gitlab_ci_and_gcp_vm_account/">Linux User 與資料夾權限</a></li>
<li><a href="https://blog.marsen.me/2023/05/29/2023/gitlab_ci_and_gcp_vm_secret_config/">機敏資料的處理</a></li>
<li><a href="https://blog.marsen.me/2023/11/16/2023/gitlab_ci_error_handle/">錯誤處理</a></li>
<li><a href="https://blog.marsen.me/2024/03/13/2024/gitlab_ci_and_gcp_workload_federation/">Workload Identity Federation</a></li>
<li><a href="https://blog.marsen.me/2024/04/17/2024/gitlab_ci_and_gcp_cloud_run/">Cloud Run</a></li>
</ul>
</li>
</ul>
<p>(fin)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.marsen.me/2023/05/29/2023/gitlab_ci_and_gcp_vm_secret_config/" data-id="cly78744d00dp2sjwen5uhc16" class="article-share-link">Share</a>
      
        <a href="https://blog.marsen.me/2023/05/29/2023/gitlab_ci_and_gcp_vm_secret_config/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">← 上一頁</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/5/">下一頁 →</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/07/03/2024/azure_vm_for_nvidia/">[實作筆記] 初體驗設定 Nvidia GPU 的 Azure VM</a>
          </li>
        
          <li>
            <a href="/2024/07/01/2024/azure_vm_snapshot/"> [實作筆記] 建立 Azure VM 的快照(Snapshot)</a>
          </li>
        
          <li>
            <a href="/2024/06/14/2024/my_tools_2024/">[生活筆記] 2024 常用工具整理</a>
          </li>
        
          <li>
            <a href="/2024/06/07/2024/azure_email_communication_service/"> [實作筆記] Azure Communication Services email</a>
          </li>
        
          <li>
            <a href="/2024/05/14/2024/gitlab_ci_and_gcs_as_static_site/"> [踩雷筆記] Gitlab CI/CD 與 GCP - 靜態網站部署整合 404 與 `/`</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a><span class="archive-list-count">2</span></li><span id='list_archives2' style='display:none'><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">八月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">6</span></li></span><span id=''></span><span onclick="var d=document.getElementById('list_archives2'); d.style.display===''?d.style='display:none':d.style=''">toggle...</span></ul>
    </div>
  </div>


  
    <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/3.0/tw/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/tw/88x31.png" />
</a>
  <br />
This work is licensed under a 
<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/3.0/tw/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Taiwan License</a>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/Net-Framework/" style="font-size: 14.67px;">.Net Framework</a> <a href="/tags/API/" style="font-size: 11.33px;">API</a> <a href="/tags/AWS/" style="font-size: 13.33px;">AWS</a> <a href="/tags/Agile/" style="font-size: 17.33px;">Agile</a> <a href="/tags/CI-CD/" style="font-size: 19.33px;">CI/CD</a> <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/Coding-Standard/" style="font-size: 10px;">Coding Standard</a> <a href="/tags/Container/" style="font-size: 12px;">Container</a> <a href="/tags/Database/" style="font-size: 12.67px;">Database</a> <a href="/tags/Design-Pattern/" style="font-size: 10.67px;">Design Pattern</a> <a href="/tags/Docker/" style="font-size: 12px;">Docker</a> <a href="/tags/Entity-Framework/" style="font-size: 10.67px;">Entity Framework</a> <a href="/tags/Firebase/" style="font-size: 10px;">Firebase</a> <a href="/tags/Git/" style="font-size: 10.67px;">Git</a> <a href="/tags/Golang/" style="font-size: 11.33px;">Golang</a> <a href="/tags/Google/" style="font-size: 11.33px;">Google</a> <a href="/tags/GulpJs/" style="font-size: 10.67px;">GulpJs</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 15.33px;">Hexo</a> <a href="/tags/IIS/" style="font-size: 10px;">IIS</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/Integrated-Testing/" style="font-size: 10px;">Integrated Testing</a> <a href="/tags/Jenkins/" style="font-size: 12px;">Jenkins</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Linux/" style="font-size: 10.67px;">Linux</a> <a href="/tags/Mongodb/" style="font-size: 10px;">Mongodb</a> <a href="/tags/MsSQL/" style="font-size: 11.33px;">MsSQL</a> <a href="/tags/MsTest/" style="font-size: 10px;">MsTest</a> <a href="/tags/Mutation-Testing/" style="font-size: 10px;">Mutation Testing</a> <a href="/tags/Nodejs/" style="font-size: 15.33px;">Nodejs</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/OOP/" style="font-size: 11.33px;">OOP</a> <a href="/tags/Openshift/" style="font-size: 10.67px;">Openshift</a> <a href="/tags/PowerShell/" style="font-size: 11.33px;">PowerShell</a> <a href="/tags/React/" style="font-size: 12px;">React</a> <a href="/tags/Redis/" style="font-size: 10.67px;">Redis</a> <a href="/tags/SQL/" style="font-size: 12px;">SQL</a> <a href="/tags/Scrum/" style="font-size: 16.67px;">Scrum</a> <a href="/tags/Shell/" style="font-size: 10.67px;">Shell</a> <a href="/tags/Specflow/" style="font-size: 10px;">Specflow</a> <a href="/tags/StyleCop/" style="font-size: 10px;">StyleCop</a> <a href="/tags/TDD/" style="font-size: 16px;">TDD</a> <a href="/tags/Testing/" style="font-size: 14px;">Testing</a> <a href="/tags/Thread/" style="font-size: 10.67px;">Thread</a> <a href="/tags/Trello/" style="font-size: 10px;">Trello</a> <a href="/tags/TypeScript/" style="font-size: 13.33px;">TypeScript</a> <a href="/tags/Unit-Testing/" style="font-size: 18.67px;">Unit Testing</a> <a href="/tags/Unix/" style="font-size: 10.67px;">Unix</a> <a href="/tags/Vim/" style="font-size: 10px;">Vim</a> <a href="/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/post/" style="font-size: 10px;">post</a> <a href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" style="font-size: 20px;">實作筆記</a> <a href="/tags/%E6%99%82%E9%96%93%E7%AE%A1%E7%90%86/" style="font-size: 10.67px;">時間管理</a> <a href="/tags/%E6%B4%BB%E5%8B%95%E7%AD%86%E8%A8%98/" style="font-size: 12.67px;">活動筆記</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/" style="font-size: 16px;">生活筆記</a> <a href="/tags/%E8%A8%98%E9%8C%84/" style="font-size: 11.33px;">記錄</a> <a href="/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/" style="font-size: 14.67px;">踩雷筆記</a> <a href="/tags/%E9%87%8D%E6%A7%8B/" style="font-size: 12px;">重構</a> <a href="/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98/" style="font-size: 18px;">閱讀筆記</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Net-Framework/" rel="tag">.Net Framework</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/" rel="tag">API</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/" rel="tag">AWS</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Agile/" rel="tag">Agile</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/" rel="tag">Cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coding-Standard/" rel="tag">Coding Standard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Container/" rel="tag">Container</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/" rel="tag">Database</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Pattern/" rel="tag">Design Pattern</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Entity-Framework/" rel="tag">Entity Framework</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Firebase/" rel="tag">Firebase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google/" rel="tag">Google</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GulpJs/" rel="tag">GulpJs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IIS/" rel="tag">IIS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Integrated-Testing/" rel="tag">Integrated Testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mongodb/" rel="tag">Mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MsSQL/" rel="tag">MsSQL</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MsTest/" rel="tag">MsTest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mutation-Testing/" rel="tag">Mutation Testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/" rel="tag">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/" rel="tag">OOP</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PowerShell/" rel="tag">PowerShell</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrum/" rel="tag">Scrum</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Specflow/" rel="tag">Specflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StyleCop/" rel="tag">StyleCop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TDD/" rel="tag">TDD</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Testing/" rel="tag">Testing</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thread/" rel="tag">Thread</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Trello/" rel="tag">Trello</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unit-Testing/" rel="tag">Unit Testing</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix/" rel="tag">Unix</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Visual-Studio/" rel="tag">Visual Studio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/post/" rel="tag">post</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/" rel="tag">實作筆記</a><span class="tag-list-count">112</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%82%E9%96%93%E7%AE%A1%E7%90%86/" rel="tag">時間管理</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B4%BB%E5%8B%95%E7%AD%86%E8%A8%98/" rel="tag">活動筆記</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB%E7%AD%86%E8%A8%98/" rel="tag">生活筆記</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A8%98%E9%8C%84/" rel="tag">記錄</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B8%A9%E9%9B%B7%E7%AD%86%E8%A8%98/" rel="tag">踩雷筆記</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%A7%8B/" rel="tag">重構</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98/" rel="tag">閱讀筆記</a><span class="tag-list-count">15</span></li></ul>
    </div>
  </div>


  
    

  
    <div class="widget-wrap">
    <h3 class="widget-title">多語系</h3>
    <div class="widget">
        <div id="ytWidget"></div>
    </div>
</div>
<script src="https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=zh&widgetTheme=dark&autoMode=false" type="text/javascript"></script>
  
    <div class="widget-wrap">
    <h3 class="widget-title">BADGES</h3>
    <div class="widget">
        <a target="_blank" rel="noopener" href="https://bcert.me/bc/html/show-badge.html?b=uufxvngl">
            <img src="/images/2018/csm/seal-csm.png" alt="Certified ScrumMaster®">
        </a>
    </div>
</div>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 Marsen L.<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>



<script src="/js/sayings.js?v=0.js"></script>
  

<script src="/js/script.js?v=0.js"></script>

<div id="likecoin">
Please enable JavaScript to view the LikeCoin. :P
</div>
<script>

  (function(){
    var ifrm = document.createElement("iframe");
    ifrm.setAttribute("src", "https://button.like.co/in/embed/marsenlin/button?referrer=undefined");      
    ifrm.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox");
    ifrm.frameborder = "0";
    ifrm.scrolling = "no";
    (document.getElementById("likecoin").replaceChild(ifrm, document.getElementById("likecoin").childNodes[0]));
  })();

</script>
<script>

  var disqus_shortname = 'marsenlin';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

  </div>
    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NTDGNJZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

</body>
</html>